[0m17:52:31.748567 [info ] [Thread-2 (]: 19 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m17:52:31.751081 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m17:52:31.751787 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m17:52:31.759282 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m17:52:31.761069 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m17:52:31.769783 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m17:52:31.774026 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m17:52:31.775717 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m17:52:31.981208 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.002 seconds
[0m17:52:31.981208 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBC170A710>]}
[0m17:52:31.981208 [info ] [Thread-4 (]: 17 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 1.01s]
[0m17:52:31.990652 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m17:52:31.992081 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m17:52:31.992081 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m17:52:31.992081 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.031 seconds
[0m17:52:31.992081 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m17:52:31.992081 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBC16BB910>]}
[0m17:52:31.992081 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m17:52:31.992081 [info ] [Thread-3 (]: 16 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 1.07s]
[0m17:52:32.003158 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m17:52:32.003158 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m17:52:32.003158 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m17:52:32.003158 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m17:52:32.003158 [info ] [Thread-3 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m17:52:32.003158 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m17:52:32.003158 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m17:52:32.003158 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m17:52:32.016902 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m17:52:32.021652 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m17:52:32.022652 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m17:52:32.024653 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m17:52:32.029163 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m17:52:32.032418 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m17:52:32.032418 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m17:52:32.448535 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.789 seconds
[0m17:52:32.448535 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBC0E26590>]}
[0m17:52:32.448535 [info ] [Thread-5 (]: 18 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 0.81s]
[0m17:52:32.448535 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m17:52:32.448535 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m17:52:32.448535 [info ] [Thread-5 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m17:52:32.448535 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m17:52:32.448535 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m17:52:32.458885 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m17:52:32.458885 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m17:52:32.470552 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m17:52:32.470552 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m17:52:32.480916 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m17:52:32.550331 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.774 seconds
[0m17:52:32.554353 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBC1464DD0>]}
[0m17:52:32.554353 [info ] [Thread-2 (]: 19 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 0.81s]
[0m17:52:32.558794 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m17:52:32.558794 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m17:52:32.558794 [info ] [Thread-2 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m17:52:32.558794 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m17:52:32.558794 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m17:52:32.558794 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m17:52:32.558794 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m17:52:32.569746 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m17:52:32.575376 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m17:52:32.575376 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m17:52:32.825717 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.794 seconds
[0m17:52:32.829833 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBC16FA290>]}
[0m17:52:32.829833 [info ] [Thread-3 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 0.83s]
[0m17:52:32.829833 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m17:52:32.829833 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m17:52:32.829833 [info ] [Thread-3 (]: 24 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m17:52:32.829833 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m17:52:32.829833 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m17:52:32.838000 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m17:52:32.839223 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m17:52:32.842194 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m17:52:32.843422 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m17:52:32.843956 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m17:52:32.903066 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.880 seconds
[0m17:52:32.907206 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBC271F750>]}
[0m17:52:32.907206 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 0.91s]
[0m17:52:32.907206 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m17:52:32.909218 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m17:52:32.909218 [info ] [Thread-4 (]: 25 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m17:52:32.909218 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m17:52:32.911228 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m17:52:32.914345 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m17:52:32.914345 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m17:52:32.914345 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m17:52:32.922581 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m17:52:32.922581 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m17:52:33.692115 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.849 seconds
[0m17:52:33.694281 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBC13F0950>]}
[0m17:52:33.694281 [info ] [Thread-3 (]: 24 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 0.86s]
[0m17:52:33.694281 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m17:52:33.694281 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m17:52:33.694281 [info ] [Thread-3 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m17:52:33.694281 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_position_attribution, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m17:52:33.694281 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m17:52:33.705361 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m17:52:33.705361 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m17:52:33.709371 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m17:52:33.711375 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m17:52:33.711375 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m17:52:33.725587 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.149 seconds
[0m17:52:33.725587 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBC0F26C50>]}
[0m17:52:33.836611 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.914 seconds
[0m17:52:33.836611 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBC281A1D0>]}
[0m17:52:34.525843 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.048 seconds
[0m17:52:34.525843 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.818 seconds
[0m17:52:34.537668 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBAE2A6510>]}
[0m17:52:34.539081 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '028a4627-efa0-4e11-976a-e1b99656548f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBC27AB7D0>]}
[0m17:52:34.752179 [debug] [Thread-2 (]: An error was encountered while trying to send an event
[0m17:52:34.752179 [info ] [Thread-4 (]: 25 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 0.93s]
[0m17:52:34.752179 [info ] [Thread-5 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 2.09s]
[0m17:52:34.756681 [info ] [Thread-3 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 0.84s]
[0m17:52:34.757256 [info ] [Thread-2 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.17s]
[0m17:52:34.758808 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m17:52:34.758808 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m17:52:34.758808 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m17:52:34.758808 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m17:52:34.758808 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:52:34.758808 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m17:52:34.758808 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m17:52:35.540376 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m17:52:35.540376 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m17:52:36.236445 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_executive_summary' was left open.
[0m17:52:36.236445 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m17:52:37.003101 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m17:52:37.003101 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m17:52:37.729190 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_performance_drivers' was left open.
[0m17:52:37.729190 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m17:52:38.396990 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m17:52:38.398073 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m17:52:39.033488 [info ] [MainThread]: 
[0m17:52:39.033488 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 16.36 seconds (16.36s).
[0m17:52:39.036601 [debug] [MainThread]: Command end result
[0m17:52:39.069830 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:52:39.069830 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:52:39.080957 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m17:52:39.080957 [info ] [MainThread]: 
[0m17:52:39.080957 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:52:39.080957 [info ] [MainThread]: 
[0m17:52:39.080957 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m17:52:39.080957 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:52:39.080957 [debug] [MainThread]: Command `dbt build` succeeded at 17:52:39.080957 after 18.18 seconds
[0m17:52:39.092098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBAE250310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBAE2518D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BBAE252710>]}
[0m17:52:39.092098 [debug] [MainThread]: Flushing usage events
[0m17:52:39.914602 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:53:55.984298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000148F2A9C290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000148F28400D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000148F28421D0>]}


============================== 17:53:55.990981 | d7628a6c-c172-4df4-a919-8e6db9323196 ==============================
[0m17:53:55.990981 [info ] [MainThread]: Running with dbt=1.11.2
[0m17:53:55.993013 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m17:53:56.568696 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m17:53:56.568696 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m17:53:56.568696 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m17:53:56.680041 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m17:53:56.685738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd7628a6c-c172-4df4-a919-8e6db9323196', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014884E964D0>]}
[0m17:53:56.824029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd7628a6c-c172-4df4-a919-8e6db9323196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014884FBB0D0>]}
[0m17:53:56.879612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd7628a6c-c172-4df4-a919-8e6db9323196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000148F1A754D0>]}
[0m17:53:56.879612 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m17:53:57.212967 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m17:53:57.390697 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:53:57.390697 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m17:53:57.390697 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:53:57.405959 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m17:53:57.447160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd7628a6c-c172-4df4-a919-8e6db9323196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014884F7D190>]}
[0m17:53:57.588161 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:53:57.592422 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:53:57.624173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd7628a6c-c172-4df4-a919-8e6db9323196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014885280710>]}
[0m17:53:57.624173 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m17:53:57.635192 [info ] [MainThread]: 
[0m17:53:57.635192 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:53:57.635192 [info ] [MainThread]: 
[0m17:53:57.635192 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:53:57.644762 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m17:53:57.701877 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m17:53:57.713184 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m17:53:57.713942 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:53:59.741194 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.027 seconds
[0m17:53:59.757221 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m17:53:59.777054 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m17:53:59.777054 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m17:53:59.777054 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:54:01.313370 [debug] [ThreadPool]: SQL status: SUCCESS 87 in 1.538 seconds
[0m17:54:01.324112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd7628a6c-c172-4df4-a919-8e6db9323196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014885992990>]}
[0m17:54:01.335224 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:54:01.335224 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:54:01.335224 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m17:54:01.335224 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m17:54:01.335224 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m17:54:01.335224 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m17:54:01.335224 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:54:01.335224 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:54:01.346373 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:54:01.346373 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:54:01.346373 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:54:01.379642 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:54:01.379642 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:54:01.387294 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:54:01.387294 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:54:01.387294 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m17:54:01.390641 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:54:01.390641 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:54:01.390641 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m17:54:01.390641 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:54:04.313696 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.925 seconds
[0m17:54:04.313696 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.925 seconds
[0m17:54:04.346199 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd7628a6c-c172-4df4-a919-8e6db9323196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014885A57ED0>]}
[0m17:54:04.346199 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd7628a6c-c172-4df4-a919-8e6db9323196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014885DBBB90>]}
[0m17:54:04.357273 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.01s]
[0m17:54:04.357273 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.01s]
[0m17:54:04.357273 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:54:04.357273 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:54:04.357273 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:54:04.357273 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:54:04.357273 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m17:54:04.357273 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m17:54:04.357273 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m17:54:04.368424 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m17:54:04.368424 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:54:04.368424 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:54:04.368424 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:54:04.368424 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:54:04.379503 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:54:04.379503 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:54:04.379503 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:54:04.468353 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:54:04.479535 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:54:04.479535 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:54:04.479535 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m17:54:04.479535 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m17:54:04.479535 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m17:54:06.411478 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.928 seconds
[0m17:54:06.412893 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd7628a6c-c172-4df4-a919-8e6db9323196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014884F5F9D0>]}
[0m17:54:06.412893 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 2.04s]
[0m17:54:06.412893 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:54:06.913512 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.433 seconds
[0m17:54:06.913512 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd7628a6c-c172-4df4-a919-8e6db9323196', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014884F96C90>]}
[0m17:54:06.913512 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 2.56s]
[0m17:54:06.913512 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:54:06.924046 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:54:06.924046 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m17:54:06.924046 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m17:54:07.616640 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m17:54:07.616640 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m17:54:08.351358 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m17:54:08.351358 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m17:54:09.016329 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m17:54:09.016329 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m17:54:09.686619 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m17:54:09.686619 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m17:54:10.437786 [info ] [MainThread]: 
[0m17:54:10.437786 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 12.80 seconds (12.80s).
[0m17:54:10.437786 [debug] [MainThread]: Command end result
[0m17:54:10.480384 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:54:10.480384 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:54:10.490751 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m17:54:10.490751 [info ] [MainThread]: 
[0m17:54:10.490751 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:54:10.490751 [info ] [MainThread]: 
[0m17:54:10.490751 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m17:54:10.490751 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:54:10.490751 [debug] [MainThread]: Command `dbt build` succeeded at 17:54:10.490751 after 14.59 seconds
[0m17:54:10.490751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000148EBE47D10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000148EBE47CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014885AAB410>]}
[0m17:54:10.490751 [debug] [MainThread]: Flushing usage events
[0m17:54:11.600624 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:54:33.405448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E2165D550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E2165FBD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E2165E750>]}


============================== 17:54:33.405448 | 94e2828e-89fd-4b99-abd6-8a6564afd30c ==============================
[0m17:54:33.405448 [info ] [MainThread]: Running with dbt=1.11.2
[0m17:54:33.405448 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_b', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m17:54:34.020789 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m17:54:34.020789 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m17:54:34.022793 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m17:54:34.123783 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m17:54:34.123783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E339C4E90>]}
[0m17:54:34.279045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E33A7D750>]}
[0m17:54:34.334665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E2064D490>]}
[0m17:54:34.334665 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m17:54:34.690900 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m17:54:34.883032 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:54:34.883032 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m17:54:34.883032 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:54:34.890280 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m17:54:34.934782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E33F841D0>]}
[0m17:54:35.056854 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:54:35.060323 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:54:35.101187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E33E026D0>]}
[0m17:54:35.104275 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m17:54:35.110388 [info ] [MainThread]: 
[0m17:54:35.112338 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:54:35.113188 [info ] [MainThread]: 
[0m17:54:35.113929 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:54:35.113929 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m17:54:35.201535 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m17:54:35.201535 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m17:54:35.201535 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:54:37.260202 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.056 seconds
[0m17:54:37.260202 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m17:54:37.281322 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m17:54:37.282324 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m17:54:37.283323 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:54:39.059583 [debug] [ThreadPool]: SQL status: SUCCESS 87 in 1.780 seconds
[0m17:54:39.067985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E33A7D1D0>]}
[0m17:54:39.080873 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m17:54:39.080873 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m17:54:39.080873 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m17:54:39.080873 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m17:54:39.080873 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m17:54:39.080873 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m17:54:39.080873 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m17:54:39.080873 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m17:54:39.080873 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m17:54:39.080873 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m17:54:39.080873 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m17:54:39.088922 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m17:54:39.090034 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m17:54:39.090034 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m17:54:39.090034 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m17:54:39.090034 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m17:54:39.090034 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m17:54:39.101289 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m17:54:39.101289 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m17:54:39.101289 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m17:54:39.101289 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m17:54:39.112268 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m17:54:39.112268 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m17:54:39.123541 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m17:54:39.134575 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m17:54:39.134575 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m17:54:39.145704 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m17:54:39.145704 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m17:54:39.145704 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m17:54:39.145704 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m17:54:39.145704 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m17:54:39.156811 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m17:54:39.156811 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m17:54:39.156811 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m17:54:39.156811 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m17:54:39.156811 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m17:54:39.156811 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:54:39.156811 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:54:39.156811 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:54:39.156811 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m17:54:41.069195 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.910 seconds
[0m17:54:41.092681 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E349B2AD0>]}
[0m17:54:41.092681 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.01s]
[0m17:54:41.092681 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m17:54:41.101606 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.939 seconds
[0m17:54:41.101606 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E33B36B50>]}
[0m17:54:41.101606 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.01s]
[0m17:54:41.101606 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m17:54:41.234907 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.073 seconds
[0m17:54:41.234907 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E34205810>]}
[0m17:54:41.234907 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 2.15s]
[0m17:54:41.234907 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m17:54:41.234907 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m17:54:41.234907 [info ] [Thread-2 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m17:54:41.234907 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m17:54:41.234907 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m17:54:41.245759 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m17:54:41.245759 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m17:54:41.252656 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m17:54:41.254662 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m17:54:41.254662 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m17:54:41.368483 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.209 seconds
[0m17:54:41.368483 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E349A6D10>]}
[0m17:54:41.379131 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.29s]
[0m17:54:41.380167 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m17:54:42.101423 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.846 seconds
[0m17:54:42.104809 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E33B35C90>]}
[0m17:54:42.104809 [info ] [Thread-2 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.87s]
[0m17:54:42.106819 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m17:54:42.106819 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m17:54:42.108830 [info ] [Thread-4 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m17:54:42.108830 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m17:54:42.108830 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m17:54:42.112728 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m17:54:42.112728 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m17:54:42.112728 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m17:54:42.112728 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m17:54:42.112728 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m17:54:43.079339 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.960 seconds
[0m17:54:43.079339 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E206DA8D0>]}
[0m17:54:43.090061 [info ] [Thread-4 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 0.97s]
[0m17:54:43.090061 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m17:54:43.090061 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m17:54:43.090061 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m17:54:43.090061 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m17:54:43.090061 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m17:54:43.090061 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m17:54:43.090061 [info ] [Thread-2 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m17:54:43.090061 [info ] [Thread-5 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m17:54:43.096319 [info ] [Thread-4 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m17:54:43.096319 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m17:54:43.096319 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m17:54:43.096319 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m17:54:43.096319 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m17:54:43.096319 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m17:54:43.096319 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m17:54:43.101067 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m17:54:43.101804 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m17:54:43.101804 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m17:54:43.107709 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m17:54:43.115646 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m17:54:43.119104 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m17:54:43.120347 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m17:54:43.121494 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m17:54:43.122025 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m17:54:43.128108 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m17:54:43.128643 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m17:54:43.132228 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m17:54:43.136747 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m17:54:43.140645 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m17:54:43.141398 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m17:54:43.142709 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m17:54:43.145697 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m17:54:43.145697 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m17:54:43.147001 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m17:54:43.147001 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m17:54:43.147001 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m17:54:43.147001 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m17:54:43.998498 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.849 seconds
[0m17:54:44.003478 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E34867A90>]}
[0m17:54:44.004476 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 0.91s]
[0m17:54:44.005476 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m17:54:44.033784 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.882 seconds
[0m17:54:44.038867 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E34A31BD0>]}
[0m17:54:44.039787 [info ] [Thread-2 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 0.94s]
[0m17:54:44.040824 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m17:54:44.127410 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.974 seconds
[0m17:54:44.130701 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E3433AA90>]}
[0m17:54:44.131662 [info ] [Thread-4 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.03s]
[0m17:54:44.132660 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m17:54:44.133584 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m17:54:44.133584 [info ] [Thread-3 (]: 11 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m17:54:44.134554 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m17:54:44.135586 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m17:54:44.138239 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m17:54:44.139219 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m17:54:44.143220 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m17:54:44.145220 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m17:54:44.145530 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m17:54:44.155110 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.003 seconds
[0m17:54:44.157635 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E34A75290>]}
[0m17:54:44.158623 [info ] [Thread-5 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.06s]
[0m17:54:44.159615 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m17:54:44.160638 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m17:54:44.161637 [info ] [Thread-4 (]: 12 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m17:54:44.162615 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m17:54:44.162615 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m17:54:44.166636 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m17:54:44.167685 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m17:54:44.171685 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m17:54:44.173685 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m17:54:44.174685 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m17:54:45.002919 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.856 seconds
[0m17:54:45.007723 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E34AC48D0>]}
[0m17:54:45.008691 [info ] [Thread-3 (]: 11 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 0.87s]
[0m17:54:45.009691 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m17:54:45.112798 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.940 seconds
[0m17:54:45.112798 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94e2828e-89fd-4b99-abd6-8a6564afd30c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E346F9A10>]}
[0m17:54:45.123547 [info ] [Thread-4 (]: 12 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 0.95s]
[0m17:54:45.123547 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m17:54:45.123547 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:54:45.123547 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m17:54:45.123547 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m17:54:45.839658 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m17:54:45.839658 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m17:54:46.573609 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m17:54:46.575613 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m17:54:47.243939 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m17:54:47.243939 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m17:54:47.900242 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m17:54:47.900242 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m17:54:48.574726 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_execution_analysis' was left open.
[0m17:54:48.576715 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: Close
[0m17:54:49.266910 [info ] [MainThread]: 
[0m17:54:49.267983 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 14.15 seconds (14.15s).
[0m17:54:49.267983 [debug] [MainThread]: Command end result
[0m17:54:49.300941 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:54:49.300941 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:54:49.315020 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m17:54:49.315020 [info ] [MainThread]: 
[0m17:54:49.315020 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:54:49.315020 [info ] [MainThread]: 
[0m17:54:49.315020 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m17:54:49.315020 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:54:49.315020 [debug] [MainThread]: Command `dbt build` succeeded at 17:54:49.315020 after 15.99 seconds
[0m17:54:49.315020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E1AA17D10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E1AA17CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E2079DE50>]}
[0m17:54:49.315020 [debug] [MainThread]: Flushing usage events
[0m17:54:50.236754 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:55:25.263302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002610AFDC9D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002610AFCFF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002610AFDC850>]}


============================== 17:55:25.267290 | 7232f952-2732-41e1-80b8-f083bcb7e24d ==============================
[0m17:55:25.267290 [info ] [MainThread]: Running with dbt=1.11.2
[0m17:55:25.267290 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m17:55:25.901216 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m17:55:25.901216 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m17:55:25.901216 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m17:55:26.011674 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m17:55:26.011674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '7232f952-2732-41e1-80b8-f083bcb7e24d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002610AFD0910>]}
[0m17:55:26.156053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7232f952-2732-41e1-80b8-f083bcb7e24d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002611D40CE90>]}
[0m17:55:26.211615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7232f952-2732-41e1-80b8-f083bcb7e24d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026109FBD490>]}
[0m17:55:26.211615 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m17:55:26.533938 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m17:55:26.722592 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:55:26.722592 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m17:55:26.722592 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:55:26.722592 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m17:55:26.778299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7232f952-2732-41e1-80b8-f083bcb7e24d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002610B041990>]}
[0m17:55:26.889408 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:55:26.889408 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:55:26.933779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7232f952-2732-41e1-80b8-f083bcb7e24d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002611DB87050>]}
[0m17:55:26.933779 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m17:55:26.933779 [info ] [MainThread]: 
[0m17:55:26.933779 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:55:26.933779 [info ] [MainThread]: 
[0m17:55:26.933779 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:55:26.945138 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m17:55:27.022929 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m17:55:27.022929 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m17:55:27.022929 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:55:29.060465 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.033 seconds
[0m17:55:29.067205 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m17:55:29.078230 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m17:55:29.078230 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m17:55:29.087196 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:55:30.656398 [debug] [ThreadPool]: SQL status: SUCCESS 87 in 1.574 seconds
[0m17:55:30.675641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7232f952-2732-41e1-80b8-f083bcb7e24d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002611D955490>]}
[0m17:55:30.678147 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:55:30.678147 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:55:30.678147 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m17:55:30.678147 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m17:55:30.678147 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m17:55:30.678147 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m17:55:30.678147 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:55:30.678147 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:55:30.689412 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:55:30.689412 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:55:30.689412 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:55:30.689412 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:55:30.724207 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:55:30.731866 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:55:30.733723 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:55:30.734917 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m17:55:30.734917 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:55:30.734917 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:55:30.734917 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m17:55:30.734917 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:55:33.650840 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.913 seconds
[0m17:55:33.667084 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7232f952-2732-41e1-80b8-f083bcb7e24d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002611DCBAE50>]}
[0m17:55:33.667084 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 2.99s]
[0m17:55:33.667084 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:55:33.667084 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:55:33.667084 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m17:55:33.667084 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m17:55:33.667084 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:55:33.678189 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:55:33.679068 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:55:33.679068 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:55:33.679068 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:55:33.679068 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m17:55:33.679068 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m17:55:33.735660 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.999 seconds
[0m17:55:33.735660 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7232f952-2732-41e1-80b8-f083bcb7e24d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002611E439C10>]}
[0m17:55:33.739574 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.06s]
[0m17:55:33.741585 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:55:33.742620 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:55:33.743158 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m17:55:33.744785 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m17:55:33.745886 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:55:33.833779 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:55:33.833779 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:55:33.841541 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:55:33.844777 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:55:33.845862 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m17:55:35.367792 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.524 seconds
[0m17:55:35.367792 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7232f952-2732-41e1-80b8-f083bcb7e24d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002611DB811D0>]}
[0m17:55:35.367792 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.62s]
[0m17:55:35.367792 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:55:36.490006 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.806 seconds
[0m17:55:36.490006 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7232f952-2732-41e1-80b8-f083bcb7e24d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002611E43A7D0>]}
[0m17:55:36.501232 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 2.82s]
[0m17:55:36.501232 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:55:36.501232 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:55:36.501232 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m17:55:36.501232 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m17:55:37.195365 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m17:55:37.197381 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m17:55:37.885587 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m17:55:37.885587 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m17:55:38.578344 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m17:55:38.578860 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m17:55:39.227074 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m17:55:39.227074 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m17:55:39.926235 [info ] [MainThread]: 
[0m17:55:39.928240 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 12.99 seconds (12.99s).
[0m17:55:39.928240 [debug] [MainThread]: Command end result
[0m17:55:39.967068 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:55:39.967068 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:55:39.967068 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m17:55:39.967068 [info ] [MainThread]: 
[0m17:55:39.967068 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:55:39.978125 [info ] [MainThread]: 
[0m17:55:39.978125 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m17:55:39.978125 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:55:39.978125 [debug] [MainThread]: Command `dbt build` succeeded at 17:55:39.978125 after 14.79 seconds
[0m17:55:39.978125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002610AD6DDD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000261043D7E50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002610AC98490>]}
[0m17:55:39.978125 [debug] [MainThread]: Flushing usage events
[0m17:55:41.109500 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:56:15.400498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6FF53C090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6FF53FF90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6FF53E550>]}


============================== 17:56:15.410945 | b66e5919-4e2d-4cd9-9521-ea4e400fb4ed ==============================
[0m17:56:15.410945 [info ] [MainThread]: Running with dbt=1.11.2
[0m17:56:15.410945 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m17:56:15.977675 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m17:56:15.977675 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m17:56:15.977675 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m17:56:16.088721 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m17:56:16.088721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b66e5919-4e2d-4cd9-9521-ea4e400fb4ed', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6919C9550>]}
[0m17:56:16.233059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b66e5919-4e2d-4cd9-9521-ea4e400fb4ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6919DCA10>]}
[0m17:56:16.309388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b66e5919-4e2d-4cd9-9521-ea4e400fb4ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6FE509410>]}
[0m17:56:16.311492 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m17:56:16.666481 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m17:56:16.833547 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:56:16.833547 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m17:56:16.833547 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:56:16.844383 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m17:56:16.888644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b66e5919-4e2d-4cd9-9521-ea4e400fb4ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C68F67F350>]}
[0m17:56:17.010873 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:56:17.010873 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:56:17.044276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b66e5919-4e2d-4cd9-9521-ea4e400fb4ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C691D85450>]}
[0m17:56:17.055928 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m17:56:17.056400 [info ] [MainThread]: 
[0m17:56:17.056400 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:56:17.056400 [info ] [MainThread]: 
[0m17:56:17.056400 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:56:17.056400 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m17:56:17.121894 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m17:56:17.121894 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m17:56:17.121894 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:56:19.066989 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 1.939 seconds
[0m17:56:19.077521 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m17:56:19.088724 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m17:56:19.088724 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m17:56:19.092929 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:56:20.672831 [debug] [ThreadPool]: SQL status: SUCCESS 87 in 1.580 seconds
[0m17:56:20.694057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b66e5919-4e2d-4cd9-9521-ea4e400fb4ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6927B7110>]}
[0m17:56:20.698869 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:56:20.699753 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:56:20.701205 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m17:56:20.702973 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m17:56:20.703962 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m17:56:20.705208 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m17:56:20.705743 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:56:20.706851 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:56:20.714923 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:56:20.719437 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:56:20.720443 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:56:20.721652 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:56:20.761610 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:56:20.762577 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:56:20.763500 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:56:20.764501 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m17:56:20.765502 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:56:20.766340 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:56:20.767392 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m17:56:20.767392 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:56:23.566722 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.799 seconds
[0m17:56:23.588615 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.823 seconds
[0m17:56:23.591121 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b66e5919-4e2d-4cd9-9521-ea4e400fb4ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C692268810>]}
[0m17:56:23.591121 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b66e5919-4e2d-4cd9-9521-ea4e400fb4ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C692286B90>]}
[0m17:56:23.591121 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 2.88s]
[0m17:56:23.591121 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 2.89s]
[0m17:56:23.591121 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:56:23.591121 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:56:23.591121 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:56:23.591121 [info ] [Thread-3 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m17:56:23.591121 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m17:56:23.599651 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:56:23.599651 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:56:23.599651 [info ] [Thread-4 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m17:56:23.599651 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:56:23.599651 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m17:56:23.599651 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:56:23.610862 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:56:23.610862 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:56:23.678249 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:56:23.678249 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:56:23.682268 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:56:23.684278 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:56:23.686286 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m17:56:23.686286 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:56:23.688520 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m17:56:23.689551 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:56:25.077692 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.391 seconds
[0m17:56:25.077692 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b66e5919-4e2d-4cd9-9521-ea4e400fb4ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C69291CB10>]}
[0m17:56:25.077692 [info ] [Thread-3 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.49s]
[0m17:56:25.077692 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:56:26.467000 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.777 seconds
[0m17:56:26.467000 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b66e5919-4e2d-4cd9-9521-ea4e400fb4ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C691A04890>]}
[0m17:56:26.467000 [info ] [Thread-4 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 2.87s]
[0m17:56:26.467000 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:56:26.467000 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:56:26.467000 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m17:56:26.467000 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m17:56:27.181720 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m17:56:27.181720 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m17:56:27.847097 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m17:56:27.847097 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m17:56:28.544765 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m17:56:28.544765 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m17:56:29.233247 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m17:56:29.233247 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m17:56:29.937580 [info ] [MainThread]: 
[0m17:56:29.937580 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 12.88 seconds (12.88s).
[0m17:56:29.937580 [debug] [MainThread]: Command end result
[0m17:56:29.977300 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:56:29.977300 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:56:29.977300 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m17:56:29.977300 [info ] [MainThread]: 
[0m17:56:29.977300 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:56:29.977300 [info ] [MainThread]: 
[0m17:56:29.977300 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m17:56:29.977300 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:56:29.988595 [debug] [MainThread]: Command `dbt build` succeeded at 17:56:29.988595 after 14.66 seconds
[0m17:56:29.988595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6FF5AC210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6FF5AE710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C6FF5ACCD0>]}
[0m17:56:29.988595 [debug] [MainThread]: Flushing usage events
[0m17:56:30.900172 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:57:06.098960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4A1139D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4A173DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4A172590>]}


============================== 17:57:06.110269 | 3da07190-cfeb-4290-b4fb-13a421e1dd8d ==============================
[0m17:57:06.110269 [info ] [MainThread]: Running with dbt=1.11.2
[0m17:57:06.110269 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_b', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m17:57:06.689959 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m17:57:06.690884 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m17:57:06.691952 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m17:57:06.788077 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m17:57:06.788077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5C529890>]}
[0m17:57:06.945007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5C534490>]}
[0m17:57:06.999037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D490ED410>]}
[0m17:57:07.010004 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m17:57:07.332434 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m17:57:07.510253 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:57:07.510253 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m17:57:07.510253 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:57:07.521189 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m17:57:07.576749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5BCB9350>]}
[0m17:57:07.687858 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:57:07.687858 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:57:07.721254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5CCCABD0>]}
[0m17:57:07.721254 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m17:57:07.721254 [info ] [MainThread]: 
[0m17:57:07.721254 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:57:07.721254 [info ] [MainThread]: 
[0m17:57:07.721254 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:57:07.733284 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m17:57:07.798956 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m17:57:07.798956 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m17:57:07.798956 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:57:09.770037 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 1.966 seconds
[0m17:57:09.777095 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m17:57:09.821516 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m17:57:09.821516 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m17:57:09.821516 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:57:11.704424 [debug] [ThreadPool]: SQL status: SUCCESS 87 in 1.877 seconds
[0m17:57:11.718772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5D0E8850>]}
[0m17:57:11.721121 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m17:57:11.721121 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m17:57:11.721121 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m17:57:11.721121 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m17:57:11.721121 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m17:57:11.721121 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m17:57:11.721121 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m17:57:11.721121 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m17:57:11.721121 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m17:57:11.721121 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m17:57:11.721121 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m17:57:11.732294 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m17:57:11.732294 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m17:57:11.732294 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m17:57:11.732294 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m17:57:11.732294 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m17:57:11.732294 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m17:57:11.743499 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m17:57:11.743499 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m17:57:11.743499 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m17:57:11.754535 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m17:57:11.754535 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m17:57:11.754535 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m17:57:11.765720 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m17:57:11.776806 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m17:57:11.782383 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m17:57:11.782383 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m17:57:11.787759 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m17:57:11.787759 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m17:57:11.787759 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m17:57:11.787759 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m17:57:11.787759 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m17:57:11.787759 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m17:57:11.787759 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m17:57:11.787759 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m17:57:11.787759 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:57:11.798923 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m17:57:11.798923 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:57:11.798923 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:57:11.800859 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m17:57:13.721449 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.925 seconds
[0m17:57:13.743283 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5C5A7390>]}
[0m17:57:13.743283 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.02s]
[0m17:57:13.743283 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m17:57:13.788356 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.991 seconds
[0m17:57:13.788356 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5D500890>]}
[0m17:57:13.788356 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.07s]
[0m17:57:13.788356 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m17:57:13.832929 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.035 seconds
[0m17:57:13.842044 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5D4E2550>]}
[0m17:57:13.843519 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 2.12s]
[0m17:57:13.843519 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m17:57:13.888420 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.089 seconds
[0m17:57:13.888420 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5C5EEF10>]}
[0m17:57:13.898924 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.16s]
[0m17:57:13.898924 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m17:57:13.898924 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m17:57:13.898924 [info ] [Thread-2 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m17:57:13.898924 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m17:57:13.898924 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m17:57:13.898924 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m17:57:13.898924 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m17:57:13.910097 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m17:57:13.912158 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m17:57:13.914164 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m17:57:14.772066 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.857 seconds
[0m17:57:14.776532 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D49F55850>]}
[0m17:57:14.778349 [info ] [Thread-2 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.88s]
[0m17:57:14.778349 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m17:57:14.780336 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m17:57:14.781342 [info ] [Thread-4 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m17:57:14.782341 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m17:57:14.783342 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m17:57:14.788914 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m17:57:14.790982 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m17:57:14.798865 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m17:57:14.800937 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m17:57:14.802945 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m17:57:15.743256 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.940 seconds
[0m17:57:15.749352 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5C565B90>]}
[0m17:57:15.749352 [info ] [Thread-4 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 0.97s]
[0m17:57:15.751359 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m17:57:15.753810 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m17:57:15.754326 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m17:57:15.754904 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m17:57:15.755470 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m17:57:15.755470 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m17:57:15.755470 [info ] [Thread-2 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m17:57:15.755470 [info ] [Thread-5 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m17:57:15.755470 [info ] [Thread-4 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m17:57:15.755470 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m17:57:15.755470 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m17:57:15.755470 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m17:57:15.755470 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m17:57:15.755470 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m17:57:15.755470 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m17:57:15.755470 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m17:57:15.755470 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m17:57:15.766073 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m17:57:15.766073 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m17:57:15.766073 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m17:57:15.776428 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m17:57:15.776428 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m17:57:15.776428 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m17:57:15.776428 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m17:57:15.776428 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m17:57:15.776428 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m17:57:15.787699 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m17:57:15.787699 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m17:57:15.794678 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m17:57:15.794678 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m17:57:15.794678 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m17:57:15.794678 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m17:57:15.799347 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m17:57:15.799347 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m17:57:15.799347 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m17:57:15.799347 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m17:57:15.799347 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m17:57:16.680117 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.879 seconds
[0m17:57:16.692801 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5D4269D0>]}
[0m17:57:16.695520 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 0.93s]
[0m17:57:16.697060 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m17:57:16.723538 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.922 seconds
[0m17:57:16.732685 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5CCBAED0>]}
[0m17:57:16.744821 [info ] [Thread-2 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 0.98s]
[0m17:57:16.747069 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.945 seconds
[0m17:57:16.757370 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m17:57:16.765670 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5C582BD0>]}
[0m17:57:16.765670 [info ] [Thread-5 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.01s]
[0m17:57:16.765670 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m17:57:16.765670 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m17:57:16.765670 [info ] [Thread-3 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m17:57:16.779302 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m17:57:16.779302 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m17:57:16.788310 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m17:57:16.788310 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m17:57:16.799016 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m17:57:16.799016 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m17:57:16.809905 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m17:57:16.880684 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.073 seconds
[0m17:57:16.885693 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5D2A52D0>]}
[0m17:57:16.889515 [info ] [Thread-4 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.13s]
[0m17:57:16.892757 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m17:57:16.894770 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m17:57:16.896444 [info ] [Thread-5 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m17:57:16.897555 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m17:57:16.898648 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m17:57:16.907993 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m17:57:16.909607 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m17:57:16.920715 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m17:57:16.924371 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m17:57:16.926495 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m17:57:17.713657 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.784 seconds
[0m17:57:17.719897 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5C4BC590>]}
[0m17:57:17.720804 [info ] [Thread-5 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 0.82s]
[0m17:57:17.722302 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m17:57:17.733954 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.923 seconds
[0m17:57:17.736164 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3da07190-cfeb-4290-b4fb-13a421e1dd8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5C537E50>]}
[0m17:57:17.737427 [info ] [Thread-3 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 0.96s]
[0m17:57:17.738420 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m17:57:17.740327 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:57:17.740327 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m17:57:17.741360 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m17:57:18.432779 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m17:57:18.432779 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m17:57:19.131718 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m17:57:19.132129 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m17:57:19.799624 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m17:57:19.803376 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m17:57:20.467806 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_summary' was left open.
[0m17:57:20.467806 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m17:57:21.123998 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m17:57:21.123998 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m17:57:21.808887 [info ] [MainThread]: 
[0m17:57:21.809843 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 14.09 seconds (14.09s).
[0m17:57:21.810428 [debug] [MainThread]: Command end result
[0m17:57:21.855395 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:57:21.857401 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:57:21.863415 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m17:57:21.863415 [info ] [MainThread]: 
[0m17:57:21.863415 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:57:21.865381 [info ] [MainThread]: 
[0m17:57:21.865381 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m17:57:21.865381 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:57:21.865381 [debug] [MainThread]: Command `dbt build` succeeded at 17:57:21.865381 after 15.85 seconds
[0m17:57:21.865381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D43547D50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5C8F1BD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D43547CD0>]}
[0m17:57:21.865381 [debug] [MainThread]: Flushing usage events
[0m17:57:22.955574 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:57:53.975995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001421029C610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001421029DA90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001421029C0D0>]}


============================== 17:57:53.975995 | 57e03515-3b1c-4d39-b7ca-2e7c7be2b21b ==============================
[0m17:57:53.975995 [info ] [MainThread]: Running with dbt=1.11.2
[0m17:57:53.975995 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m17:57:54.709303 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m17:57:54.710354 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m17:57:54.710354 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m17:57:54.844356 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m17:57:54.845496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '57e03515-3b1c-4d39-b7ca-2e7c7be2b21b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014221685E50>]}
[0m17:57:55.012782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '57e03515-3b1c-4d39-b7ca-2e7c7be2b21b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001421F1BC7D0>]}
[0m17:57:55.076145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '57e03515-3b1c-4d39-b7ca-2e7c7be2b21b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001420E2A9350>]}
[0m17:57:55.076145 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m17:57:55.443695 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m17:57:55.631482 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:57:55.631482 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m17:57:55.631482 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:57:55.643580 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m17:57:55.687080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '57e03515-3b1c-4d39-b7ca-2e7c7be2b21b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000142217AB550>]}
[0m17:57:55.798304 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:57:55.798304 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:57:55.842811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '57e03515-3b1c-4d39-b7ca-2e7c7be2b21b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014221E8BA50>]}
[0m17:57:55.843946 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m17:57:55.843946 [info ] [MainThread]: 
[0m17:57:55.843946 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:57:55.843946 [info ] [MainThread]: 
[0m17:57:55.843946 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:57:55.853964 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m17:57:55.909325 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m17:57:55.909325 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m17:57:55.909325 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:57:57.937728 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.020 seconds
[0m17:57:57.942803 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m17:57:57.959815 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m17:57:57.959815 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m17:57:57.959815 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:57:59.567081 [debug] [ThreadPool]: SQL status: SUCCESS 87 in 1.610 seconds
[0m17:57:59.584242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57e03515-3b1c-4d39-b7ca-2e7c7be2b21b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000142216EEAD0>]}
[0m17:57:59.586936 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:57:59.586936 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:57:59.586936 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m17:57:59.586936 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m17:57:59.586936 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m17:57:59.586936 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m17:57:59.586936 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:57:59.586936 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:57:59.598211 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:57:59.606128 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:57:59.606128 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:57:59.606128 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:57:59.634234 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:57:59.634234 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:57:59.634234 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m17:57:59.634234 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m17:57:59.634234 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m17:57:59.634234 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m17:57:59.634234 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m17:57:59.642747 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:58:02.598865 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.957 seconds
[0m17:58:02.632673 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57e03515-3b1c-4d39-b7ca-2e7c7be2b21b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001422262A110>]}
[0m17:58:02.632673 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.04s]
[0m17:58:02.632673 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m17:58:02.632673 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:58:02.632673 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m17:58:02.632673 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m17:58:02.632673 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:58:02.644593 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:58:02.646599 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:58:02.650610 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:58:02.653626 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m17:58:02.653626 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m17:58:02.653626 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m17:58:02.753871 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.113 seconds
[0m17:58:02.765179 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57e03515-3b1c-4d39-b7ca-2e7c7be2b21b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000142224F9DD0>]}
[0m17:58:02.765179 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.17s]
[0m17:58:02.765179 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m17:58:02.765179 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:58:02.765179 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m17:58:02.765179 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m17:58:02.775880 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:58:02.846813 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:58:02.846813 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:58:02.854956 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:58:02.856883 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m17:58:02.857970 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m17:58:04.398865 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.543 seconds
[0m17:58:04.409504 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57e03515-3b1c-4d39-b7ca-2e7c7be2b21b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000142217C2150>]}
[0m17:58:04.409504 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.64s]
[0m17:58:04.409504 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m17:58:05.220808 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.566 seconds
[0m17:58:05.220808 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57e03515-3b1c-4d39-b7ca-2e7c7be2b21b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000142217315D0>]}
[0m17:58:05.220808 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 2.59s]
[0m17:58:05.220808 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m17:58:05.220808 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:58:05.220808 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m17:58:05.220808 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m17:58:06.038686 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m17:58:06.038686 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m17:58:06.765058 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m17:58:06.765058 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m17:58:07.431421 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m17:58:07.431421 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m17:58:08.178385 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m17:58:08.179476 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m17:58:08.874090 [info ] [MainThread]: 
[0m17:58:08.876072 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 13.03 seconds (13.03s).
[0m17:58:08.876815 [debug] [MainThread]: Command end result
[0m17:58:08.909295 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m17:58:08.909295 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m17:58:08.920347 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m17:58:08.920347 [info ] [MainThread]: 
[0m17:58:08.920347 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:58:08.920347 [info ] [MainThread]: 
[0m17:58:08.920347 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m17:58:08.920347 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m17:58:08.920347 [debug] [MainThread]: Command `dbt build` succeeded at 17:58:08.920347 after 15.03 seconds
[0m17:58:08.920347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014208707D10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014208707CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000142222EEF90>]}
[0m17:58:08.920347 [debug] [MainThread]: Flushing usage events
[0m17:58:10.054784 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:25:02.451896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223F502E390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223F502F1D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223F502F610>]}


============================== 01:25:02.457254 | f085998b-338f-4107-819b-5cc0577e19a6 ==============================
[0m01:25:02.457254 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:25:02.457254 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m01:25:03.820095 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:25:03.821654 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:25:03.822868 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:25:03.938978 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:25:03.938978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f085998b-338f-4107-819b-5cc0577e19a6', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223874B7F10>]}
[0m01:25:04.146609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f085998b-338f-4107-819b-5cc0577e19a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223874CDE90>]}
[0m01:25:04.217600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f085998b-338f-4107-819b-5cc0577e19a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223F401D050>]}
[0m01:25:04.217600 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:25:04.607770 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:25:04.982429 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:25:04.982429 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://seeds\sample_trades.csv
[0m01:25:05.218970 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:25:05.248513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f085998b-338f-4107-819b-5cc0577e19a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002238785CB10>]}
[0m01:25:05.378399 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:25:05.378399 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:25:05.435920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f085998b-338f-4107-819b-5cc0577e19a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022387EA07D0>]}
[0m01:25:05.435920 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:25:05.435920 [info ] [MainThread]: 
[0m01:25:05.435920 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:25:05.435920 [info ] [MainThread]: 
[0m01:25:05.435920 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:25:05.447839 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:25:05.511347 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:25:05.511347 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:25:05.511347 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:25:09.806408 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 4.299 seconds
[0m01:25:09.822611 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:25:09.839276 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:25:09.839276 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:25:09.839276 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:25:12.529241 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.680 seconds
[0m01:25:12.544016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f085998b-338f-4107-819b-5cc0577e19a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022387C7F8D0>]}
[0m01:25:12.544016 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:25:12.544016 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:25:12.559656 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:25:12.561017 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:25:12.561017 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:25:12.561017 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:25:12.563029 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:25:12.563029 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:25:12.571070 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:25:12.575584 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:25:12.575584 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:25:12.607080 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:25:12.607080 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:25:12.607080 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:25:12.607080 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:25:12.607080 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:25:12.622884 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:25:12.623627 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:25:12.623627 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:25:12.623627 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:25:16.434047 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.812 seconds
[0m01:25:16.465027 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f085998b-338f-4107-819b-5cc0577e19a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022387510250>]}
[0m01:25:16.465027 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.90s]
[0m01:25:16.465027 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:25:16.465027 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:25:16.465027 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:25:16.465027 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m01:25:16.465027 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:25:16.476849 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:25:16.476849 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:25:16.480701 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:25:16.480701 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:25:16.480701 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:25:16.480701 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:25:16.775881 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 4.151 seconds
[0m01:25:16.775881 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f085998b-338f-4107-819b-5cc0577e19a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022387520090>]}
[0m01:25:16.775881 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 4.21s]
[0m01:25:16.775881 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:25:16.775881 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:25:16.775881 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:25:16.788080 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m01:25:16.788080 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:25:16.791618 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:25:16.791618 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:25:16.791618 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:25:16.801923 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:25:16.801923 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:25:17.995227 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.192 seconds
[0m01:25:18.003299 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f085998b-338f-4107-819b-5cc0577e19a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223F47B3A10>]}
[0m01:25:18.005312 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.21s]
[0m01:25:18.005312 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:25:19.953242 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.466 seconds
[0m01:25:19.959709 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f085998b-338f-4107-819b-5cc0577e19a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002238849DFD0>]}
[0m01:25:19.959709 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 3.49s]
[0m01:25:19.959709 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:25:19.959709 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:25:19.967784 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:25:19.967784 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:25:20.924244 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:25:20.926254 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:25:21.954940 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:25:21.956966 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:25:23.270068 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m01:25:23.270068 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m01:25:24.195310 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:25:24.196402 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:25:25.739496 [info ] [MainThread]: 
[0m01:25:25.743523 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 20.30 seconds (20.30s).
[0m01:25:25.747551 [debug] [MainThread]: Command end result
[0m01:25:25.789170 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:25:25.789170 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:25:25.789170 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:25:25.789170 [info ] [MainThread]: 
[0m01:25:25.789170 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:25:25.789170 [info ] [MainThread]: 
[0m01:25:25.805041 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:25:25.805041 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:25:25.805041 [debug] [MainThread]: Command `dbt build` succeeded at 01:25:25.805041 after 23.45 seconds
[0m01:25:25.805041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223EE417950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223EE4179D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223EE41CB90>]}
[0m01:25:25.805041 [debug] [MainThread]: Flushing usage events
[0m01:25:29.146023 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:25:47.216605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E8639D150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E8639D190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E8639DC90>]}


============================== 01:25:47.216605 | 9bbdbc3d-1849-458e-b3ae-0a7071e5766c ==============================
[0m01:25:47.216605 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:25:47.216605 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m01:25:47.857551 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:25:47.857551 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:25:47.857551 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:25:47.968982 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:25:47.968982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9bbdbc3d-1849-458e-b3ae-0a7071e5766c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E98754910>]}
[0m01:25:48.142565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9bbdbc3d-1849-458e-b3ae-0a7071e5766c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E987CD610>]}
[0m01:25:48.206028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9bbdbc3d-1849-458e-b3ae-0a7071e5766c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E8538D050>]}
[0m01:25:48.206028 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:25:48.603289 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:25:48.850312 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:25:48.850312 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:25:48.850312 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:25:48.850312 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m01:25:48.913938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9bbdbc3d-1849-458e-b3ae-0a7071e5766c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E98CBBF90>]}
[0m01:25:49.028758 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:25:49.041384 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:25:49.073299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9bbdbc3d-1849-458e-b3ae-0a7071e5766c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E99010490>]}
[0m01:25:49.073299 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:25:49.083867 [info ] [MainThread]: 
[0m01:25:49.083867 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:25:49.083867 [info ] [MainThread]: 
[0m01:25:49.083867 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:25:49.089120 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:25:49.152458 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:25:49.152458 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:25:49.152458 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:25:52.820595 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.658 seconds
[0m01:25:52.832083 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:25:52.848717 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:25:52.848717 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:25:52.848717 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:25:55.725675 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.874 seconds
[0m01:25:55.743137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9bbdbc3d-1849-458e-b3ae-0a7071e5766c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E95A4EB10>]}
[0m01:25:55.747459 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:25:55.747459 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:25:55.747459 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:25:55.747459 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:25:55.747459 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:25:55.747459 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:25:55.747459 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:25:55.747459 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:25:55.760904 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:25:55.762909 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:25:55.762909 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:25:55.803021 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:25:55.803863 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:25:55.813829 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:25:55.816022 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:25:55.816022 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:25:55.816022 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:25:55.818979 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:25:55.818979 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:25:55.818979 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:25:59.679481 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.860 seconds
[0m01:25:59.679481 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.863 seconds
[0m01:25:59.696158 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bbdbc3d-1849-458e-b3ae-0a7071e5766c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E98DD73D0>]}
[0m01:25:59.696158 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bbdbc3d-1849-458e-b3ae-0a7071e5766c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E9957A8D0>]}
[0m01:25:59.696158 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.95s]
[0m01:25:59.696158 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.95s]
[0m01:25:59.696158 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:25:59.711338 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:25:59.711338 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:25:59.711338 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:25:59.711338 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:25:59.711338 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:25:59.711338 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m01:25:59.711338 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m01:25:59.711338 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:25:59.711338 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:25:59.711338 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:25:59.727209 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:25:59.727209 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:25:59.727209 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:25:59.727209 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:25:59.727209 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:25:59.727209 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:25:59.727209 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:25:59.727209 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:25:59.727209 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:25:59.743086 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:26:01.316874 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.574 seconds
[0m01:26:01.316874 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bbdbc3d-1849-458e-b3ae-0a7071e5766c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E995C9FD0>]}
[0m01:26:01.316874 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.61s]
[0m01:26:01.333831 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:26:03.057912 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.317 seconds
[0m01:26:03.057912 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bbdbc3d-1849-458e-b3ae-0a7071e5766c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E997EC5D0>]}
[0m01:26:03.057912 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.35s]
[0m01:26:03.057912 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:26:03.067202 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:26:03.067202 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:26:03.067202 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:26:03.746733 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:26:03.749436 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:26:04.783485 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m01:26:04.783485 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m01:26:05.949461 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:26:05.949461 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:26:07.107914 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:26:07.107914 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:26:08.056036 [info ] [MainThread]: 
[0m01:26:08.060234 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 18.97 seconds (18.97s).
[0m01:26:08.060234 [debug] [MainThread]: Command end result
[0m01:26:08.144940 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:26:08.153058 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:26:08.169582 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:26:08.171591 [info ] [MainThread]: 
[0m01:26:08.171591 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:26:08.171591 [info ] [MainThread]: 
[0m01:26:08.171591 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:26:08.171591 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:26:08.179660 [debug] [MainThread]: Command `dbt build` succeeded at 01:26:08.177646 after 21.05 seconds
[0m01:26:08.182588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024EFF7B7950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024EFF7B79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E988AC690>]}
[0m01:26:08.184602 [debug] [MainThread]: Flushing usage events
[0m01:26:10.943988 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:26:25.751720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C3433E090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C3433F550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C3433FB50>]}


============================== 01:26:25.758185 | fa4f951e-cdbf-4a98-8398-d6adb90b8c1b ==============================
[0m01:26:25.758185 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:26:25.760196 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m01:26:26.640083 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:26:26.643131 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:26:26.643131 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:26:26.778328 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:26:26.780332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'fa4f951e-cdbf-4a98-8398-d6adb90b8c1b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C343E49D0>]}
[0m01:26:26.939094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fa4f951e-cdbf-4a98-8398-d6adb90b8c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C467DA050>]}
[0m01:26:27.002466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fa4f951e-cdbf-4a98-8398-d6adb90b8c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C3332CF90>]}
[0m01:26:27.002466 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:26:27.381429 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:26:27.571084 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:26:27.571084 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:26:27.587186 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:26:27.587186 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:26:27.651228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fa4f951e-cdbf-4a98-8398-d6adb90b8c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C46CD72D0>]}
[0m01:26:27.760885 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:26:27.777004 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:26:27.814949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fa4f951e-cdbf-4a98-8398-d6adb90b8c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C46EFF450>]}
[0m01:26:27.814949 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:26:27.818616 [info ] [MainThread]: 
[0m01:26:27.818616 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:26:27.818616 [info ] [MainThread]: 
[0m01:26:27.820120 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:26:27.825027 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:26:27.893859 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:26:27.893859 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:26:27.895863 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:26:30.704653 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.813 seconds
[0m01:26:30.719852 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:26:30.733483 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:26:30.733483 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:26:30.733483 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:26:34.449034 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 3.720 seconds
[0m01:26:34.480659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa4f951e-cdbf-4a98-8398-d6adb90b8c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C467D80D0>]}
[0m01:26:34.480659 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:26:34.480659 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:26:34.480659 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:26:34.480659 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:26:34.480659 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:26:34.480659 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:26:34.480659 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:26:34.480659 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:26:34.495937 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:26:34.508225 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:26:34.508225 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:26:34.527610 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:26:34.533315 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:26:34.544949 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:26:34.546954 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:26:34.549672 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:26:34.549672 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:26:34.551678 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:26:34.552301 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:26:34.553113 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:26:37.768695 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.216 seconds
[0m01:26:37.812077 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa4f951e-cdbf-4a98-8398-d6adb90b8c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C46773610>]}
[0m01:26:37.812077 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.33s]
[0m01:26:37.812077 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:26:37.812077 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:26:37.828180 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:26:37.830921 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m01:26:37.832932 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:26:37.842582 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:26:37.845789 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:26:37.857771 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:26:37.860571 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:26:37.860571 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:26:37.860571 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:26:38.178812 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.624 seconds
[0m01:26:38.182831 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa4f951e-cdbf-4a98-8398-d6adb90b8c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C4756ACD0>]}
[0m01:26:38.184843 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.70s]
[0m01:26:38.184843 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:26:38.184843 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:26:38.184843 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:26:38.184843 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m01:26:38.184843 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:26:38.192181 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:26:38.192181 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:26:38.271074 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:26:38.274093 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:26:38.274093 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:26:39.827110 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.551 seconds
[0m01:26:39.831440 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa4f951e-cdbf-4a98-8398-d6adb90b8c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C34286390>]}
[0m01:26:39.832493 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.65s]
[0m01:26:39.834285 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:26:41.058783 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.190 seconds
[0m01:26:41.068286 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa4f951e-cdbf-4a98-8398-d6adb90b8c1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C4777A4D0>]}
[0m01:26:41.069999 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 3.24s]
[0m01:26:41.072118 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:26:41.072118 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:26:41.072118 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:26:41.072118 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:26:42.339248 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:26:42.339248 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:26:43.670636 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:26:43.671833 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:26:46.744498 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m01:26:46.744498 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m01:26:47.966317 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:26:47.966317 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:26:48.916371 [info ] [MainThread]: 
[0m01:26:48.916371 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 21.10 seconds (21.10s).
[0m01:26:48.916371 [debug] [MainThread]: Command end result
[0m01:26:48.992243 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:26:48.992243 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:26:49.007939 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:26:49.007939 [info ] [MainThread]: 
[0m01:26:49.007939 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:26:49.007939 [info ] [MainThread]: 
[0m01:26:49.007939 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:26:49.007939 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:26:49.007939 [debug] [MainThread]: Command `dbt build` succeeded at 01:26:49.007939 after 23.40 seconds
[0m01:26:49.007939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C340E1C10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2D7979D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2D797950>]}
[0m01:26:49.007939 [debug] [MainThread]: Flushing usage events
[0m01:26:51.037310 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:27:07.351100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245EA3AC190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245EA412890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245EA3AC710>]}


============================== 01:27:07.351100 | f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49 ==============================
[0m01:27:07.351100 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:27:07.351100 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m01:27:08.018031 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:27:08.018031 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:27:08.018031 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:27:08.142162 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:27:08.142162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245FC7645D0>]}
[0m01:27:08.294185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245FC71C490>]}
[0m01:27:08.353295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245E9391190>]}
[0m01:27:08.353295 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:27:08.751222 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:27:09.024737 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:27:09.024737 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:27:09.024737 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:27:09.030131 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:27:09.088366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245FCDE7390>]}
[0m01:27:09.217065 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:27:09.217065 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:27:09.246617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245FD051150>]}
[0m01:27:09.246617 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:27:09.263437 [info ] [MainThread]: 
[0m01:27:09.265442 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:27:09.265442 [info ] [MainThread]: 
[0m01:27:09.265442 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:27:09.265442 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:27:09.348359 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:27:09.348359 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:27:09.348359 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:12.797716 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.449 seconds
[0m01:27:12.815104 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:27:12.825180 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:27:12.825180 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:27:12.825180 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:15.003054 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.164 seconds
[0m01:27:15.025333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245FCF6C850>]}
[0m01:27:15.033427 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:27:15.036886 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:27:15.037392 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:27:15.037392 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:27:15.037392 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:27:15.041101 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:27:15.042477 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:27:15.044333 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:27:15.059074 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:27:15.067752 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:27:15.068746 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:27:15.117482 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:27:15.118864 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:27:15.126119 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:27:15.127124 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:27:15.127124 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:27:15.129838 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:27:15.129838 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:27:15.131851 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:27:15.135200 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:27:18.117348 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.986 seconds
[0m01:27:18.159440 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245FD6AB1D0>]}
[0m01:27:18.161189 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.12s]
[0m01:27:18.162013 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:27:18.164018 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:27:18.166018 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:27:18.167403 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m01:27:18.167403 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:27:18.177462 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:27:18.179813 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:27:18.188749 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:27:18.189325 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:27:18.189325 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:27:18.189325 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:27:18.340275 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.207 seconds
[0m01:27:18.347801 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245FD5D78D0>]}
[0m01:27:18.347801 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.31s]
[0m01:27:18.353268 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:27:18.355009 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:27:18.356317 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:27:18.357733 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m01:27:18.357733 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:27:18.367247 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:27:18.368277 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:27:18.474418 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:27:18.477622 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:27:18.479482 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:27:19.757961 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.278 seconds
[0m01:27:19.769738 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245FD7EE890>]}
[0m01:27:19.769738 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.40s]
[0m01:27:19.769738 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:27:20.990354 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.794 seconds
[0m01:27:20.993355 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1fd13ce-3c70-4f9e-a4e4-a5e6c2a53f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245FD7EE8D0>]}
[0m01:27:20.993355 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 2.83s]
[0m01:27:20.993355 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:27:20.999449 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:27:20.999449 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:27:20.999449 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:27:21.862538 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:27:21.862923 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:27:23.092098 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:27:23.092098 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:27:24.364877 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m01:27:24.367791 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m01:27:25.551495 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:27:25.551495 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:27:26.470996 [info ] [MainThread]: 
[0m01:27:26.470996 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 17.21 seconds (17.21s).
[0m01:27:26.470996 [debug] [MainThread]: Command end result
[0m01:27:26.530610 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:27:26.530610 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:27:26.530610 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:27:26.530610 [info ] [MainThread]: 
[0m01:27:26.546671 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:27:26.548164 [info ] [MainThread]: 
[0m01:27:26.548164 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:27:26.548164 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:27:26.548164 [debug] [MainThread]: Command `dbt build` succeeded at 01:27:26.548164 after 19.28 seconds
[0m01:27:26.548164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245E3767AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245E37679D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000245E9327310>]}
[0m01:27:26.548164 [debug] [MainThread]: Flushing usage events
[0m01:27:29.311151 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:27:42.960493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7A697DA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7A697F2D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7A697F7D0>]}


============================== 01:27:42.968641 | dea035ad-64fa-403a-ad41-1515efbb0d9d ==============================
[0m01:27:42.968641 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:27:42.970647 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m01:27:43.689543 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:27:43.689543 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:27:43.689543 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:27:43.816202 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:27:43.816202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'dea035ad-64fa-403a-ad41-1515efbb0d9d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7B8D9C5D0>]}
[0m01:27:43.981249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dea035ad-64fa-403a-ad41-1515efbb0d9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7B8D93DD0>]}
[0m01:27:44.047485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dea035ad-64fa-403a-ad41-1515efbb0d9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7A5969190>]}
[0m01:27:44.047485 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:27:44.435329 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:27:44.645649 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:27:44.647655 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:27:44.647655 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:27:44.658119 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:27:44.723394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dea035ad-64fa-403a-ad41-1515efbb0d9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7B91601D0>]}
[0m01:27:44.855875 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:27:44.860815 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:27:44.932481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dea035ad-64fa-403a-ad41-1515efbb0d9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7B95F0610>]}
[0m01:27:44.935656 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:27:44.939780 [info ] [MainThread]: 
[0m01:27:44.939780 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:27:44.943585 [info ] [MainThread]: 
[0m01:27:44.943585 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:27:44.956060 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:27:45.050781 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:27:45.055443 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:27:45.056848 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:47.815770 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.757 seconds
[0m01:27:47.822526 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:27:47.845428 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:27:47.845428 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:27:47.845428 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:50.737312 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.890 seconds
[0m01:27:50.782460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dea035ad-64fa-403a-ad41-1515efbb0d9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7B8CC2890>]}
[0m01:27:50.791564 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:27:50.791564 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:27:50.791564 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:27:50.791564 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:27:50.791564 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:27:50.798493 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:27:50.798493 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:27:50.798493 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:27:50.808479 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:27:50.821064 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:27:50.822255 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:27:50.865766 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:27:50.865766 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:27:50.867925 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:27:50.877019 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:27:50.878377 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:27:50.878377 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:27:50.878377 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:27:50.882824 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:27:50.884831 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:27:53.909318 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.031 seconds
[0m01:27:53.940986 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea035ad-64fa-403a-ad41-1515efbb0d9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7B9C80950>]}
[0m01:27:53.940986 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.15s]
[0m01:27:53.940986 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:27:53.940986 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:27:53.940986 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:27:53.952735 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m01:27:53.952735 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:27:53.956751 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:27:53.956751 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:27:53.963151 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:27:53.967171 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:27:53.967171 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:27:53.967171 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:27:54.038006 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.153 seconds
[0m01:27:54.042019 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea035ad-64fa-403a-ad41-1515efbb0d9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7B9C6BD10>]}
[0m01:27:54.042019 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.25s]
[0m01:27:54.042019 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:27:54.042019 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:27:54.042019 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:27:54.042019 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m01:27:54.042019 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:27:54.049920 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:27:54.051667 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:27:54.132418 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:27:54.132418 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:27:54.132418 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:27:55.564239 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.423 seconds
[0m01:27:55.573636 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea035ad-64fa-403a-ad41-1515efbb0d9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7B953E050>]}
[0m01:27:55.575651 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.53s]
[0m01:27:55.575651 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:27:57.449040 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.482 seconds
[0m01:27:57.449040 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dea035ad-64fa-403a-ad41-1515efbb0d9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7B9DBD2D0>]}
[0m01:27:57.449040 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 3.51s]
[0m01:27:57.449040 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:27:57.449040 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:27:57.449040 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:27:57.459874 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:27:58.729180 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:27:58.729180 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:27:59.992176 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:27:59.992176 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:28:01.080528 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m01:28:01.080528 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m01:28:02.406883 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:28:02.406883 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:28:03.438970 [info ] [MainThread]: 
[0m01:28:03.440982 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 18.50 seconds (18.50s).
[0m01:28:03.442992 [debug] [MainThread]: Command end result
[0m01:28:03.494183 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:28:03.496198 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:28:03.500960 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:28:03.500960 [info ] [MainThread]: 
[0m01:28:03.500960 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:28:03.500960 [info ] [MainThread]: 
[0m01:28:03.500960 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:28:03.500960 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:28:03.500960 [debug] [MainThread]: Command `dbt build` succeeded at 01:28:03.500960 after 20.64 seconds
[0m01:28:03.500960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7A69EFF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7A69EFC50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7A69EFE50>]}
[0m01:28:03.500960 [debug] [MainThread]: Flushing usage events
[0m01:28:05.177003 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:28:19.057930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB023D8250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB023DBC90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB023DA750>]}


============================== 01:28:19.059939 | 45048b69-896f-487a-9c23-813d51f16326 ==============================
[0m01:28:19.059939 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:28:19.061944 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m01:28:19.678054 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:28:19.685138 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:28:19.685138 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:28:19.798129 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:28:19.798129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '45048b69-896f-487a-9c23-813d51f16326', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB14764950>]}
[0m01:28:19.941082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45048b69-896f-487a-9c23-813d51f16326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB14873710>]}
[0m01:28:20.017225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45048b69-896f-487a-9c23-813d51f16326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB013CD050>]}
[0m01:28:20.017225 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:28:20.440210 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:28:20.631938 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:28:20.631938 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:28:20.631938 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:28:20.652300 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:28:20.711167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45048b69-896f-487a-9c23-813d51f16326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB14B90D90>]}
[0m01:28:20.830228 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:28:20.837829 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:28:20.870909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45048b69-896f-487a-9c23-813d51f16326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB15050750>]}
[0m01:28:20.870909 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:28:20.887745 [info ] [MainThread]: 
[0m01:28:20.889764 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:28:20.889764 [info ] [MainThread]: 
[0m01:28:20.891771 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:28:20.895790 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:28:20.971195 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:28:20.973206 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:28:20.973206 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:28:23.919254 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.945 seconds
[0m01:28:23.937030 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:28:23.950834 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:28:23.950834 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:28:23.950834 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:28:27.551099 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 3.596 seconds
[0m01:28:27.579102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45048b69-896f-487a-9c23-813d51f16326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB146F2A10>]}
[0m01:28:27.585878 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:28:27.585878 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:28:27.590072 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:28:27.592079 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:28:27.592079 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:28:27.594085 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:28:27.595093 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:28:27.595834 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:28:27.605191 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:28:27.611110 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:28:27.615920 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:28:27.615920 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:28:27.659163 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:28:27.665611 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:28:27.669765 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:28:27.669765 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:28:27.669765 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:28:27.669765 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:28:27.669765 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:28:27.669765 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:28:31.274133 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.602 seconds
[0m01:28:31.305237 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45048b69-896f-487a-9c23-813d51f16326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB156AC810>]}
[0m01:28:31.305237 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.71s]
[0m01:28:31.305237 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:28:31.305237 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:28:31.305237 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:28:31.305237 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m01:28:31.305237 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:28:31.305237 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:28:31.321081 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:28:31.321081 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:28:31.321081 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:28:31.321081 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:28:31.321081 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:28:31.417712 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.744 seconds
[0m01:28:31.421469 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45048b69-896f-487a-9c23-813d51f16326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB156BB7D0>]}
[0m01:28:31.423754 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.83s]
[0m01:28:31.423754 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:28:31.425804 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:28:31.427217 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:28:31.427217 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m01:28:31.429115 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:28:31.436395 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:28:31.437404 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:28:31.525456 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:28:31.525456 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:28:31.525456 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:28:32.881141 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.350 seconds
[0m01:28:32.885159 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45048b69-896f-487a-9c23-813d51f16326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB15299D90>]}
[0m01:28:32.887165 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.46s]
[0m01:28:32.887165 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:28:33.953780 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.626 seconds
[0m01:28:33.963182 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45048b69-896f-487a-9c23-813d51f16326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB14851AD0>]}
[0m01:28:33.964918 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 2.66s]
[0m01:28:33.964918 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:28:33.964918 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:28:33.964918 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:28:33.964918 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:28:34.955722 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:28:34.955722 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:28:36.412042 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m01:28:36.414055 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m01:28:37.407104 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:28:37.407104 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:28:38.494066 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:28:38.496080 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:28:39.529211 [info ] [MainThread]: 
[0m01:28:39.529211 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 18.64 seconds (18.64s).
[0m01:28:39.529211 [debug] [MainThread]: Command end result
[0m01:28:39.599909 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:28:39.601915 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:28:39.604073 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:28:39.604073 [info ] [MainThread]: 
[0m01:28:39.604073 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:28:39.604073 [info ] [MainThread]: 
[0m01:28:39.604073 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:28:39.604073 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:28:39.604073 [debug] [MainThread]: Command `dbt build` succeeded at 01:28:39.604073 after 20.64 seconds
[0m01:28:39.604073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB7B787950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB7B7879D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB01323850>]}
[0m01:28:39.604073 [debug] [MainThread]: Flushing usage events
[0m01:28:42.654350 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:29:17.512870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E3185CE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E3185C350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E3185FC90>]}


============================== 01:29:17.522476 | 888097f0-9dab-4894-9796-9a9692a8ac04 ==============================
[0m01:29:17.522476 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:29:17.529505 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m01:29:18.422360 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:29:18.422360 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:29:18.422360 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:29:18.570384 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:29:18.570384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '888097f0-9dab-4894-9796-9a9692a8ac04', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E41B95C10>]}
[0m01:29:18.774484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '888097f0-9dab-4894-9796-9a9692a8ac04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E41629210>]}
[0m01:29:18.835848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '888097f0-9dab-4894-9796-9a9692a8ac04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E3084D0D0>]}
[0m01:29:18.835848 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:29:19.359385 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:29:20.030828 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:29:20.032833 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:29:20.054647 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:29:20.080240 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:29:20.253263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '888097f0-9dab-4894-9796-9a9692a8ac04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E442181D0>]}
[0m01:29:20.583288 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:29:20.589005 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:29:20.647835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '888097f0-9dab-4894-9796-9a9692a8ac04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E445001D0>]}
[0m01:29:20.647835 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:29:20.653816 [info ] [MainThread]: 
[0m01:29:20.655827 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:29:20.655827 [info ] [MainThread]: 
[0m01:29:20.657836 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:29:20.661851 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:29:20.749686 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:29:20.751194 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:29:20.751194 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:29:23.825247 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.072 seconds
[0m01:29:23.853663 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:29:23.905117 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:29:23.910121 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:29:23.913136 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:29:27.102802 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 3.189 seconds
[0m01:29:27.153328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '888097f0-9dab-4894-9796-9a9692a8ac04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E43BA24D0>]}
[0m01:29:27.165326 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:29:27.166327 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:29:27.169331 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:29:27.171326 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:29:27.174326 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:29:27.177385 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:29:27.180397 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:29:27.182400 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:29:27.204332 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:29:27.220160 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:29:27.222628 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:29:27.225643 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:29:27.377064 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:29:27.389321 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:29:27.396318 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:29:27.399841 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:29:27.401841 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:29:27.405840 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:29:27.408843 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:29:27.410840 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:29:30.331677 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.921 seconds
[0m01:29:30.423085 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '888097f0-9dab-4894-9796-9a9692a8ac04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E44A57C90>]}
[0m01:29:30.428086 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.24s]
[0m01:29:30.432093 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:29:30.435168 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:29:30.438171 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:29:30.441212 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m01:29:30.444149 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:29:30.461196 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:29:30.466202 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:29:30.485373 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:29:30.492363 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:29:30.495366 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:29:30.498433 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:29:30.632154 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.224 seconds
[0m01:29:30.645970 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '888097f0-9dab-4894-9796-9a9692a8ac04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E44B4B390>]}
[0m01:29:30.650622 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.47s]
[0m01:29:30.653545 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:29:30.656540 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:29:30.659541 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:29:30.662661 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m01:29:30.666653 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:29:30.683553 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:29:30.687548 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:29:30.876826 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:29:30.886615 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:29:30.889630 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:29:32.296915 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.403 seconds
[0m01:29:32.304912 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '888097f0-9dab-4894-9796-9a9692a8ac04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E44BB8150>]}
[0m01:29:32.307915 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.64s]
[0m01:29:32.311643 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:29:33.292064 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.794 seconds
[0m01:29:33.302162 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '888097f0-9dab-4894-9796-9a9692a8ac04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E44C8FD50>]}
[0m01:29:33.305075 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 2.86s]
[0m01:29:33.308076 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:29:33.313610 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:29:33.315607 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:29:33.317608 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:29:34.378851 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:29:34.380851 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:29:37.613028 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m01:29:37.614483 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m01:29:40.447197 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:29:40.449201 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:29:42.902022 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:29:42.904488 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:29:45.960414 [info ] [MainThread]: 
[0m01:29:45.963368 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 25.30 seconds (25.30s).
[0m01:29:45.970458 [debug] [MainThread]: Command end result
[0m01:29:46.153192 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:29:46.163497 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:29:46.187109 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:29:46.190514 [info ] [MainThread]: 
[0m01:29:46.193516 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:29:46.195516 [info ] [MainThread]: 
[0m01:29:46.199514 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:29:46.203511 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:29:46.206512 [debug] [MainThread]: Command `dbt build` succeeded at 01:29:46.206512 after 28.80 seconds
[0m01:29:46.209508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E3150B2D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E2AC27950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E2AC279D0>]}
[0m01:29:46.211769 [debug] [MainThread]: Flushing usage events
[0m01:29:52.305779 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:30:27.168402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3EEA6C090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3EEA6FB50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3EEA6C990>]}


============================== 01:30:27.168402 | 6e9197fd-9ae3-441c-9f5d-034ed90b6da5 ==============================
[0m01:30:27.168402 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:30:27.168402 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m01:30:27.926198 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:30:27.926198 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:30:27.928377 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:30:28.053634 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:30:28.053634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6e9197fd-9ae3-441c-9f5d-034ed90b6da5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3EEA5FA10>]}
[0m01:30:28.212680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e9197fd-9ae3-441c-9f5d-034ed90b6da5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B380FC36D0>]}
[0m01:30:28.260526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e9197fd-9ae3-441c-9f5d-034ed90b6da5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3EDA4D0D0>]}
[0m01:30:28.260526 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:30:28.674453 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:30:28.882174 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:30:28.882174 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:30:28.882174 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:30:28.893243 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m01:30:28.948003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6e9197fd-9ae3-441c-9f5d-034ed90b6da5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B380FB0450>]}
[0m01:30:29.091544 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:30:29.097305 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:30:29.142026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6e9197fd-9ae3-441c-9f5d-034ed90b6da5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3817B0F90>]}
[0m01:30:29.146472 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:30:29.149463 [info ] [MainThread]: 
[0m01:30:29.152190 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:30:29.153470 [info ] [MainThread]: 
[0m01:30:29.153470 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:30:29.158973 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:30:29.228073 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:30:29.228073 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:30:29.228073 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:34.278642 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 5.041 seconds
[0m01:30:34.285508 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:30:34.302759 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:30:34.304912 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:30:34.304912 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:36.424319 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.120 seconds
[0m01:30:36.452092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e9197fd-9ae3-441c-9f5d-034ed90b6da5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3817EB4D0>]}
[0m01:30:36.457340 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:30:36.457340 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:30:36.457340 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:30:36.463208 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:30:36.463208 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:30:36.463208 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:30:36.463208 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:30:36.463208 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:30:36.475091 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:30:36.485481 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:30:36.485481 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:30:36.517804 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:30:36.517804 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:30:36.517804 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:30:36.534216 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:30:36.534216 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:30:36.534216 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:30:36.534216 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:30:36.534216 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:30:36.534216 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:30:39.852982 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.313 seconds
[0m01:30:39.870033 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e9197fd-9ae3-441c-9f5d-034ed90b6da5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3817CB3D0>]}
[0m01:30:39.872038 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.41s]
[0m01:30:39.872038 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:30:39.874042 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:30:39.874042 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:30:39.874042 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m01:30:39.874042 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:30:39.874042 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:30:39.883670 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:30:39.884744 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:30:39.884744 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:30:39.884744 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:30:39.884744 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:30:40.100981 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.563 seconds
[0m01:30:40.104994 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e9197fd-9ae3-441c-9f5d-034ed90b6da5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B381CE5DD0>]}
[0m01:30:40.106999 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.64s]
[0m01:30:40.106999 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:30:40.120569 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:30:40.122577 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:30:40.124583 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m01:30:40.124583 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:30:40.134558 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:30:40.136565 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:30:40.252375 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:30:40.252375 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:30:40.252375 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:30:42.021131 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.764 seconds
[0m01:30:42.022971 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e9197fd-9ae3-441c-9f5d-034ed90b6da5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3817B1510>]}
[0m01:30:42.027165 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.90s]
[0m01:30:42.027165 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:30:42.646966 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.757 seconds
[0m01:30:42.646966 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e9197fd-9ae3-441c-9f5d-034ed90b6da5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B381EA6950>]}
[0m01:30:42.655993 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 2.77s]
[0m01:30:42.655993 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:30:42.658659 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:30:42.658659 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:30:42.658659 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:30:43.801987 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:30:43.801987 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:30:44.874215 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m01:30:44.874215 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m01:30:46.153674 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:30:46.153674 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:30:47.384093 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:30:47.386101 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:30:48.614887 [info ] [MainThread]: 
[0m01:30:48.616007 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 19.46 seconds (19.46s).
[0m01:30:48.618597 [debug] [MainThread]: Command end result
[0m01:30:48.672696 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:30:48.672696 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:30:48.689275 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:30:48.689275 [info ] [MainThread]: 
[0m01:30:48.689275 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:30:48.689275 [info ] [MainThread]: 
[0m01:30:48.689275 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:30:48.689275 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:30:48.689275 [debug] [MainThread]: Command `dbt build` succeeded at 01:30:48.689275 after 21.62 seconds
[0m01:30:48.689275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3EE71B2D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3819E3F50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E7E17950>]}
[0m01:30:48.689275 [debug] [MainThread]: Flushing usage events
[0m01:30:51.375493 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:31:11.083638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021253DEFD90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021253DEC110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021253DEFA50>]}


============================== 01:31:11.091934 | 83c91304-e1d0-46c4-b8fe-0300d31dd1be ==============================
[0m01:31:11.091934 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:31:11.093038 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_b', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m01:31:12.023523 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:31:12.023523 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:31:12.023523 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:31:12.162603 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:31:12.170662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021263185F10>]}
[0m01:31:12.397018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002126626C4D0>]}
[0m01:31:12.463724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002126610EA50>]}
[0m01:31:12.463724 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:31:12.966696 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:31:13.294281 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:31:13.295318 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:31:13.296371 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:31:13.299244 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:31:13.376661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021266718950>]}
[0m01:31:13.579318 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:31:13.579318 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:31:13.645463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212665C7A50>]}
[0m01:31:13.645463 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:31:13.649979 [info ] [MainThread]: 
[0m01:31:13.652154 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:31:13.652154 [info ] [MainThread]: 
[0m01:31:13.652154 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:31:13.652154 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:31:13.764592 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:31:13.764592 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:31:13.764592 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:31:17.637483 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.876 seconds
[0m01:31:17.662317 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:31:17.732499 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:31:17.735652 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:31:17.738624 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:31:20.180521 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.442 seconds
[0m01:31:20.228258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021253E27B50>]}
[0m01:31:20.244739 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:31:20.244739 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:31:20.244739 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m01:31:20.244739 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m01:31:20.253141 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m01:31:20.253141 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m01:31:20.253141 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m01:31:20.261957 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m01:31:20.261957 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m01:31:20.269629 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m01:31:20.271641 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m01:31:20.275664 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m01:31:20.277762 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:31:20.277762 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:31:20.282432 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m01:31:20.285877 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m01:31:20.340794 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m01:31:20.342803 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m01:31:20.351200 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m01:31:20.367266 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m01:31:20.375463 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:31:20.375463 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:31:20.375463 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m01:31:20.400908 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m01:31:20.541813 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m01:31:20.548873 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m01:31:20.565366 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m01:31:20.582298 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m01:31:20.587456 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m01:31:20.591903 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m01:31:20.591903 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m01:31:20.598075 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m01:31:20.598075 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m01:31:20.598075 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m01:31:20.606763 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m01:31:20.606763 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:31:20.606763 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m01:31:20.606763 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:31:20.614545 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:31:20.614545 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:31:23.377190 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.774 seconds
[0m01:31:23.468511 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212671E4ED0>]}
[0m01:31:23.468511 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 3.20s]
[0m01:31:23.468511 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:31:23.980976 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.370 seconds
[0m01:31:23.980976 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.366 seconds
[0m01:31:23.987916 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.374 seconds
[0m01:31:23.996751 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212671F8D10>]}
[0m01:31:24.008945 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002126721FB90>]}
[0m01:31:24.012252 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002126701F8D0>]}
[0m01:31:24.020992 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 3.73s]
[0m01:31:24.020992 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 3.73s]
[0m01:31:24.020992 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 3.74s]
[0m01:31:24.028558 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:31:24.032186 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m01:31:24.037051 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m01:31:24.037051 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:31:24.045097 [info ] [Thread-2 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m01:31:24.045097 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m01:31:24.045097 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:31:24.064759 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m01:31:24.070325 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:31:24.078516 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m01:31:24.091016 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m01:31:24.094853 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m01:31:25.214758 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.118 seconds
[0m01:31:25.222177 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021266253250>]}
[0m01:31:25.233186 [info ] [Thread-2 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 1.18s]
[0m01:31:25.233186 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:31:25.238241 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:31:25.243641 [info ] [Thread-5 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m01:31:25.246656 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m01:31:25.246656 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:31:25.266266 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m01:31:25.270422 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:31:25.287113 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m01:31:25.294923 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m01:31:25.294923 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m01:31:26.645747 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.341 seconds
[0m01:31:26.667005 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021266999E90>]}
[0m01:31:26.669062 [info ] [Thread-5 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 1.42s]
[0m01:31:26.674676 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:31:26.674676 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m01:31:26.680743 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:31:26.680743 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:31:26.682753 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:31:26.684725 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m01:31:26.684725 [info ] [Thread-2 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m01:31:26.687310 [info ] [Thread-4 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m01:31:26.690324 [info ] [Thread-5 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m01:31:26.692811 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m01:31:26.692811 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m01:31:26.695536 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m01:31:26.698232 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m01:31:26.698232 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m01:31:26.700238 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:31:26.702002 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:31:26.702002 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:31:26.712902 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m01:31:26.720664 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m01:31:26.731405 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m01:31:26.744119 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m01:31:26.747366 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m01:31:26.753428 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m01:31:26.761504 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:31:26.764081 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:31:26.764081 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:31:26.777789 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m01:31:26.786263 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m01:31:26.800113 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m01:31:26.811895 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m01:31:26.811895 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m01:31:26.819346 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m01:31:26.827611 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m01:31:26.835698 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m01:31:26.835698 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m01:31:26.844281 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m01:31:26.849153 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m01:31:27.901382 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.048 seconds
[0m01:31:27.905410 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.047 seconds
[0m01:31:27.915607 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021267133F10>]}
[0m01:31:27.921885 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212670073D0>]}
[0m01:31:27.931998 [info ] [Thread-5 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.22s]
[0m01:31:27.931998 [info ] [Thread-4 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.23s]
[0m01:31:27.938012 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:31:27.940999 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:31:27.946400 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:31:27.946400 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:31:27.946400 [info ] [Thread-5 (]: 11 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m01:31:27.954233 [info ] [Thread-4 (]: 12 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m01:31:27.954233 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m01:31:27.959872 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m01:31:27.962980 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:31:27.962980 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:31:27.981125 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m01:31:27.995962 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m01:31:28.004151 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:31:28.004151 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:31:28.020936 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m01:31:28.037452 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m01:31:28.046354 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m01:31:28.051880 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m01:31:28.053635 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m01:31:28.055645 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m01:31:28.112929 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.264 seconds
[0m01:31:28.119006 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.291 seconds
[0m01:31:28.129705 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002126721EF10>]}
[0m01:31:28.137509 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002126721F050>]}
[0m01:31:28.141538 [info ] [Thread-2 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.43s]
[0m01:31:28.143885 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.45s]
[0m01:31:28.143885 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:31:28.151800 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m01:31:29.288162 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.229 seconds
[0m01:31:29.296219 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002126655E6D0>]}
[0m01:31:29.296219 [info ] [Thread-4 (]: 12 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.34s]
[0m01:31:29.304629 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:31:29.522246 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.465 seconds
[0m01:31:29.529388 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83c91304-e1d0-46c4-b8fe-0300d31dd1be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021266D5F5D0>]}
[0m01:31:29.537629 [info ] [Thread-5 (]: 11 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.58s]
[0m01:31:29.537629 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:31:29.545899 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:31:29.545899 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:31:29.545899 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:31:30.701851 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:31:30.702275 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:31:32.235417 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m01:31:32.235417 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m01:31:33.192736 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_trades' was left open.
[0m01:31:33.192736 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_trades: Close
[0m01:31:34.285337 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m01:31:34.285337 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m01:31:35.411325 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m01:31:35.415841 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m01:31:36.345171 [info ] [MainThread]: 
[0m01:31:36.345171 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 22.69 seconds (22.69s).
[0m01:31:36.347932 [debug] [MainThread]: Command end result
[0m01:31:36.406876 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:31:36.412044 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:31:36.417720 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:31:36.417720 [info ] [MainThread]: 
[0m01:31:36.417720 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:31:36.417720 [info ] [MainThread]: 
[0m01:31:36.417720 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m01:31:36.417720 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:31:36.417720 [debug] [MainThread]: Command `dbt build` succeeded at 01:31:36.417720 after 25.50 seconds
[0m01:31:36.417720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021253A9B2D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002124D1A7950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002124D1A79D0>]}
[0m01:31:36.427842 [debug] [MainThread]: Flushing usage events
[0m01:31:38.686803 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:32:51.800599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000110506FC890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000110506FC350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000110504A1950>]}


============================== 01:32:51.817674 | 591f92e3-a918-467a-ac20-93f26d94d79d ==============================
[0m01:32:51.817674 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:32:51.821707 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_b', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m01:32:53.247848 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:32:53.251896 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:32:53.254432 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:32:53.643935 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:32:53.646964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011062B1C710>]}
[0m01:32:54.241242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011062B308D0>]}
[0m01:32:54.515506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001104F6E5090>]}
[0m01:32:54.520601 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:32:56.010659 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:32:56.803263 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:32:56.804767 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:32:56.807785 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:32:56.840255 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:32:57.011088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001106306DD10>]}
[0m01:32:57.531048 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:32:57.540042 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:32:57.684907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011062EB7A50>]}
[0m01:32:57.688590 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:32:57.706694 [info ] [MainThread]: 
[0m01:32:57.708694 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:32:57.710694 [info ] [MainThread]: 
[0m01:32:57.712691 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:32:57.732437 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:32:58.049146 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:32:58.052222 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:32:58.055138 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:33:02.202609 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 4.147 seconds
[0m01:33:02.226327 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:33:02.287701 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:33:02.289698 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:33:02.291698 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:33:05.158047 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.866 seconds
[0m01:33:05.221664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000110633BB890>]}
[0m01:33:05.234606 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:33:05.236605 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:33:05.238604 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m01:33:05.240605 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m01:33:05.242617 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m01:33:05.245691 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m01:33:05.248705 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m01:33:05.251687 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m01:33:05.254702 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m01:33:05.257687 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m01:33:05.259610 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m01:33:05.261694 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m01:33:05.264124 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:33:05.266147 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:33:05.268123 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m01:33:05.270132 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m01:33:05.302373 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m01:33:05.317473 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m01:33:05.332195 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m01:33:05.346852 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m01:33:05.351752 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:33:05.353758 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:33:05.356762 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m01:33:05.373265 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m01:33:05.504546 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m01:33:05.511477 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m01:33:05.529011 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m01:33:05.544567 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m01:33:05.549569 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m01:33:05.552576 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m01:33:05.557579 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m01:33:05.559565 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m01:33:05.561572 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m01:33:05.564588 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m01:33:05.567577 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m01:33:05.569572 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:33:05.572572 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m01:33:05.574572 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:33:05.577567 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:33:05.582564 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:33:08.135436 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.566 seconds
[0m01:33:08.215470 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001104FF6C510>]}
[0m01:33:08.219493 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.95s]
[0m01:33:08.222495 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:33:08.433377 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.851 seconds
[0m01:33:08.435365 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.861 seconds
[0m01:33:08.445189 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011063A5FF90>]}
[0m01:33:08.455211 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011063AFEFD0>]}
[0m01:33:08.458211 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 3.18s]
[0m01:33:08.461776 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 3.20s]
[0m01:33:08.464800 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m01:33:08.467795 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:33:09.455380 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.878 seconds
[0m01:33:09.463373 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011063AFFE90>]}
[0m01:33:09.465372 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 4.20s]
[0m01:33:09.466373 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m01:33:09.469371 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:33:09.472893 [info ] [Thread-3 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m01:33:09.475861 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m01:33:09.477898 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:33:09.492386 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m01:33:09.496362 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:33:09.507642 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m01:33:09.514641 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m01:33:09.516628 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m01:33:10.626784 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.108 seconds
[0m01:33:10.634775 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011063AEC590>]}
[0m01:33:10.637777 [info ] [Thread-3 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 1.16s]
[0m01:33:10.642017 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:33:10.645016 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:33:10.648045 [info ] [Thread-2 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m01:33:10.651034 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m01:33:10.653032 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:33:10.665815 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m01:33:10.669816 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:33:10.683022 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m01:33:10.693426 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m01:33:10.696529 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m01:33:11.624540 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.925 seconds
[0m01:33:11.634467 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011063AECDD0>]}
[0m01:33:11.637732 [info ] [Thread-2 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 0.98s]
[0m01:33:11.640757 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:33:11.644297 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m01:33:11.646296 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:33:11.647393 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:33:11.649321 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:33:11.652306 [info ] [Thread-5 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m01:33:11.655388 [info ] [Thread-3 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m01:33:11.658296 [info ] [Thread-4 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m01:33:11.661300 [info ] [Thread-2 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m01:33:11.664376 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.fact_trades)
[0m01:33:11.666294 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m01:33:11.669294 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m01:33:11.670298 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m01:33:11.673293 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m01:33:11.675292 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:33:11.677291 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:33:11.680390 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:33:11.693482 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m01:33:11.705408 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m01:33:11.723149 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m01:33:11.737158 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m01:33:11.741669 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m01:33:11.744681 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:33:11.747680 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:33:11.765128 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m01:33:11.767129 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:33:11.783126 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m01:33:11.797714 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m01:33:11.809067 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m01:33:11.817088 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m01:33:11.824587 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m01:33:11.826734 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m01:33:11.835827 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m01:33:11.839817 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m01:33:11.844485 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m01:33:11.848479 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m01:33:11.857623 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m01:33:12.745914 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.879 seconds
[0m01:33:12.757311 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001104FF6C590>]}
[0m01:33:12.760298 [info ] [Thread-2 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.09s]
[0m01:33:12.762305 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:33:12.766600 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:33:12.768607 [info ] [Thread-2 (]: 11 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m01:33:12.770607 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m01:33:12.772713 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:33:12.784264 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m01:33:12.787074 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:33:12.797080 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m01:33:12.799711 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m01:33:12.801143 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m01:33:12.885561 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.023 seconds
[0m01:33:12.888549 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.042 seconds
[0m01:33:12.899554 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000110639E8350>]}
[0m01:33:12.908553 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011062BDF790>]}
[0m01:33:12.912551 [info ] [Thread-4 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.23s]
[0m01:33:12.916549 [info ] [Thread-5 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.25s]
[0m01:33:12.920559 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:33:12.923548 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m01:33:12.926551 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:33:12.929858 [info ] [Thread-4 (]: 12 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m01:33:12.932856 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m01:33:12.934851 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:33:12.948774 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m01:33:12.952259 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:33:12.968713 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m01:33:12.975530 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m01:33:12.979089 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m01:33:12.993364 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.140 seconds
[0m01:33:13.007743 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011062C38850>]}
[0m01:33:13.010782 [info ] [Thread-3 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.34s]
[0m01:33:13.013783 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:33:13.822992 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.841 seconds
[0m01:33:13.831997 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011062A08C10>]}
[0m01:33:13.834998 [info ] [Thread-4 (]: 12 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 0.90s]
[0m01:33:13.840359 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:33:13.913299 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.111 seconds
[0m01:33:13.923281 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '591f92e3-a918-467a-ac20-93f26d94d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011062B7ED50>]}
[0m01:33:13.928292 [info ] [Thread-2 (]: 11 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.15s]
[0m01:33:13.932283 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:33:13.937284 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:33:13.941293 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:33:13.943298 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:33:14.833084 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:33:14.836083 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:33:15.636880 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m01:33:15.639881 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m01:33:16.998802 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m01:33:17.000880 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m01:33:17.940803 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m01:33:17.943333 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m01:33:20.014993 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_trades' was left open.
[0m01:33:20.017242 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_trades: Close
[0m01:33:20.677887 [info ] [MainThread]: 
[0m01:33:20.679885 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 22.96 seconds (22.96s).
[0m01:33:20.686886 [debug] [MainThread]: Command end result
[0m01:33:20.860316 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:33:20.871658 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:33:20.898958 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:33:20.901980 [info ] [MainThread]: 
[0m01:33:20.905966 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:33:20.906971 [info ] [MainThread]: 
[0m01:33:20.908968 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m01:33:20.912473 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:33:20.916835 [debug] [MainThread]: Command `dbt build` succeeded at 01:33:20.916835 after 29.33 seconds
[0m01:33:20.920208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011049B77AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011049B779D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000110503A8850>]}
[0m01:33:20.923383 [debug] [MainThread]: Flushing usage events
[0m01:33:26.870655 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:34:17.411641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1ED5AE250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F0C7C810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F0C7D2D0>]}


============================== 01:34:17.415648 | 132ebb19-d547-4476-a26f-3f6c4e60d03b ==============================
[0m01:34:17.415648 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:34:17.416697 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_b', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m01:34:18.389302 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:34:18.390362 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:34:18.390362 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:34:18.588041 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:34:18.589549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1830FF310>]}
[0m01:34:18.852142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F183159210>]}
[0m01:34:18.946030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1EFC6D0D0>]}
[0m01:34:18.950568 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:34:19.436393 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:34:19.663382 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:34:19.664367 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:34:19.664367 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:34:19.671993 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m01:34:19.731645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F183677110>]}
[0m01:34:19.865999 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:34:19.869414 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:34:19.909781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F18389F210>]}
[0m01:34:19.910809 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:34:19.913870 [info ] [MainThread]: 
[0m01:34:19.915788 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:34:19.915788 [info ] [MainThread]: 
[0m01:34:19.916840 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:34:19.924574 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:34:20.007432 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:34:20.008434 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:34:20.008434 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:34:23.706141 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.697 seconds
[0m01:34:23.728384 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:34:23.771922 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:34:23.774923 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:34:23.776910 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:34:26.055945 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.279 seconds
[0m01:34:26.110740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F04183D0>]}
[0m01:34:26.123308 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:34:26.125307 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:34:26.127221 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m01:34:26.129822 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m01:34:26.131910 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m01:34:26.134171 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m01:34:26.137280 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m01:34:26.140700 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m01:34:26.143698 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m01:34:26.146703 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m01:34:26.150253 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m01:34:26.153319 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m01:34:26.155236 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:34:26.157286 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:34:26.160421 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m01:34:26.162516 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m01:34:26.200007 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m01:34:26.213194 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m01:34:26.225452 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m01:34:26.240083 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m01:34:26.243558 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:34:26.246956 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:34:26.249487 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m01:34:26.287330 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m01:34:26.372687 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m01:34:26.396490 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m01:34:26.408553 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m01:34:26.427689 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m01:34:26.433813 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m01:34:26.437828 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m01:34:26.443447 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m01:34:26.447258 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m01:34:26.452892 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m01:34:26.454903 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m01:34:26.457807 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m01:34:26.461357 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:34:26.464350 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m01:34:26.466350 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:34:26.469350 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:34:26.474787 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:34:29.119414 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.657 seconds
[0m01:34:29.121540 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.652 seconds
[0m01:34:29.424212 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F183FB5450>]}
[0m01:34:29.425724 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F184073050>]}
[0m01:34:29.429265 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 3.27s]
[0m01:34:29.432281 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 3.27s]
[0m01:34:29.435295 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m01:34:29.438290 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m01:34:29.443896 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.969 seconds
[0m01:34:29.446899 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.980 seconds
[0m01:34:29.458427 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1840737D0>]}
[0m01:34:29.467742 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F184068FD0>]}
[0m01:34:29.471277 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 3.31s]
[0m01:34:29.474293 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 3.32s]
[0m01:34:29.477312 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m01:34:29.480565 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m01:34:29.484103 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:34:29.487102 [info ] [Thread-2 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m01:34:29.490634 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m01:34:29.492794 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:34:29.512639 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m01:34:29.516825 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:34:29.532879 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m01:34:29.536878 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m01:34:29.539385 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m01:34:30.503675 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.962 seconds
[0m01:34:30.516904 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F183C50990>]}
[0m01:34:30.519566 [info ] [Thread-2 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 1.03s]
[0m01:34:30.523097 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m01:34:30.526090 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:34:30.529174 [info ] [Thread-5 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m01:34:30.531798 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m01:34:30.535284 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:34:30.550745 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m01:34:30.554274 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:34:30.570407 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m01:34:30.580407 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m01:34:30.583431 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m01:34:31.695093 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.108 seconds
[0m01:34:31.705179 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1830FC910>]}
[0m01:34:31.708169 [info ] [Thread-5 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 1.17s]
[0m01:34:31.712231 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m01:34:31.715244 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m01:34:31.717246 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:34:31.719267 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:34:31.720883 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:34:31.722895 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m01:34:31.726252 [info ] [Thread-2 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m01:34:31.729465 [info ] [Thread-4 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m01:34:31.732674 [info ] [Thread-5 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m01:34:31.735675 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m01:34:31.738171 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m01:34:31.740729 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m01:34:31.743762 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m01:34:31.746762 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m01:34:31.747762 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:34:31.751313 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:34:31.754315 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:34:31.770443 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m01:34:31.778283 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m01:34:31.792830 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m01:34:31.802608 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m01:34:31.804977 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m01:34:31.806353 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:34:31.808569 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:34:31.818461 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m01:34:31.819591 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:34:31.829063 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m01:34:31.844683 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m01:34:31.863680 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m01:34:31.866684 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m01:34:31.875207 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m01:34:31.883743 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m01:34:31.885742 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m01:34:31.891289 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m01:34:31.893275 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m01:34:31.896441 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m01:34:31.900916 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m01:34:33.023423 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.116 seconds
[0m01:34:33.027425 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.116 seconds
[0m01:34:33.037965 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F183FF6290>]}
[0m01:34:33.047663 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F183FB74D0>]}
[0m01:34:33.051577 [info ] [Thread-2 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.30s]
[0m01:34:33.055604 [info ] [Thread-4 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.31s]
[0m01:34:33.059276 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m01:34:33.062830 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m01:34:33.066831 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:34:33.070463 [info ] [Thread-2 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m01:34:33.073007 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_security_performance, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m01:34:33.075542 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:34:33.090379 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m01:34:33.095362 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:34:33.115696 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m01:34:33.121744 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m01:34:33.124708 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m01:34:33.287044 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.388 seconds
[0m01:34:33.290645 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.375 seconds
[0m01:34:33.300377 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F183FF9410>]}
[0m01:34:33.310068 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F183F99950>]}
[0m01:34:33.313154 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.57s]
[0m01:34:33.316918 [info ] [Thread-5 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.57s]
[0m01:34:33.320644 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m01:34:33.323642 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m01:34:33.327559 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:34:33.330957 [info ] [Thread-4 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m01:34:33.333875 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m01:34:33.335865 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:34:33.355483 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m01:34:33.360824 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:34:33.376512 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m01:34:33.381517 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m01:34:33.384477 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m01:34:34.046759 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.920 seconds
[0m01:34:34.055797 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F18360A310>]}
[0m01:34:34.057901 [info ] [Thread-2 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 0.98s]
[0m01:34:34.060183 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m01:34:34.358383 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.971 seconds
[0m01:34:34.368433 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132ebb19-d547-4476-a26f-3f6c4e60d03b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1830FCF10>]}
[0m01:34:34.372758 [info ] [Thread-4 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.04s]
[0m01:34:34.374783 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m01:34:34.380388 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:34:34.382390 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:34:34.385441 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:34:35.134955 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:34:35.136960 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:34:36.461658 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m01:34:36.463834 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m01:34:37.513329 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_trades' was left open.
[0m01:34:37.516250 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_trades: Close
[0m01:34:38.517199 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m01:34:38.519701 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m01:34:39.537218 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_summary' was left open.
[0m01:34:39.539733 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m01:34:40.576336 [info ] [MainThread]: 
[0m01:34:40.579725 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 20.66 seconds (20.66s).
[0m01:34:40.589902 [debug] [MainThread]: Command end result
[0m01:34:40.809965 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:34:40.816577 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:34:40.832278 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:34:40.834439 [info ] [MainThread]: 
[0m01:34:40.835518 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:34:40.837736 [info ] [MainThread]: 
[0m01:34:40.838892 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m01:34:40.840517 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:34:40.845202 [debug] [MainThread]: Command `dbt build` succeeded at 01:34:40.845202 after 23.54 seconds
[0m01:34:40.848184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F0CEF190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1EA077AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1EA0779D0>]}
[0m01:34:40.850712 [debug] [MainThread]: Flushing usage events
[0m01:34:43.364456 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:36:22.897891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E22CF1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E23C12CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E23951E10>]}


============================== 01:36:22.905580 | d5e46da6-906e-437e-b773-145ee4343b8d ==============================
[0m01:36:22.905580 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:36:22.907497 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_c', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m01:36:24.002424 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:36:24.003441 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:36:24.003441 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:36:24.137991 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:36:24.139497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E35EF2610>]}
[0m01:36:24.304968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E35FCED50>]}
[0m01:36:24.366881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E22B9C490>]}
[0m01:36:24.367881 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:36:24.749813 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:36:24.967637 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:36:24.969141 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:36:24.969141 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:36:24.977510 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:36:25.037938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E364B8050>]}
[0m01:36:25.163389 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:36:25.165390 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:36:25.199391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36850350>]}
[0m01:36:25.200396 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:36:25.204396 [info ] [MainThread]: 
[0m01:36:25.205396 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:36:25.206396 [info ] [MainThread]: 
[0m01:36:25.206396 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:36:25.212908 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:36:25.282440 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:36:25.283359 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:36:25.283359 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:36:29.569245 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 4.285 seconds
[0m01:36:29.581347 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:36:29.599323 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:36:29.599923 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:36:29.600922 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:36:32.381638 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.781 seconds
[0m01:36:32.436143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E3688B950>]}
[0m01:36:32.449338 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:36:32.451535 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:36:32.453047 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:36:32.455071 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:36:32.457065 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m01:36:32.459577 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m01:36:32.462605 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m01:36:32.465592 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m01:36:32.469215 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m01:36:32.472736 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m01:36:32.474748 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m01:36:32.477746 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m01:36:32.479293 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:36:32.480303 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:36:32.482307 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:36:32.483315 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:36:32.502395 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:36:32.510366 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:36:32.519880 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:36:32.527894 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:36:32.531424 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:36:32.531424 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:36:32.533944 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:36:32.617845 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:36:32.584773 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:36:32.599802 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:36:32.534942 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:36:32.629361 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:36:32.630875 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:36:32.631880 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:36:32.633881 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:36:32.634880 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m01:36:32.637883 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:36:32.639389 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m01:36:32.641397 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m01:36:32.642403 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:36:32.642403 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m01:36:32.643403 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:36:32.644404 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:36:32.647408 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:36:35.132663 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.488 seconds
[0m01:36:35.235206 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36F9BD50>]}
[0m01:36:35.236174 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 2.76s]
[0m01:36:35.237168 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:36:35.238244 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:36:35.239186 [info ] [Thread-3 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m01:36:35.239791 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m01:36:35.240855 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:36:35.246163 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:36:35.248066 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:36:35.253762 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:36:35.255684 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:36:35.256765 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m01:36:35.338216 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.694 seconds
[0m01:36:35.343740 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36823910>]}
[0m01:36:35.344738 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.88s]
[0m01:36:35.346736 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:36:35.368060 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.726 seconds
[0m01:36:35.372575 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36FB0190>]}
[0m01:36:35.373578 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 2.90s]
[0m01:36:35.374579 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:36:35.914719 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.268 seconds
[0m01:36:35.917718 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36FABB10>]}
[0m01:36:35.919222 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 3.44s]
[0m01:36:35.920228 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:36:35.921228 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:36:35.921228 [info ] [Thread-2 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m01:36:35.922228 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m01:36:35.923230 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:36:35.927353 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:36:35.929349 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:36:35.933860 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:36:35.935863 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:36:35.936958 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m01:36:36.195868 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.938 seconds
[0m01:36:36.199351 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36318110>]}
[0m01:36:36.200355 [info ] [Thread-3 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.96s]
[0m01:36:36.201882 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:36:36.202905 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:36:36.203889 [info ] [Thread-5 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m01:36:36.205400 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m01:36:36.205400 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:36:36.214545 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:36:36.216566 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:36:36.222972 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:36:36.229487 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:36:36.230493 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav,
        nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date) as daily_pnl,
        case
            when lag(nav_usd) over (partition by portfolio_id order by valuation_date) > 0
            then (nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date)) / lag(nav_usd) over (partition by portfolio_id order by valuation_date)
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from valuations
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m01:36:36.788431 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.851 seconds
[0m01:36:36.794134 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36F9AF10>]}
[0m01:36:36.796133 [info ] [Thread-2 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 0.87s]
[0m01:36:36.797130 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:36:36.798128 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:36:36.799636 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:36:36.800752 [info ] [Thread-3 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m01:36:36.801643 [info ] [Thread-4 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m01:36:36.803655 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m01:36:36.806164 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m01:36:36.807176 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:36:36.808176 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:36:36.812609 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:36:36.821117 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:36:36.823121 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:36:36.824121 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:36:36.830630 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:36:36.836994 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:36:36.840503 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:36:36.841503 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        portfolio_id,
        position_date,
        sector,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd
    from enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(market_value_usd) as sector_value,
        sum(quantity) as total_quantity
    from cast_enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as portfolio_value
    from cast_enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m01:36:36.843585 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:36:36.844617 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value,
        market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date) as daily_pnl,
        case
            when lag(market_value_usd) over (partition by security_id order by position_date) > 0
            then (market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date)) / lag(market_value_usd) over (partition by security_id order by position_date)
            else 0
        end as daily_return_pct
    from cast_enriched
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m01:36:37.241705 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.011 seconds
[0m01:36:37.245079 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36B9D010>]}
[0m01:36:37.246349 [info ] [Thread-5 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 1.04s]
[0m01:36:37.248383 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:36:37.251991 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:36:37.251991 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:36:37.253496 [info ] [Thread-2 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m01:36:37.254501 [info ] [Thread-5 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m01:36:37.255548 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m01:36:37.256557 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m01:36:37.257558 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:36:37.257558 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:36:37.267596 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:36:37.274393 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:36:37.276303 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:36:37.277307 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:36:37.283818 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:36:37.291620 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:36:37.297178 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:36:37.300186 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:36:37.301193 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m01:36:37.303236 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m01:36:38.048319 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.202 seconds
[0m01:36:38.051843 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.209 seconds
[0m01:36:38.059351 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E33C72BD0>]}
[0m01:36:38.063949 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36FD68D0>]}
[0m01:36:38.065883 [info ] [Thread-3 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 1.26s]
[0m01:36:38.067873 [info ] [Thread-4 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 1.26s]
[0m01:36:38.069412 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:36:38.071420 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:36:38.072505 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:36:38.073788 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:36:38.075801 [info ] [Thread-3 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m01:36:38.077798 [info ] [Thread-4 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m01:36:38.078507 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m01:36:38.079495 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m01:36:38.080872 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:36:38.082199 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:36:38.089220 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:36:38.093992 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:36:38.097361 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:36:38.097361 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:36:38.101871 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:36:38.105954 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:36:38.109397 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:36:38.110403 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m01:36:38.113402 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:36:38.114403 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m01:36:38.219233 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.914 seconds
[0m01:36:38.221784 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.918 seconds
[0m01:36:38.229283 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36FABC50>]}
[0m01:36:38.232798 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E35F47D50>]}
[0m01:36:38.234068 [info ] [Thread-5 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 0.97s]
[0m01:36:38.236080 [info ] [Thread-2 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 0.98s]
[0m01:36:38.236722 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:36:38.237517 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:36:38.238594 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:36:38.239599 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:36:38.239599 [info ] [Thread-5 (]: 14 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m01:36:38.241025 [info ] [Thread-2 (]: 15 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m01:36:38.242070 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m01:36:38.243031 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m01:36:38.243031 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:36:38.244064 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:36:38.249657 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:36:38.253662 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:36:38.254710 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:36:38.255662 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:36:38.259254 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:36:38.263602 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:36:38.265496 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:36:38.266493 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m01:36:38.267774 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:36:38.270385 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m01:36:38.779875 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.669 seconds
[0m01:36:38.785154 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E3676D250>]}
[0m01:36:38.786153 [info ] [Thread-3 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 0.71s]
[0m01:36:38.788158 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:36:38.788158 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:36:38.789670 [info ] [Thread-3 (]: 16 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m01:36:38.790679 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m01:36:38.791681 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:36:38.796691 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:36:38.797692 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:36:38.801417 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:36:38.803718 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:36:38.804718 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m01:36:39.013798 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.899 seconds
[0m01:36:39.021311 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36FD68D0>]}
[0m01:36:39.022316 [info ] [Thread-4 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 0.94s]
[0m01:36:39.024316 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:36:39.025346 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:36:39.028315 [info ] [Thread-4 (]: 17 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m01:36:39.029324 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m01:36:39.030419 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:36:39.039224 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:36:39.041784 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:36:39.051812 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:36:39.055877 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:36:39.057871 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m01:36:39.309308 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.040 seconds
[0m01:36:39.313458 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E23BD2010>]}
[0m01:36:39.316487 [info ] [Thread-5 (]: 14 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 1.07s]
[0m01:36:39.317476 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:36:39.318955 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:36:39.319459 [info ] [Thread-5 (]: 18 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m01:36:39.319459 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m01:36:39.320925 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:36:39.324729 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:36:39.329164 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:36:39.334509 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:36:39.339170 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:36:39.340901 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m01:36:39.595405 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.790 seconds
[0m01:36:39.599979 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36B9CB50>]}
[0m01:36:39.601676 [info ] [Thread-3 (]: 16 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 0.81s]
[0m01:36:39.604866 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:36:39.606458 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:36:39.607507 [info ] [Thread-3 (]: 19 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m01:36:39.609259 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m01:36:39.610139 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:36:39.620866 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:36:39.622175 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:36:39.632874 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:36:39.639416 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:36:39.640996 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m01:36:39.905394 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.634 seconds
[0m01:36:39.919148 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E380D4910>]}
[0m01:36:39.923323 [info ] [Thread-2 (]: 15 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 1.68s]
[0m01:36:39.927350 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:36:39.929345 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:36:39.932472 [info ] [Thread-2 (]: 20 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m01:36:39.935463 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m01:36:39.938465 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:36:39.951050 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:36:39.954568 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:36:39.966522 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:36:39.972338 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:36:39.973345 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m01:36:40.829603 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.770 seconds
[0m01:36:40.831047 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.490 seconds
[0m01:36:40.832443 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.191 seconds
[0m01:36:40.837870 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36B331D0>]}
[0m01:36:40.842860 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E3808ED90>]}
[0m01:36:40.845742 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E380C13D0>]}
[0m01:36:40.850519 [info ] [Thread-4 (]: 17 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 1.81s]
[0m01:36:40.851515 [info ] [Thread-5 (]: 18 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 1.52s]
[0m01:36:40.853519 [info ] [Thread-3 (]: 19 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 1.24s]
[0m01:36:40.854837 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:36:40.855849 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:36:40.856845 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:36:40.856845 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:36:40.859253 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:36:40.862305 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:36:40.862846 [info ] [Thread-4 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m01:36:40.863869 [info ] [Thread-5 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m01:36:40.865011 [info ] [Thread-3 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m01:36:40.865011 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m01:36:40.866023 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m01:36:40.867164 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m01:36:40.868227 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:36:40.868227 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:36:40.869232 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:36:40.876272 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:36:40.884519 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:36:40.890004 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:36:40.892446 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:36:40.894457 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:36:40.898462 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:36:40.899462 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:36:40.944127 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:36:40.947124 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:36:40.956992 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:36:40.960237 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m01:36:40.962238 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:36:40.964240 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m01:36:40.967238 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:36:40.971703 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m01:36:41.121720 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.147 seconds
[0m01:36:41.131529 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E3812EAD0>]}
[0m01:36:41.134046 [info ] [Thread-2 (]: 20 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 1.20s]
[0m01:36:41.137529 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:36:41.140114 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:36:41.141197 [info ] [Thread-2 (]: 24 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m01:36:41.143117 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m01:36:41.144160 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:36:41.154104 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:36:41.158036 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:36:41.175869 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:36:41.181388 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:36:41.185399 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m01:36:42.100535 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.913 seconds
[0m01:36:42.106043 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E36859790>]}
[0m01:36:42.108041 [info ] [Thread-2 (]: 24 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 0.96s]
[0m01:36:42.108041 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:36:42.109547 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:36:42.110553 [info ] [Thread-2 (]: 25 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m01:36:42.111557 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_position_attribution, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m01:36:42.111557 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:36:42.116034 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:36:42.117032 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:36:42.123586 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:36:42.126573 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:36:42.126573 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m01:36:42.458387 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.495 seconds
[0m01:36:42.464433 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E3608A250>]}
[0m01:36:42.466509 [info ] [Thread-4 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 1.60s]
[0m01:36:42.468451 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:36:42.469930 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:36:42.471955 [info ] [Thread-4 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m01:36:42.472942 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m01:36:42.473942 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:36:42.481470 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:36:42.483474 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:36:42.487474 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:36:42.489474 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:36:42.489979 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m01:36:42.773646 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.799 seconds
[0m01:36:42.777629 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E38059350>]}
[0m01:36:43.039695 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.912 seconds
[0m01:36:43.049287 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E1FAB0F90>]}
[0m01:36:43.379260 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.887 seconds
[0m01:36:43.390722 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E380E9610>]}
[0m01:36:43.987638 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.019 seconds
[0m01:36:43.995686 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e46da6-906e-437e-b773-145ee4343b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E38064450>]}
[0m01:36:46.357196 [debug] [Thread-3 (]: An error was encountered while trying to send an event
[0m01:36:46.358990 [info ] [Thread-2 (]: 25 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 0.94s]
[0m01:36:46.360091 [info ] [Thread-4 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 0.92s]
[0m01:36:46.360091 [info ] [Thread-5 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 3.13s]
[0m01:36:46.362105 [info ] [Thread-3 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.91s]
[0m01:36:46.363792 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:36:46.365290 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:36:46.366840 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:36:46.367905 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:36:46.371510 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:36:46.372606 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:36:46.373333 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:36:47.642685 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:36:47.643725 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:36:48.885375 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_performance_drivers' was left open.
[0m01:36:48.888365 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m01:36:50.197768 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_executive_summary' was left open.
[0m01:36:50.200277 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m01:36:51.542828 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m01:36:51.545919 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m01:36:52.653575 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m01:36:52.655693 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m01:36:53.682522 [info ] [MainThread]: 
[0m01:36:53.685495 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 28.48 seconds (28.48s).
[0m01:36:53.706936 [debug] [MainThread]: Command end result
[0m01:36:53.942690 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:36:53.953231 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:36:53.986485 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:36:53.989488 [info ] [MainThread]: 
[0m01:36:53.992517 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:36:53.996184 [info ] [MainThread]: 
[0m01:36:53.999196 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m01:36:54.003731 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:36:54.009357 [debug] [MainThread]: Command `dbt build` succeeded at 01:36:54.007726 after 31.23 seconds
[0m01:36:54.012470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E1CF67AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E1CF679D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021E22CF1810>]}
[0m01:36:54.015375 [debug] [MainThread]: Flushing usage events
[0m01:36:55.653485 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:37:37.463668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000228596AD910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022859712850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000228596AF0D0>]}


============================== 01:37:37.471468 | 700f5896-8648-4a57-bfa6-d03ee7e5db2a ==============================
[0m01:37:37.471468 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:37:37.472987 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --select tag:pipeline_c', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m01:37:38.751113 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:37:38.753635 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:37:38.754634 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:37:38.936530 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:37:38.938531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286BACC210>]}
[0m01:37:39.113783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286BB50950>]}
[0m01:37:39.188482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002285869D110>]}
[0m01:37:39.189457 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:37:39.560474 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:37:39.793551 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:37:39.794548 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:37:39.795543 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:37:39.803067 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m01:37:39.866864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C0E7190>]}
[0m01:37:40.015228 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:37:40.017287 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:37:40.073818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286BE57E10>]}
[0m01:37:40.074812 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:37:40.077812 [info ] [MainThread]: 
[0m01:37:40.079316 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:37:40.080320 [info ] [MainThread]: 
[0m01:37:40.080320 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:37:40.086830 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:37:40.157690 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:37:40.157690 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:37:40.159196 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:37:43.393014 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.234 seconds
[0m01:37:43.407570 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:37:43.441253 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:37:43.442249 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:37:43.442249 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:37:45.597731 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.156 seconds
[0m01:37:45.656849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C8A37D0>]}
[0m01:37:45.666912 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:37:45.667909 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:37:45.667909 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:37:45.670426 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:37:45.672434 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m01:37:45.674432 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m01:37:45.676433 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m01:37:45.678433 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m01:37:45.679433 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m01:37:45.680640 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m01:37:45.682642 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m01:37:45.684637 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m01:37:45.687110 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:37:45.688471 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:37:45.689483 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:37:45.690567 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:37:45.707506 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:37:45.714319 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:37:45.719131 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:37:45.728486 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:37:45.732628 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:37:45.735629 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:37:45.739142 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:37:45.740150 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:37:45.799320 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:37:45.794923 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:37:45.809240 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:37:45.817649 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:37:45.820159 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:37:45.822423 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:37:45.825428 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:37:45.827424 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m01:37:45.829417 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:37:45.830425 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m01:37:45.831763 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m01:37:45.832769 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:37:45.834149 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m01:37:45.835196 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:37:45.837167 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:37:45.840478 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:37:48.639331 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.805 seconds
[0m01:37:48.769125 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C375550>]}
[0m01:37:48.770138 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 3.08s]
[0m01:37:48.771138 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:37:48.772148 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:37:48.772148 [info ] [Thread-4 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m01:37:48.773147 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m01:37:48.774170 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:37:48.778167 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:37:48.779155 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:37:48.783541 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:37:48.784525 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:37:48.785530 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m01:37:48.857286 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.020 seconds
[0m01:37:48.859284 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.026 seconds
[0m01:37:48.868072 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C369310>]}
[0m01:37:48.875678 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286CA9A810>]}
[0m01:37:48.879115 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 3.19s]
[0m01:37:48.882133 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 3.20s]
[0m01:37:48.885128 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:37:48.888218 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:37:49.135194 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.295 seconds
[0m01:37:49.144203 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286CA0C710>]}
[0m01:37:49.147974 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 3.46s]
[0m01:37:49.151501 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:37:49.154515 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:37:49.156513 [info ] [Thread-2 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m01:37:49.160028 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m01:37:49.161668 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:37:49.174722 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:37:49.176719 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:37:49.187363 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:37:49.191582 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:37:49.192590 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m01:37:49.429460 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.643 seconds
[0m01:37:49.434514 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286CA04810>]}
[0m01:37:49.436369 [info ] [Thread-4 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.66s]
[0m01:37:49.437377 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:37:49.439188 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:37:49.440423 [info ] [Thread-5 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m01:37:49.442006 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m01:37:49.443130 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:37:49.450106 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:37:49.451884 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:37:49.458728 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:37:49.462526 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:37:49.463574 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav,
        nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date) as daily_pnl,
        case
            when lag(nav_usd) over (partition by portfolio_id order by valuation_date) > 0
            then (nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date)) / lag(nav_usd) over (partition by portfolio_id order by valuation_date)
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from valuations
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m01:37:50.037161 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.843 seconds
[0m01:37:50.043838 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286CAC3E50>]}
[0m01:37:50.045756 [info ] [Thread-2 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 0.88s]
[0m01:37:50.046757 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:37:50.047863 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:37:50.047863 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:37:50.049376 [info ] [Thread-4 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m01:37:50.050502 [info ] [Thread-3 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m01:37:50.051846 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m01:37:50.052855 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m01:37:50.053948 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:37:50.054903 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:37:50.060134 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:37:50.067562 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:37:50.069460 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:37:50.070724 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:37:50.073714 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:37:50.079288 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:37:50.082476 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:37:50.083481 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value,
        market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date) as daily_pnl,
        case
            when lag(market_value_usd) over (partition by security_id order by position_date) > 0
            then (market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date)) / lag(market_value_usd) over (partition by security_id order by position_date)
            else 0
        end as daily_return_pct
    from cast_enriched
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m01:37:50.084495 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:37:50.085491 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        portfolio_id,
        position_date,
        sector,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd
    from enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(market_value_usd) as sector_value,
        sum(quantity) as total_quantity
    from cast_enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as portfolio_value
    from cast_enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m01:37:50.302642 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.838 seconds
[0m01:37:50.308331 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C672D10>]}
[0m01:37:50.310550 [info ] [Thread-5 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 0.87s]
[0m01:37:50.311551 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:37:50.312549 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:37:50.313551 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:37:50.314636 [info ] [Thread-2 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m01:37:50.315671 [info ] [Thread-5 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m01:37:50.317553 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m01:37:50.318683 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m01:37:50.319291 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:37:50.320777 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:37:50.327850 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:37:50.334215 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:37:50.336263 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:37:50.340769 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:37:50.341773 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:37:50.345773 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:37:50.347773 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:37:50.350285 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m01:37:50.351286 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:37:50.352301 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m01:37:50.879131 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.793 seconds
[0m01:37:50.885711 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C3521D0>]}
[0m01:37:50.886711 [info ] [Thread-4 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 0.83s]
[0m01:37:50.887792 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:37:50.889375 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:37:50.891398 [info ] [Thread-4 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m01:37:50.893028 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m01:37:50.894040 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:37:50.900544 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:37:50.903537 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:37:50.908612 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:37:50.911178 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:37:50.912143 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m01:37:51.079581 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.994 seconds
[0m01:37:51.081855 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.730 seconds
[0m01:37:51.087761 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000228596E40D0>]}
[0m01:37:51.091410 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286BAD5C90>]}
[0m01:37:51.093531 [info ] [Thread-3 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 1.03s]
[0m01:37:51.094537 [info ] [Thread-2 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 0.77s]
[0m01:37:51.095537 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:37:51.095916 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:37:51.096672 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:37:51.097368 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:37:51.098373 [info ] [Thread-3 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m01:37:51.099384 [info ] [Thread-2 (]: 14 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m01:37:51.099906 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m01:37:51.100907 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m01:37:51.101922 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:37:51.101922 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:37:51.105908 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:37:51.109413 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:37:51.110419 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.756 seconds
[0m01:37:51.112579 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:37:51.114677 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C8BB050>]}
[0m01:37:51.115664 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:37:51.118438 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:37:51.119441 [info ] [Thread-5 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 0.80s]
[0m01:37:51.124822 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:37:51.126584 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:37:51.127671 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:37:51.129176 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:37:51.130182 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:37:51.131200 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m01:37:51.131797 [info ] [Thread-5 (]: 15 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m01:37:51.132801 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m01:37:51.134801 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m01:37:51.136802 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:37:51.140882 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:37:51.143349 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:37:51.147354 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:37:51.149857 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:37:51.150861 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m01:37:51.641574 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.729 seconds
[0m01:37:51.648751 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286DB91510>]}
[0m01:37:51.650274 [info ] [Thread-4 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 0.75s]
[0m01:37:51.651268 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:37:51.652472 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:37:51.653477 [info ] [Thread-4 (]: 16 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m01:37:51.655485 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m01:37:51.656939 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:37:51.666325 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:37:51.670004 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:37:51.677902 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:37:51.684175 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:37:51.685416 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m01:37:51.952080 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.801 seconds
[0m01:37:51.956080 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C999210>]}
[0m01:37:51.958082 [info ] [Thread-5 (]: 15 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 0.82s]
[0m01:37:51.960608 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:37:51.961612 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:37:51.961612 [info ] [Thread-5 (]: 17 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m01:37:51.962615 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m01:37:51.963614 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:37:51.967784 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:37:51.970309 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:37:51.975313 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:37:51.978324 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:37:51.979329 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m01:37:52.205139 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.069 seconds
[0m01:37:52.208147 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.074 seconds
[0m01:37:52.216761 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C3537D0>]}
[0m01:37:52.226356 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286CA07ED0>]}
[0m01:37:52.229436 [info ] [Thread-2 (]: 14 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 1.11s]
[0m01:37:52.231740 [info ] [Thread-3 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 1.13s]
[0m01:37:52.235278 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:37:52.238274 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:37:52.240924 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:37:52.242982 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:37:52.245906 [info ] [Thread-2 (]: 18 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m01:37:52.249571 [info ] [Thread-3 (]: 19 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m01:37:52.252594 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m01:37:52.254595 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m01:37:52.257592 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:37:52.260638 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:37:52.271711 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:37:52.281343 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:37:52.284345 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:37:52.295149 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:37:52.297164 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:37:52.305755 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:37:52.309322 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:37:52.312334 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m01:37:52.315937 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:37:52.317918 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m01:37:52.498413 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.812 seconds
[0m01:37:52.503817 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022858744FD0>]}
[0m01:37:52.505819 [info ] [Thread-4 (]: 16 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 0.85s]
[0m01:37:52.506817 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:37:52.506817 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:37:52.507818 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m01:37:52.509325 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m01:37:52.510330 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:37:52.514845 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:37:52.516841 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:37:52.523407 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:37:52.525404 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:37:52.526411 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m01:37:52.918232 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.937 seconds
[0m01:37:52.921555 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002285650CF10>]}
[0m01:37:52.923507 [info ] [Thread-5 (]: 17 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 0.96s]
[0m01:37:52.925516 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:37:52.928505 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:37:52.930025 [info ] [Thread-5 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m01:37:52.931053 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m01:37:52.932125 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:37:52.941569 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:37:52.943567 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:37:52.952183 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:37:52.954198 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:37:52.955178 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m01:37:53.215658 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.898 seconds
[0m01:37:53.217982 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.896 seconds
[0m01:37:53.220494 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C0973D0>]}
[0m01:37:53.227511 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286CA0F710>]}
[0m01:37:53.228511 [info ] [Thread-2 (]: 18 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 0.97s]
[0m01:37:53.229515 [info ] [Thread-3 (]: 19 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 0.97s]
[0m01:37:53.230560 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:37:53.231560 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:37:53.232559 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:37:53.233562 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:37:53.234560 [info ] [Thread-2 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m01:37:53.235559 [info ] [Thread-3 (]: 23 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m01:37:53.239564 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m01:37:53.241086 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m01:37:53.242084 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:37:53.243083 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:37:53.251482 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:37:53.255479 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:37:53.258497 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:37:53.259994 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:37:53.307836 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:37:53.315917 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:37:53.320396 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:37:53.322402 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:37:53.323405 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m01:37:53.324404 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m01:37:53.447205 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.920 seconds
[0m01:37:53.452756 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C323250>]}
[0m01:37:53.454733 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 0.94s]
[0m01:37:53.455734 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:37:53.456733 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:37:53.457732 [info ] [Thread-4 (]: 24 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m01:37:53.459246 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m01:37:53.461256 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:37:53.468260 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:37:53.472517 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:37:53.478075 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:37:53.486122 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:37:53.487124 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m01:37:54.148283 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.192 seconds
[0m01:37:54.152827 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C3500D0>]}
[0m01:37:54.153825 [info ] [Thread-5 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 1.22s]
[0m01:37:54.154829 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:37:54.155855 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:37:54.157857 [info ] [Thread-5 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m01:37:54.159364 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m01:37:54.160369 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:37:54.168382 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:37:54.171535 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:37:54.180032 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:37:54.182063 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:37:54.184059 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m01:37:54.446842 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.118 seconds
[0m01:37:54.452893 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286C35BA50>]}
[0m01:37:54.454907 [info ] [Thread-3 (]: 23 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 1.21s]
[0m01:37:54.455905 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:37:54.456907 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:37:54.457906 [info ] [Thread-3 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m01:37:54.459508 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_performance_drivers, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m01:37:54.460612 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:37:54.464518 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:37:54.465518 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:37:54.468518 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:37:54.470022 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:37:54.471027 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m01:37:54.927685 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.439 seconds
[0m01:37:54.931213 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022856C6F5D0>]}
[0m01:37:55.034997 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.850 seconds
[0m01:37:55.044631 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286DB8A750>]}
[0m01:37:55.817237 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.345 seconds
[0m01:37:55.825030 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022858745250>]}
[0m01:37:56.394064 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.068 seconds
[0m01:37:56.402764 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700f5896-8648-4a57-bfa6-d03ee7e5db2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002286CB3F010>]}
[0m01:37:57.711855 [debug] [Thread-4 (]: An error was encountered while trying to send an event
[0m01:37:57.712872 [info ] [Thread-5 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 0.89s]
[0m01:37:57.715045 [info ] [Thread-3 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 1.37s]
[0m01:37:57.717057 [info ] [Thread-2 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 3.16s]
[0m01:37:57.718502 [info ] [Thread-4 (]: 24 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.47s]
[0m01:37:57.719547 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:37:57.721635 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:37:57.723166 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:37:57.725172 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:37:57.731432 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:37:57.732509 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:37:57.733522 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:37:59.421057 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:37:59.422042 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:38:00.561676 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m01:38:00.561676 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m01:38:01.887752 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m01:38:01.889294 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m01:38:02.804981 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_executive_summary' was left open.
[0m01:38:02.806969 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m01:38:03.718031 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_position_attribution' was left open.
[0m01:38:03.720563 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m01:38:04.780450 [info ] [MainThread]: 
[0m01:38:04.781537 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 24.70 seconds (24.70s).
[0m01:38:04.786466 [debug] [MainThread]: Command end result
[0m01:38:04.846868 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:38:04.850409 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:38:04.859248 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:38:04.859752 [info ] [MainThread]: 
[0m01:38:04.859752 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:38:04.861179 [info ] [MainThread]: 
[0m01:38:04.862196 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m01:38:04.862196 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:38:04.863196 [debug] [MainThread]: Command `dbt build` succeeded at 01:38:04.863196 after 27.51 seconds
[0m01:38:04.864193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022852AD7A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022852AD79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002285969FCD0>]}
[0m01:38:04.865194 [debug] [MainThread]: Flushing usage events
[0m01:38:07.100195 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:38:56.784860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1875EE290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1875EC8D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1875EE2D0>]}


============================== 01:38:56.789337 | b99acd62-73aa-4152-bf2e-5efe969df8b5 ==============================
[0m01:38:56.789337 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:38:56.790367 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_c', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m01:38:58.401602 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:38:58.403604 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:38:58.406621 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:38:58.746656 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:38:58.750330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1876949D0>]}
[0m01:38:59.330659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C199ADCE50>]}
[0m01:38:59.533216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1865CD090>]}
[0m01:38:59.537160 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:39:01.028369 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:39:01.736494 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:39:01.738494 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:39:01.741061 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:39:01.769246 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m01:39:01.974889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C199ACB350>]}
[0m01:39:02.425346 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:39:02.433029 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:39:02.559515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A290410>]}
[0m01:39:02.561533 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:39:02.575379 [info ] [MainThread]: 
[0m01:39:02.577381 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:39:02.579976 [info ] [MainThread]: 
[0m01:39:02.583175 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:39:02.604812 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:39:02.885404 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:39:02.888390 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:39:02.890774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:39:06.307866 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.418 seconds
[0m01:39:06.331618 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:39:06.373116 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:39:06.375115 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:39:06.377996 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:39:09.156310 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.779 seconds
[0m01:39:09.210666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A19AE50>]}
[0m01:39:09.223289 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:39:09.225340 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:39:09.226375 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:39:09.228369 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:39:09.231067 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m01:39:09.234052 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m01:39:09.237160 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m01:39:09.239659 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m01:39:09.241680 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m01:39:09.244684 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m01:39:09.247683 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m01:39:09.251222 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m01:39:09.253247 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:39:09.255236 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:39:09.257749 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:39:09.260402 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:39:09.291476 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:39:09.304629 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:39:09.320189 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:39:09.333734 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:39:09.337742 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:39:09.341380 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:39:09.343219 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:39:09.404902 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:39:09.491494 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:39:09.499451 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:39:09.510440 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:39:09.526495 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:39:09.532964 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:39:09.536028 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:39:09.540665 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:39:09.543742 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m01:39:09.545653 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:39:09.547759 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m01:39:09.551381 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m01:39:09.553919 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:39:09.555920 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m01:39:09.558592 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:39:09.560637 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:39:09.565753 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:39:12.280088 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.726 seconds
[0m01:39:12.386217 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A9C4350>]}
[0m01:39:12.390654 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 3.14s]
[0m01:39:12.395676 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:39:12.397679 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:39:12.400287 [info ] [Thread-3 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m01:39:12.404101 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m01:39:12.406122 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:39:12.424027 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:39:12.429525 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:39:12.449408 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:39:12.456296 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:39:12.465533 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m01:39:12.499587 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.934 seconds
[0m01:39:12.513683 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A952AD0>]}
[0m01:39:12.517683 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 3.26s]
[0m01:39:12.522215 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:39:12.525215 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:39:12.530746 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.969 seconds
[0m01:39:12.531745 [info ] [Thread-5 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m01:39:12.545813 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A7EB050>]}
[0m01:39:12.549320 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m01:39:12.552360 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 3.30s]
[0m01:39:12.555338 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:39:12.559337 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:39:12.576608 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:39:12.581691 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:39:12.598228 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:39:12.605806 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:39:12.607805 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m01:39:13.208349 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.649 seconds
[0m01:39:13.212912 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.741 seconds
[0m01:39:13.222973 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A9C5710>]}
[0m01:39:13.235529 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A92E6D0>]}
[0m01:39:13.238524 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 3.98s]
[0m01:39:13.241894 [info ] [Thread-3 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.83s]
[0m01:39:13.245922 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:39:13.249439 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:39:13.252469 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:39:13.255469 [info ] [Thread-4 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m01:39:13.258474 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m01:39:13.261878 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:39:13.281135 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:39:13.284321 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:39:13.301267 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:39:13.309279 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:39:13.313318 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav,
        nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date) as daily_pnl,
        case
            when lag(nav_usd) over (partition by portfolio_id order by valuation_date) > 0
            then (nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date)) / lag(nav_usd) over (partition by portfolio_id order by valuation_date)
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from valuations
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m01:39:13.500960 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.889 seconds
[0m01:39:13.513240 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C186E4C390>]}
[0m01:39:13.514747 [info ] [Thread-5 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 0.96s]
[0m01:39:13.517503 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:39:13.521358 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:39:13.523356 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:39:13.525760 [info ] [Thread-3 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m01:39:13.527936 [info ] [Thread-2 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m01:39:13.530465 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m01:39:13.531466 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m01:39:13.534646 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:39:13.535664 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:39:13.555592 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:39:13.569588 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:39:13.575601 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:39:13.593643 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:39:13.595642 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:39:13.612400 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:39:13.620955 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:39:13.622932 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value,
        market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date) as daily_pnl,
        case
            when lag(market_value_usd) over (partition by security_id order by position_date) > 0
            then (market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date)) / lag(market_value_usd) over (partition by security_id order by position_date)
            else 0
        end as daily_return_pct
    from cast_enriched
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m01:39:13.630881 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:39:13.635900 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        portfolio_id,
        position_date,
        sector,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd
    from enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(market_value_usd) as sector_value,
        sum(quantity) as total_quantity
    from cast_enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as portfolio_value
    from cast_enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m01:39:14.324960 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.009 seconds
[0m01:39:14.336781 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A80B2D0>]}
[0m01:39:14.340418 [info ] [Thread-4 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 1.08s]
[0m01:39:14.344417 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:39:14.348500 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:39:14.350097 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:39:14.352703 [info ] [Thread-5 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m01:39:14.355727 [info ] [Thread-4 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m01:39:14.359304 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m01:39:14.361320 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m01:39:14.364344 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:39:14.366877 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:39:14.382517 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:39:14.400388 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:39:14.405394 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:39:14.423693 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:39:14.426691 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:39:14.441279 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:39:14.454137 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:39:14.458137 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m01:39:14.465628 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:39:14.469137 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m01:39:14.711895 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.078 seconds
[0m01:39:14.726994 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19AA37F50>]}
[0m01:39:14.730520 [info ] [Thread-3 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 1.20s]
[0m01:39:14.734559 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:39:14.736588 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:39:14.740180 [info ] [Thread-3 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m01:39:14.742371 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m01:39:14.745391 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:39:14.757505 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:39:14.761732 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:39:14.777950 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:39:14.787997 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:39:14.790552 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m01:39:14.805360 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.164 seconds
[0m01:39:14.815508 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A9F7710>]}
[0m01:39:14.818419 [info ] [Thread-2 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 1.28s]
[0m01:39:14.821986 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:39:14.824975 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:39:14.828061 [info ] [Thread-2 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m01:39:14.831325 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m01:39:14.834290 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:39:14.848010 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:39:14.853147 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:39:14.869167 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:39:14.877757 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:39:14.881406 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m01:39:15.367532 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.893 seconds
[0m01:39:15.379221 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A9FFFD0>]}
[0m01:39:15.382748 [info ] [Thread-4 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 1.02s]
[0m01:39:15.385758 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:39:15.389265 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:39:15.392279 [info ] [Thread-4 (]: 14 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m01:39:15.394285 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m01:39:15.397081 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:39:15.412184 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:39:15.416641 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:39:15.428459 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:39:15.434498 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:39:15.437493 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m01:39:15.586408 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.126 seconds
[0m01:39:15.596967 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A8D4FD0>]}
[0m01:39:15.601491 [info ] [Thread-5 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 1.24s]
[0m01:39:15.605504 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:39:15.607504 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:39:15.610911 [info ] [Thread-5 (]: 15 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m01:39:15.614428 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m01:39:15.616427 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:39:15.631116 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:39:15.636171 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:39:15.661336 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:39:15.673421 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:39:15.677409 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m01:39:15.683491 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.891 seconds
[0m01:39:15.687504 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.803 seconds
[0m01:39:15.701561 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C186DB1790>]}
[0m01:39:15.717608 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19BAD72D0>]}
[0m01:39:15.723163 [info ] [Thread-3 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 0.96s]
[0m01:39:15.726440 [info ] [Thread-2 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 0.89s]
[0m01:39:15.729466 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:39:15.732988 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:39:15.737012 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:39:15.739515 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:39:15.742532 [info ] [Thread-3 (]: 16 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m01:39:15.747534 [info ] [Thread-2 (]: 17 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m01:39:15.751054 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m01:39:15.754056 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m01:39:15.758057 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:39:15.761576 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:39:15.774676 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:39:15.788487 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:39:15.793358 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:39:15.796094 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:39:15.813193 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:39:15.826122 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:39:15.835640 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:39:15.842176 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:39:15.845233 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m01:39:15.848176 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m01:39:16.675034 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.823 seconds
[0m01:39:16.677034 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.237 seconds
[0m01:39:16.686566 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19BADBB50>]}
[0m01:39:16.693105 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A1AC290>]}
[0m01:39:16.695105 [info ] [Thread-3 (]: 16 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 0.94s]
[0m01:39:16.698105 [info ] [Thread-4 (]: 14 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 1.30s]
[0m01:39:16.701617 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:39:16.705051 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:39:16.708073 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:39:16.709592 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:39:16.712599 [info ] [Thread-3 (]: 18 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m01:39:16.715884 [info ] [Thread-4 (]: 19 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m01:39:16.719402 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m01:39:16.721419 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m01:39:16.724416 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:39:16.727415 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:39:16.741503 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:39:16.757999 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:39:16.762521 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:39:16.765519 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:39:16.776079 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:39:16.795182 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:39:16.805594 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:39:16.815220 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:39:16.817220 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m01:39:16.819724 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m01:39:16.926130 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.073 seconds
[0m01:39:16.929127 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.239 seconds
[0m01:39:16.937751 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19BB16D90>]}
[0m01:39:16.947309 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19BB17B10>]}
[0m01:39:16.950837 [info ] [Thread-2 (]: 17 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 1.18s]
[0m01:39:16.953858 [info ] [Thread-5 (]: 15 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 1.33s]
[0m01:39:16.958172 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:39:16.961281 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:39:16.963298 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:39:16.966293 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:39:16.969785 [info ] [Thread-2 (]: 20 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m01:39:16.972091 [info ] [Thread-5 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m01:39:16.974085 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m01:39:16.976084 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m01:39:16.979541 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:39:16.979541 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:39:16.996545 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:39:17.011632 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:39:17.016605 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:39:17.019128 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:39:17.028271 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:39:17.040796 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:39:17.047803 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:39:17.050940 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:39:17.052954 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m01:39:17.057787 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m01:39:17.941205 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.118 seconds
[0m01:39:17.945219 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.882 seconds
[0m01:39:17.948201 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.121 seconds
[0m01:39:17.957252 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A2A9CD0>]}
[0m01:39:17.968364 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19BAFCC10>]}
[0m01:39:17.975582 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C199FE6310>]}
[0m01:39:17.979996 [info ] [Thread-3 (]: 18 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 1.24s]
[0m01:39:17.984020 [info ] [Thread-5 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 0.99s]
[0m01:39:17.987015 [info ] [Thread-4 (]: 19 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 1.25s]
[0m01:39:17.991587 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:39:17.994595 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:39:17.996593 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:39:18.000105 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:39:18.002109 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:39:18.005109 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:39:18.008109 [info ] [Thread-3 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m01:39:18.011636 [info ] [Thread-5 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m01:39:18.014997 [info ] [Thread-4 (]: 24 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m01:39:18.017012 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m01:39:18.020935 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m01:39:18.024073 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m01:39:18.026071 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:39:18.028070 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:39:18.030581 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:39:18.047115 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:39:18.062684 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:39:18.079552 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:39:18.082566 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:39:18.085563 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:39:18.126263 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:39:18.220251 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:39:18.222258 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:39:18.243827 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:39:18.246826 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.186 seconds
[0m01:39:18.259899 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:39:18.265907 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:39:18.275137 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A9F1D50>]}
[0m01:39:18.279634 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:39:18.282821 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m01:39:18.285828 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m01:39:18.290386 [info ] [Thread-2 (]: 20 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 1.30s]
[0m01:39:18.293390 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m01:39:18.304604 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:39:18.315711 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:39:18.320885 [info ] [Thread-2 (]: 25 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m01:39:18.323918 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m01:39:18.327902 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:39:18.347744 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:39:18.352795 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:39:18.373412 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:39:18.380578 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:39:18.382583 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m01:39:19.200463 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.892 seconds
[0m01:39:19.210130 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19AAA0F90>]}
[0m01:39:19.213361 [info ] [Thread-4 (]: 24 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 1.19s]
[0m01:39:19.215376 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:39:19.217275 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:39:19.219781 [info ] [Thread-4 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m01:39:19.222804 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_position_attribution, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m01:39:19.223804 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:39:19.235114 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:39:19.239463 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.855 seconds
[0m01:39:19.250835 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19BB81ED0>]}
[0m01:39:19.251845 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:39:19.269389 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:39:19.280205 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:39:19.283358 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m01:39:19.528137 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.232 seconds
[0m01:39:19.539586 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A959190>]}
[0m01:39:20.179687 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.894 seconds
[0m01:39:20.189215 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19A290DD0>]}
[0m01:39:20.336514 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.038 seconds
[0m01:39:20.347720 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b99acd62-73aa-4152-bf2e-5efe969df8b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19AA6A290>]}
[0m01:39:22.371204 [debug] [Thread-2 (]: An error was encountered while trying to send an event
[0m01:39:22.372723 [info ] [Thread-5 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.52s]
[0m01:39:22.373746 [info ] [Thread-4 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 0.97s]
[0m01:39:22.374740 [info ] [Thread-3 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 2.33s]
[0m01:39:22.377245 [info ] [Thread-2 (]: 25 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 0.93s]
[0m01:39:22.377805 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:39:22.379556 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:39:22.381564 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:39:22.382383 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:39:22.385391 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:39:22.386469 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:39:22.387471 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:39:23.598376 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:39:23.599904 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:39:24.823407 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_performance_drivers' was left open.
[0m01:39:24.824448 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m01:39:25.847516 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m01:39:25.847516 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m01:39:26.986501 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m01:39:26.987506 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m01:39:28.305021 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_executive_summary' was left open.
[0m01:39:28.306100 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m01:39:29.739500 [info ] [MainThread]: 
[0m01:39:29.740508 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 27.16 seconds (27.16s).
[0m01:39:29.746508 [debug] [MainThread]: Command end result
[0m01:39:29.806313 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:39:29.809836 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:39:29.820813 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:39:29.823812 [info ] [MainThread]: 
[0m01:39:29.825812 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:39:29.826813 [info ] [MainThread]: 
[0m01:39:29.827830 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m01:39:29.827830 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:39:29.829334 [debug] [MainThread]: Command `dbt build` succeeded at 01:39:29.829334 after 33.19 seconds
[0m01:39:29.830338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C18765FE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C18765FD90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C18765FA50>]}
[0m01:39:29.831338 [debug] [MainThread]: Flushing usage events
[0m01:39:32.297530 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:40:08.835827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA59A0E110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA59A0F450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA59A0FA10>]}


============================== 01:40:08.842459 | 3040d63b-595a-47f5-b335-f16d27a28328 ==============================
[0m01:40:08.842459 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:40:08.843954 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_c', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m01:40:09.596699 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:40:09.597787 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:40:09.599299 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:40:09.852282 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:40:09.855289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6BDC4950>]}
[0m01:40:10.474457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA59A36590>]}
[0m01:40:10.716589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA589FD210>]}
[0m01:40:10.721003 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:40:12.260199 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:40:13.016593 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:40:13.018592 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:40:13.022228 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:40:13.055134 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m01:40:13.276135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6C12FF90>]}
[0m01:40:13.741689 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:40:13.753863 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:40:13.920283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6C6B0450>]}
[0m01:40:13.923577 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:40:13.940341 [info ] [MainThread]: 
[0m01:40:13.943339 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:40:13.945340 [info ] [MainThread]: 
[0m01:40:13.949363 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:40:13.979162 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:40:14.284521 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:40:14.287522 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:40:14.290057 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:40:17.403396 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.114 seconds
[0m01:40:17.426250 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:40:17.470239 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:40:17.474334 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:40:17.476243 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:40:20.226712 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.750 seconds
[0m01:40:20.282024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6C1E6AD0>]}
[0m01:40:20.292629 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:40:20.294629 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:40:20.296627 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:40:20.297628 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:40:20.300164 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m01:40:20.301913 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m01:40:20.303094 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m01:40:20.304478 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m01:40:20.305770 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m01:40:20.307776 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m01:40:20.310306 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m01:40:20.313294 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m01:40:20.315294 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:40:20.318518 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:40:20.322059 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:40:20.324057 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:40:20.360395 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:40:20.373996 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:40:20.388518 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:40:20.403035 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:40:20.407017 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:40:20.410841 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:40:20.414117 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:40:20.472812 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:40:20.536259 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:40:20.559855 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:40:20.572967 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:40:20.587747 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:40:20.592266 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:40:20.595262 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:40:20.597663 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:40:20.601191 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m01:40:20.605191 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:40:20.607202 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m01:40:20.610706 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m01:40:20.612727 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:40:20.615720 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m01:40:20.617708 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:40:20.620262 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:40:20.625279 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:40:22.988114 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.368 seconds
[0m01:40:22.991662 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.366 seconds
[0m01:40:23.188284 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.575 seconds
[0m01:40:23.248117 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.630 seconds
[0m01:40:23.257826 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6CE2F1D0>]}
[0m01:40:23.260439 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6CE30390>]}
[0m01:40:23.261522 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6923CDD0>]}
[0m01:40:23.271743 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6CD79210>]}
[0m01:40:23.274853 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 2.93s]
[0m01:40:23.278265 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 2.93s]
[0m01:40:23.280785 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.95s]
[0m01:40:23.283793 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 2.96s]
[0m01:40:23.285901 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:40:23.289322 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:40:23.292341 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:40:23.295342 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:40:23.298341 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:40:23.301865 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:40:23.305864 [info ] [Thread-4 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m01:40:23.307858 [info ] [Thread-5 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m01:40:23.311660 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m01:40:23.314676 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m01:40:23.316670 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:40:23.319202 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:40:23.339426 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:40:23.356888 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:40:23.361072 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:40:23.363191 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:40:23.379941 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:40:23.394468 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:40:23.399980 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:40:23.405145 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:40:23.407543 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m01:40:23.411263 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m01:40:24.410548 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.996 seconds
[0m01:40:24.423020 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6CE228D0>]}
[0m01:40:24.428062 [info ] [Thread-4 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 1.11s]
[0m01:40:24.432594 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:40:24.435805 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:40:24.440807 [info ] [Thread-2 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m01:40:24.444302 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m01:40:24.448311 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:40:24.467384 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:40:24.470382 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:40:24.492072 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:40:24.501459 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:40:24.503467 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav,
        nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date) as daily_pnl,
        case
            when lag(nav_usd) over (partition by portfolio_id order by valuation_date) > 0
            then (nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date)) / lag(nav_usd) over (partition by portfolio_id order by valuation_date)
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from valuations
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m01:40:24.642260 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.226 seconds
[0m01:40:24.650354 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6C3FA6D0>]}
[0m01:40:24.652120 [info ] [Thread-5 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 1.34s]
[0m01:40:24.654971 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:40:24.657127 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:40:24.657646 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:40:24.659152 [info ] [Thread-4 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m01:40:24.661747 [info ] [Thread-3 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m01:40:24.663597 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m01:40:24.665206 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m01:40:24.667764 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:40:24.669342 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:40:24.682495 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:40:24.692674 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:40:24.696676 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:40:24.711017 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:40:24.713034 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:40:24.728556 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:40:24.735212 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:40:24.739198 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value,
        market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date) as daily_pnl,
        case
            when lag(market_value_usd) over (partition by security_id order by position_date) > 0
            then (market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date)) / lag(market_value_usd) over (partition by security_id order by position_date)
            else 0
        end as daily_return_pct
    from cast_enriched
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m01:40:24.745766 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:40:24.750093 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        portfolio_id,
        position_date,
        sector,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd
    from enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(market_value_usd) as sector_value,
        sum(quantity) as total_quantity
    from cast_enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as portfolio_value
    from cast_enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m01:40:25.283741 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.777 seconds
[0m01:40:25.293188 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA59933950>]}
[0m01:40:25.296190 [info ] [Thread-2 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 0.85s]
[0m01:40:25.298194 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:40:25.301725 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:40:25.303720 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:40:25.305725 [info ] [Thread-5 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m01:40:25.307719 [info ] [Thread-2 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m01:40:25.312325 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m01:40:25.315671 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m01:40:25.317632 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:40:25.320252 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:40:25.337253 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:40:25.352652 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:40:25.357558 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:40:25.374881 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:40:25.373783 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:40:25.390909 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:40:25.404452 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:40:25.407448 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m01:40:25.412972 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:40:25.417987 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m01:40:25.534567 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.788 seconds
[0m01:40:25.545307 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA591E2310>]}
[0m01:40:25.549298 [info ] [Thread-4 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 0.88s]
[0m01:40:25.550994 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:40:25.554917 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:40:25.557996 [info ] [Thread-4 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m01:40:25.560613 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m01:40:25.563713 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:40:25.580621 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:40:25.584623 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:40:25.600773 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:40:25.609445 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:40:25.612460 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m01:40:25.783680 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.029 seconds
[0m01:40:25.792241 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA56FB3E90>]}
[0m01:40:25.795239 [info ] [Thread-3 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 1.13s]
[0m01:40:25.796236 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:40:25.797237 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:40:25.800629 [info ] [Thread-3 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m01:40:25.802637 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m01:40:25.804638 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:40:25.821045 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:40:25.823065 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:40:25.834609 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:40:25.844487 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:40:25.847486 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m01:40:26.263514 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.841 seconds
[0m01:40:26.277175 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6C5CD490>]}
[0m01:40:26.280751 [info ] [Thread-2 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 0.96s]
[0m01:40:26.283758 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:40:26.285768 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:40:26.289365 [info ] [Thread-2 (]: 14 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m01:40:26.291463 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m01:40:26.294603 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:40:26.307181 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:40:26.312779 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:40:26.324219 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:40:26.330769 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:40:26.333795 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m01:40:26.421319 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.012 seconds
[0m01:40:26.429854 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6CD68A10>]}
[0m01:40:26.432281 [info ] [Thread-5 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 1.12s]
[0m01:40:26.434014 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:40:26.434519 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:40:26.436527 [info ] [Thread-5 (]: 15 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m01:40:26.438134 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m01:40:26.440370 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:40:26.454938 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:40:26.457944 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:40:26.471427 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:40:26.478352 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:40:26.479868 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m01:40:26.529265 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.915 seconds
[0m01:40:26.544871 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6CA03A90>]}
[0m01:40:26.547883 [info ] [Thread-4 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 0.98s]
[0m01:40:26.552400 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:40:26.555401 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:40:26.558489 [info ] [Thread-4 (]: 16 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m01:40:26.561144 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m01:40:26.563192 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:40:26.582714 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:40:26.587712 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:40:26.607244 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:40:26.615666 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:40:26.619169 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m01:40:26.796500 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.947 seconds
[0m01:40:26.810612 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6CEAB490>]}
[0m01:40:26.814577 [info ] [Thread-3 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 1.01s]
[0m01:40:26.818577 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:40:26.821678 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:40:26.824850 [info ] [Thread-3 (]: 17 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m01:40:26.827855 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m01:40:26.831434 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:40:26.857719 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:40:26.864497 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:40:26.881260 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:40:26.888351 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:40:26.892861 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m01:40:27.371892 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.036 seconds
[0m01:40:27.375990 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.893 seconds
[0m01:40:27.385558 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6CBF55D0>]}
[0m01:40:27.395042 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6CD17550>]}
[0m01:40:27.398032 [info ] [Thread-2 (]: 14 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 1.09s]
[0m01:40:27.401764 [info ] [Thread-5 (]: 15 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 0.96s]
[0m01:40:27.404771 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:40:27.407751 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:40:27.411463 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:40:27.413376 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:40:27.416361 [info ] [Thread-2 (]: 18 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m01:40:27.418362 [info ] [Thread-5 (]: 19 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m01:40:27.420872 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m01:40:27.423889 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m01:40:27.424888 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:40:27.427898 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:40:27.440106 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:40:27.453890 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:40:27.457902 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:40:27.460714 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:40:27.475672 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:40:27.493813 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:40:27.501739 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:40:27.511516 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:40:27.513514 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m01:40:27.516594 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m01:40:27.591367 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.969 seconds
[0m01:40:27.602460 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6C9FD950>]}
[0m01:40:27.606441 [info ] [Thread-4 (]: 16 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 1.04s]
[0m01:40:27.610564 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:40:27.612549 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:40:27.614559 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m01:40:27.616556 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m01:40:27.618550 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:40:27.634771 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:40:27.639552 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:40:27.655541 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:40:27.661207 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:40:27.664253 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m01:40:27.936871 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.040 seconds
[0m01:40:27.945405 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6BEF66D0>]}
[0m01:40:27.948423 [info ] [Thread-3 (]: 17 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 1.12s]
[0m01:40:27.950940 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:40:27.952947 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:40:27.955949 [info ] [Thread-3 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m01:40:27.957947 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m01:40:27.960550 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:40:27.972670 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:40:27.976561 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:40:27.991793 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:40:27.998133 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:40:28.000571 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m01:40:28.468026 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.802 seconds
[0m01:40:28.479181 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6DF3B2D0>]}
[0m01:40:28.481529 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 0.86s]
[0m01:40:28.485071 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:40:28.488064 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:40:28.492722 [info ] [Thread-4 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m01:40:28.495603 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m01:40:28.497602 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:40:28.513236 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:40:28.517226 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:40:28.600067 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:40:28.605457 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:40:28.607499 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m01:40:28.624456 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.104 seconds
[0m01:40:28.636972 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA58B514D0>]}
[0m01:40:28.640533 [info ] [Thread-5 (]: 19 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 1.21s]
[0m01:40:28.644529 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:40:28.647531 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:40:28.650033 [info ] [Thread-5 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m01:40:28.653066 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m01:40:28.657051 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:40:28.677489 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:40:28.681628 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.163 seconds
[0m01:40:28.691902 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6C5D4110>]}
[0m01:40:28.693889 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:40:28.695896 [info ] [Thread-2 (]: 18 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 1.27s]
[0m01:40:28.714001 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:40:28.717005 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:40:28.720541 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:40:28.727561 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:40:28.730067 [info ] [Thread-2 (]: 24 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m01:40:28.732451 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m01:40:28.735474 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m01:40:28.739987 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:40:28.757889 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:40:28.762835 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:40:28.775434 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:40:28.781932 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:40:28.785461 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m01:40:28.936197 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.933 seconds
[0m01:40:28.940696 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6DF7B950>]}
[0m01:40:28.941778 [info ] [Thread-3 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 0.98s]
[0m01:40:28.946812 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:40:28.949299 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:40:28.951357 [info ] [Thread-3 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m01:40:28.954317 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m01:40:28.957423 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:40:28.971359 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:40:28.975373 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:40:28.990232 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:40:28.997237 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:40:28.999283 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m01:40:29.700531 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.962 seconds
[0m01:40:29.704531 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6DFA7790>]}
[0m01:40:29.706537 [info ] [Thread-5 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.05s]
[0m01:40:29.707531 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:40:29.709528 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:40:29.712878 [info ] [Thread-5 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m01:40:29.715900 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_executive_summary, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m01:40:29.719490 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:40:29.736557 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:40:29.740105 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:40:29.758034 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:40:29.764669 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:40:29.767582 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m01:40:29.934716 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.146 seconds
[0m01:40:29.944230 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6DF91450>]}
[0m01:40:30.183308 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.182 seconds
[0m01:40:30.193449 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6DF24490>]}
[0m01:40:30.727913 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.116 seconds
[0m01:40:30.736048 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6BD79D50>]}
[0m01:40:30.774788 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.003 seconds
[0m01:40:30.786872 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3040d63b-595a-47f5-b335-f16d27a28328', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA6C5CD350>]}
[0m01:40:33.226161 [debug] [Thread-2 (]: An error was encountered while trying to send an event
[0m01:40:33.228185 [info ] [Thread-3 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 1.24s]
[0m01:40:33.229685 [info ] [Thread-4 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 2.24s]
[0m01:40:33.232786 [info ] [Thread-5 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 1.07s]
[0m01:40:33.236120 [info ] [Thread-2 (]: 24 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 1.21s]
[0m01:40:33.238141 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:40:33.241524 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:40:33.243532 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:40:33.245916 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:40:33.250457 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:40:33.252464 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:40:33.255463 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:40:34.670166 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:40:34.672273 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:40:35.790586 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_performance_drivers' was left open.
[0m01:40:35.792954 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m01:40:36.862610 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_position_attribution' was left open.
[0m01:40:36.866606 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m01:40:38.055640 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m01:40:38.057933 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m01:40:39.193376 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m01:40:39.196384 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m01:40:40.502749 [info ] [MainThread]: 
[0m01:40:40.504740 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 26.55 seconds (26.55s).
[0m01:40:40.517513 [debug] [MainThread]: Command end result
[0m01:40:40.684558 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:40:40.693656 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:40:40.716374 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:40:40.719291 [info ] [MainThread]: 
[0m01:40:40.721296 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:40:40.723370 [info ] [MainThread]: 
[0m01:40:40.725366 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m01:40:40.728286 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:40:40.733298 [debug] [MainThread]: Command `dbt build` succeeded at 01:40:40.732292 after 32.02 seconds
[0m01:40:40.735299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA52E97950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA52E979D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA698C7BD0>]}
[0m01:40:40.737300 [debug] [MainThread]: Flushing usage events
[0m01:40:42.449942 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:41:07.146594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E0F4BC750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E0F4BCF50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E0F4BC350>]}


============================== 01:41:07.150605 | dcad217e-0141-430f-a9cb-984edc510923 ==============================
[0m01:41:07.150605 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:41:07.151605 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_c', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m01:41:07.923740 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:41:07.924913 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:41:07.924913 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:41:08.050446 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:41:08.051446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E2180FED0>]}
[0m01:41:08.228898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E21775850>]}
[0m01:41:08.288875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E0E499110>]}
[0m01:41:08.290875 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:41:08.659655 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:41:08.935488 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:41:08.937012 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:41:08.938020 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:41:08.948088 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:41:09.047193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E21DC8290>]}
[0m01:41:09.185192 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:41:09.189712 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:41:09.237225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E22160590>]}
[0m01:41:09.238232 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:41:09.241231 [info ] [MainThread]: 
[0m01:41:09.242227 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:41:09.243228 [info ] [MainThread]: 
[0m01:41:09.244459 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:41:09.252846 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:41:09.344488 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:41:09.345581 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:41:09.347058 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:41:13.215587 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.869 seconds
[0m01:41:13.223094 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:41:13.237412 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:41:13.237412 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:41:13.238450 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:41:16.137594 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.899 seconds
[0m01:41:16.161633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E1F3AE790>]}
[0m01:41:16.169774 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:41:16.169774 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:41:16.170783 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:41:16.171800 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:41:16.172776 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m01:41:16.172776 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m01:41:16.173799 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m01:41:16.174777 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m01:41:16.176282 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m01:41:16.176282 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m01:41:16.177809 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m01:41:16.178969 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m01:41:16.180003 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:41:16.180543 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:41:16.181182 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:41:16.182214 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:41:16.189752 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:41:16.194750 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:41:16.199292 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:41:16.204428 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:41:16.205412 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:41:16.206413 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:41:16.206413 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:41:16.247943 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:41:16.246938 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:41:16.254942 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:41:16.259763 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:41:16.266409 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:41:16.269444 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:41:16.270422 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:41:16.271416 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:41:16.272447 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m01:41:16.273455 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:41:16.274455 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m01:41:16.274455 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m01:41:16.275454 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:41:16.276457 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m01:41:16.276457 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:41:16.278002 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:41:16.279010 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:41:18.943791 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.664 seconds
[0m01:41:18.946338 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.670 seconds
[0m01:41:19.051918 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E224A2490>]}
[0m01:41:19.051918 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E227EF710>]}
[0m01:41:19.052925 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 2.87s]
[0m01:41:19.053923 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.88s]
[0m01:41:19.054926 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:41:19.055752 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:41:19.056511 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:41:19.057201 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:41:19.058206 [info ] [Thread-5 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m01:41:19.059221 [info ] [Thread-2 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m01:41:19.059221 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m01:41:19.060210 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m01:41:19.061206 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:41:19.061206 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:41:19.065251 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:41:19.069799 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:41:19.071717 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:41:19.075716 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:41:19.076721 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:41:19.078618 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:41:19.082281 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:41:19.083378 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m01:41:19.085510 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:41:19.087038 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m01:41:19.206425 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.928 seconds
[0m01:41:19.212557 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E22811350>]}
[0m01:41:19.213534 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 3.03s]
[0m01:41:19.214445 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:41:19.440536 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.163 seconds
[0m01:41:19.445576 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E228A5B90>]}
[0m01:41:19.446586 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 3.27s]
[0m01:41:19.447636 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:41:19.832357 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.745 seconds
[0m01:41:19.836859 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E2281EE90>]}
[0m01:41:19.838871 [info ] [Thread-2 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 0.78s]
[0m01:41:19.839871 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:41:19.840975 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:41:19.841955 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:41:19.842929 [info ] [Thread-4 (]: 7 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m01:41:19.843870 [info ] [Thread-3 (]: 8 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m01:41:19.844872 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m01:41:19.844872 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m01:41:19.846376 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:41:19.846376 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:41:19.850491 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:41:19.854553 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:41:19.855554 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:41:19.856476 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:41:19.861556 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:41:19.867066 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:41:19.870160 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:41:19.871191 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value,
        market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date) as daily_pnl,
        case
            when lag(market_value_usd) over (partition by security_id order by position_date) > 0
            then (market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date)) / lag(market_value_usd) over (partition by security_id order by position_date)
            else 0
        end as daily_return_pct
    from cast_enriched
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m01:41:19.873080 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:41:19.874078 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        portfolio_id,
        position_date,
        sector,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd
    from enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(market_value_usd) as sector_value,
        sum(quantity) as total_quantity
    from cast_enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as portfolio_value
    from cast_enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m01:41:20.035686 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.951 seconds
[0m01:41:20.039951 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E227AD5D0>]}
[0m01:41:20.040962 [info ] [Thread-5 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.98s]
[0m01:41:20.041962 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:41:20.043977 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:41:20.045433 [info ] [Thread-2 (]: 9 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m01:41:20.046973 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m01:41:20.046973 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:41:20.053008 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:41:20.056513 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:41:20.062520 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:41:20.066395 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:41:20.068401 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav,
        nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date) as daily_pnl,
        case
            when lag(nav_usd) over (partition by portfolio_id order by valuation_date) > 0
            then (nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date)) / lag(nav_usd) over (partition by portfolio_id order by valuation_date)
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from valuations
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m01:41:20.689056 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.815 seconds
[0m01:41:20.692205 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E0BDA60D0>]}
[0m01:41:20.693229 [info ] [Thread-4 (]: 7 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 0.85s]
[0m01:41:20.694129 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:41:20.696632 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:41:20.696632 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:41:20.699640 [info ] [Thread-5 (]: 10 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m01:41:20.701170 [info ] [Thread-4 (]: 11 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m01:41:20.702223 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m01:41:20.702868 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m01:41:20.703958 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:41:20.704873 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:41:20.708573 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:41:20.715585 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:41:20.716605 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:41:20.723041 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:41:20.724078 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:41:20.727656 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:41:20.728771 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:41:20.732658 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:41:20.734658 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m01:41:20.735300 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.860 seconds
[0m01:41:20.737355 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m01:41:20.740313 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E226C32D0>]}
[0m01:41:20.746503 [info ] [Thread-3 (]: 8 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 0.90s]
[0m01:41:20.747510 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:41:20.749512 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:41:20.750571 [info ] [Thread-3 (]: 12 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m01:41:20.751874 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m01:41:20.752514 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:41:20.760849 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:41:20.761773 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:41:20.769302 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:41:20.772299 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:41:20.773298 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m01:41:20.998648 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.929 seconds
[0m01:41:21.008188 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E219A6F10>]}
[0m01:41:21.011305 [info ] [Thread-2 (]: 9 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 0.96s]
[0m01:41:21.013327 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:41:21.015329 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:41:21.016845 [info ] [Thread-2 (]: 13 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m01:41:21.018847 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m01:41:21.020386 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:41:21.037018 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:41:21.041275 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:41:21.052834 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:41:21.060577 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:41:21.062567 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m01:41:21.791101 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.053 seconds
[0m01:41:21.795098 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E22179D50>]}
[0m01:41:21.795098 [info ] [Thread-5 (]: 10 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 1.09s]
[0m01:41:21.797630 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:41:21.798631 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:41:21.800633 [info ] [Thread-5 (]: 14 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m01:41:21.801632 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m01:41:21.802630 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:41:21.807134 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:41:21.808139 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:41:21.815151 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:41:21.819646 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:41:21.820655 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m01:41:22.028405 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.253 seconds
[0m01:41:22.033653 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.289 seconds
[0m01:41:22.045442 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E22131A50>]}
[0m01:41:22.057925 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E226C4850>]}
[0m01:41:22.060087 [info ] [Thread-3 (]: 12 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 1.29s]
[0m01:41:22.062718 [info ] [Thread-4 (]: 11 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 1.35s]
[0m01:41:22.066279 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:41:22.069311 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:41:22.071944 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:41:22.074253 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:41:22.077764 [info ] [Thread-3 (]: 15 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m01:41:22.080281 [info ] [Thread-4 (]: 16 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m01:41:22.082422 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m01:41:22.084833 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m01:41:22.087417 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:41:22.089440 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:41:22.102424 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:41:22.114784 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:41:22.118377 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:41:22.138753 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:41:22.139793 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:41:22.157936 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:41:22.164935 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:41:22.168542 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m01:41:22.172096 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:41:22.174093 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m01:41:22.425572 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.362 seconds
[0m01:41:22.429676 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E22161810>]}
[0m01:41:22.430595 [info ] [Thread-2 (]: 13 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 1.41s]
[0m01:41:22.431607 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:41:22.431607 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:41:22.432617 [info ] [Thread-2 (]: 17 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m01:41:22.433618 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m01:41:22.433618 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:41:22.438136 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:41:22.439151 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:41:22.444090 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:41:22.447640 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:41:22.447640 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m01:41:22.738880 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.917 seconds
[0m01:41:22.748516 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E21803150>]}
[0m01:41:22.750527 [info ] [Thread-5 (]: 14 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 0.95s]
[0m01:41:22.752526 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:41:22.753524 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:41:22.755185 [info ] [Thread-5 (]: 18 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m01:41:22.756692 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m01:41:22.757700 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:41:22.762706 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:41:22.764712 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:41:22.771398 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:41:22.773317 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:41:22.774326 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m01:41:23.251133 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.079 seconds
[0m01:41:23.253114 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.075 seconds
[0m01:41:23.256622 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E0E594750>]}
[0m01:41:23.259715 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E22971150>]}
[0m01:41:23.260629 [info ] [Thread-3 (]: 15 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 1.18s]
[0m01:41:23.261629 [info ] [Thread-4 (]: 16 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 1.18s]
[0m01:41:23.262630 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:41:23.263674 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:41:23.263674 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:41:23.264629 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:41:23.265629 [info ] [Thread-3 (]: 19 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m01:41:23.266859 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m01:41:23.267386 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m01:41:23.268393 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m01:41:23.269399 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:41:23.270400 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:41:23.275399 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:41:23.278791 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:41:23.280706 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:41:23.284937 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:41:23.287515 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.839 seconds
[0m01:41:23.289022 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:41:23.291114 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E239D6190>]}
[0m01:41:23.292045 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:41:23.295111 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:41:23.296616 [info ] [Thread-2 (]: 17 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 0.86s]
[0m01:41:23.297625 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m01:41:23.299050 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:41:23.302055 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:41:23.303492 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:41:23.305051 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m01:41:23.305051 [info ] [Thread-2 (]: 21 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m01:41:23.306601 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m01:41:23.307607 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:41:23.311609 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:41:23.313456 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:41:23.316479 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:41:23.318487 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:41:23.318487 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m01:41:24.066469 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.292 seconds
[0m01:41:24.076823 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E23988390>]}
[0m01:41:24.078846 [info ] [Thread-5 (]: 18 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 1.32s]
[0m01:41:24.080837 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:41:24.082835 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:41:24.083835 [info ] [Thread-5 (]: 22 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m01:41:24.084836 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m01:41:24.085833 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:41:24.089863 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:41:24.090376 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:41:24.093381 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:41:24.095815 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:41:24.096318 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m01:41:24.144861 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.838 seconds
[0m01:41:24.151822 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E0F511B90>]}
[0m01:41:24.153916 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 0.88s]
[0m01:41:24.154907 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:41:24.156498 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:41:24.158678 [info ] [Thread-4 (]: 23 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m01:41:24.159716 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m01:41:24.160769 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:41:24.166776 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:41:24.168257 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:41:24.176676 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:41:24.179204 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:41:24.180204 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m01:41:24.317027 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.998 seconds
[0m01:41:24.320538 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.018 seconds
[0m01:41:24.323622 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E22797790>]}
[0m01:41:24.327041 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E227D49D0>]}
[0m01:41:24.328048 [info ] [Thread-2 (]: 21 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 1.02s]
[0m01:41:24.329133 [info ] [Thread-3 (]: 19 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 1.06s]
[0m01:41:24.331137 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:41:24.332156 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:41:24.333155 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:41:24.334155 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:41:24.335156 [info ] [Thread-2 (]: 24 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m01:41:24.335156 [info ] [Thread-3 (]: 25 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m01:41:24.336676 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_position_attribution, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m01:41:24.337688 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m01:41:24.337688 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:41:24.338708 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:41:24.342706 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:41:24.347862 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:41:24.349870 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:41:24.355135 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:41:24.355135 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:41:24.361762 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:41:24.362959 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:41:24.363972 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m01:41:24.367488 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:41:24.368493 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m01:41:25.299527 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.202 seconds
[0m01:41:25.303759 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E239A9C50>]}
[0m01:41:25.304774 [info ] [Thread-5 (]: 22 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 1.22s]
[0m01:41:25.306282 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:41:25.307290 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:41:25.308291 [info ] [Thread-5 (]: 26 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m01:41:25.309292 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_performance_drivers, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m01:41:25.310300 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:41:25.317286 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:41:25.318762 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:41:25.354717 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:41:25.356819 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.991 seconds
[0m01:41:25.360514 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E22163490>]}
[0m01:41:25.362259 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:41:25.364368 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m01:41:25.712496 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.532 seconds
[0m01:41:25.714491 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.345 seconds
[0m01:41:25.720469 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E22800F50>]}
[0m01:41:25.725424 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E23A346D0>]}
[0m01:41:27.956454 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.590 seconds
[0m01:41:27.964763 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcad217e-0141-430f-a9cb-984edc510923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E23986290>]}
[0m01:41:28.213482 [debug] [Thread-2 (]: An error was encountered while trying to send an event
[0m01:41:28.215496 [info ] [Thread-4 (]: 23 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 1.56s]
[0m01:41:28.216732 [info ] [Thread-3 (]: 25 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.39s]
[0m01:41:28.218836 [info ] [Thread-5 (]: 26 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 2.66s]
[0m01:41:28.220528 [info ] [Thread-2 (]: 24 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 1.02s]
[0m01:41:28.222341 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:41:28.224356 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:41:28.226353 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:41:28.227160 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:41:28.234240 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:41:28.235243 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:41:28.235243 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:41:29.140485 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:41:29.141590 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:41:30.103024 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis' was left open.
[0m01:41:30.106936 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: Close
[0m01:41:31.102629 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_executive_summary' was left open.
[0m01:41:31.103718 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m01:41:32.136618 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m01:41:32.137626 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m01:41:33.263401 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m01:41:33.266406 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m01:41:34.370100 [info ] [MainThread]: 
[0m01:41:34.371604 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 25.13 seconds (25.13s).
[0m01:41:34.384158 [debug] [MainThread]: Command end result
[0m01:41:34.443159 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:41:34.445159 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:41:34.453845 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:41:34.453845 [info ] [MainThread]: 
[0m01:41:34.454847 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:41:34.454847 [info ] [MainThread]: 
[0m01:41:34.456356 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m01:41:34.457365 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:41:34.458366 [debug] [MainThread]: Command `dbt build` succeeded at 01:41:34.458366 after 27.42 seconds
[0m01:41:34.459448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E0F523410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E088A7950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024E088A79D0>]}
[0m01:41:34.460446 [debug] [MainThread]: Flushing usage events
[0m01:41:35.912592 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:42:04.427919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B16B5184D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B16B51BCD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B16B519F90>]}


============================== 01:42:04.431928 | aa500cd3-5078-4da2-abc5-f2c6a9ad8197 ==============================
[0m01:42:04.431928 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:42:04.432929 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m01:42:05.532795 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:42:05.532795 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:42:05.533897 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:42:05.739950 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:42:05.741639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'aa500cd3-5078-4da2-abc5-f2c6a9ad8197', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B17D93D7D0>]}
[0m01:42:05.969533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aa500cd3-5078-4da2-abc5-f2c6a9ad8197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B17D950910>]}
[0m01:42:06.072542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aa500cd3-5078-4da2-abc5-f2c6a9ad8197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B16A4F5150>]}
[0m01:42:06.074551 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:42:06.620757 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:42:06.917221 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:42:06.918210 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:42:06.918210 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:42:06.932561 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m01:42:07.016292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aa500cd3-5078-4da2-abc5-f2c6a9ad8197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B17DCF9450>]}
[0m01:42:07.204134 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:42:07.206649 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:42:07.266197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aa500cd3-5078-4da2-abc5-f2c6a9ad8197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B17E1C0190>]}
[0m01:42:07.268306 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:42:07.272843 [info ] [MainThread]: 
[0m01:42:07.274839 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:42:07.277634 [info ] [MainThread]: 
[0m01:42:07.278631 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:42:07.285192 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:42:07.402347 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:42:07.403342 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:42:07.404341 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:42:12.386684 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 4.982 seconds
[0m01:42:12.399746 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:42:12.427351 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:42:12.428380 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:42:12.430352 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:42:14.510392 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.080 seconds
[0m01:42:14.573646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa500cd3-5078-4da2-abc5-f2c6a9ad8197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B17E6FEF10>]}
[0m01:42:14.582172 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:42:14.583172 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:42:14.585174 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:42:14.586680 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:42:14.588697 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:42:14.589695 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:42:14.591695 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:42:14.592696 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:42:14.606503 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:42:14.612738 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:42:14.614718 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:42:14.615714 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:42:14.669208 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:42:14.678354 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:42:14.680661 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:42:14.681668 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:42:14.684076 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:42:14.684076 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:42:14.685540 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:42:14.687855 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:42:18.294001 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.606 seconds
[0m01:42:18.333011 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa500cd3-5078-4da2-abc5-f2c6a9ad8197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B17E709350>]}
[0m01:42:18.335105 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.74s]
[0m01:42:18.336624 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:42:18.338355 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:42:18.338355 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:42:18.339403 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m01:42:18.340390 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:42:18.346361 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:42:18.347872 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:42:18.352909 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:42:18.356400 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:42:18.357409 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:42:18.358492 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:42:18.525648 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.842 seconds
[0m01:42:18.530179 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa500cd3-5078-4da2-abc5-f2c6a9ad8197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B17E505750>]}
[0m01:42:18.531140 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.94s]
[0m01:42:18.533142 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:42:18.535196 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:42:18.536708 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:42:18.536708 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m01:42:18.537719 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:42:18.542824 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:42:18.546346 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:42:18.650648 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:42:18.653622 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:42:18.656626 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:42:20.227446 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.570 seconds
[0m01:42:20.231452 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa500cd3-5078-4da2-abc5-f2c6a9ad8197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B17E1C0D10>]}
[0m01:42:20.233453 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.69s]
[0m01:42:20.235452 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:42:22.080975 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.722 seconds
[0m01:42:22.088408 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa500cd3-5078-4da2-abc5-f2c6a9ad8197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B17F926050>]}
[0m01:42:22.090928 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.75s]
[0m01:42:22.091925 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:42:22.094938 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:42:22.094938 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:42:22.094938 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:42:23.207730 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:42:23.209192 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:42:24.413582 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m01:42:24.415598 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m01:42:25.667636 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:42:25.669960 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:42:27.102554 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:42:27.102554 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:42:28.536469 [info ] [MainThread]: 
[0m01:42:28.538817 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 21.26 seconds (21.26s).
[0m01:42:28.544185 [debug] [MainThread]: Command end result
[0m01:42:28.600747 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:42:28.603749 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:42:28.610786 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:42:28.611727 [info ] [MainThread]: 
[0m01:42:28.613168 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:42:28.614184 [info ] [MainThread]: 
[0m01:42:28.615178 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:42:28.616328 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:42:28.617345 [debug] [MainThread]: Command `dbt build` succeeded at 01:42:28.617345 after 24.28 seconds
[0m01:42:28.618478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1648C7950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1648C79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B16B50FF50>]}
[0m01:42:28.619744 [debug] [MainThread]: Flushing usage events
[0m01:42:32.012352 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:43:10.056980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DE984D710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DE984F690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DE984FC50>]}


============================== 01:43:10.063531 | 78a49d13-2131-4303-b56d-864fb2ccd202 ==============================
[0m01:43:10.063531 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:43:10.066528 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m01:43:11.049151 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:43:11.050164 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:43:11.050687 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:43:11.224483 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:43:11.225590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '78a49d13-2131-4303-b56d-864fb2ccd202', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DF906D750>]}
[0m01:43:11.446499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '78a49d13-2131-4303-b56d-864fb2ccd202', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DFBC6E710>]}
[0m01:43:11.528513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '78a49d13-2131-4303-b56d-864fb2ccd202', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DFBB82610>]}
[0m01:43:11.532862 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:43:11.977576 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:43:12.207336 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:43:12.208341 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:43:12.208341 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:43:12.216752 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:43:12.277278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '78a49d13-2131-4303-b56d-864fb2ccd202', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DFBD3C150>]}
[0m01:43:12.422533 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:43:12.425519 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:43:12.467207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '78a49d13-2131-4303-b56d-864fb2ccd202', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DFC4F02D0>]}
[0m01:43:12.468216 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:43:12.470796 [info ] [MainThread]: 
[0m01:43:12.471893 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:43:12.472904 [info ] [MainThread]: 
[0m01:43:12.473893 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:43:12.478818 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:43:12.551701 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:43:12.552760 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:43:12.552760 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:43:15.784872 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.232 seconds
[0m01:43:15.804196 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:43:15.836033 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:43:15.837024 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:43:15.838010 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:43:18.285964 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.447 seconds
[0m01:43:18.308435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '78a49d13-2131-4303-b56d-864fb2ccd202', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DFBD10350>]}
[0m01:43:18.315960 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:43:18.315960 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:43:18.318188 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:43:18.319136 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:43:18.320640 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:43:18.321656 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:43:18.321656 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:43:18.322668 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:43:18.330654 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:43:18.336443 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:43:18.338444 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:43:18.346971 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:43:18.376874 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:43:18.381387 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:43:18.383386 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:43:18.384392 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:43:18.385392 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:43:18.386410 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:43:18.386410 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:43:18.388392 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:43:21.827754 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.439 seconds
[0m01:43:21.856280 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78a49d13-2131-4303-b56d-864fb2ccd202', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DFCB50F90>]}
[0m01:43:21.857468 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.53s]
[0m01:43:21.858560 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:43:21.860185 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:43:21.860770 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:43:21.861780 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m01:43:21.861780 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:43:21.865778 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:43:21.866780 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:43:21.870776 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:43:21.872298 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:43:21.873560 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:43:21.874654 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:43:22.498682 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 4.112 seconds
[0m01:43:22.505894 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78a49d13-2131-4303-b56d-864fb2ccd202', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DFCB79F90>]}
[0m01:43:22.506885 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 4.19s]
[0m01:43:22.508233 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:43:22.509245 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:43:22.510759 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:43:22.511764 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m01:43:22.512268 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:43:22.515778 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:43:22.516777 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:43:22.593627 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:43:22.596538 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:43:22.597536 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:43:24.129210 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.531 seconds
[0m01:43:24.140289 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78a49d13-2131-4303-b56d-864fb2ccd202', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DFCC83050>]}
[0m01:43:24.144906 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.63s]
[0m01:43:24.146978 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:43:25.818252 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.943 seconds
[0m01:43:25.826899 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78a49d13-2131-4303-b56d-864fb2ccd202', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DFBCCFC90>]}
[0m01:43:25.828902 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.97s]
[0m01:43:25.831504 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:43:25.833504 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:43:25.835502 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:43:25.835502 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:43:27.208020 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:43:27.209049 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:43:28.263355 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m01:43:28.265457 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m01:43:29.464909 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:43:29.465910 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:43:30.424931 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:43:30.425940 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:43:31.817094 [info ] [MainThread]: 
[0m01:43:31.819109 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 19.34 seconds (19.34s).
[0m01:43:31.823653 [debug] [MainThread]: Command end result
[0m01:43:31.881188 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:43:31.886198 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:43:31.892741 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:43:31.893734 [info ] [MainThread]: 
[0m01:43:31.894821 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:43:31.895730 [info ] [MainThread]: 
[0m01:43:31.896733 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:43:31.897738 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:43:31.899730 [debug] [MainThread]: Command `dbt build` succeeded at 01:43:31.898738 after 21.99 seconds
[0m01:43:31.900737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DE98BC4D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DE2C97950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026DE2C979D0>]}
[0m01:43:31.900737 [debug] [MainThread]: Flushing usage events
[0m01:43:34.864277 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:44:34.795274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002075B4F1C10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002075B2321D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002075B47F910>]}


============================== 01:44:34.799572 | 1fd783ea-9416-47e9-b88d-840c44928378 ==============================
[0m01:44:34.799572 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:44:34.800475 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_c', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m01:44:35.472099 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:44:35.473175 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:44:35.474096 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:44:35.590416 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:44:35.591461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076A93FA10>]}
[0m01:44:35.757585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076D8BDD10>]}
[0m01:44:35.817618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002075A47D0D0>]}
[0m01:44:35.819623 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:44:36.236876 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:44:36.444245 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:44:36.445223 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:44:36.446226 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:44:36.453690 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m01:44:36.510274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076D83C650>]}
[0m01:44:36.638514 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:44:36.642400 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:44:36.679730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E1305D0>]}
[0m01:44:36.680284 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:44:36.685663 [info ] [MainThread]: 
[0m01:44:36.686700 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:44:36.687667 [info ] [MainThread]: 
[0m01:44:36.687667 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:44:36.693278 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:44:36.758974 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:44:36.758974 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:44:36.758974 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:44:40.543062 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.783 seconds
[0m01:44:40.550851 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:44:40.567413 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:44:40.568411 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:44:40.569411 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:44:42.630325 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.061 seconds
[0m01:44:42.651614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E68BFD0>]}
[0m01:44:42.657702 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:44:42.658696 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:44:42.658696 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:44:42.659738 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:44:42.660283 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m01:44:42.661061 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m01:44:42.662067 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m01:44:42.663072 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m01:44:42.664071 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m01:44:42.665071 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m01:44:42.665071 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m01:44:42.666071 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m01:44:42.667112 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:44:42.667754 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:44:42.668758 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:44:42.668758 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:44:42.679270 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:44:42.682949 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:44:42.686867 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:44:42.690607 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:44:42.692614 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:44:42.693613 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:44:42.703123 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:44:42.725578 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:44:42.726587 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:44:42.730701 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:44:42.734797 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:44:42.740734 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:44:42.741763 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m01:44:42.743768 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m01:44:42.744767 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m01:44:42.746032 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m01:44:42.746032 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m01:44:42.747045 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m01:44:42.748043 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m01:44:42.748043 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:44:42.749044 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m01:44:42.750285 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:44:42.750285 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:44:42.753175 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:44:44.781565 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.031 seconds
[0m01:44:44.888759 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E100590>]}
[0m01:44:44.891269 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 2.22s]
[0m01:44:44.892269 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m01:44:44.893273 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:44:44.894296 [info ] [Thread-3 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m01:44:44.895276 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m01:44:44.896375 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:44:44.900783 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:44:44.901786 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:44:44.906789 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:44:44.907790 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m01:44:44.908870 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m01:44:45.059344 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.309 seconds
[0m01:44:45.066464 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E781050>]}
[0m01:44:45.068466 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 2.40s]
[0m01:44:45.069468 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m01:44:45.071736 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:44:45.072743 [info ] [Thread-5 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m01:44:45.073742 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m01:44:45.074947 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:44:45.080663 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:44:45.081670 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:44:45.086756 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:44:45.088669 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m01:44:45.089670 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m01:44:45.106617 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.354 seconds
[0m01:44:45.111498 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E7FB450>]}
[0m01:44:45.112958 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 2.45s]
[0m01:44:45.115437 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m01:44:45.342414 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.594 seconds
[0m01:44:45.346511 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E7CFC90>]}
[0m01:44:45.347428 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.68s]
[0m01:44:45.348423 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m01:44:45.591693 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.682 seconds
[0m01:44:45.595246 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076D7DD7D0>]}
[0m01:44:45.597263 [info ] [Thread-3 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.70s]
[0m01:44:45.598263 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m01:44:45.599263 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:44:45.600263 [info ] [Thread-4 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m01:44:45.600790 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m01:44:45.601814 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:44:45.607307 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:44:45.608767 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:44:45.614239 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:44:45.616239 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m01:44:45.617232 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav,
        nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date) as daily_pnl,
        case
            when lag(nav_usd) over (partition by portfolio_id order by valuation_date) > 0
            then (nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date)) / lag(nav_usd) over (partition by portfolio_id order by valuation_date)
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from valuations
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m01:44:46.102745 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.012 seconds
[0m01:44:46.107836 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002075AC73410>]}
[0m01:44:46.108884 [info ] [Thread-5 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 1.03s]
[0m01:44:46.110390 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m01:44:46.112319 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:44:46.113327 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:44:46.114330 [info ] [Thread-3 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m01:44:46.115338 [info ] [Thread-2 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m01:44:46.116336 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m01:44:46.117790 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m01:44:46.117790 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:44:46.119152 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:44:46.122754 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:44:46.128697 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:44:46.130201 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:44:46.134214 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:44:46.135215 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:44:46.140747 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:44:46.143054 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m01:44:46.144059 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value,
        market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date) as daily_pnl,
        case
            when lag(market_value_usd) over (partition by security_id order by position_date) > 0
            then (market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date)) / lag(market_value_usd) over (partition by security_id order by position_date)
            else 0
        end as daily_return_pct
    from cast_enriched
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m01:44:46.145452 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m01:44:46.146473 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        portfolio_id,
        position_date,
        sector,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd
    from enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(market_value_usd) as sector_value,
        sum(quantity) as total_quantity
    from cast_enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as portfolio_value
    from cast_enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m01:44:46.417858 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.799 seconds
[0m01:44:46.423499 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002075AC30710>]}
[0m01:44:46.425372 [info ] [Thread-4 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 0.82s]
[0m01:44:46.426443 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m01:44:46.429371 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:44:46.429371 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:44:46.430384 [info ] [Thread-5 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m01:44:46.432026 [info ] [Thread-4 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m01:44:46.433557 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m01:44:46.434564 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m01:44:46.435595 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:44:46.436573 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:44:46.442082 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:44:46.446499 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:44:46.448510 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:44:46.453575 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:44:46.454615 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:44:46.459551 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:44:46.463031 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m01:44:46.465556 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m01:44:46.466556 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m01:44:46.468556 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m01:44:46.914440 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.769 seconds
[0m01:44:46.920399 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076D79C610>]}
[0m01:44:46.922946 [info ] [Thread-3 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 0.80s]
[0m01:44:46.923899 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m01:44:46.923899 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:44:46.925381 [info ] [Thread-3 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m01:44:46.926388 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m01:44:46.926388 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:44:46.933102 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:44:46.934111 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:44:46.938177 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:44:46.941614 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m01:44:46.941614 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m01:44:47.146631 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.998 seconds
[0m01:44:47.151889 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002075A47D790>]}
[0m01:44:47.153899 [info ] [Thread-2 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 1.03s]
[0m01:44:47.154888 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m01:44:47.155892 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:44:47.156893 [info ] [Thread-2 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m01:44:47.157903 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m01:44:47.157903 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:44:47.158888 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.692 seconds
[0m01:44:47.164780 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:44:47.167696 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076D79CA50>]}
[0m01:44:47.169696 [info ] [Thread-5 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 0.73s]
[0m01:44:47.169696 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:44:47.170695 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m01:44:47.176031 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:44:47.176640 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:44:47.177651 [info ] [Thread-5 (]: 14 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m01:44:47.179651 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m01:44:47.180685 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m01:44:47.181843 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m01:44:47.182384 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:44:47.188052 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:44:47.193433 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:44:47.198439 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:44:47.199439 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m01:44:47.200943 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m01:44:47.546017 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.076 seconds
[0m01:44:47.551602 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E6A8850>]}
[0m01:44:47.553634 [info ] [Thread-4 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 1.12s]
[0m01:44:47.554623 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m01:44:47.555602 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:44:47.556605 [info ] [Thread-4 (]: 15 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m01:44:47.557660 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m01:44:47.558620 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:44:47.564239 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:44:47.566201 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:44:47.570778 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:44:47.573896 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m01:44:47.574801 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m01:44:47.794815 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.852 seconds
[0m01:44:47.798017 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E132410>]}
[0m01:44:47.799021 [info ] [Thread-3 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 0.87s]
[0m01:44:47.800554 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m01:44:47.800554 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:44:47.801988 [info ] [Thread-3 (]: 16 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m01:44:47.801988 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m01:44:47.803008 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:44:47.808993 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:44:47.810497 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:44:47.815514 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:44:47.818502 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m01:44:47.820518 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m01:44:48.062977 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.880 seconds
[0m01:44:48.068965 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076D79CBD0>]}
[0m01:44:48.072486 [info ] [Thread-2 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 0.91s]
[0m01:44:48.074698 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m01:44:48.078100 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:44:48.080627 [info ] [Thread-2 (]: 17 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m01:44:48.081636 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m01:44:48.082635 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:44:48.091182 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:44:48.093537 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.892 seconds
[0m01:44:48.099537 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E476D50>]}
[0m01:44:48.101050 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:44:48.102061 [info ] [Thread-5 (]: 14 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 0.92s]
[0m01:44:48.111562 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:44:48.113325 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m01:44:48.116323 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:44:48.117323 [info ] [Thread-5 (]: 18 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m01:44:48.121475 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m01:44:48.123486 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m01:44:48.124470 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m01:44:48.125481 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:44:48.135516 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:44:48.138517 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:44:48.145553 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:44:48.148546 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m01:44:48.148546 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m01:44:48.764462 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.944 seconds
[0m01:44:48.766487 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.191 seconds
[0m01:44:48.769471 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002075B4B1C50>]}
[0m01:44:48.775555 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E7C0850>]}
[0m01:44:48.776539 [info ] [Thread-3 (]: 16 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 0.97s]
[0m01:44:48.778541 [info ] [Thread-4 (]: 15 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 1.22s]
[0m01:44:48.781245 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m01:44:48.782242 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m01:44:48.784244 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:44:48.785715 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:44:48.787757 [info ] [Thread-3 (]: 19 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m01:44:48.788771 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m01:44:48.790278 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m01:44:48.792681 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m01:44:48.794682 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:44:48.795857 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:44:48.801426 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:44:48.808003 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:44:48.811288 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:44:48.812278 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:44:48.820301 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:44:48.827821 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:44:48.833384 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m01:44:48.835381 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m01:44:48.837368 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m01:44:48.839368 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m01:44:48.935667 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.809 seconds
[0m01:44:48.943341 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E04C550>]}
[0m01:44:48.946681 [info ] [Thread-2 (]: 17 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 0.86s]
[0m01:44:48.949703 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m01:44:48.951692 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:44:48.953890 [info ] [Thread-2 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m01:44:48.955987 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m01:44:48.957910 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:44:48.965625 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:44:48.967623 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:44:48.976153 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:44:48.979152 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m01:44:48.979152 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m01:44:48.996300 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.847 seconds
[0m01:44:49.001810 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E781D10>]}
[0m01:44:49.002818 [info ] [Thread-5 (]: 18 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 0.88s]
[0m01:44:49.003816 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m01:44:49.004816 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:44:49.005816 [info ] [Thread-5 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m01:44:49.006832 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m01:44:49.006832 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:44:49.011333 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:44:49.013487 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:44:49.041287 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:44:49.043272 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m01:44:49.044277 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m01:44:49.716228 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.874 seconds
[0m01:44:49.724490 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076F938150>]}
[0m01:44:49.727575 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 0.93s]
[0m01:44:49.730494 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m01:44:49.732109 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:44:49.735187 [info ] [Thread-4 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m01:44:49.737149 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m01:44:49.738180 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:44:49.748875 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:44:49.750452 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:44:49.756542 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:44:49.759460 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m01:44:49.760459 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m01:44:49.936075 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.098 seconds
[0m01:44:49.939028 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.958 seconds
[0m01:44:49.945721 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076F93AB50>]}
[0m01:44:49.952685 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076F9E80D0>]}
[0m01:44:49.955306 [info ] [Thread-3 (]: 19 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 1.15s]
[0m01:44:49.957318 [info ] [Thread-2 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 1.00s]
[0m01:44:49.959305 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m01:44:49.961443 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m01:44:49.962438 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:44:49.963521 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:44:49.965599 [info ] [Thread-3 (]: 24 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m01:44:49.967684 [info ] [Thread-2 (]: 25 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m01:44:49.968691 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m01:44:49.969701 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m01:44:49.970754 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:44:49.972192 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:44:49.978284 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:44:49.983804 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:44:49.984795 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:44:49.985795 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:44:49.988889 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:44:49.993496 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:44:49.995420 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m01:44:49.996517 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m01:44:49.997508 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m01:44:49.998267 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m01:44:50.775409 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.014 seconds
[0m01:44:50.779606 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076DD9E4D0>]}
[0m01:44:50.780525 [info ] [Thread-4 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.04s]
[0m01:44:50.781048 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m01:44:50.782071 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:44:50.783052 [info ] [Thread-4 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m01:44:50.784049 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_executive_summary, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m01:44:50.784049 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:44:50.787406 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:44:50.788385 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:44:50.791597 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:44:50.792692 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m01:44:50.793604 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m01:44:50.870335 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.869 seconds
[0m01:44:50.872347 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.873 seconds
[0m01:44:50.877431 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076FA6FF50>]}
[0m01:44:50.882864 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E7F3550>]}
[0m01:44:51.103873 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.059 seconds
[0m01:44:51.112430 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E133110>]}
[0m01:44:51.742676 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.948 seconds
[0m01:44:51.747661 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1fd783ea-9416-47e9-b88d-840c44928378', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076E69E310>]}
[0m01:44:54.378435 [debug] [Thread-2 (]: An error was encountered while trying to send an event
[0m01:44:54.380389 [info ] [Thread-3 (]: 24 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 0.91s]
[0m01:44:54.381396 [info ] [Thread-5 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 2.11s]
[0m01:44:54.381396 [info ] [Thread-4 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 0.96s]
[0m01:44:54.383695 [info ] [Thread-2 (]: 25 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 0.91s]
[0m01:44:54.384397 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m01:44:54.386410 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m01:44:54.388411 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m01:44:54.390410 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m01:44:54.393997 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:44:54.395292 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:44:54.396303 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:44:55.682929 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:44:55.684018 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:44:56.727902 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_performance_drivers' was left open.
[0m01:44:56.730794 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m01:44:58.038399 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_position_attribution' was left open.
[0m01:44:58.039573 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m01:44:58.985836 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m01:44:58.987346 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m01:44:59.903029 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m01:44:59.904035 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m01:45:01.111578 [info ] [MainThread]: 
[0m01:45:01.112584 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 24.42 seconds (24.42s).
[0m01:45:01.117597 [debug] [MainThread]: Command end result
[0m01:45:01.167603 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:45:01.171230 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:45:01.179421 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:45:01.180422 [info ] [MainThread]: 
[0m01:45:01.180927 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:45:01.181936 [info ] [MainThread]: 
[0m01:45:01.182940 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m01:45:01.183944 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:45:01.185048 [debug] [MainThread]: Command `dbt build` succeeded at 01:45:01.185048 after 26.47 seconds
[0m01:45:01.186154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020754917950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000207549179D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002076DDFD2D0>]}
[0m01:45:01.187056 [debug] [MainThread]: Flushing usage events
[0m01:45:02.989699 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:53:52.649903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209F00FD690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209F0162850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209F0163990>]}


============================== 01:53:52.653418 | 245b2e9b-9e6e-4955-9b67-25c2aaf9522a ==============================
[0m01:53:52.653418 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:53:52.654417 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m01:53:53.629300 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:53:53.630805 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:53:53.632816 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:53:53.892237 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:53:53.892237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '245b2e9b-9e6e-4955-9b67-25c2aaf9522a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020982DA8910>]}
[0m01:53:54.195066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '245b2e9b-9e6e-4955-9b67-25c2aaf9522a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020982E5BE50>]}
[0m01:53:54.347328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '245b2e9b-9e6e-4955-9b67-25c2aaf9522a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020982D5EA50>]}
[0m01:53:54.350688 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:53:54.928897 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:53:55.297812 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:53:55.298806 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:53:55.300316 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:53:55.320239 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m01:53:55.413371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '245b2e9b-9e6e-4955-9b67-25c2aaf9522a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020982E6C450>]}
[0m01:53:55.671803 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:53:55.680309 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:53:55.763587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '245b2e9b-9e6e-4955-9b67-25c2aaf9522a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209836E1090>]}
[0m01:53:55.767503 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:53:55.778355 [info ] [MainThread]: 
[0m01:53:55.780380 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:53:55.781539 [info ] [MainThread]: 
[0m01:53:55.783540 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:53:55.796344 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:53:55.955779 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:53:55.956969 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:53:55.958026 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:53:59.921869 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.964 seconds
[0m01:53:59.931381 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:53:59.945459 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:53:59.946461 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:53:59.947377 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:54:02.618863 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.672 seconds
[0m01:54:02.644692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '245b2e9b-9e6e-4955-9b67-25c2aaf9522a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209ECA49C50>]}
[0m01:54:02.649093 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:54:02.651280 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:54:02.652360 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:54:02.653411 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:54:02.654473 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:54:02.655656 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:54:02.657291 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:54:02.657820 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:54:02.669635 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:54:02.678436 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:54:02.680517 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:54:02.700459 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:54:02.715199 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:54:02.719176 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:54:02.721599 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:54:02.722615 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:54:02.723605 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:54:02.723605 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:54:02.724644 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:54:02.725607 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:54:05.944372 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.219 seconds
[0m01:54:05.973915 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '245b2e9b-9e6e-4955-9b67-25c2aaf9522a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020983D6B7D0>]}
[0m01:54:05.975420 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.32s]
[0m01:54:05.976425 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:54:05.977331 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:54:05.977331 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:54:05.978397 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m01:54:05.979399 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:54:05.981923 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:54:05.982929 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:54:05.986928 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:54:05.987928 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:54:05.988928 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:54:05.988928 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:54:06.242070 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.517 seconds
[0m01:54:06.244079 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '245b2e9b-9e6e-4955-9b67-25c2aaf9522a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020983D6BA90>]}
[0m01:54:06.245078 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.59s]
[0m01:54:06.246080 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:54:06.247080 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:54:06.248080 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:54:06.248080 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m01:54:06.249142 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:54:06.251727 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:54:06.252737 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:54:06.328230 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:54:06.331807 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:54:06.331807 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:54:09.015731 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.683 seconds
[0m01:54:09.020256 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '245b2e9b-9e6e-4955-9b67-25c2aaf9522a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209805AF290>]}
[0m01:54:09.021261 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 2.77s]
[0m01:54:09.022266 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:54:09.546433 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.557 seconds
[0m01:54:09.554727 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '245b2e9b-9e6e-4955-9b67-25c2aaf9522a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020982F1CF90>]}
[0m01:54:09.557782 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.58s]
[0m01:54:09.560401 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:54:09.563583 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:54:09.565655 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:54:09.566663 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:54:10.707319 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:54:10.709333 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:54:12.345166 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m01:54:12.347194 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m01:54:13.461027 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:54:13.462802 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:54:14.944237 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:54:14.945253 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:54:15.962514 [info ] [MainThread]: 
[0m01:54:15.963569 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 20.18 seconds (20.18s).
[0m01:54:15.965727 [debug] [MainThread]: Command end result
[0m01:54:16.023616 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:54:16.026616 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:54:16.033351 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:54:16.034340 [info ] [MainThread]: 
[0m01:54:16.035335 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:54:16.035335 [info ] [MainThread]: 
[0m01:54:16.036342 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:54:16.037334 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:54:16.038334 [debug] [MainThread]: Command `dbt build` succeeded at 01:54:16.038334 after 23.50 seconds
[0m01:54:16.039334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209E94F7AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209E94F79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209EFE9D9D0>]}
[0m01:54:16.039334 [debug] [MainThread]: Flushing usage events
[0m01:54:18.997327 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:56:15.100374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CE44FD690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CE44FD090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CE44FFD90>]}


============================== 01:56:15.105951 | d0ecbac8-7c2e-4799-a2c2-f6af013edcb8 ==============================
[0m01:56:15.105951 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:56:15.105951 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m01:56:15.890226 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:56:15.892231 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:56:15.892231 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:56:16.017295 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:56:16.017295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd0ecbac8-7c2e-4799-a2c2-f6af013edcb8', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CF30A2E50>]}
[0m01:56:16.176292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd0ecbac8-7c2e-4799-a2c2-f6af013edcb8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CE4509190>]}
[0m01:56:16.239816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd0ecbac8-7c2e-4799-a2c2-f6af013edcb8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CE251D0D0>]}
[0m01:56:16.239816 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:56:16.670871 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:56:16.892240 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:56:16.892240 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:56:16.892240 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:56:16.907956 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m01:56:16.955714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd0ecbac8-7c2e-4799-a2c2-f6af013edcb8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CF367FE90>]}
[0m01:56:17.098044 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:56:17.098044 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:56:17.138056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd0ecbac8-7c2e-4799-a2c2-f6af013edcb8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CF61D1010>]}
[0m01:56:17.138056 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:56:17.145514 [info ] [MainThread]: 
[0m01:56:17.146435 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:56:17.146435 [info ] [MainThread]: 
[0m01:56:17.148753 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:56:17.152475 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:56:17.209644 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:56:17.209644 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:56:17.209644 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:56:20.483657 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.260 seconds
[0m01:56:20.490591 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:56:20.503954 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:56:20.505964 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:56:20.505964 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:56:22.439357 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 1.933 seconds
[0m01:56:22.460444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd0ecbac8-7c2e-4799-a2c2-f6af013edcb8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CF670EF10>]}
[0m01:56:22.462500 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:56:22.462500 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:56:22.462500 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:56:22.462500 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:56:22.462500 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:56:22.462500 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:56:22.462500 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:56:22.462500 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:56:22.478155 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:56:22.481425 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:56:22.481425 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:56:22.487634 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:56:22.521721 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:56:22.521721 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:56:22.521721 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:56:22.521721 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:56:22.521721 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:56:22.521721 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:56:22.532859 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:56:22.532859 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:56:25.830809 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.298 seconds
[0m01:56:25.859282 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd0ecbac8-7c2e-4799-a2c2-f6af013edcb8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CF6816B90>]}
[0m01:56:25.875035 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.40s]
[0m01:56:25.875035 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:56:25.875035 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:56:25.875035 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:56:25.875035 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m01:56:25.875035 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:56:25.881547 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:56:25.883553 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:56:25.887388 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:56:25.889393 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:56:25.889393 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:56:25.891138 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:56:26.540084 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 4.007 seconds
[0m01:56:26.540084 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd0ecbac8-7c2e-4799-a2c2-f6af013edcb8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CF674E2D0>]}
[0m01:56:26.540084 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 4.08s]
[0m01:56:26.553198 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:56:26.553198 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:56:26.553198 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:56:26.553198 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m01:56:26.553198 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:56:26.553198 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:56:26.553198 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:56:26.659701 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:56:26.662066 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:56:26.663131 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:56:28.016317 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.353 seconds
[0m01:56:28.016317 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd0ecbac8-7c2e-4799-a2c2-f6af013edcb8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CF6973B90>]}
[0m01:56:28.016317 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.46s]
[0m01:56:28.031062 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:56:29.195755 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.305 seconds
[0m01:56:29.195755 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd0ecbac8-7c2e-4799-a2c2-f6af013edcb8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CF6965ED0>]}
[0m01:56:29.195755 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 3.32s]
[0m01:56:29.195755 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:56:29.195755 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:56:29.205674 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:56:29.205674 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:56:30.385000 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:56:30.387035 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:56:31.817991 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:56:31.817991 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:56:33.064819 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m01:56:33.066838 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m01:56:33.973184 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:56:33.973184 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:56:35.020441 [info ] [MainThread]: 
[0m01:56:35.020441 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 17.87 seconds (17.87s).
[0m01:56:35.025483 [debug] [MainThread]: Command end result
[0m01:56:35.117720 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:56:35.120524 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:56:35.120524 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:56:35.120524 [info ] [MainThread]: 
[0m01:56:35.120524 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:56:35.120524 [info ] [MainThread]: 
[0m01:56:35.120524 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:56:35.120524 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:56:35.120524 [debug] [MainThread]: Command `dbt build` succeeded at 01:56:35.120524 after 20.17 seconds
[0m01:56:35.120524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CDC9A7AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CDC9A79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CF5A3CD50>]}
[0m01:56:35.120524 [debug] [MainThread]: Flushing usage events
[0m01:56:38.473010 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:58:20.918679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A67E61C10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A67E62910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A67E62890>]}


============================== 01:58:20.924238 | 9348cfea-19ad-4c26-bd28-ea2e62baeadd ==============================
[0m01:58:20.924238 [info ] [MainThread]: Running with dbt=1.11.2
[0m01:58:20.924238 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m01:58:21.657261 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:58:21.657261 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:58:21.657261 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:58:21.771364 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m01:58:21.771364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9348cfea-19ad-4c26-bd28-ea2e62baeadd', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A7A1AFB50>]}
[0m01:58:21.946491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9348cfea-19ad-4c26-bd28-ea2e62baeadd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A7A219150>]}
[0m01:58:21.997216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9348cfea-19ad-4c26-bd28-ea2e62baeadd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A7A132710>]}
[0m01:58:21.997216 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m01:58:22.371267 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m01:58:22.606958 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:58:22.606958 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m01:58:22.606958 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:58:22.622970 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m01:58:22.685626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9348cfea-19ad-4c26-bd28-ea2e62baeadd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A7A728110>]}
[0m01:58:22.819353 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:58:22.819353 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:58:22.866926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9348cfea-19ad-4c26-bd28-ea2e62baeadd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A7AAA0710>]}
[0m01:58:22.866926 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m01:58:22.876347 [info ] [MainThread]: 
[0m01:58:22.876347 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:58:22.876347 [info ] [MainThread]: 
[0m01:58:22.878362 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:58:22.882382 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m01:58:22.964029 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m01:58:22.966041 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m01:58:22.966041 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:58:26.686381 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.719 seconds
[0m01:58:26.695310 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m01:58:26.704770 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m01:58:26.704770 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m01:58:26.704770 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:58:29.211129 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.505 seconds
[0m01:58:29.255039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9348cfea-19ad-4c26-bd28-ea2e62baeadd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A7A56D850>]}
[0m01:58:29.261678 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:58:29.261678 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:58:29.261678 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m01:58:29.261678 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m01:58:29.261678 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m01:58:29.261678 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m01:58:29.269799 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:58:29.269799 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:58:29.278087 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:58:29.282179 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:58:29.282179 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:58:29.309992 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:58:29.309992 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:58:29.309992 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m01:58:29.309992 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:58:29.309992 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m01:58:29.326005 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:58:29.326005 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m01:58:29.326005 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m01:58:29.326005 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:58:33.303202 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.977 seconds
[0m01:58:33.307156 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.982 seconds
[0m01:58:33.329040 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9348cfea-19ad-4c26-bd28-ea2e62baeadd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A7ADE3710>]}
[0m01:58:33.329040 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9348cfea-19ad-4c26-bd28-ea2e62baeadd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A7A5D7390>]}
[0m01:58:33.329040 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 4.07s]
[0m01:58:33.334779 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 4.07s]
[0m01:58:33.334779 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m01:58:33.334779 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m01:58:33.334779 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:58:33.334779 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:58:33.334779 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m01:58:33.334779 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m01:58:33.334779 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m01:58:33.334779 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m01:58:33.334779 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:58:33.334779 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:58:33.334779 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:58:33.349977 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:58:33.349977 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:58:33.349977 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:58:33.349977 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:58:33.363706 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:58:33.365711 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m01:58:33.365711 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m01:58:33.367784 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m01:58:33.367784 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m01:58:33.369799 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m01:58:35.463611 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.093 seconds
[0m01:58:35.467624 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9348cfea-19ad-4c26-bd28-ea2e62baeadd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A7B227B50>]}
[0m01:58:35.467624 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 2.13s]
[0m01:58:35.469628 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m01:58:36.695520 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.329 seconds
[0m01:58:36.695520 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9348cfea-19ad-4c26-bd28-ea2e62baeadd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A7B24CB90>]}
[0m01:58:36.695520 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.36s]
[0m01:58:36.695520 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m01:58:36.695520 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:58:36.695520 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m01:58:36.695520 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m01:58:37.595291 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m01:58:37.597303 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m01:58:39.000165 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m01:58:39.001522 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m01:58:39.932128 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m01:58:39.934137 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m01:58:41.192571 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m01:58:41.192571 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m01:58:42.949366 [info ] [MainThread]: 
[0m01:58:42.949366 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 20.07 seconds (20.07s).
[0m01:58:42.951673 [debug] [MainThread]: Command end result
[0m01:58:43.020515 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m01:58:43.026599 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m01:58:43.026599 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m01:58:43.026599 [info ] [MainThread]: 
[0m01:58:43.026599 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:58:43.026599 [info ] [MainThread]: 
[0m01:58:43.034780 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m01:58:43.034780 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m01:58:43.034780 [debug] [MainThread]: Command `dbt build` succeeded at 01:58:43.034780 after 22.21 seconds
[0m01:58:43.037967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A67AB80D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A611C7AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A611C79D0>]}
[0m01:58:43.037967 [debug] [MainThread]: Flushing usage events
[0m01:58:46.473634 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:01:02.605485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C83342E10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C83342890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C833426D0>]}


============================== 02:01:02.614581 | e45d6fdd-2d43-4e05-9a26-8c0d336917b4 ==============================
[0m02:01:02.614581 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:01:02.614581 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m02:01:03.595597 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:01:03.599042 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:01:03.599042 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:01:03.728075 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:01:03.728075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e45d6fdd-2d43-4e05-9a26-8c0d336917b4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C95694F10>]}
[0m02:01:03.904765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e45d6fdd-2d43-4e05-9a26-8c0d336917b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C95704490>]}
[0m02:01:03.958038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e45d6fdd-2d43-4e05-9a26-8c0d336917b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C822C9190>]}
[0m02:01:03.958038 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:01:04.416181 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:01:04.605253 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:04.605253 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:01:04.605253 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:04.625072 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:01:04.669320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e45d6fdd-2d43-4e05-9a26-8c0d336917b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C95C081D0>]}
[0m02:01:04.796718 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:01:04.803864 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:01:04.827991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e45d6fdd-2d43-4e05-9a26-8c0d336917b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C95F80590>]}
[0m02:01:04.827991 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:01:04.844054 [info ] [MainThread]: 
[0m02:01:04.844054 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:01:04.844054 [info ] [MainThread]: 
[0m02:01:04.844054 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:04.844054 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:01:04.907741 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:01:04.907741 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:01:04.907741 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:08.279094 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.359 seconds
[0m02:01:08.290312 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:01:08.307224 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:01:08.307224 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:01:08.307224 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:10.834379 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.517 seconds
[0m02:01:10.863248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e45d6fdd-2d43-4e05-9a26-8c0d336917b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C95A4EA50>]}
[0m02:01:10.865821 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:01:10.865821 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:01:10.865821 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:01:10.865821 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:01:10.872602 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:01:10.872602 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:01:10.872602 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:01:10.872602 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:01:10.882030 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:01:10.882030 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:01:10.882030 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:01:10.913569 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:01:10.929580 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:01:10.936625 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:01:10.936625 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:01:10.936625 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:01:10.943297 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:01:10.943297 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:01:10.945653 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:01:10.948025 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:01:14.185457 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.241 seconds
[0m02:01:14.214200 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e45d6fdd-2d43-4e05-9a26-8c0d336917b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C96620590>]}
[0m02:01:14.215249 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.35s]
[0m02:01:14.216074 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:01:14.217161 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:01:14.218595 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:01:14.219128 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m02:01:14.220186 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:01:14.225868 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:01:14.227538 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:01:14.232733 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:01:14.235999 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:01:14.237151 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:01:14.237760 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:01:14.653050 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.707 seconds
[0m02:01:14.659748 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e45d6fdd-2d43-4e05-9a26-8c0d336917b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C964F99D0>]}
[0m02:01:14.659748 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.79s]
[0m02:01:14.659748 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:01:14.668980 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:01:14.668980 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:01:14.668980 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m02:01:14.668980 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:01:14.681961 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:01:14.683872 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:01:14.768711 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:01:14.768711 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:01:14.768711 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:01:16.281720 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.509 seconds
[0m02:01:16.285230 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e45d6fdd-2d43-4e05-9a26-8c0d336917b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9671AFD0>]}
[0m02:01:16.285230 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.61s]
[0m02:01:16.287235 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:01:17.403427 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.165 seconds
[0m02:01:17.406106 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e45d6fdd-2d43-4e05-9a26-8c0d336917b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C95E8B5D0>]}
[0m02:01:17.413296 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 3.19s]
[0m02:01:17.413296 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:01:17.413296 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:01:17.413296 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:01:17.421445 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:01:18.372845 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:01:18.375412 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:01:19.670368 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:01:19.670368 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:01:20.734455 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m02:01:20.734455 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m02:01:21.920931 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:01:21.920931 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:01:23.050244 [info ] [MainThread]: 
[0m02:01:23.050244 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 18.21 seconds (18.21s).
[0m02:01:23.050244 [debug] [MainThread]: Command end result
[0m02:01:23.113841 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:01:23.117329 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:01:23.124047 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:01:23.124047 [info ] [MainThread]: 
[0m02:01:23.124047 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:01:23.124047 [info ] [MainThread]: 
[0m02:01:23.124047 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:01:23.124047 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:01:23.128487 [debug] [MainThread]: Command `dbt build` succeeded at 02:01:23.124047 after 20.62 seconds
[0m02:01:23.128487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C8334C410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C8334FE90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C8334FFD0>]}
[0m02:01:23.128487 [debug] [MainThread]: Flushing usage events
[0m02:01:26.426313 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:01:46.086905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FEC5ADCD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FEC5AF610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FEC5AFCD0>]}


============================== 02:01:46.092186 | 9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7 ==============================
[0m02:01:46.092186 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:01:46.092186 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_c', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m02:01:47.190401 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:01:47.190401 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:01:47.190401 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:01:47.340053 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:01:47.344045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFE945E10>]}
[0m02:01:47.512967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFE964490>]}
[0m02:01:47.581331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FEB59D0D0>]}
[0m02:01:47.581331 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:01:47.986553 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:01:48.194924 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:48.194924 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:01:48.194924 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:48.194924 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:01:48.257924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFEFEB050>]}
[0m02:01:48.380981 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:01:48.380981 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:01:48.412562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF2506D0>]}
[0m02:01:48.412562 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:01:48.428362 [info ] [MainThread]: 
[0m02:01:48.428362 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:01:48.428362 [info ] [MainThread]: 
[0m02:01:48.428362 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:48.428362 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:01:48.512502 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:01:48.512502 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:01:48.512502 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:52.028970 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.514 seconds
[0m02:01:52.049992 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:01:52.060937 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:01:52.060937 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:01:52.060937 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:54.587508 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.520 seconds
[0m02:01:54.609473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFEB07310>]}
[0m02:01:54.609473 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:01:54.609473 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:01:54.609473 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:01:54.609473 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:01:54.609473 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m02:01:54.609473 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m02:01:54.609473 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m02:01:54.624157 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m02:01:54.625869 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m02:01:54.625869 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m02:01:54.627100 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m02:01:54.627100 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m02:01:54.627100 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:01:54.627100 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:01:54.627100 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:01:54.627100 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:01:54.641050 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:01:54.641050 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:01:54.655390 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:01:54.659067 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:01:54.659067 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:01:54.659067 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:01:54.667971 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:01:54.684438 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:01:54.704092 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:01:54.706098 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:01:54.706098 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:01:54.715836 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:01:54.715836 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:01:54.715836 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:01:54.715836 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:01:54.715836 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m02:01:54.731480 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:01:54.731480 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m02:01:54.731480 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m02:01:54.731480 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:01:54.731480 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m02:01:54.731480 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:01:54.731480 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:01:54.731480 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:01:57.196066 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.461 seconds
[0m02:01:57.307242 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.568 seconds
[0m02:01:57.307242 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FE9182110>]}
[0m02:01:57.307242 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF2536D0>]}
[0m02:01:57.307242 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.67s]
[0m02:01:57.307242 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 2.68s]
[0m02:01:57.307242 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:01:57.307242 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:01:57.307242 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:01:57.307242 [info ] [Thread-2 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m02:01:57.307242 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m02:01:57.307242 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:01:57.307242 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:01:57.323334 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:01:57.325345 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:01:57.325345 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:01:57.325345 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m02:01:57.596289 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.856 seconds
[0m02:01:57.596289 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF8878D0>]}
[0m02:01:57.596289 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 2.97s]
[0m02:01:57.596289 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:01:57.916881 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.172 seconds
[0m02:01:57.918892 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF887950>]}
[0m02:01:57.918892 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 3.29s]
[0m02:01:57.918892 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:01:57.918892 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:01:57.918892 [info ] [Thread-3 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m02:01:57.918892 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m02:01:57.918892 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:01:57.929615 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:01:57.929615 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:01:57.929615 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:01:57.929615 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:01:57.929615 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m02:01:58.225508 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.896 seconds
[0m02:01:58.235575 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF51F8D0>]}
[0m02:01:58.237589 [info ] [Thread-2 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.93s]
[0m02:01:58.240632 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:01:58.242644 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:01:58.245480 [info ] [Thread-5 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m02:01:58.245480 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m02:01:58.245480 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:01:58.254380 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:01:58.254380 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:01:58.260408 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:01:58.262414 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:01:58.262414 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav,
        nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date) as daily_pnl,
        case
            when lag(nav_usd) over (partition by portfolio_id order by valuation_date) > 0
            then (nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date)) / lag(nav_usd) over (partition by portfolio_id order by valuation_date)
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from valuations
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m02:01:58.731282 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.792 seconds
[0m02:01:58.731282 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF51F190>]}
[0m02:01:58.731282 [info ] [Thread-3 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 0.81s]
[0m02:01:58.737999 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:01:58.737999 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:01:58.737999 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:01:58.740016 [info ] [Thread-2 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m02:01:58.740016 [info ] [Thread-4 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m02:01:58.740016 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m02:01:58.743185 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m02:01:58.743185 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:01:58.743185 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:01:58.745925 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:01:58.755416 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:01:58.755416 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:01:58.763782 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:01:58.763782 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:01:58.767367 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:01:58.767367 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:01:58.767367 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value,
        market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date) as daily_pnl,
        case
            when lag(market_value_usd) over (partition by security_id order by position_date) > 0
            then (market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date)) / lag(market_value_usd) over (partition by security_id order by position_date)
            else 0
        end as daily_return_pct
    from cast_enriched
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m02:01:58.777589 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:01:58.778787 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        portfolio_id,
        position_date,
        sector,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd
    from enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(market_value_usd) as sector_value,
        sum(quantity) as total_quantity
    from cast_enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as portfolio_value
    from cast_enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m02:01:59.035725 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.771 seconds
[0m02:01:59.035725 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF89A190>]}
[0m02:01:59.035725 [info ] [Thread-5 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 0.79s]
[0m02:01:59.035725 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:01:59.035725 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:01:59.035725 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:01:59.035725 [info ] [Thread-3 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m02:01:59.035725 [info ] [Thread-5 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m02:01:59.035725 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m02:01:59.035725 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m02:01:59.035725 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:01:59.035725 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:01:59.050977 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:01:59.054999 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:01:59.054999 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:01:59.054999 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:01:59.054999 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:01:59.066591 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:01:59.066591 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:01:59.066591 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m02:01:59.066591 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:01:59.076060 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m02:01:59.486614 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.709 seconds
[0m02:01:59.489833 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FEC5BA110>]}
[0m02:01:59.489833 [info ] [Thread-2 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 0.75s]
[0m02:01:59.489833 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:01:59.489833 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:01:59.489833 [info ] [Thread-2 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m02:01:59.496029 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m02:01:59.496029 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:01:59.502119 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:01:59.502119 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:01:59.506131 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:01:59.510140 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:01:59.510140 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m02:01:59.524108 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.744 seconds
[0m02:01:59.531730 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FEBD81210>]}
[0m02:01:59.531730 [info ] [Thread-4 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 0.79s]
[0m02:01:59.534835 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:01:59.534835 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:01:59.534835 [info ] [Thread-4 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m02:01:59.534835 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m02:01:59.534835 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:01:59.543016 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:01:59.545022 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:01:59.547688 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:01:59.549694 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:01:59.551698 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m02:01:59.848227 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.774 seconds
[0m02:01:59.848227 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.780 seconds
[0m02:01:59.848227 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF7DD890>]}
[0m02:01:59.863913 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFEAA2ED0>]}
[0m02:01:59.863913 [info ] [Thread-5 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 0.81s]
[0m02:01:59.863913 [info ] [Thread-3 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 0.83s]
[0m02:01:59.863913 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:01:59.863913 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:01:59.863913 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:01:59.863913 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:01:59.879747 [info ] [Thread-5 (]: 14 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m02:01:59.884453 [info ] [Thread-3 (]: 15 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m02:01:59.886573 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m02:01:59.886573 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m02:01:59.888173 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:01:59.890149 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:01:59.890762 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:01:59.901442 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:01:59.901442 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:01:59.901442 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:01:59.901442 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:01:59.909545 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:01:59.909545 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:01:59.909545 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m02:01:59.912720 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:01:59.912720 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m02:02:00.572942 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.022 seconds
[0m02:02:00.577790 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.066 seconds
[0m02:02:00.580651 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF15BDD0>]}
[0m02:02:00.601807 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF7AF710>]}
[0m02:02:00.601807 [info ] [Thread-4 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 1.05s]
[0m02:02:00.601807 [info ] [Thread-2 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 1.11s]
[0m02:02:00.607227 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:02:00.607227 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:02:00.612392 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:02:00.612392 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:02:00.612392 [info ] [Thread-4 (]: 16 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m02:02:00.612392 [info ] [Thread-2 (]: 17 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m02:02:00.622998 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m02:02:00.622998 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m02:02:00.622998 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:02:00.631442 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:02:00.646171 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:02:00.655948 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:02:00.662160 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:02:00.664637 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:02:00.672968 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:02:00.691780 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:02:00.691780 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:02:00.698559 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:02:00.702039 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m02:02:00.702039 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m02:02:00.716425 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.802 seconds
[0m02:02:00.722662 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF15BE10>]}
[0m02:02:00.722662 [info ] [Thread-5 (]: 14 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 0.84s]
[0m02:02:00.722662 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:02:00.722662 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:02:00.722662 [info ] [Thread-5 (]: 18 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m02:02:00.722662 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m02:02:00.733887 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:02:00.733887 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:02:00.738341 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:02:00.738341 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:02:00.738341 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:02:00.738341 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m02:02:00.852845 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.935 seconds
[0m02:02:00.852845 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FEBD81210>]}
[0m02:02:00.852845 [info ] [Thread-3 (]: 15 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 0.97s]
[0m02:02:00.867286 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:02:00.867286 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:02:00.867286 [info ] [Thread-3 (]: 19 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m02:02:00.867286 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m02:02:00.873100 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:02:00.879125 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:02:00.879125 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:02:00.884144 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:02:00.888155 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:02:00.890163 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m02:02:01.497001 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.789 seconds
[0m02:02:01.497001 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFFB2F910>]}
[0m02:02:01.497001 [info ] [Thread-4 (]: 16 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 0.87s]
[0m02:02:01.497001 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:02:01.497001 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:02:01.497001 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m02:02:01.497001 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m02:02:01.497001 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:02:01.497001 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:02:01.497001 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:02:01.517217 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:02:01.517217 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:02:01.519230 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m02:02:01.696895 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.992 seconds
[0m02:02:01.701805 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF8A1090>]}
[0m02:02:01.701805 [info ] [Thread-2 (]: 17 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 1.08s]
[0m02:02:01.701805 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:02:01.706229 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:02:01.706229 [info ] [Thread-2 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m02:02:01.706229 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m02:02:01.706229 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:02:01.712993 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:02:01.712993 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:02:01.719073 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:02:01.719073 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:02:01.719073 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m02:02:01.729911 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.983 seconds
[0m02:02:01.729911 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF25B010>]}
[0m02:02:01.729911 [info ] [Thread-5 (]: 18 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 1.01s]
[0m02:02:01.729911 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:02:01.729911 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:02:01.729911 [info ] [Thread-5 (]: 22 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m02:02:01.729911 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m02:02:01.729911 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:02:01.741667 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:02:01.743672 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:02:01.745176 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:02:01.745176 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:02:01.745176 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m02:02:02.114346 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.223 seconds
[0m02:02:02.116368 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFEA8DE10>]}
[0m02:02:02.116368 [info ] [Thread-3 (]: 19 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 1.25s]
[0m02:02:02.116368 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:02:02.128204 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:02:02.128204 [info ] [Thread-3 (]: 23 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m02:02:02.128204 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m02:02:02.128204 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:02:02.138598 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:02:02.140607 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:02:02.159897 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:02:02.159897 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:02:02.159897 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m02:02:02.441281 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.921 seconds
[0m02:02:02.445747 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FE84BA990>]}
[0m02:02:02.446953 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 0.95s]
[0m02:02:02.447514 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:02:02.448684 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:02:02.449834 [info ] [Thread-4 (]: 24 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m02:02:02.450486 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m02:02:02.451126 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:02:02.457233 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:02:02.459065 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:02:02.464469 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:02:02.467961 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:02:02.468585 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m02:02:02.718794 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.969 seconds
[0m02:02:02.723602 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.999 seconds
[0m02:02:02.723602 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFFB4BA90>]}
[0m02:02:02.734629 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFFAD2F90>]}
[0m02:02:02.734629 [info ] [Thread-5 (]: 22 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 0.99s]
[0m02:02:02.734629 [info ] [Thread-2 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 1.03s]
[0m02:02:02.734629 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:02:02.734629 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:02:02.734629 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:02:02.734629 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:02:02.734629 [info ] [Thread-5 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m02:02:02.734629 [info ] [Thread-2 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m02:02:02.734629 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_executive_summary, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m02:02:02.750756 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m02:02:02.750756 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:02:02.750756 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:02:02.750756 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:02:02.760191 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:02:02.762198 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:02:02.766828 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:02:02.766828 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:02:02.766828 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:02:02.766828 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:02:02.766828 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m02:02:02.766828 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:02:02.766828 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m02:02:03.641556 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.174 seconds
[0m02:02:03.641556 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.870 seconds
[0m02:02:03.647309 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FE84BBB10>]}
[0m02:02:03.655529 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FE84C08D0>]}
[0m02:02:03.884919 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.110 seconds
[0m02:02:03.891682 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FE5ED0350>]}
[0m02:02:04.568991 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.405 seconds
[0m02:02:04.568991 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c97a7ce-d6eb-4fb2-a1f8-99570f67a1b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FFF59EF50>]}
[0m02:02:06.060326 [debug] [Thread-4 (]: An error was encountered while trying to send an event
[0m02:02:06.062162 [info ] [Thread-2 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 0.90s]
[0m02:02:06.062162 [info ] [Thread-5 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 1.16s]
[0m02:02:06.062162 [info ] [Thread-3 (]: 23 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 2.44s]
[0m02:02:06.070259 [info ] [Thread-4 (]: 24 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 1.20s]
[0m02:02:06.070259 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:02:06.073581 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:02:06.073581 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:02:06.073581 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:02:06.085689 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:02:06.087703 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:02:06.089724 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:02:07.182350 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:02:07.182350 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:02:08.309232 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m02:02:08.309937 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m02:02:09.334443 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m02:02:09.337147 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m02:02:10.563650 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_performance_drivers' was left open.
[0m02:02:10.563650 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m02:02:11.502323 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_position_attribution' was left open.
[0m02:02:11.502323 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m02:02:12.818240 [info ] [MainThread]: 
[0m02:02:12.818240 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 24.39 seconds (24.39s).
[0m02:02:12.830359 [debug] [MainThread]: Command end result
[0m02:02:12.862277 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:02:12.862277 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:02:12.878289 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:02:12.878289 [info ] [MainThread]: 
[0m02:02:12.878289 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:02:12.878289 [info ] [MainThread]: 
[0m02:02:12.878289 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m02:02:12.878289 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:02:12.878289 [debug] [MainThread]: Command `dbt build` succeeded at 02:02:12.878289 after 26.91 seconds
[0m02:02:12.878289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FE5A07AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FE5A079D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FEC2588D0>]}
[0m02:02:12.878289 [debug] [MainThread]: Flushing usage events
[0m02:02:16.501048 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:03:55.944567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025CEECED3D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025CEEA92090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025CEECEC190>]}


============================== 02:03:55.944567 | 9a5b0c3b-ba59-4e05-91a1-613685433b92 ==============================
[0m02:03:55.944567 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:03:55.944567 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_c', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m02:03:56.817431 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:03:56.817431 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:03:56.817431 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:03:57.167398 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:03:57.179810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9a5b0c3b-ba59-4e05-91a1-613685433b92', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C81155790>]}
[0m02:03:57.834247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a5b0c3b-ba59-4e05-91a1-613685433b92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C8123B310>]}
[0m02:03:58.042747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9a5b0c3b-ba59-4e05-91a1-613685433b92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025CEDCCD110>]}
[0m02:03:58.055633 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:03:59.444352 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:04:00.288509 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:04:00.292065 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:04:00.295729 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:04:00.326853 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:04:00.447169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9a5b0c3b-ba59-4e05-91a1-613685433b92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C81722ED0>]}
[0m02:04:00.670201 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:04:00.670201 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:04:00.724617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9a5b0c3b-ba59-4e05-91a1-613685433b92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025C81A41090>]}
[0m02:04:00.724617 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:04:00.726799 [info ] [MainThread]: 
[0m02:04:00.726799 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:04:00.726799 [info ] [MainThread]: 
[0m02:04:00.732888 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:04:00.735188 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:04:00.855043 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:04:00.855043 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:04:00.855043 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:04:04.948856 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 4.088 seconds
[0m02:04:04.952160 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:04:04.953216 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:04:04.954293 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:04:05.263045 [error] [MainThread]: Encountered an error:

[0m02:04:05.291753 [error] [MainThread]: Traceback (most recent call last):
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\task\runnable.py", line 546, in execute_with_hooks
    before_run_status = self.before_run(adapter, selected_uids)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\task\run.py", line 1074, in before_run
    self.create_schemas(adapter, required_schemas)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\task\runnable.py", line 720, in create_schemas
    for ls_future in as_completed(list_futures):
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\concurrent\futures\_base.py", line 243, in as_completed
    waiter.event.wait(wait_timeout)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 622, in wait
    signaled = self._cond.wait(timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 320, in wait
    waiter.acquire()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\vendored\urllib3\contrib\pyopenssl.py", line 326, in recv_into
    return self.connection.recv_into(*args, **kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\OpenSSL\SSL.py", line 2339, in recv_into
    self._raise_ssl_error(self._ssl, result)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\OpenSSL\SSL.py", line 2017, in _raise_ssl_error
    raise WantReadError()
OpenSSL.SSL.WantReadError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 182, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 128, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 276, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 321, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 391, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 368, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 408, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\main.py", line 210, in build
    results = task.run()
              ^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\task\runnable.py", line 613, in run
    result = self.execute_with_hooks(selected_uids)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\task\runnable.py", line 579, in execute_with_hooks
    adapter.cleanup_connections()
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\adapters\base\impl.py", line 416, in cleanup_connections
    self.connections.cleanup_all()
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\adapters\base\connections.py", line 309, in cleanup_all
    self.close(connection)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\adapters\base\connections.py", line 379, in close
    cls._close_handle(connection)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\adapters\base\connections.py", line 346, in _close_handle
    connection.handle.close()
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\connection.py", line 1199, in close
    self._telemetry.close(retry=retry)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\telemetry.py", line 213, in close
    self.send_batch(retry=retry)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\telemetry.py", line 185, in send_batch
    ret = self._rest.request(
          ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\network.py", line 487, in request
    return self._post_request(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\network.py", line 754, in _post_request
    ret = self.fetch(
          ^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\network.py", line 873, in fetch
    ret = self._request_exec_wrapper(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\network.py", line 924, in _request_exec_wrapper
    return_object = self._request_exec(
                    ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\network.py", line 1109, in _request_exec
    raw_ret = session.request(
              ^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\vendored\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\vendored\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\vendored\requests\adapters.py", line 644, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\vendored\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\vendored\urllib3\connectionpool.py", line 534, in _make_request
    response = conn.getresponse()
               ^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\vendored\urllib3\connection.py", line 574, in getresponse
    httplib_response = super().getresponse()
                       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\http\client.py", line 1374, in getresponse
    response.begin()
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\http\client.py", line 318, in begin
    version, status, reason = self._read_status()
                              ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\http\client.py", line 279, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\socket.py", line 705, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\vendored\urllib3\contrib\pyopenssl.py", line 338, in recv_into
    if not util.wait_for_read(self.socket, self.socket.gettimeout()):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\vendored\urllib3\util\wait.py", line 117, in wait_for_read
    return wait_for_socket(sock, read=True, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\snowflake\connector\vendored\urllib3\util\wait.py", line 53, in select_wait_for_socket
    rready, wready, xready = fn(timeout)
                             ^^^^^^^^^^^
KeyboardInterrupt

[0m02:04:05.291753 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:04:05.297847 [debug] [MainThread]: Command `dbt build` failed at 02:04:05.297847 after 9.44 seconds
[0m02:04:05.297847 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:04:05.297847 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:04:05.297847 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:04:06.072916 [debug] [MainThread]: Flushing usage events
[0m02:04:09.472085 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:04:15.836663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019912DB8710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019913173990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001991310DC90>]}


============================== 02:04:15.845484 | e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c ==============================
[0m02:04:15.845484 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:04:15.847825 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m02:04:16.655046 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:04:16.655046 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:04:16.655046 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:04:16.781095 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:04:16.782600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001992552E810>]}
[0m02:04:16.937666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001992558E510>]}
[0m02:04:16.985737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000199120ED210>]}
[0m02:04:16.985737 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:04:17.352777 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:04:17.602177 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:04:17.604191 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:04:17.604191 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:04:17.612387 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:04:17.678775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019925AA72D0>]}
[0m02:04:17.824983 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:04:17.824983 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:04:17.881177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019925DB06D0>]}
[0m02:04:17.883187 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:04:17.888252 [info ] [MainThread]: 
[0m02:04:17.890467 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:04:17.890467 [info ] [MainThread]: 
[0m02:04:17.892473 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:04:17.896482 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:04:17.984864 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:04:17.984864 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:04:17.988232 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:04:20.999920 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.015 seconds
[0m02:04:20.999920 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:04:21.021638 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:04:21.026766 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:04:21.026766 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:04:23.215942 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.189 seconds
[0m02:04:23.230986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019925B4B790>]}
[0m02:04:23.230986 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:04:23.230986 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:04:23.230986 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:04:23.246676 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:04:23.246676 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:04:23.246676 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:04:23.246676 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:04:23.246676 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:04:23.258274 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:04:23.262754 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:04:23.262754 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:04:23.278828 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:04:23.294897 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:04:23.294897 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:04:23.294897 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:04:23.294897 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:04:23.294897 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:04:23.294897 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:04:23.294897 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:04:23.294897 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:04:26.756503 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.447 seconds
[0m02:04:26.781658 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001992630D2D0>]}
[0m02:04:26.781658 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.53s]
[0m02:04:26.781658 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:04:26.781658 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:04:26.781658 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:04:26.781658 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m02:04:26.781658 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:04:26.781658 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:04:26.781658 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:04:26.802605 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:04:26.802605 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.496 seconds
[0m02:04:26.804613 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000199258E4DD0>]}
[0m02:04:26.804613 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.56s]
[0m02:04:26.804613 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:04:26.804613 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:04:26.804613 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:04:26.804613 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:04:26.804613 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:04:26.813175 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:04:26.813952 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m02:04:26.813952 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:04:26.813952 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:04:26.813952 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:04:26.821679 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:04:26.904701 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:04:26.907201 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:04:28.858655 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.950 seconds
[0m02:04:28.864424 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001992633EB50>]}
[0m02:04:28.865958 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 2.05s]
[0m02:04:28.865958 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:04:29.980976 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.169 seconds
[0m02:04:29.987014 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e24f8ab4-c423-4ea5-916b-7ddfb78a5e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019925D83250>]}
[0m02:04:29.987014 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.21s]
[0m02:04:29.987014 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:04:29.994799 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:04:29.994799 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:04:29.994799 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:04:30.669983 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:04:30.669983 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:04:31.775795 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m02:04:31.775795 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m02:04:33.419809 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:04:33.423492 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:04:34.339221 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:04:34.339221 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:04:35.572218 [info ] [MainThread]: 
[0m02:04:35.574232 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 17.68 seconds (17.68s).
[0m02:04:35.574232 [debug] [MainThread]: Command end result
[0m02:04:35.629159 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:04:35.632169 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:04:35.632169 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:04:35.632169 [info ] [MainThread]: 
[0m02:04:35.640811 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:04:35.640811 [info ] [MainThread]: 
[0m02:04:35.640811 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:04:35.643338 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:04:35.643338 [debug] [MainThread]: Command `dbt build` succeeded at 02:04:35.643338 after 19.94 seconds
[0m02:04:35.643338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001990C537950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001990C5379D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000199130FFB90>]}
[0m02:04:35.646625 [debug] [MainThread]: Flushing usage events
[0m02:04:38.073221 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:05:52.183685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E1510D550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E1510D4D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E1510E010>]}


============================== 02:05:52.192174 | 8bda46b5-9614-4c5c-b553-5b330bf4cc0a ==============================
[0m02:05:52.192174 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:05:52.192174 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_b', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m02:05:53.335049 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:05:53.342794 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:05:53.345940 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:05:53.517658 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:05:53.520164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E247B46D0>]}
[0m02:05:53.704375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E27540150>]}
[0m02:05:53.767547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E140F9190>]}
[0m02:05:53.767547 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:05:54.202632 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:05:54.397016 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:05:54.397016 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:05:54.397016 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:05:54.408366 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:05:54.456011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E278F0350>]}
[0m02:05:54.598532 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:05:54.598532 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:05:54.632071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E27DB0ED0>]}
[0m02:05:54.632071 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:05:54.644068 [info ] [MainThread]: 
[0m02:05:54.644068 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:05:54.646081 [info ] [MainThread]: 
[0m02:05:54.646885 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:05:54.650896 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:05:54.710709 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:05:54.720073 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:05:54.721579 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:05:57.939297 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.220 seconds
[0m02:05:57.948812 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:05:57.967959 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:05:57.969964 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:05:57.970968 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:06:00.461148 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.490 seconds
[0m02:06:00.486195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E280FC210>]}
[0m02:06:00.498264 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:06:00.498264 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:06:00.498264 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:06:00.498264 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:06:00.498264 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:06:00.501830 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:06:00.501830 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:06:00.501830 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:06:00.501830 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:06:00.501830 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:06:00.501830 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:06:00.501830 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:06:00.501830 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:06:00.501830 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:06:00.501830 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:06:00.501830 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:06:00.515852 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:06:00.517598 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:06:00.523351 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:06:00.523351 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:06:00.523351 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:06:00.523351 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:06:00.523351 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:06:00.558951 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:06:00.558951 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:06:00.562370 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:06:00.565871 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:06:00.565871 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:06:00.565871 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:06:00.565871 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:06:00.565871 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:06:00.565871 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:06:00.565871 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:06:00.565871 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:06:00.565871 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:06:00.565871 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:06:00.565871 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:06:00.565871 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:06:00.565871 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:06:00.582886 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:06:03.366536 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.785 seconds
[0m02:06:03.366536 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.789 seconds
[0m02:06:03.467857 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E28464310>]}
[0m02:06:03.467857 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E28467C90>]}
[0m02:06:03.483704 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.97s]
[0m02:06:03.483704 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 2.97s]
[0m02:06:03.483704 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:06:03.483704 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:06:03.985131 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.407 seconds
[0m02:06:03.985131 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.409 seconds
[0m02:06:03.985131 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E2846E490>]}
[0m02:06:03.993418 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E280F5A10>]}
[0m02:06:03.993418 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 3.48s]
[0m02:06:03.993418 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 3.49s]
[0m02:06:03.993418 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:06:03.993418 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:06:03.993418 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:06:04.000942 [info ] [Thread-5 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:06:04.000942 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:06:04.000942 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:06:04.000942 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:06:04.000942 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:06:04.010565 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:06:04.012572 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:06:04.014576 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:06:04.912301 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.898 seconds
[0m02:06:04.916104 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E27B02A90>]}
[0m02:06:04.920853 [info ] [Thread-5 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.92s]
[0m02:06:04.920853 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:06:04.922858 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:06:04.922858 [info ] [Thread-3 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:06:04.922858 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:06:04.922858 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:06:04.931217 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:06:04.934218 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:06:04.938239 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:06:04.941992 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:06:04.942512 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:06:05.818731 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.875 seconds
[0m02:06:05.824769 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E27586DD0>]}
[0m02:06:05.824769 [info ] [Thread-3 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 0.90s]
[0m02:06:05.826777 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:06:05.826777 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:06:05.826777 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:06:05.826777 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:06:05.826777 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:06:05.832561 [info ] [Thread-4 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:06:05.832561 [info ] [Thread-5 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:06:05.832561 [info ] [Thread-2 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:06:05.832561 [info ] [Thread-3 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:06:05.832561 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:06:05.832561 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:06:05.832561 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:06:05.832561 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:06:05.832561 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:06:05.832561 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:06:05.832561 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:06:05.832561 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:06:05.848541 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:06:05.848541 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:06:05.848541 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:06:05.862041 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:06:05.862041 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:06:05.864630 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:06:05.864630 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:06:05.864630 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:06:05.864630 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:06:05.864630 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:06:05.875993 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:06:05.880412 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:06:05.880412 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:06:05.880412 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:06:05.880412 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:06:05.880412 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:06:05.880412 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:06:05.880412 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:06:05.880412 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:06:05.880412 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:06:06.908711 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.015 seconds
[0m02:06:06.908711 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.021 seconds
[0m02:06:06.914818 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E27591990>]}
[0m02:06:06.919716 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E27DB8E90>]}
[0m02:06:06.919716 [info ] [Thread-3 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.08s]
[0m02:06:06.919716 [info ] [Thread-4 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.09s]
[0m02:06:06.924831 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:06:06.925633 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:06:06.927358 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:06:06.928300 [info ] [Thread-3 (]: 11 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:06:06.928300 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:06:06.928300 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:06:06.930992 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:06:06.935621 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:06:06.935621 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:06:06.935621 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:06:06.941973 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:06:07.157835 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.264 seconds
[0m02:06:07.160310 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.267 seconds
[0m02:06:07.160310 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E275C3350>]}
[0m02:06:07.171732 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E148B0E90>]}
[0m02:06:07.171732 [info ] [Thread-2 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.33s]
[0m02:06:07.171732 [info ] [Thread-5 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.34s]
[0m02:06:07.183419 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:06:07.183419 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:06:07.187604 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:06:07.187604 [info ] [Thread-4 (]: 12 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:06:07.187604 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:06:07.187604 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:06:07.187604 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:06:07.187604 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:06:07.205671 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:06:07.205671 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:06:07.208622 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:06:07.768859 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.827 seconds
[0m02:06:07.768859 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E28450810>]}
[0m02:06:07.768859 [info ] [Thread-3 (]: 11 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 0.84s]
[0m02:06:07.768859 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:06:08.086229 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.880 seconds
[0m02:06:08.086229 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bda46b5-9614-4c5c-b553-5b330bf4cc0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E275C2550>]}
[0m02:06:08.103950 [info ] [Thread-4 (]: 12 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 0.90s]
[0m02:06:08.104644 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:06:08.104644 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:06:08.104644 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:06:08.104644 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:06:09.241372 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:06:09.243987 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:06:10.393772 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_execution_analysis' was left open.
[0m02:06:10.393772 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: Close
[0m02:06:11.644338 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:06:11.644338 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:06:12.851546 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:06:12.851546 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:06:14.180221 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m02:06:14.181254 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m02:06:15.712940 [info ] [MainThread]: 
[0m02:06:15.712940 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 21.07 seconds (21.07s).
[0m02:06:15.716951 [debug] [MainThread]: Command end result
[0m02:06:15.782548 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:06:15.785363 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:06:15.793864 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:06:15.795768 [info ] [MainThread]: 
[0m02:06:15.795768 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:06:15.795768 [info ] [MainThread]: 
[0m02:06:15.795768 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:06:15.795768 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:06:15.800240 [debug] [MainThread]: Command `dbt build` succeeded at 02:06:15.800240 after 23.76 seconds
[0m02:06:15.800240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E0E547AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E0E5479D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017E11C44ED0>]}
[0m02:06:15.800240 [debug] [MainThread]: Flushing usage events
[0m02:06:18.994167 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:07:01.732966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9CACDCE50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9CACDF890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9CACDFE50>]}


============================== 02:07:01.732966 | 64881747-2431-42e7-99c7-9082bfa83bdf ==============================
[0m02:07:01.732966 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:07:01.732966 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_b', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m02:07:02.432330 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:07:02.434337 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:07:02.434337 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:07:02.563857 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:07:02.565788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '64881747-2431-42e7-99c7-9082bfa83bdf', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9C762DA90>]}
[0m02:07:02.726371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64881747-2431-42e7-99c7-9082bfa83bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9DD110090>]}
[0m02:07:02.780392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64881747-2431-42e7-99c7-9082bfa83bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9C9CBD090>]}
[0m02:07:02.780392 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:07:03.143804 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:07:03.350507 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:07:03.350507 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:07:03.350507 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:07:03.350507 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:07:03.415172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '64881747-2431-42e7-99c7-9082bfa83bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9DD4B7950>]}
[0m02:07:03.548476 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:07:03.548476 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:07:03.583459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64881747-2431-42e7-99c7-9082bfa83bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9DD980510>]}
[0m02:07:03.595899 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:07:03.595899 [info ] [MainThread]: 
[0m02:07:03.595899 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:07:03.595899 [info ] [MainThread]: 
[0m02:07:03.595899 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:07:03.611670 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:07:03.665825 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:07:03.676084 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:07:03.676084 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:07:07.685547 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 4.012 seconds
[0m02:07:07.697248 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:07:07.725771 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:07:07.729869 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:07:07.729869 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:07:10.808163 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 3.076 seconds
[0m02:07:10.815882 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:07:10.817047 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:07:10.818226 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:07:11.438235 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:07:11.438235 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:07:12.653158 [info ] [MainThread]: 
[0m02:07:12.653158 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 9.06 seconds (9.06s).
[0m02:07:12.653158 [error] [MainThread]: Encountered an error:

[0m02:07:12.653158 [error] [MainThread]: Traceback (most recent call last):
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 182, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 128, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 276, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 321, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 391, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 368, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\requires.py", line 408, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\cli\main.py", line 210, in build
    results = task.run()
              ^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\task\runnable.py", line 613, in run
    result = self.execute_with_hooks(selected_uids)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\task\runnable.py", line 546, in execute_with_hooks
    before_run_status = self.before_run(adapter, selected_uids)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\task\run.py", line 1075, in before_run
    self.populate_adapter_cache(adapter, required_schemas)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\task\runnable.py", line 512, in populate_adapter_cache
    adapter.set_relations_cache(cachable_nodes)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\adapters\base\impl.py", line 651, in set_relations_cache
    self._relations_cache_for_schemas(relation_configs, required_schemas)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\site-packages\dbt\adapters\base\impl.py", line 624, in _relations_cache_for_schemas
    for future in as_completed(futures):
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\concurrent\futures\_base.py", line 243, in as_completed
    waiter.event.wait(wait_timeout)
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 622, in wait
    signaled = self._cond.wait(timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\digi kaj\AppData\Local\Programs\Python\Python311\Lib\threading.py", line 320, in wait
    waiter.acquire()
KeyboardInterrupt

[0m02:07:12.653158 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:07:12.663925 [debug] [MainThread]: Command `dbt build` failed at 02:07:12.663925 after 11.01 seconds
[0m02:07:12.663925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9CA9980D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9CAD43510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F9CAD43150>]}
[0m02:07:12.663925 [debug] [MainThread]: Flushing usage events
[0m02:07:15.149885 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:07:25.485233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B21729C250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B21729FC10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B21729C7D0>]}


============================== 02:07:25.486603 | 146f6af7-e397-41c4-ab61-9c4b9583c567 ==============================
[0m02:07:25.486603 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:07:25.486603 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_b', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m02:07:26.388351 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:07:26.389923 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:07:26.390993 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:07:26.608290 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:07:26.612943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2286EF490>]}
[0m02:07:26.834350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B215A6F690>]}
[0m02:07:26.923448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2285EE890>]}
[0m02:07:26.923448 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:07:27.466212 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:07:27.753053 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:07:27.753053 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:07:27.753053 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:07:27.766185 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:07:27.851924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B228AA9950>]}
[0m02:07:28.036552 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:07:28.039283 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:07:28.091274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B228F703D0>]}
[0m02:07:28.097170 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:07:28.099595 [info ] [MainThread]: 
[0m02:07:28.099595 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:07:28.099595 [info ] [MainThread]: 
[0m02:07:28.099595 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:07:28.110752 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:07:28.270207 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:07:28.270207 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:07:28.270207 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:07:32.774064 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 4.497 seconds
[0m02:07:32.774064 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:07:32.797956 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:07:32.797956 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:07:32.799962 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:07:35.595964 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.799 seconds
[0m02:07:35.632142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2292D3E50>]}
[0m02:07:35.639958 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:07:35.639958 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:07:35.639958 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:07:35.639958 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:07:35.639958 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:07:35.639958 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:07:35.639958 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:07:35.639958 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:07:35.639958 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:07:35.639958 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:07:35.639958 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:07:35.655705 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:07:35.655705 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:07:35.655705 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:07:35.655705 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:07:35.655705 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:07:35.672301 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:07:35.683680 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:07:35.687464 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:07:35.687464 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:07:35.687464 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:07:35.687464 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:07:35.701498 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:07:35.719069 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:07:35.737991 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:07:35.743988 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:07:35.751774 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:07:35.760214 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:07:35.763088 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:07:35.763088 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:07:35.768238 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:07:35.771568 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:07:35.771568 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:07:35.774029 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:07:35.774029 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:07:35.776287 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:07:35.776287 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:07:35.776287 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:07:35.776287 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:07:35.776287 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:07:37.989316 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.211 seconds
[0m02:07:37.993339 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.217 seconds
[0m02:07:37.995348 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.220 seconds
[0m02:07:38.107276 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B229636510>]}
[0m02:07:38.107276 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2296A5950>]}
[0m02:07:38.107276 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B22963CDD0>]}
[0m02:07:38.107276 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 2.45s]
[0m02:07:38.107276 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.47s]
[0m02:07:38.107276 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.47s]
[0m02:07:38.107276 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:07:38.107276 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:07:38.123771 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:07:38.509715 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.732 seconds
[0m02:07:38.517503 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2295E4AD0>]}
[0m02:07:38.519512 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.88s]
[0m02:07:38.519512 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:07:38.519512 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:07:38.524657 [info ] [Thread-4 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:07:38.524657 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:07:38.524657 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:07:38.530668 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:07:38.530668 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:07:38.540578 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:07:38.540578 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:07:38.540578 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:07:39.435688 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.892 seconds
[0m02:07:39.445638 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B228A66610>]}
[0m02:07:39.447649 [info ] [Thread-4 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.92s]
[0m02:07:39.452134 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:07:39.456454 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:07:39.457963 [info ] [Thread-2 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:07:39.461456 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:07:39.461456 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:07:39.466286 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:07:39.466286 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:07:39.485441 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:07:39.500017 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:07:39.500017 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:07:40.952072 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.446 seconds
[0m02:07:40.952072 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2294C5BD0>]}
[0m02:07:40.952072 [info ] [Thread-2 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 1.49s]
[0m02:07:40.952072 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:07:40.952072 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:07:40.952072 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:07:40.952072 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:07:40.952072 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:07:40.952072 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:07:40.952072 [info ] [Thread-4 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:07:40.968179 [info ] [Thread-5 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:07:40.968179 [info ] [Thread-2 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:07:40.968179 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:07:40.968179 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:07:40.968179 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:07:40.968179 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:07:40.974313 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:07:40.974313 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:07:40.974313 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:07:40.974313 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:07:40.982668 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:07:40.990826 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:07:40.990826 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:07:40.996505 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:07:40.996505 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:07:40.996505 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:07:40.996505 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:07:41.012609 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:07:41.012609 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:07:41.012609 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:07:41.012609 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:07:41.029613 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:07:41.029613 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:07:41.029613 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:07:41.029613 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:07:41.029613 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:07:41.029613 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:07:41.029613 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:07:41.044929 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:07:41.044929 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:07:41.979657 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.929 seconds
[0m02:07:41.992162 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2295E6690>]}
[0m02:07:41.992162 [info ] [Thread-5 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.02s]
[0m02:07:42.002071 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:07:42.002992 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:07:42.009027 [info ] [Thread-5 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:07:42.013044 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:07:42.013859 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:07:42.023677 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:07:42.032698 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.984 seconds
[0m02:07:42.036133 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.990 seconds
[0m02:07:42.036727 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.983 seconds
[0m02:07:42.043529 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2296D81D0>]}
[0m02:07:42.045536 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:07:42.050665 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2287AB810>]}
[0m02:07:42.056762 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2296A6750>]}
[0m02:07:42.058019 [info ] [Thread-4 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.08s]
[0m02:07:42.068276 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:07:42.068276 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.08s]
[0m02:07:42.073009 [info ] [Thread-2 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.09s]
[0m02:07:42.074331 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:07:42.077544 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:07:42.081488 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:07:42.082525 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:07:42.085153 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:07:42.087301 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:07:42.091987 [info ] [Thread-4 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:07:42.095200 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_security_performance, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:07:42.096772 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:07:42.114659 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:07:42.116417 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:07:42.125645 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:07:42.128551 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:07:42.129057 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:07:43.246382 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.160 seconds
[0m02:07:43.246382 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.117 seconds
[0m02:07:43.250681 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2287C8410>]}
[0m02:07:43.250681 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '146f6af7-e397-41c4-ab61-9c4b9583c567', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B2294EB910>]}
[0m02:07:43.250681 [info ] [Thread-5 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.24s]
[0m02:07:43.265805 [info ] [Thread-4 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.16s]
[0m02:07:43.265805 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:07:43.265805 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:07:43.265805 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:07:43.275368 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:07:43.277386 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:07:44.292659 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:07:44.292659 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:07:45.456872 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_summary' was left open.
[0m02:07:45.456872 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m02:07:46.807581 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_trades' was left open.
[0m02:07:46.810579 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_trades: Close
[0m02:07:47.982433 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:07:47.982433 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:07:49.830693 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:07:49.833592 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:07:50.950796 [info ] [MainThread]: 
[0m02:07:50.955346 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 22.85 seconds (22.85s).
[0m02:07:50.960373 [debug] [MainThread]: Command end result
[0m02:07:51.120529 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:07:51.162384 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:07:51.198763 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:07:51.200353 [info ] [MainThread]: 
[0m02:07:51.201477 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:07:51.202634 [info ] [MainThread]: 
[0m02:07:51.203735 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:07:51.204787 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:07:51.207734 [debug] [MainThread]: Command `dbt build` succeeded at 02:07:51.207018 after 25.85 seconds
[0m02:07:51.209442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B21730FE10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B20F677950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B20F6779D0>]}
[0m02:07:51.210495 [debug] [MainThread]: Flushing usage events
[0m02:07:54.222079 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:08:13.594699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001639204D590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001639203FC50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001639204C850>]}


============================== 02:08:13.602726 | b3545468-3e65-4be4-92a8-387e9480bcc9 ==============================
[0m02:08:13.602726 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:08:13.604343 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_b', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m02:08:14.605063 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:08:14.605063 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:08:14.605063 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:08:14.744837 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:08:14.746853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A435C490>]}
[0m02:08:15.073538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A4507550>]}
[0m02:08:15.232247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001639103D290>]}
[0m02:08:15.242334 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:08:15.904723 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:08:16.219824 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:08:16.219824 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:08:16.229875 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:08:16.240442 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:08:16.319232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A4A8A5D0>]}
[0m02:08:16.479104 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:08:16.484387 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:08:16.526108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A4CF0890>]}
[0m02:08:16.526108 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:08:16.545626 [info ] [MainThread]: 
[0m02:08:16.545626 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:08:16.545626 [info ] [MainThread]: 
[0m02:08:16.545626 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:08:16.545626 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:08:16.621348 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:08:16.621348 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:08:16.621348 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:08:20.485697 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.861 seconds
[0m02:08:20.496769 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:08:20.530226 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:08:20.530226 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:08:20.530226 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:08:23.101115 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.564 seconds
[0m02:08:23.133202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A5246A50>]}
[0m02:08:23.148210 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:08:23.148210 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:08:23.148210 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:08:23.148210 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:08:23.148210 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:08:23.148210 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:08:23.148210 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:08:23.148210 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:08:23.158671 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:08:23.158671 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:08:23.164267 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:08:23.165396 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:08:23.165396 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:08:23.169760 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:08:23.173964 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:08:23.173964 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:08:23.197359 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:08:23.212348 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:08:23.222163 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:08:23.228892 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:08:23.237038 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:08:23.240368 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:08:23.240368 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:08:23.261568 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:08:23.261568 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:08:23.279620 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:08:23.293596 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:08:23.293596 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:08:23.293596 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:08:23.301242 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:08:23.301242 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:08:23.301242 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:08:23.309268 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:08:23.309268 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:08:23.309268 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:08:23.309268 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:08:23.309268 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:08:23.317884 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:08:23.317884 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:08:23.322470 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:08:25.533291 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.217 seconds
[0m02:08:25.650295 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A53B7750>]}
[0m02:08:25.650295 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.49s]
[0m02:08:25.666048 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:08:25.809164 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.487 seconds
[0m02:08:25.809164 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A5467FD0>]}
[0m02:08:25.809164 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.64s]
[0m02:08:25.809164 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:08:26.533038 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.213 seconds
[0m02:08:26.534622 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.219 seconds
[0m02:08:26.538033 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A545AD50>]}
[0m02:08:26.540893 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A525D090>]}
[0m02:08:26.541982 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 3.38s]
[0m02:08:26.542545 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 3.38s]
[0m02:08:26.543699 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:08:26.544258 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:08:26.544812 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:08:26.546555 [info ] [Thread-2 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:08:26.547134 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:08:26.548214 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:08:26.554303 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:08:26.554828 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:08:26.554828 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:08:26.561477 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:08:26.561477 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:08:27.655050 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.094 seconds
[0m02:08:27.655050 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A2385510>]}
[0m02:08:27.669990 [info ] [Thread-2 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 1.11s]
[0m02:08:27.669990 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:08:27.669990 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:08:27.669990 [info ] [Thread-4 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:08:27.682441 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:08:27.684795 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:08:27.684795 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:08:27.701744 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:08:27.721391 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:08:27.721391 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:08:27.732718 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:08:29.217931 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.487 seconds
[0m02:08:29.234160 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001639204D390>]}
[0m02:08:29.234160 [info ] [Thread-4 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 1.55s]
[0m02:08:29.241394 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:08:29.245419 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:08:29.247430 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:08:29.247430 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:08:29.249443 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:08:29.251576 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:08:29.255108 [info ] [Thread-2 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:08:29.257116 [info ] [Thread-5 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:08:29.258064 [info ] [Thread-4 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:08:29.258064 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:08:29.260075 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:08:29.260075 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:08:29.265206 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:08:29.266561 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:08:29.266561 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:08:29.266561 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:08:29.266561 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:08:29.266561 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:08:29.280853 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:08:29.290313 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:08:29.299707 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:08:29.301408 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:08:29.302495 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:08:29.303383 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:08:29.312870 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:08:29.313936 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:08:29.318253 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:08:29.325874 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:08:29.334906 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:08:29.335991 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:08:29.337607 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:08:29.337607 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:08:29.343784 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:08:29.343784 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:08:29.343784 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:08:29.343784 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:08:29.343784 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:08:30.220179 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.876 seconds
[0m02:08:30.220179 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A5450310>]}
[0m02:08:30.235836 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 0.96s]
[0m02:08:30.235836 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:08:30.312025 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.960 seconds
[0m02:08:30.313097 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A4CF3450>]}
[0m02:08:30.317939 [info ] [Thread-4 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.05s]
[0m02:08:30.317939 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:08:30.324121 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:08:30.324121 [info ] [Thread-3 (]: 11 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:08:30.326618 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:08:30.326618 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:08:30.336125 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:08:30.336125 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:08:30.343547 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:08:30.351166 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:08:30.353966 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:08:30.455875 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.106 seconds
[0m02:08:30.455875 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.109 seconds
[0m02:08:30.459275 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A545B590>]}
[0m02:08:30.464765 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001639205A150>]}
[0m02:08:30.464765 [info ] [Thread-5 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.20s]
[0m02:08:30.464765 [info ] [Thread-2 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.20s]
[0m02:08:30.471425 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:08:30.473138 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:08:30.476109 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:08:30.480322 [info ] [Thread-4 (]: 12 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:08:30.481832 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:08:30.481832 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:08:30.491076 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:08:30.493082 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:08:30.504213 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:08:30.506553 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:08:30.507203 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:08:31.343520 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.986 seconds
[0m02:08:31.344528 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A446EE10>]}
[0m02:08:31.344528 [info ] [Thread-3 (]: 11 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.02s]
[0m02:08:31.344528 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:08:31.938517 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.431 seconds
[0m02:08:31.938517 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3545468-3e65-4be4-92a8-387e9480bcc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000163A5363710>]}
[0m02:08:31.953275 [info ] [Thread-4 (]: 12 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.46s]
[0m02:08:31.953275 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:08:31.953275 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:08:31.953275 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:08:31.953275 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:08:33.041304 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:08:33.045022 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:08:34.269897 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:08:34.269897 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:08:35.652743 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m02:08:35.655000 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m02:08:36.932186 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:08:36.934304 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:08:37.877634 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_execution_analysis' was left open.
[0m02:08:37.877634 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: Close
[0m02:08:39.425561 [info ] [MainThread]: 
[0m02:08:39.427219 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 22.88 seconds (22.88s).
[0m02:08:39.432958 [debug] [MainThread]: Command end result
[0m02:08:39.496952 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:08:39.508377 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:08:39.519911 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:08:39.519911 [info ] [MainThread]: 
[0m02:08:39.519911 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:08:39.519911 [info ] [MainThread]: 
[0m02:08:39.519911 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:08:39.519911 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:08:39.519911 [debug] [MainThread]: Command `dbt build` succeeded at 02:08:39.519911 after 26.06 seconds
[0m02:08:39.528616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001638B477AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001638B4779D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001638B47CB90>]}
[0m02:08:39.530492 [debug] [MainThread]: Flushing usage events
[0m02:08:41.969664 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:09:03.200313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287ACDCCF90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287ACDCDF90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287ACDCE190>]}


============================== 02:09:03.200313 | afb7ae56-7346-4acb-b573-ec828cbb9b39 ==============================
[0m02:09:03.200313 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:09:03.200313 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m02:09:03.883114 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:09:03.883114 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:09:03.883114 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:09:03.993502 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:09:03.993502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'afb7ae56-7346-4acb-b573-ec828cbb9b39', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287BF1EC210>]}
[0m02:09:04.154317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'afb7ae56-7346-4acb-b573-ec828cbb9b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287BF293610>]}
[0m02:09:04.221683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'afb7ae56-7346-4acb-b573-ec828cbb9b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287ABDB9150>]}
[0m02:09:04.221683 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:09:04.592196 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:09:04.804932 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:09:04.804932 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:09:04.804932 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:09:04.823110 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:09:04.868628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'afb7ae56-7346-4acb-b573-ec828cbb9b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287BF6D84D0>]}
[0m02:09:04.985909 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:09:04.985909 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:09:05.042806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'afb7ae56-7346-4acb-b573-ec828cbb9b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287BFA439D0>]}
[0m02:09:05.042806 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:09:05.042806 [info ] [MainThread]: 
[0m02:09:05.058501 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:09:05.058501 [info ] [MainThread]: 
[0m02:09:05.058501 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:09:05.068719 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:09:05.136876 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:09:05.136876 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:09:05.136876 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:09:08.962018 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.815 seconds
[0m02:09:08.979676 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:09:08.993783 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:09:08.993783 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:09:08.993783 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:09:11.844665 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.845 seconds
[0m02:09:11.851286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'afb7ae56-7346-4acb-b573-ec828cbb9b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287BF30AD50>]}
[0m02:09:11.866938 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:09:11.866938 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:09:11.866938 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:09:11.866938 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:09:11.866938 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:09:11.866938 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:09:11.866938 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:09:11.866938 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:09:11.884676 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:09:11.884676 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:09:11.884676 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:09:11.896187 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:09:11.942132 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:09:11.948669 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:09:11.952392 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:09:11.953615 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:09:11.953615 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:09:11.955769 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:09:11.955769 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:09:11.955769 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:09:15.166188 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.209 seconds
[0m02:09:15.166188 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.211 seconds
[0m02:09:15.197435 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afb7ae56-7346-4acb-b573-ec828cbb9b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287BFFFA190>]}
[0m02:09:15.197435 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afb7ae56-7346-4acb-b573-ec828cbb9b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287C00FD750>]}
[0m02:09:15.197435 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.33s]
[0m02:09:15.197435 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.33s]
[0m02:09:15.197435 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:09:15.197435 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:09:15.209149 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:09:15.209149 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:09:15.209149 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:09:15.209149 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m02:09:15.209149 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:09:15.209149 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:09:15.209149 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m02:09:15.209149 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:09:15.209149 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:09:15.222356 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:09:15.224361 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:09:15.224361 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:09:15.224361 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:09:15.232404 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:09:15.234411 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:09:15.234411 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:09:15.234411 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:09:15.234411 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:09:15.240279 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:09:16.862399 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.621 seconds
[0m02:09:16.868441 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afb7ae56-7346-4acb-b573-ec828cbb9b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287C00B4250>]}
[0m02:09:16.872479 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.66s]
[0m02:09:16.874488 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:09:18.374015 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.139 seconds
[0m02:09:18.378441 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afb7ae56-7346-4acb-b573-ec828cbb9b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287C0214ED0>]}
[0m02:09:18.380456 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 3.17s]
[0m02:09:18.380456 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:09:18.382467 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:09:18.382467 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:09:18.382467 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:09:19.631404 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:09:19.633417 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:09:20.859619 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:09:20.861652 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:09:22.087504 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m02:09:22.087504 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m02:09:23.420734 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:09:23.420734 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:09:24.686329 [info ] [MainThread]: 
[0m02:09:24.688919 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 19.63 seconds (19.63s).
[0m02:09:24.689881 [debug] [MainThread]: Command end result
[0m02:09:24.755171 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:09:24.758805 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:09:24.766509 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:09:24.767035 [info ] [MainThread]: 
[0m02:09:24.768124 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:09:24.768654 [info ] [MainThread]: 
[0m02:09:24.769218 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:09:24.769740 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:09:24.771312 [debug] [MainThread]: Command `dbt build` succeeded at 02:09:24.770793 after 21.65 seconds
[0m02:09:24.771829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287A6247AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287A62479D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000287BC48F410>]}
[0m02:09:24.772359 [debug] [MainThread]: Flushing usage events
[0m02:09:27.844588 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:09:49.993612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF7ECDCA10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF7ED42890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF7ED432D0>]}


============================== 02:09:49.999946 | b37da46d-895a-4caf-a171-9ad301bf0103 ==============================
[0m02:09:49.999946 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:09:49.999946 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --select tag:pipeline_b', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m02:09:51.148703 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:09:51.150126 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:09:51.150636 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:09:51.259366 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:09:51.259366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF10E57E50>]}
[0m02:09:51.437758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF10F2E4D0>]}
[0m02:09:51.513883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF7CCF9190>]}
[0m02:09:51.513883 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:09:51.938412 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:09:52.148329 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:09:52.148329 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:09:52.148329 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:09:52.148329 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:09:52.213060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11220150>]}
[0m02:09:52.326309 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:09:52.339656 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:09:52.370521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF116B0E50>]}
[0m02:09:52.370521 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:09:52.386295 [info ] [MainThread]: 
[0m02:09:52.386295 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:09:52.386295 [info ] [MainThread]: 
[0m02:09:52.386295 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:09:52.395968 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:09:52.464310 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:09:52.464310 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:09:52.464310 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:09:55.639370 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.175 seconds
[0m02:09:55.665767 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:09:55.711745 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:09:55.716591 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:09:55.716591 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:09:57.964193 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.247 seconds
[0m02:09:57.980107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11C3EF10>]}
[0m02:09:57.995771 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:09:57.995771 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:09:57.995771 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:09:57.995771 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:09:57.995771 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:09:57.995771 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:09:57.995771 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:09:57.995771 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:09:57.995771 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:09:57.995771 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:09:57.995771 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:09:57.995771 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:09:57.995771 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:09:57.995771 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:09:57.995771 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:09:57.995771 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:09:58.011757 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:09:58.020448 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:09:58.020448 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:09:58.028737 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:09:58.028737 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:09:58.028737 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:09:58.028737 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:09:58.061786 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:09:58.073138 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:09:58.073138 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:09:58.073138 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:09:58.073138 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:09:58.084562 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:09:58.084562 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:09:58.084562 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:09:58.084562 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:09:58.094234 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:09:58.094234 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:09:58.097279 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:09:58.097279 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:09:58.097279 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:09:58.097279 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:09:58.097279 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:09:58.105420 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:10:00.227175 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.128 seconds
[0m02:10:00.368740 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF1134F750>]}
[0m02:10:00.368740 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.37s]
[0m02:10:00.371718 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:10:00.384147 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.287 seconds
[0m02:10:00.390094 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.287 seconds
[0m02:10:00.390094 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11D70910>]}
[0m02:10:00.402075 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF116B2550>]}
[0m02:10:00.402075 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.39s]
[0m02:10:00.405149 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 2.40s]
[0m02:10:00.406332 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:10:00.409008 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:10:00.462655 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.356 seconds
[0m02:10:00.471415 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11600410>]}
[0m02:10:00.473371 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.48s]
[0m02:10:00.478084 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:10:00.479700 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:10:00.481269 [info ] [Thread-3 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:10:00.482331 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:10:00.483562 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:10:00.493509 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:10:00.496101 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:10:00.505105 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:10:00.509431 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:10:00.512559 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:10:01.308429 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.795 seconds
[0m02:10:01.318483 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11DAD0D0>]}
[0m02:10:01.318483 [info ] [Thread-3 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.83s]
[0m02:10:01.322201 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:10:01.325586 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:10:01.325586 [info ] [Thread-4 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:10:01.330579 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:10:01.332892 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:10:01.341377 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:10:01.341377 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:10:01.357113 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:10:01.368183 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:10:01.370196 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:10:02.583339 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.211 seconds
[0m02:10:02.590183 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11DAC810>]}
[0m02:10:02.590183 [info ] [Thread-4 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 1.26s]
[0m02:10:02.593910 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:10:02.598540 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:10:02.598540 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:10:02.598540 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:10:02.598540 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:10:02.603370 [info ] [Thread-2 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:10:02.605019 [info ] [Thread-3 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:10:02.607931 [info ] [Thread-5 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:10:02.610836 [info ] [Thread-4 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:10:02.613947 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:10:02.613947 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:10:02.617215 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:10:02.617215 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:10:02.617215 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:10:02.623208 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:10:02.623208 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:10:02.624732 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:10:02.633405 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:10:02.638451 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:10:02.643613 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:10:02.653310 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:10:02.658038 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:10:02.658038 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:10:02.666517 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:10:02.666517 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:10:02.666517 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:10:02.674984 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:10:02.683244 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:10:02.683244 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:10:02.691424 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:10:02.694495 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:10:02.694495 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:10:02.699140 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:10:02.700394 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:10:02.702608 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:10:02.704270 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:10:02.709016 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:10:03.751095 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.050 seconds
[0m02:10:03.751095 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11D1EE50>]}
[0m02:10:03.751095 [info ] [Thread-2 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.14s]
[0m02:10:03.751095 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:10:03.839979 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.131 seconds
[0m02:10:03.839979 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF10EC2390>]}
[0m02:10:03.850708 [info ] [Thread-5 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.22s]
[0m02:10:03.850708 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:10:03.850708 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:10:03.850708 [info ] [Thread-2 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:10:03.850708 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:10:03.861268 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:10:03.862390 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:10:03.873275 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:10:03.884433 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:10:03.884433 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:10:03.884433 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:10:04.123885 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.414 seconds
[0m02:10:04.123885 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.424 seconds
[0m02:10:04.123885 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11E3BF50>]}
[0m02:10:04.139990 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11711F50>]}
[0m02:10:04.139990 [info ] [Thread-4 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.51s]
[0m02:10:04.139990 [info ] [Thread-3 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.53s]
[0m02:10:04.139990 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:10:04.155802 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:10:04.155802 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:10:04.155802 [info ] [Thread-5 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:10:04.155802 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:10:04.155802 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:10:04.172058 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:10:04.172058 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:10:04.172058 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:10:04.172058 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:10:04.172058 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:10:04.840334 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.952 seconds
[0m02:10:04.851674 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11E66FD0>]}
[0m02:10:04.851674 [info ] [Thread-2 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.00s]
[0m02:10:04.851674 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:10:05.452159 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.267 seconds
[0m02:10:05.452159 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37da46d-895a-4caf-a171-9ad301bf0103', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF11EE2D50>]}
[0m02:10:05.452159 [info ] [Thread-5 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.30s]
[0m02:10:05.452159 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:10:05.452159 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:10:05.460706 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:10:05.461229 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:10:06.373806 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:10:06.373806 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:10:07.292447 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:10:07.295497 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:10:08.375492 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m02:10:08.375492 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m02:10:09.530696 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_summary' was left open.
[0m02:10:09.530696 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m02:10:10.435954 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:10:10.437962 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:10:11.449144 [info ] [MainThread]: 
[0m02:10:11.451157 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 19.06 seconds (19.06s).
[0m02:10:11.454925 [debug] [MainThread]: Command end result
[0m02:10:11.516176 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:10:11.524296 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:10:11.528153 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:10:11.538278 [info ] [MainThread]: 
[0m02:10:11.538278 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:10:11.538278 [info ] [MainThread]: 
[0m02:10:11.538278 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:10:11.538278 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:10:11.538278 [debug] [MainThread]: Command `dbt build` succeeded at 02:10:11.538278 after 21.67 seconds
[0m02:10:11.538278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF770D7AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF770D79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF119A3990>]}
[0m02:10:11.545061 [debug] [MainThread]: Flushing usage events
[0m02:10:15.540080 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:10:43.528567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B333BA86D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B333C12950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B333C13990>]}


============================== 02:10:43.528567 | 95879599-661c-4675-9fab-2f9321a43beb ==============================
[0m02:10:43.528567 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:10:43.528567 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_b', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m02:10:44.586637 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:10:44.593377 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:10:44.594232 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:10:44.783588 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:10:44.783588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B344FFC7D0>]}
[0m02:10:45.016545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3423C1B10>]}
[0m02:10:45.095488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B331BCD050>]}
[0m02:10:45.095488 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:10:45.564806 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:10:45.805042 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:10:45.807063 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:10:45.807063 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:10:45.814235 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:10:45.869873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B34554DE90>]}
[0m02:10:46.027460 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:10:46.029478 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:10:46.060062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B345853990>]}
[0m02:10:46.076131 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:10:46.076131 [info ] [MainThread]: 
[0m02:10:46.076131 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:10:46.076131 [info ] [MainThread]: 
[0m02:10:46.076131 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:10:46.091784 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:10:46.170224 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:10:46.170224 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:10:46.170224 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:10:50.096800 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.912 seconds
[0m02:10:50.105425 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:10:50.123958 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:10:50.125277 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:10:50.125975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:10:52.715695 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.591 seconds
[0m02:10:52.747393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3453BB490>]}
[0m02:10:52.750317 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:10:52.750317 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:10:52.750317 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:10:52.750317 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:10:52.757437 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:10:52.757437 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:10:52.757437 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:10:52.757437 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:10:52.757437 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:10:52.757437 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:10:52.757437 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:10:52.757437 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:10:52.757437 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:10:52.757437 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:10:52.757437 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:10:52.757437 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:10:52.772731 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:10:52.778556 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:10:52.778556 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:10:52.778556 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:10:52.778556 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:10:52.778556 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:10:52.788371 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:10:52.788371 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:10:52.814897 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:10:52.820316 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:10:52.823783 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:10:52.830347 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:10:52.830347 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:10:52.830347 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:10:52.830347 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:10:52.830347 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:10:52.836282 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:10:52.836282 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:10:52.838566 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:10:52.838566 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:10:52.838566 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:10:52.840573 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:10:52.840573 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:10:52.840573 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:10:55.223141 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.384 seconds
[0m02:10:55.229318 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.389 seconds
[0m02:10:55.232590 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.393 seconds
[0m02:10:55.352177 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B345E0D450>]}
[0m02:10:55.352177 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B345BA7E50>]}
[0m02:10:55.352177 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B345F23710>]}
[0m02:10:55.352177 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.59s]
[0m02:10:55.352177 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.59s]
[0m02:10:55.352177 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.59s]
[0m02:10:55.352177 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:10:55.352177 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:10:55.352177 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:10:55.525500 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.687 seconds
[0m02:10:55.529890 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B345F47310>]}
[0m02:10:55.529890 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 2.77s]
[0m02:10:55.529890 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:10:55.541600 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:10:55.541600 [info ] [Thread-5 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:10:55.541600 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:10:55.541600 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:10:55.552724 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:10:55.552724 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:10:55.556735 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:10:55.558739 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:10:55.558739 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:10:56.655097 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.096 seconds
[0m02:10:56.659703 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B345381250>]}
[0m02:10:56.659703 [info ] [Thread-5 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 1.12s]
[0m02:10:56.661719 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:10:56.663163 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:10:56.663163 [info ] [Thread-2 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:10:56.663163 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:10:56.665673 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:10:56.669688 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:10:56.671196 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:10:56.672124 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:10:56.672124 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:10:56.687299 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:10:57.546880 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.861 seconds
[0m02:10:57.546880 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3323E7850>]}
[0m02:10:57.546880 [info ] [Thread-2 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 0.88s]
[0m02:10:57.562289 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:10:57.564298 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:10:57.564298 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:10:57.564298 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:10:57.564298 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:10:57.564298 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:10:57.564298 [info ] [Thread-5 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:10:57.564298 [info ] [Thread-4 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:10:57.564298 [info ] [Thread-2 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:10:57.564298 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:10:57.564298 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:10:57.564298 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:10:57.564298 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:10:57.564298 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:10:57.578207 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:10:57.578207 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:10:57.578207 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:10:57.578207 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:10:57.590933 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:10:57.594008 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:10:57.601773 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:10:57.601773 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:10:57.601773 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:10:57.601773 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:10:57.609762 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:10:57.609762 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:10:57.614366 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:10:57.625703 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:10:57.629693 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:10:57.629693 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:10:57.629693 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:10:57.629693 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:10:57.636992 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:10:57.636992 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:10:57.636992 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:10:57.636992 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:10:57.636992 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:10:58.494548 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.854 seconds
[0m02:10:58.500461 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B345F4DF90>]}
[0m02:10:58.504957 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 0.94s]
[0m02:10:58.507922 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:10:58.541659 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.897 seconds
[0m02:10:58.543694 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.901 seconds
[0m02:10:58.548866 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B345F21750>]}
[0m02:10:58.548866 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B333BD3050>]}
[0m02:10:58.548866 [info ] [Thread-2 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 0.98s]
[0m02:10:58.548866 [info ] [Thread-4 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 0.98s]
[0m02:10:58.548866 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:10:58.561697 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:10:58.561697 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:10:58.561697 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:10:58.561697 [info ] [Thread-3 (]: 11 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:10:58.561697 [info ] [Thread-2 (]: 12 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:10:58.568119 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:10:58.568119 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:10:58.568119 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:10:58.571549 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:10:58.582493 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:10:58.590520 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:10:58.593709 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:10:58.594775 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:10:58.608379 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:10:58.620540 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:10:58.621233 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:10:58.621233 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:10:58.626560 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:10:58.628263 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.987 seconds
[0m02:10:58.632091 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:10:58.636379 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B345DC9B50>]}
[0m02:10:58.639293 [info ] [Thread-5 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.07s]
[0m02:10:58.644015 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:10:59.831905 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.204 seconds
[0m02:10:59.831905 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.197 seconds
[0m02:10:59.841050 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B3460907D0>]}
[0m02:10:59.848770 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95879599-661c-4675-9fab-2f9321a43beb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B345EDBC50>]}
[0m02:10:59.848770 [info ] [Thread-3 (]: 11 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.27s]
[0m02:10:59.854561 [info ] [Thread-2 (]: 12 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.28s]
[0m02:10:59.859034 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:10:59.859034 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:10:59.859034 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:10:59.859034 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:10:59.859034 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:11:00.577697 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:11:00.577697 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:11:01.829457 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:11:01.829457 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:11:03.056591 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:11:03.056591 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:11:03.982714 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_execution_analysis' was left open.
[0m02:11:03.982714 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: Close
[0m02:11:05.107586 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m02:11:05.110674 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m02:11:06.335432 [info ] [MainThread]: 
[0m02:11:06.338534 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 20.26 seconds (20.26s).
[0m02:11:06.348618 [debug] [MainThread]: Command end result
[0m02:11:06.615629 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:11:06.625696 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:11:06.658202 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:11:06.661066 [info ] [MainThread]: 
[0m02:11:06.665276 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:11:06.668707 [info ] [MainThread]: 
[0m02:11:06.668707 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:11:06.674349 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:11:06.674349 [debug] [MainThread]: Command `dbt build` succeeded at 02:11:06.674349 after 23.30 seconds
[0m02:11:06.682702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B32BFC7AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B32BFC79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B332977A50>]}
[0m02:11:06.685892 [debug] [MainThread]: Flushing usage events
[0m02:11:09.813612 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:11:30.181680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAC361E190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAC361F190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAC361F690>]}


============================== 02:11:30.189407 | ba8e4112-4e6f-498c-bf0e-ba7ab3a449be ==============================
[0m02:11:30.189407 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:11:30.189407 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_b', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m02:11:30.946888 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:11:30.946888 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:11:30.946888 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:11:31.058888 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:11:31.060720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD5A3CAD0>]}
[0m02:11:31.227675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD59D4490>]}
[0m02:11:31.303673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAC260D110>]}
[0m02:11:31.315489 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:11:31.716336 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:11:31.949548 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:11:31.952136 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:11:31.952136 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:11:31.959405 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:11:32.037048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD5F89510>]}
[0m02:11:32.216524 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:11:32.221430 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:11:32.274673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD6291010>]}
[0m02:11:32.276687 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:11:32.282752 [info ] [MainThread]: 
[0m02:11:32.282752 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:11:32.282752 [info ] [MainThread]: 
[0m02:11:32.282752 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:11:32.288648 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:11:32.368090 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:11:32.368090 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:11:32.368090 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:11:35.821551 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.457 seconds
[0m02:11:35.837403 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:11:35.853276 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:11:35.853276 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:11:35.853276 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:11:38.693253 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.828 seconds
[0m02:11:38.715147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD595E850>]}
[0m02:11:38.717153 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:11:38.723127 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:11:38.723632 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:11:38.717153 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:11:38.724477 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:11:38.724477 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:11:38.727290 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:11:38.727290 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:11:38.729311 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:11:38.729311 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:11:38.731316 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:11:38.731316 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:11:38.733319 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:11:38.733319 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:11:38.735324 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:11:38.735324 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:11:38.748132 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:11:38.752294 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:11:38.759229 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:11:38.766410 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:11:38.770239 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:11:38.771709 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:11:38.771709 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:11:38.804145 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:11:38.811270 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:11:38.816302 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:11:38.817941 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:11:38.825823 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:11:38.827422 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:11:38.828975 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:11:38.830318 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:11:38.830318 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:11:38.833994 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:11:38.833994 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:11:38.833994 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:11:38.836010 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:11:38.836935 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:11:38.836935 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:11:38.836935 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:11:38.836935 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:11:40.967800 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.129 seconds
[0m02:11:41.105279 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD698B710>]}
[0m02:11:41.105279 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.37s]
[0m02:11:41.105279 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:11:41.517954 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.678 seconds
[0m02:11:41.520808 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.686 seconds
[0m02:11:41.529566 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD6980A90>]}
[0m02:11:41.538007 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD5AC08D0>]}
[0m02:11:41.541570 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.80s]
[0m02:11:41.544351 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.81s]
[0m02:11:41.545608 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:11:41.546653 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:11:42.117294 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.278 seconds
[0m02:11:42.117294 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD684FA90>]}
[0m02:11:42.117294 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 3.39s]
[0m02:11:42.117294 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:11:42.126561 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:11:42.127597 [info ] [Thread-3 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:11:42.127597 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:11:42.127597 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:11:42.137054 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:11:42.138797 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:11:42.138797 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:11:42.138797 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:11:42.138797 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:11:42.939170 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.793 seconds
[0m02:11:42.939170 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD6291290>]}
[0m02:11:42.939170 [info ] [Thread-3 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.81s]
[0m02:11:42.939170 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:11:42.939170 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:11:42.950088 [info ] [Thread-2 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:11:42.952102 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:11:42.952102 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:11:42.956817 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:11:42.956817 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:11:42.965180 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:11:42.970499 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:11:42.973901 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:11:43.774097 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.799 seconds
[0m02:11:43.778882 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD684FED0>]}
[0m02:11:43.779936 [info ] [Thread-2 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 0.83s]
[0m02:11:43.781520 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:11:43.782571 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:11:43.783622 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:11:43.784669 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:11:43.785186 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:11:43.786764 [info ] [Thread-5 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:11:43.787804 [info ] [Thread-3 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:11:43.788514 [info ] [Thread-4 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:11:43.789565 [info ] [Thread-2 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:11:43.790689 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:11:43.791263 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:11:43.792411 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:11:43.793459 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:11:43.794508 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:11:43.795067 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:11:43.795680 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:11:43.796707 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:11:43.800708 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:11:43.803498 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:11:43.803498 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:11:43.813667 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:11:43.813667 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:11:43.813667 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:11:43.819196 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:11:43.819196 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:11:43.819196 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:11:43.819196 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:11:43.828971 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:11:43.836476 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:11:43.837766 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:11:43.842581 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:11:43.842919 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:11:43.845638 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:11:43.845638 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:11:43.848020 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:11:43.850230 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:11:43.850230 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:11:44.907624 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.054 seconds
[0m02:11:44.909638 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.058 seconds
[0m02:11:44.909638 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.052 seconds
[0m02:11:44.913659 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD5AD1F10>]}
[0m02:11:44.913659 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD62F6FD0>]}
[0m02:11:44.919654 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD5D95CD0>]}
[0m02:11:44.919654 [info ] [Thread-3 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.12s]
[0m02:11:44.922794 [info ] [Thread-5 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.12s]
[0m02:11:44.923532 [info ] [Thread-2 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.13s]
[0m02:11:44.925359 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:11:44.925866 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:11:44.925866 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:11:44.927894 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:11:44.927894 [info ] [Thread-3 (]: 11 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:11:44.927894 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_security_performance, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:11:44.927894 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:11:44.927894 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:11:44.937888 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:11:44.942593 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:11:44.942593 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:11:44.944621 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:11:45.181963 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.328 seconds
[0m02:11:45.181963 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD6966F90>]}
[0m02:11:45.190030 [info ] [Thread-4 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.39s]
[0m02:11:45.190030 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:11:45.192803 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:11:45.192803 [info ] [Thread-2 (]: 12 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:11:45.192803 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:11:45.192803 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:11:45.198124 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:11:45.204028 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:11:45.206832 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:11:45.211214 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:11:45.211214 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:11:45.804781 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.860 seconds
[0m02:11:45.805855 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD6A28AD0>]}
[0m02:11:45.805855 [info ] [Thread-3 (]: 11 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 0.88s]
[0m02:11:45.805855 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:11:46.417382 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.205 seconds
[0m02:11:46.427134 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba8e4112-4e6f-498c-bf0e-ba7ab3a449be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAD5AD3490>]}
[0m02:11:46.427134 [info ] [Thread-2 (]: 12 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.23s]
[0m02:11:46.427134 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:11:46.431389 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:11:46.437137 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:11:46.438581 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:11:47.121663 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:11:47.122814 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:11:48.040634 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:11:48.041705 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:11:49.344389 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_execution_analysis' was left open.
[0m02:11:49.346416 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: Close
[0m02:11:50.302277 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_trades' was left open.
[0m02:11:50.305287 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_trades: Close
[0m02:11:51.190244 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:11:51.193595 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:11:52.415999 [info ] [MainThread]: 
[0m02:11:52.418995 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 20.13 seconds (20.13s).
[0m02:11:52.426794 [debug] [MainThread]: Command end result
[0m02:11:52.621690 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:11:52.633208 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:11:52.653647 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:11:52.654697 [info ] [MainThread]: 
[0m02:11:52.656347 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:11:52.656881 [info ] [MainThread]: 
[0m02:11:52.657968 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:11:52.659845 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:11:52.664274 [debug] [MainThread]: Command `dbt build` succeeded at 02:11:52.663746 after 22.57 seconds
[0m02:11:52.665357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAC368CAD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAC368F990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CAC368C790>]}
[0m02:11:52.666384 [debug] [MainThread]: Flushing usage events
[0m02:11:55.515308 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:12:27.174061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029EEE88C390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029EEE88E810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029EEE88E410>]}


============================== 02:12:27.180590 | 541218da-cc8f-4b62-9ac4-8822f8401e48 ==============================
[0m02:12:27.180590 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:12:27.181588 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m02:12:27.987513 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:12:27.989530 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:12:27.991515 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:12:28.182941 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:12:28.183923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '541218da-cc8f-4b62-9ac4-8822f8401e48', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029EFFC74590>]}
[0m02:12:28.501564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '541218da-cc8f-4b62-9ac4-8822f8401e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029EFD7AE750>]}
[0m02:12:28.590568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '541218da-cc8f-4b62-9ac4-8822f8401e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029EEC8AD110>]}
[0m02:12:28.592577 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:12:29.309719 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:12:29.554898 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:12:29.554898 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:12:29.555895 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:12:29.564512 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:12:29.607933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '541218da-cc8f-4b62-9ac4-8822f8401e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029E801D4610>]}
[0m02:12:29.741770 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:12:29.745963 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:12:29.869918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '541218da-cc8f-4b62-9ac4-8822f8401e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029E80570650>]}
[0m02:12:29.875261 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:12:29.889299 [info ] [MainThread]: 
[0m02:12:29.890300 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:12:29.891301 [info ] [MainThread]: 
[0m02:12:29.894299 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:12:29.898993 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:12:30.002860 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:12:30.003859 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:12:30.004859 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:12:33.837720 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.833 seconds
[0m02:12:33.844957 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:12:33.860914 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:12:33.861914 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:12:33.862944 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:12:36.343173 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.480 seconds
[0m02:12:36.364829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '541218da-cc8f-4b62-9ac4-8822f8401e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029EEE8BBD90>]}
[0m02:12:36.371453 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:12:36.372453 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:12:36.373639 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:12:36.374646 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:12:36.375649 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:12:36.376653 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:12:36.377165 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:12:36.378165 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:12:36.389627 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:12:36.406657 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:12:36.401142 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:12:36.476700 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:12:36.478707 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:12:36.479710 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:12:36.490224 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:12:36.495224 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:12:36.496729 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:12:36.498849 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:12:36.499848 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:12:36.500848 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:12:39.253214 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.756 seconds
[0m02:12:39.287675 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '541218da-cc8f-4b62-9ac4-8822f8401e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029E80ABB3D0>]}
[0m02:12:39.289666 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 2.91s]
[0m02:12:39.289666 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:12:39.291664 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:12:39.293675 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:12:39.297172 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m02:12:39.298180 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:12:39.307719 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:12:39.309724 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:12:39.319394 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:12:39.323515 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:12:39.325411 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:12:39.328945 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:12:40.440504 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.939 seconds
[0m02:12:40.452952 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '541218da-cc8f-4b62-9ac4-8822f8401e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029E80AE23D0>]}
[0m02:12:40.455948 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 4.08s]
[0m02:12:40.460627 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:12:40.463624 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:12:40.466627 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:12:40.469305 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m02:12:40.470316 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:12:40.485079 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:12:40.488613 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:12:40.668991 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:12:40.693627 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:12:40.696624 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:12:42.149805 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.451 seconds
[0m02:12:42.152310 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '541218da-cc8f-4b62-9ac4-8822f8401e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029E80CC3950>]}
[0m02:12:42.153316 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.68s]
[0m02:12:42.154316 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:12:42.740132 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.412 seconds
[0m02:12:42.746651 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '541218da-cc8f-4b62-9ac4-8822f8401e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029E80CF0910>]}
[0m02:12:42.748669 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 3.45s]
[0m02:12:42.749667 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:12:42.751658 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:12:42.752884 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:12:42.754130 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:12:43.822391 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:12:43.823386 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:12:44.984849 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:12:44.986860 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:12:46.486022 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m02:12:46.488233 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m02:12:47.715024 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:12:47.715785 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:12:48.946934 [info ] [MainThread]: 
[0m02:12:48.948043 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 19.05 seconds (19.05s).
[0m02:12:48.950065 [debug] [MainThread]: Command end result
[0m02:12:49.024193 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:12:49.028822 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:12:49.037847 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:12:49.039340 [info ] [MainThread]: 
[0m02:12:49.040348 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:12:49.040987 [info ] [MainThread]: 
[0m02:12:49.041993 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:12:49.042994 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:12:49.045016 [debug] [MainThread]: Command `dbt build` succeeded at 02:12:49.045016 after 21.97 seconds
[0m02:12:49.047530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029EE6D07950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029EE6D079D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029EE6D07AD0>]}
[0m02:12:49.048537 [debug] [MainThread]: Flushing usage events
[0m02:12:53.544982 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:13:35.852500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270A164C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270A164FF50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270A164E090>]}


============================== 02:13:35.858748 | 9cbe356b-8d7b-4d00-9c78-1e864cbed95e ==============================
[0m02:13:35.858748 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:13:35.860357 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --select tag:pipeline_b', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m02:13:36.560998 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:13:36.561995 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:13:36.562996 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:13:36.696511 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:13:36.698527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B3A046D0>]}
[0m02:13:36.880123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B153CAD0>]}
[0m02:13:36.949869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B3AA9AD0>]}
[0m02:13:36.951861 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:13:37.319794 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:13:37.545066 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:13:37.545066 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:13:37.546574 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:13:37.553583 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:13:37.607623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B3E30050>]}
[0m02:13:37.742676 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:13:37.746586 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:13:37.784958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B42F11D0>]}
[0m02:13:37.786462 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:13:37.791582 [info ] [MainThread]: 
[0m02:13:37.792475 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:13:37.792475 [info ] [MainThread]: 
[0m02:13:37.793573 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:13:37.799948 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:13:37.869608 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:13:37.870608 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:13:37.870608 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:13:41.830650 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.959 seconds
[0m02:13:41.841863 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:13:41.854386 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:13:41.855387 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:13:41.855387 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:13:44.749984 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.894 seconds
[0m02:13:44.771089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B3DC6450>]}
[0m02:13:44.776062 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:13:44.776579 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:13:44.777113 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:13:44.778163 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:13:44.778690 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:13:44.779745 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:13:44.780274 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:13:44.781341 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:13:44.781898 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:13:44.782990 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:13:44.783529 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:13:44.784065 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:13:44.784639 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:13:44.785201 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:13:44.785729 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:13:44.786754 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:13:44.797699 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:13:44.801699 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:13:44.804725 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:13:44.808830 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:13:44.810808 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:13:44.810808 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:13:44.811808 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:13:44.850505 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:13:44.863943 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:13:44.874476 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:13:44.882021 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:13:44.891026 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:13:44.895025 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:13:44.896540 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:13:44.899551 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:13:44.901552 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:13:44.905043 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:13:44.908569 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:13:44.910717 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:13:44.912722 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:13:44.913346 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:13:44.915831 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:13:44.917337 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:13:44.919799 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:13:47.381278 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.464 seconds
[0m02:13:47.486852 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.576 seconds
[0m02:13:47.492253 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270A0EC03D0>]}
[0m02:13:47.492253 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B4A25150>]}
[0m02:13:47.494250 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 2.70s]
[0m02:13:47.495252 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.71s]
[0m02:13:47.497834 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:13:47.498817 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:13:47.662034 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.742 seconds
[0m02:13:47.663034 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.747 seconds
[0m02:13:47.665029 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B42EDC50>]}
[0m02:13:47.667719 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B4A25010>]}
[0m02:13:47.668743 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.88s]
[0m02:13:47.669721 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.89s]
[0m02:13:47.670719 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:13:47.671368 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:13:47.672359 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:13:47.673088 [info ] [Thread-4 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:13:47.674110 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:13:47.674110 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:13:47.679560 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:13:47.680560 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:13:47.684576 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:13:47.686566 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:13:47.687101 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:13:48.896858 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.209 seconds
[0m02:13:48.904498 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B3F5B450>]}
[0m02:13:48.906008 [info ] [Thread-4 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 1.23s]
[0m02:13:48.908366 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:13:48.910361 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:13:48.912359 [info ] [Thread-5 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:13:48.914358 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:13:48.915357 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:13:48.919887 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:13:48.920887 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:13:48.925890 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:13:48.929399 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:13:48.929399 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:13:49.910126 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.979 seconds
[0m02:13:49.913454 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270A164D450>]}
[0m02:13:49.914455 [info ] [Thread-5 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 1.00s]
[0m02:13:49.915456 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:13:49.916961 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:13:49.917965 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:13:49.917965 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:13:49.918987 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:13:49.918987 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:13:49.919997 [info ] [Thread-4 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:13:49.920966 [info ] [Thread-2 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:13:49.920966 [info ] [Thread-5 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:13:49.921965 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:13:49.922990 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:13:49.923968 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:13:49.923968 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:13:49.925052 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:13:49.925052 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:13:49.926558 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:13:49.926558 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:13:49.931580 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:13:49.934563 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:13:49.939080 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:13:49.944097 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:13:49.946606 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:13:49.947662 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:13:49.948644 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:13:49.954890 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:13:49.954890 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:13:49.961070 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:13:49.965088 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:13:49.969616 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:13:49.970601 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:13:49.973021 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:13:49.975047 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:13:49.975047 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:13:49.977042 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:13:49.977042 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:13:49.978049 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:13:49.982046 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:13:51.056739 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.068 seconds
[0m02:13:51.058752 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.079 seconds
[0m02:13:51.060755 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.078 seconds
[0m02:13:51.061758 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.078 seconds
[0m02:13:51.065764 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270A164E590>]}
[0m02:13:51.069277 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B4840D90>]}
[0m02:13:51.071627 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B3984B10>]}
[0m02:13:51.075638 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B3AD3450>]}
[0m02:13:51.076638 [info ] [Thread-5 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.14s]
[0m02:13:51.077209 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.15s]
[0m02:13:51.078210 [info ] [Thread-4 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.15s]
[0m02:13:51.079215 [info ] [Thread-2 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.15s]
[0m02:13:51.080217 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:13:51.081230 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:13:51.082224 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:13:51.083222 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:13:51.084223 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:13:51.085217 [info ] [Thread-5 (]: 11 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:13:51.086455 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:13:51.087462 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:13:51.088463 [info ] [Thread-3 (]: 12 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:13:51.088463 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:13:51.089561 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:13:51.094464 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:13:51.094464 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:13:51.098711 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:13:51.099634 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:13:51.104719 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:13:51.104719 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:13:51.110229 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:13:51.111229 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:13:51.112228 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:13:51.113733 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:13:51.115741 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:13:52.165365 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.049 seconds
[0m02:13:52.172702 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002709E181750>]}
[0m02:13:52.174614 [info ] [Thread-3 (]: 12 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.08s]
[0m02:13:52.175614 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:13:52.213238 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.099 seconds
[0m02:13:52.218755 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cbe356b-8d7b-4d00-9c78-1e864cbed95e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B4AE3A90>]}
[0m02:13:52.220764 [info ] [Thread-5 (]: 11 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.13s]
[0m02:13:52.221771 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:13:52.223761 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:13:52.224760 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:13:52.224760 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:13:53.177296 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:13:53.178357 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:13:54.114993 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_execution_analysis' was left open.
[0m02:13:54.116683 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: Close
[0m02:13:55.073895 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:13:55.075002 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:13:56.228330 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m02:13:56.230914 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m02:13:57.063238 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:13:57.065239 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:13:58.079103 [info ] [MainThread]: 
[0m02:13:58.080155 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 20.29 seconds (20.29s).
[0m02:13:58.084156 [debug] [MainThread]: Command end result
[0m02:13:58.142529 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:13:58.145532 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:13:58.153049 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:13:58.153049 [info ] [MainThread]: 
[0m02:13:58.154049 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:13:58.155049 [info ] [MainThread]: 
[0m02:13:58.155049 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:13:58.156053 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:13:58.157051 [debug] [MainThread]: Command `dbt build` succeeded at 02:13:58.157051 after 22.41 seconds
[0m02:13:58.158199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000270B4AD4110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002709AA779D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002709AA77950>]}
[0m02:13:58.158199 [debug] [MainThread]: Flushing usage events
[0m02:14:00.961517 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:14:30.792884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DA89FC790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DA89FD4D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DA89FC350>]}


============================== 02:14:30.797827 | 8deee8e4-c059-4d6f-b230-6de40a11f076 ==============================
[0m02:14:30.797827 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:14:30.798823 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_b', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m02:14:32.017642 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:14:32.018719 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:14:32.020272 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:14:32.189234 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:14:32.190232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DB9DE4A90>]}
[0m02:14:32.355535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DB9E4C490>]}
[0m02:14:32.422234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DA6A0D010>]}
[0m02:14:32.424150 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:14:32.809897 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:14:33.148999 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:14:33.150017 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:14:33.151019 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:14:33.160529 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:14:33.226738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBA207750>]}
[0m02:14:33.434234 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:14:33.440800 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:14:33.498177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBA6D0250>]}
[0m02:14:33.500178 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:14:33.507772 [info ] [MainThread]: 
[0m02:14:33.508760 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:14:33.509760 [info ] [MainThread]: 
[0m02:14:33.510762 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:14:33.520276 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:14:33.627613 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:14:33.628596 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:14:33.630787 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:14:37.329156 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.699 seconds
[0m02:14:37.340639 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:14:37.355551 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:14:37.356454 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:14:37.357981 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:14:39.630632 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.273 seconds
[0m02:14:39.657217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DB9F0C150>]}
[0m02:14:39.664634 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:14:39.664634 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:14:39.665633 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:14:39.666635 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:14:39.667144 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:14:39.668147 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:14:39.670198 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:14:39.671214 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:14:39.672383 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:14:39.673388 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:14:39.674405 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:14:39.675390 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:14:39.675390 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:14:39.676967 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:14:39.677980 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:14:39.678977 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:14:39.690238 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:14:39.695236 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:14:39.698865 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:14:39.703765 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:14:39.705900 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:14:39.707416 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:14:39.707720 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:14:39.751370 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:14:39.764513 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:14:39.773171 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:14:39.778753 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:14:39.788643 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:14:39.792661 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:14:39.796666 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:14:39.797764 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:14:39.798797 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:14:39.799786 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:14:39.801771 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:14:39.803773 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:14:39.805773 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:14:39.806771 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:14:39.807910 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:14:39.808929 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:14:39.810262 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:14:42.261849 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.456 seconds
[0m02:14:42.357098 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.548 seconds
[0m02:14:42.361111 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBAE47A50>]}
[0m02:14:42.370879 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBA9AB210>]}
[0m02:14:42.373888 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.67s]
[0m02:14:42.377386 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 2.70s]
[0m02:14:42.380801 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:14:42.384776 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:14:42.557933 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.750 seconds
[0m02:14:42.568160 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBAD3C350>]}
[0m02:14:42.571157 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.89s]
[0m02:14:42.574251 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:14:42.855613 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.045 seconds
[0m02:14:42.866696 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBAA151D0>]}
[0m02:14:42.868855 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 3.19s]
[0m02:14:42.872881 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:14:42.875870 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:14:42.879452 [info ] [Thread-2 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:14:42.881922 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:14:42.885954 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:14:42.900767 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:14:42.902765 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:14:42.920165 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:14:42.924991 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:14:42.929521 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:14:43.837147 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.905 seconds
[0m02:14:43.851246 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBAD46750>]}
[0m02:14:43.855235 [info ] [Thread-2 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.97s]
[0m02:14:43.860311 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:14:43.864335 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:14:43.867856 [info ] [Thread-3 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:14:43.871855 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:14:43.874864 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:14:43.894156 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:14:43.898716 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:14:43.920437 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:14:43.932988 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:14:43.936507 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:14:44.989070 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.050 seconds
[0m02:14:44.995268 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBAC48510>]}
[0m02:14:44.999830 [info ] [Thread-3 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 1.12s]
[0m02:14:45.002816 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:14:45.008344 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:14:45.010342 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:14:45.011342 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:14:45.012525 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:14:45.014794 [info ] [Thread-4 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:14:45.017289 [info ] [Thread-2 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:14:45.019304 [info ] [Thread-5 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:14:45.023304 [info ] [Thread-3 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:14:45.025302 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:14:45.028865 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:14:45.033842 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:14:45.038368 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:14:45.041375 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:14:45.044375 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:14:45.047903 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:14:45.050414 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:14:45.067332 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:14:45.079119 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:14:45.104425 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:14:45.121300 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:14:45.125300 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:14:45.128829 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:14:45.131830 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:14:45.152465 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:14:45.155463 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:14:45.175865 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:14:45.194541 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:14:45.210915 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:14:45.213931 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:14:45.223213 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:14:45.231839 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:14:45.233843 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:14:45.241207 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:14:45.249566 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:14:45.253973 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:14:45.258517 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:14:46.234762 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.971 seconds
[0m02:14:46.246532 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBAC5FA50>]}
[0m02:14:46.249632 [info ] [Thread-5 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.21s]
[0m02:14:46.253628 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:14:46.256608 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:14:46.258882 [info ] [Thread-5 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:14:46.261884 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:14:46.264838 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:14:46.276902 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:14:46.281915 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:14:46.298675 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:14:46.305608 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:14:46.307759 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:14:46.342372 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.081 seconds
[0m02:14:46.352397 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBAECD450>]}
[0m02:14:46.355317 [info ] [Thread-2 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.32s]
[0m02:14:46.359022 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:14:46.435090 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.169 seconds
[0m02:14:46.446635 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBA703390>]}
[0m02:14:46.450699 [info ] [Thread-3 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.41s]
[0m02:14:46.453601 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:14:46.457674 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:14:46.460672 [info ] [Thread-2 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:14:46.463685 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_security_performance, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:14:46.465670 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:14:46.485827 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:14:46.490030 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:14:46.504673 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:14:46.510318 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:14:46.513308 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:14:46.731872 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.476 seconds
[0m02:14:46.740393 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBA6F7890>]}
[0m02:14:46.743395 [info ] [Thread-4 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.71s]
[0m02:14:46.745392 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:14:47.154567 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.843 seconds
[0m02:14:47.165856 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBAECCE50>]}
[0m02:14:47.169333 [info ] [Thread-5 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 0.90s]
[0m02:14:47.173247 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:14:47.388916 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.874 seconds
[0m02:14:47.398804 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8deee8e4-c059-4d6f-b230-6de40a11f076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DBAECDAD0>]}
[0m02:14:47.402082 [info ] [Thread-2 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 0.94s]
[0m02:14:47.405096 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:14:47.411619 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:14:47.412620 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:14:47.414619 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:14:48.545139 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:14:48.547676 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:14:49.603588 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:14:49.606591 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:14:51.165224 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_summary' was left open.
[0m02:14:51.167744 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m02:14:52.208295 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_trades' was left open.
[0m02:14:52.239072 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_trades: Close
[0m02:14:53.282262 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:14:53.285261 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:14:54.210865 [info ] [MainThread]: 
[0m02:14:54.212990 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 20.70 seconds (20.70s).
[0m02:14:54.224943 [debug] [MainThread]: Command end result
[0m02:14:54.454623 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:14:54.465303 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:14:54.495234 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:14:54.497804 [info ] [MainThread]: 
[0m02:14:54.500987 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:14:54.504507 [info ] [MainThread]: 
[0m02:14:54.507030 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:14:54.510168 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:14:54.515586 [debug] [MainThread]: Command `dbt build` succeeded at 02:14:54.514164 after 23.85 seconds
[0m02:14:54.517645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DA0DD7950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DA0DD79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025DB7AF4810>]}
[0m02:14:54.520663 [debug] [MainThread]: Flushing usage events
[0m02:14:59.580002 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:25:02.437354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231811FCB90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231811FF850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231811FFC90>]}


============================== 02:25:02.446210 | a369eb74-caaa-4525-a345-27d60b6be3bf ==============================
[0m02:25:02.446210 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:25:02.448211 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m02:25:03.675790 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:25:03.675790 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:25:03.678985 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:25:03.835351 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:25:03.835351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a369eb74-caaa-4525-a345-27d60b6be3bf', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231925C7E90>]}
[0m02:25:04.073690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a369eb74-caaa-4525-a345-27d60b6be3bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002318122C490>]}
[0m02:25:04.187653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a369eb74-caaa-4525-a345-27d60b6be3bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231FF17D090>]}
[0m02:25:04.190379 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:25:04.774273 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:25:05.274586 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 7 files changed.
[0m02:25:05.274586 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://models\pipeline_b\intermediate\int_trade_metrics.sql
[0m02:25:05.274586 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://models\pipeline_c\intermediate\int_sector_allocation.sql
[0m02:25:05.274586 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://models\pipeline_b\intermediate\int_trade_execution_analysis.sql
[0m02:25:05.274586 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://models\pipeline_c\intermediate\int_portfolio_returns.sql
[0m02:25:05.274586 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://models\pipeline_a\intermediate\int_cashflow_aggregated.sql
[0m02:25:05.274586 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://models\pipeline_a\staging\stg_cashflows.sql
[0m02:25:05.274586 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://models\pipeline_c\intermediate\int_position_returns.sql
[0m02:25:05.747975 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:25:05.767946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a369eb74-caaa-4525-a345-27d60b6be3bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023192E1E550>]}
[0m02:25:05.963293 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:25:05.974581 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:25:06.077316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a369eb74-caaa-4525-a345-27d60b6be3bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023192E41610>]}
[0m02:25:06.077316 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:25:06.091534 [info ] [MainThread]: 
[0m02:25:06.091534 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:25:06.091534 [info ] [MainThread]: 
[0m02:25:06.095886 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:25:06.095886 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:25:06.436477 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:25:06.438065 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:25:06.439698 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:25:10.384157 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.945 seconds
[0m02:25:10.399284 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:25:10.436480 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:25:10.436480 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:25:10.436480 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:25:12.995158 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.557 seconds
[0m02:25:13.024981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a369eb74-caaa-4525-a345-27d60b6be3bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023192FA0390>]}
[0m02:25:13.032144 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:25:13.036010 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:25:13.036010 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:25:13.036010 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:25:13.036010 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:25:13.036010 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:25:13.036010 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:25:13.036010 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:25:13.052499 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:25:13.058571 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:25:13.063525 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:25:13.064642 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:25:13.115888 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:25:13.115888 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:25:13.126187 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:25:13.128195 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:25:13.130201 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:25:13.130201 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:25:13.133003 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:25:13.134239 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:25:16.727393 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.595 seconds
[0m02:25:16.786891 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a369eb74-caaa-4525-a345-27d60b6be3bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023194522D90>]}
[0m02:25:16.786891 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.75s]
[0m02:25:16.788640 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:25:16.790648 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:25:16.790648 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:25:16.795922 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m02:25:16.797120 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:25:16.805458 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:25:16.805458 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:25:16.813900 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:25:16.813900 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:25:16.821646 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:25:16.821646 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:25:16.984374 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.852 seconds
[0m02:25:16.992862 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a369eb74-caaa-4525-a345-27d60b6be3bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002319347D450>]}
[0m02:25:16.994878 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.95s]
[0m02:25:16.996892 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:25:16.996892 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:25:16.996892 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:25:17.004490 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m02:25:17.004490 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:25:17.014539 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:25:17.014539 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:25:17.037552 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:25:17.044112 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:25:17.046127 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:25:18.465238 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.416 seconds
[0m02:25:18.468853 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a369eb74-caaa-4525-a345-27d60b6be3bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002319268AE90>]}
[0m02:25:18.468853 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.46s]
[0m02:25:18.472479 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:25:20.420652 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.601 seconds
[0m02:25:20.434009 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a369eb74-caaa-4525-a345-27d60b6be3bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002319459C650>]}
[0m02:25:20.436659 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.64s]
[0m02:25:20.437755 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:25:20.437755 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:25:20.437755 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:25:20.446464 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:25:21.805219 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:25:21.805219 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:25:22.846004 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m02:25:22.846004 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m02:25:23.775740 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:25:23.779224 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:25:24.976899 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:25:24.976899 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:25:26.925591 [info ] [MainThread]: 
[0m02:25:26.927606 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 20.83 seconds (20.83s).
[0m02:25:26.932933 [debug] [MainThread]: Command end result
[0m02:25:27.030107 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:25:27.030107 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:25:27.053746 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:25:27.055753 [info ] [MainThread]: 
[0m02:25:27.055753 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:25:27.058096 [info ] [MainThread]: 
[0m02:25:27.058096 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:25:27.058096 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:25:27.058096 [debug] [MainThread]: Command `dbt build` succeeded at 02:25:27.058096 after 24.75 seconds
[0m02:25:27.064203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002318126C4D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F9587950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F95879D0>]}
[0m02:25:27.064203 [debug] [MainThread]: Flushing usage events
[0m02:25:30.506373 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:25:59.579569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262A679D050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262A679FA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262A679FF50>]}


============================== 02:25:59.590691 | dcaec555-5bb2-452c-b1cb-563922c5131e ==============================
[0m02:25:59.590691 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:25:59.590691 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m02:26:00.823796 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:26:00.826068 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:26:00.826068 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:26:01.050847 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:26:01.050847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'dcaec555-5bb2-452c-b1cb-563922c5131e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262A6844B90>]}
[0m02:26:01.329543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dcaec555-5bb2-452c-b1cb-563922c5131e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262B7C70650>]}
[0m02:26:01.443709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dcaec555-5bb2-452c-b1cb-563922c5131e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262A47AD090>]}
[0m02:26:01.446751 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:26:02.068400 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:26:02.502307 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:26:02.502307 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:26:02.507376 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:26:02.515634 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:26:02.620420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dcaec555-5bb2-452c-b1cb-563922c5131e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262B8167810>]}
[0m02:26:02.862157 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:26:02.871960 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:26:02.939299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dcaec555-5bb2-452c-b1cb-563922c5131e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262B84736D0>]}
[0m02:26:02.939299 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:26:02.949766 [info ] [MainThread]: 
[0m02:26:02.951631 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:26:02.951631 [info ] [MainThread]: 
[0m02:26:02.951631 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:26:02.963492 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:26:03.084968 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:26:03.084968 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:26:03.084968 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:26:07.449565 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 4.361 seconds
[0m02:26:07.476579 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:26:07.513152 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:26:07.517224 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:26:07.518487 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:26:10.034890 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.515 seconds
[0m02:26:10.060269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcaec555-5bb2-452c-b1cb-563922c5131e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262B7CBD810>]}
[0m02:26:10.062508 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:26:10.062508 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:26:10.062508 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:26:10.062508 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:26:10.062508 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:26:10.062508 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:26:10.062508 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:26:10.062508 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:26:10.076033 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:26:10.076033 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:26:10.076033 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:26:10.101503 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:26:10.133705 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:26:10.152893 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:26:10.154899 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:26:10.157758 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:26:10.157758 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:26:10.157758 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:26:10.161743 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:26:10.161743 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:26:13.235185 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.072 seconds
[0m02:26:13.235185 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.076 seconds
[0m02:26:13.302177 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcaec555-5bb2-452c-b1cb-563922c5131e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262B7CCA4D0>]}
[0m02:26:13.302177 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcaec555-5bb2-452c-b1cb-563922c5131e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262B89B7810>]}
[0m02:26:13.302177 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.24s]
[0m02:26:13.302177 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.24s]
[0m02:26:13.302177 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:26:13.310275 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:26:13.310275 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:26:13.310275 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:26:13.310275 [info ] [Thread-2 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:26:13.310275 [info ] [Thread-4 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:26:13.310275 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m02:26:13.310275 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m02:26:13.310275 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:26:13.310275 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:26:13.322024 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:26:13.327340 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:26:13.327340 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:26:13.327340 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:26:13.327340 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:26:13.342939 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:26:13.342939 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:26:13.342939 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:26:13.355333 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:26:13.358257 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:26:13.516377 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:26:14.804879 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.449 seconds
[0m02:26:14.804879 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcaec555-5bb2-452c-b1cb-563922c5131e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262B8C1C850>]}
[0m02:26:14.804879 [info ] [Thread-2 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.49s]
[0m02:26:14.804879 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:26:17.047625 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.532 seconds
[0m02:26:17.051473 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcaec555-5bb2-452c-b1cb-563922c5131e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262B84413D0>]}
[0m02:26:17.052566 [info ] [Thread-4 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 3.74s]
[0m02:26:17.053613 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:26:17.056043 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:26:17.057784 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:26:17.059318 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:26:18.263398 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:26:18.266359 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:26:19.455260 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:26:19.457040 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:26:20.786643 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m02:26:20.786643 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m02:26:21.760508 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:26:21.760508 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:26:22.758006 [info ] [MainThread]: 
[0m02:26:22.761210 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 19.81 seconds (19.81s).
[0m02:26:22.761210 [debug] [MainThread]: Command end result
[0m02:26:22.868140 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:26:22.873869 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:26:22.884729 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:26:22.884729 [info ] [MainThread]: 
[0m02:26:22.886892 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:26:22.886892 [info ] [MainThread]: 
[0m02:26:22.886892 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:26:22.890217 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:26:22.893081 [debug] [MainThread]: Command `dbt build` succeeded at 02:26:22.893081 after 23.47 seconds
[0m02:26:22.893081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002629EB87950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002629EB879D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262A5572090>]}
[0m02:26:22.893081 [debug] [MainThread]: Flushing usage events
[0m02:26:25.720803 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:26:41.029782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002250AD9C810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002250AE02890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002250AE02F50>]}


============================== 02:26:41.029782 | 5125073b-46ab-4a9d-b200-469a62d8c7ad ==============================
[0m02:26:41.029782 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:26:41.029782 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m02:26:41.937009 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:26:41.937009 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:26:41.937009 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:26:42.092348 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:26:42.094353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '5125073b-46ab-4a9d-b200-469a62d8c7ad', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002251D13B4D0>]}
[0m02:26:42.323309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5125073b-46ab-4a9d-b200-469a62d8c7ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002251D1D1890>]}
[0m02:26:42.400078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5125073b-46ab-4a9d-b200-469a62d8c7ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022509D8D0D0>]}
[0m02:26:42.400078 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:26:43.011605 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:26:43.311983 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:26:43.311983 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:26:43.328820 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:26:43.352847 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:26:43.453644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5125073b-46ab-4a9d-b200-469a62d8c7ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002251D6A8050>]}
[0m02:26:43.723227 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:26:43.723227 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:26:43.795072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5125073b-46ab-4a9d-b200-469a62d8c7ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002251DA41C50>]}
[0m02:26:43.795072 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:26:43.812015 [info ] [MainThread]: 
[0m02:26:43.812015 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:26:43.812015 [info ] [MainThread]: 
[0m02:26:43.812015 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:26:43.812015 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:26:43.986293 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:26:43.986293 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:26:43.986293 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:26:46.106877 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.121 seconds
[0m02:26:46.122476 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:26:46.172972 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:26:46.172972 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:26:46.177358 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:26:50.105595 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 3.931 seconds
[0m02:26:50.131071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5125073b-46ab-4a9d-b200-469a62d8c7ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002251DD6C310>]}
[0m02:26:50.139341 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:26:50.139341 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:26:50.139341 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:26:50.139341 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:26:50.139341 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:26:50.139341 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:26:50.139341 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:26:50.139341 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:26:50.160631 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:26:50.166866 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:26:50.166866 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:26:50.166866 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:26:50.216520 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:26:50.216520 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:26:50.216520 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:26:50.216520 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:26:50.216520 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:26:50.228147 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:26:50.228760 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:26:50.230136 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:26:55.047788 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 4.816 seconds
[0m02:26:55.091611 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5125073b-46ab-4a9d-b200-469a62d8c7ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002251E0A4A10>]}
[0m02:26:55.093103 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 4.95s]
[0m02:26:55.094290 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:26:55.095376 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:26:55.096471 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:26:55.098030 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m02:26:55.099098 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:26:55.103852 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:26:55.103852 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:26:55.112437 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:26:55.116466 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:26:55.116466 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:26:55.119481 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:26:55.955904 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 5.727 seconds
[0m02:26:55.965948 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5125073b-46ab-4a9d-b200-469a62d8c7ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002251DFCB290>]}
[0m02:26:55.970460 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 5.83s]
[0m02:26:55.972473 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:26:55.976504 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:26:55.979471 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:26:55.983657 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m02:26:55.985670 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:26:55.999512 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:26:56.002258 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:26:56.115448 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:26:56.117455 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:26:56.119462 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:26:57.541818 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.421 seconds
[0m02:26:57.547137 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5125073b-46ab-4a9d-b200-469a62d8c7ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002251D27E110>]}
[0m02:26:57.547137 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.56s]
[0m02:26:57.550126 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:26:58.305276 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.187 seconds
[0m02:26:58.311332 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5125073b-46ab-4a9d-b200-469a62d8c7ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002251D1BC290>]}
[0m02:26:58.311332 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.21s]
[0m02:26:58.318987 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:26:58.318987 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:26:58.325996 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:26:58.325996 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:26:58.995843 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:26:58.995843 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:27:00.211131 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m02:27:00.211131 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m02:27:01.269828 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:27:01.271841 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:27:02.178223 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:27:02.178223 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:27:03.083311 [info ] [MainThread]: 
[0m02:27:03.087165 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 19.27 seconds (19.27s).
[0m02:27:03.089177 [debug] [MainThread]: Command end result
[0m02:27:03.160042 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:27:03.160042 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:27:03.175850 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:27:03.175850 [info ] [MainThread]: 
[0m02:27:03.175850 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:27:03.175850 [info ] [MainThread]: 
[0m02:27:03.175850 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:27:03.175850 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:27:03.175850 [debug] [MainThread]: Command `dbt build` succeeded at 02:27:03.175850 after 22.33 seconds
[0m02:27:03.188613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000225041B7AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000225041B79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000225042EAC90>]}
[0m02:27:03.188613 [debug] [MainThread]: Flushing usage events
[0m02:27:05.844934 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:27:20.879643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002958002E6D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002958002FB50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002958002D890>]}


============================== 02:27:20.885681 | 72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2 ==============================
[0m02:27:20.885681 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:27:20.887688 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m02:27:21.902523 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:27:21.902523 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:27:21.902523 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:27:22.054949 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:27:22.054949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000295923CEA90>]}
[0m02:27:22.289644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002959242D1D0>]}
[0m02:27:22.400458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000295922DE6D0>]}
[0m02:27:22.404005 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:27:22.956145 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:27:23.322308 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:27:23.322308 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:27:23.322308 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:27:23.336212 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:27:23.399153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002959291DD10>]}
[0m02:27:23.572310 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:27:23.572310 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:27:23.631983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029592C515D0>]}
[0m02:27:23.632499 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:27:23.638512 [info ] [MainThread]: 
[0m02:27:23.638512 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:27:23.638512 [info ] [MainThread]: 
[0m02:27:23.638512 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:27:23.657583 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:27:23.760991 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:27:23.760991 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:27:23.760991 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:27:25.820990 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.057 seconds
[0m02:27:25.847342 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:27:25.879213 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:27:25.879213 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:27:25.879213 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:27:29.092289 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 3.209 seconds
[0m02:27:29.141610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029592448890>]}
[0m02:27:29.153149 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:27:29.153149 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:27:29.153149 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:27:29.153149 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:27:29.153149 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:27:29.153149 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:27:29.153149 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:27:29.167028 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:27:29.191330 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:27:29.202154 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:27:29.202154 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:27:29.202154 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:27:29.305390 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:27:29.307396 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:27:29.312143 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:27:29.315526 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:27:29.315526 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:27:29.315526 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:27:29.315526 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:27:29.315526 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:27:33.030892 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.713 seconds
[0m02:27:33.119390 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029592716910>]}
[0m02:27:33.123338 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.96s]
[0m02:27:33.125355 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:27:33.127116 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:27:33.127116 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:27:33.127116 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m02:27:33.135152 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:27:33.146940 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:27:33.151953 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:27:33.160071 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:27:33.168176 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:27:33.168176 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:27:33.168176 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:27:33.238054 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.919 seconds
[0m02:27:33.258025 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000295931C5F10>]}
[0m02:27:33.266239 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 4.10s]
[0m02:27:33.270783 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:27:33.274454 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:27:33.278950 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:27:33.282721 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m02:27:33.284729 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:27:33.311604 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:27:33.315237 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:27:33.540744 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:27:33.548419 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:27:33.551275 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:27:35.225343 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.671 seconds
[0m02:27:35.242459 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029592C21B50>]}
[0m02:27:35.245834 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.96s]
[0m02:27:35.249774 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:27:36.740164 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.566 seconds
[0m02:27:36.746842 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72ea4fc0-0edb-48b4-a9ce-4b3bd57905f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029592716910>]}
[0m02:27:36.748850 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 3.62s]
[0m02:27:36.748850 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:27:36.756657 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:27:36.762989 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:27:36.768361 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:27:38.204976 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:27:38.208697 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:27:39.542269 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:27:39.543803 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:27:40.362089 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m02:27:40.363167 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m02:27:41.582351 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:27:41.582351 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:27:42.505462 [info ] [MainThread]: 
[0m02:27:42.505462 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 18.87 seconds (18.87s).
[0m02:27:42.516724 [debug] [MainThread]: Command end result
[0m02:27:42.672676 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:27:42.681082 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:27:42.701902 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:27:42.705469 [info ] [MainThread]: 
[0m02:27:42.708898 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:27:42.708898 [info ] [MainThread]: 
[0m02:27:42.708898 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:27:42.708898 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:27:42.715931 [debug] [MainThread]: Command `dbt build` succeeded at 02:27:42.715931 after 21.97 seconds
[0m02:27:42.715931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002958009CCD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000295F93F7950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000295F93F79D0>]}
[0m02:27:42.722760 [debug] [MainThread]: Flushing usage events
[0m02:27:44.985364 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:28:24.486293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A1AE9FBD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A1AE9CA10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A1AE9F450>]}


============================== 02:28:24.490279 | a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d ==============================
[0m02:28:24.490279 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:28:24.490279 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m02:28:26.072354 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:28:26.072354 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:28:26.072354 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:28:26.292952 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:28:26.292952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A2D1AC3D0>]}
[0m02:28:26.645669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A1ADC2890>]}
[0m02:28:26.765896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A19E89110>]}
[0m02:28:26.765896 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:28:27.443616 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:28:27.862403 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:28:27.863493 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:28:27.864568 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:28:27.879957 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:28:27.968868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A2D836A90>]}
[0m02:28:28.175273 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:28:28.181098 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:28:28.270135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A2DB41810>]}
[0m02:28:28.275074 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:28:28.287133 [info ] [MainThread]: 
[0m02:28:28.287133 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:28:28.290069 [info ] [MainThread]: 
[0m02:28:28.290069 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:28:28.307359 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:28:28.477208 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:28:28.477208 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:28:28.477208 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:28:31.780657 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.301 seconds
[0m02:28:31.806913 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:28:31.835042 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:28:31.844109 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:28:31.845760 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:28:34.764712 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.919 seconds
[0m02:28:34.791091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A178198D0>]}
[0m02:28:34.796323 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:28:34.796323 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:28:34.799719 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:28:34.799719 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:28:34.799719 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:28:34.799719 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:28:34.799719 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:28:34.799719 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:28:34.812936 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:28:34.820196 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:28:34.820196 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:28:34.836319 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:28:34.864727 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:28:34.871776 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:28:34.871776 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:28:34.871776 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:28:34.871776 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:28:34.877882 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:28:34.878419 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:28:34.880435 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:28:37.528611 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.649 seconds
[0m02:28:37.560667 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A2E1DBED0>]}
[0m02:28:37.560667 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 2.76s]
[0m02:28:37.564574 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:28:37.566199 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:28:37.568352 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:28:37.570366 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m02:28:37.571595 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:28:37.578724 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:28:37.580791 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:28:37.588117 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:28:37.591910 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:28:37.591910 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:28:37.591910 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:28:37.729861 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.851 seconds
[0m02:28:37.729861 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A2DE8C390>]}
[0m02:28:37.729861 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 2.93s]
[0m02:28:37.729861 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:28:37.729861 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:28:37.729861 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:28:37.743907 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m02:28:37.743907 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:28:37.751944 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:28:37.753952 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:28:37.851625 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:28:37.853719 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:28:37.857802 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:28:39.795161 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.939 seconds
[0m02:28:39.801875 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A17A80090>]}
[0m02:28:39.812183 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 2.06s]
[0m02:28:39.814202 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:28:40.709919 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.118 seconds
[0m02:28:40.709919 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3ec0c10-11ac-4d34-9bbb-6d56de2fd14d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A2E2BD610>]}
[0m02:28:40.709919 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.14s]
[0m02:28:40.725687 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:28:40.725687 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:28:40.725687 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:28:40.725687 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:28:41.904125 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:28:41.904125 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:28:43.131409 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m02:28:43.133071 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m02:28:44.372978 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:28:44.376506 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:28:45.528886 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:28:45.529922 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:28:46.811690 [info ] [MainThread]: 
[0m02:28:46.811690 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 18.52 seconds (18.52s).
[0m02:28:46.815417 [debug] [MainThread]: Command end result
[0m02:28:46.903946 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:28:46.910295 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:28:46.928811 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:28:46.932537 [info ] [MainThread]: 
[0m02:28:46.932537 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:28:46.932537 [info ] [MainThread]: 
[0m02:28:46.932537 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:28:46.932537 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:28:46.938629 [debug] [MainThread]: Command `dbt build` succeeded at 02:28:46.938629 after 22.63 seconds
[0m02:28:46.938629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A1AF03150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A14327AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000011A143279D0>]}
[0m02:28:46.938629 [debug] [MainThread]: Flushing usage events
[0m02:28:50.846674 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:34:34.152980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116C330C790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116C330C650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116C330CCD0>]}


============================== 02:34:34.152980 | 6a0d286e-0559-409d-abb4-dcf0bce34060 ==============================
[0m02:34:34.152980 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:34:34.166825 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m02:34:35.580037 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:34:35.583701 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:34:35.583701 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:34:35.750936 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:34:35.761520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6a0d286e-0559-409d-abb4-dcf0bce34060', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116D572F850>]}
[0m02:34:36.049577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6a0d286e-0559-409d-abb4-dcf0bce34060', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116D57F4B10>]}
[0m02:34:36.143708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6a0d286e-0559-409d-abb4-dcf0bce34060', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116C22FD110>]}
[0m02:34:36.145693 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:34:36.910429 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:34:37.310187 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:34:37.310187 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:34:37.310187 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:34:37.314199 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:34:37.389406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6a0d286e-0559-409d-abb4-dcf0bce34060', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116D5C184D0>]}
[0m02:34:37.654148 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:34:37.663944 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:34:37.717390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6a0d286e-0559-409d-abb4-dcf0bce34060', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116D5FB1990>]}
[0m02:34:37.717390 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:34:37.736134 [info ] [MainThread]: 
[0m02:34:37.736134 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:34:37.738140 [info ] [MainThread]: 
[0m02:34:37.738140 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:34:37.738140 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:34:37.849190 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:34:37.849190 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:34:37.849190 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:34:40.871029 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.014 seconds
[0m02:34:40.881893 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:34:40.928656 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:34:40.928656 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:34:40.928656 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:34:42.672181 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 1.742 seconds
[0m02:34:42.720530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6a0d286e-0559-409d-abb4-dcf0bce34060', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116D5FC8850>]}
[0m02:34:42.720530 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:34:42.720530 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:34:42.720530 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:34:42.736195 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:34:42.736195 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:34:42.736195 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:34:42.736195 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:34:42.736195 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:34:42.752056 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:34:42.752056 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:34:42.767717 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:34:42.767717 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:34:42.815591 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:34:42.824069 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:34:42.824069 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:34:42.827454 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:34:42.827454 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:34:42.827454 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:34:42.827454 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:34:42.832304 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:34:45.884146 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.054 seconds
[0m02:34:45.946184 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6a0d286e-0559-409d-abb4-dcf0bce34060', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116D6653890>]}
[0m02:34:45.947933 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.21s]
[0m02:34:45.947933 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:34:45.950350 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:34:45.950350 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:34:45.953054 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m02:34:45.953054 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:34:45.957066 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:34:45.959071 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:34:45.963978 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:34:45.963978 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:34:45.963978 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:34:45.963978 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:34:46.182825 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.353 seconds
[0m02:34:46.195095 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6a0d286e-0559-409d-abb4-dcf0bce34060', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116D6536990>]}
[0m02:34:46.195095 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.46s]
[0m02:34:46.201650 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:34:46.205817 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:34:46.207828 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:34:46.210725 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m02:34:46.214753 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:34:46.233130 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:34:46.237159 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:34:46.370637 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:34:46.374895 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:34:46.376903 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:34:47.827077 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.451 seconds
[0m02:34:47.827077 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6a0d286e-0559-409d-abb4-dcf0bce34060', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116D6732A90>]}
[0m02:34:47.827077 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.62s]
[0m02:34:47.842925 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:34:48.706161 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.739 seconds
[0m02:34:48.713738 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6a0d286e-0559-409d-abb4-dcf0bce34060', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116D674DB50>]}
[0m02:34:48.716713 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 2.76s]
[0m02:34:48.717304 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:34:48.717304 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:34:48.717304 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:34:48.717304 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:34:49.718795 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:34:49.719466 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:34:51.697775 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m02:34:51.697775 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m02:34:53.211185 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:34:53.213314 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:34:54.538760 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:34:54.538760 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:34:55.562448 [info ] [MainThread]: 
[0m02:34:55.564459 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 17.82 seconds (17.82s).
[0m02:34:55.566474 [debug] [MainThread]: Command end result
[0m02:34:55.663610 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:34:55.664066 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:34:55.676552 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:34:55.682535 [info ] [MainThread]: 
[0m02:34:55.686097 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:34:55.686417 [info ] [MainThread]: 
[0m02:34:55.686417 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:34:55.686417 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:34:55.686417 [debug] [MainThread]: Command `dbt build` succeeded at 02:34:55.686417 after 21.70 seconds
[0m02:34:55.686417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116BC727AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116BC7279D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000116C323DAD0>]}
[0m02:34:55.696173 [debug] [MainThread]: Flushing usage events
[0m02:34:58.509945 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:35:28.029949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203261AC3D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203261AC190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203261AFB50>]}


============================== 02:35:28.042440 | 25687054-1bf5-4e74-91a8-e18c82ab54b8 ==============================
[0m02:35:28.042440 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:35:28.044817 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_b', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m02:35:29.273225 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:35:29.273225 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:35:29.273225 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:35:29.498073 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:35:29.498073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203385CC390>]}
[0m02:35:29.775844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203386634D0>]}
[0m02:35:29.918202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002032519D110>]}
[0m02:35:29.931675 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:35:30.760329 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:35:31.136998 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:35:31.143811 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:35:31.146493 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:35:31.176261 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:35:31.302614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020338ACEB50>]}
[0m02:35:31.639063 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:35:31.645114 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:35:31.891756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020338E51CD0>]}
[0m02:35:31.899627 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:35:32.010414 [info ] [MainThread]: 
[0m02:35:32.012520 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:35:32.013919 [info ] [MainThread]: 
[0m02:35:32.033020 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:35:32.076165 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:35:32.437069 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:35:32.442631 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:35:32.444646 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:35:36.265428 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.823 seconds
[0m02:35:36.287173 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:35:36.329894 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:35:36.330687 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:35:36.333598 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:35:38.600083 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.268 seconds
[0m02:35:38.666979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203393C6F10>]}
[0m02:35:38.683205 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:35:38.683205 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:35:38.683205 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:35:38.691468 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:35:38.691468 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:35:38.698205 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:35:38.700340 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:35:38.704536 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:35:38.708298 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:35:38.708689 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:35:38.708689 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:35:38.716423 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:35:38.716423 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:35:38.716423 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:35:38.716423 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:35:38.728130 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:35:38.766260 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:35:38.790529 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:35:38.807322 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:35:38.823867 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:35:38.830784 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:35:38.832290 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:35:38.832290 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:35:38.930742 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:35:39.021576 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:35:39.014098 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:35:39.045887 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:35:39.066359 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:35:39.074914 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:35:39.078963 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:35:39.084109 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:35:39.087141 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:35:39.090792 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:35:39.090792 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:35:39.095187 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:35:39.095187 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:35:39.095187 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:35:39.095187 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:35:39.103488 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:35:39.109081 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:35:41.937180 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.835 seconds
[0m02:35:41.939189 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.831 seconds
[0m02:35:41.944645 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.845 seconds
[0m02:35:42.116897 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020338945510>]}
[0m02:35:42.116897 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203395D38D0>]}
[0m02:35:42.116897 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002033939D090>]}
[0m02:35:42.116897 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 3.39s]
[0m02:35:42.116897 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 3.40s]
[0m02:35:42.116897 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 3.41s]
[0m02:35:42.116897 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:35:42.116897 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:35:42.116897 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:35:42.308451 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.205 seconds
[0m02:35:42.319558 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002033939FBD0>]}
[0m02:35:42.320211 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 3.60s]
[0m02:35:42.323013 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:35:42.327416 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:35:42.329263 [info ] [Thread-3 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:35:42.334315 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:35:42.340957 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:35:42.355720 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:35:42.363354 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:35:42.379437 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:35:42.387417 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:35:42.394032 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:35:43.374079 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.977 seconds
[0m02:35:43.381785 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203386DE810>]}
[0m02:35:43.385200 [info ] [Thread-3 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 1.05s]
[0m02:35:43.388494 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:35:43.388494 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:35:43.393852 [info ] [Thread-2 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:35:43.396692 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:35:43.396692 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:35:43.404946 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:35:43.411328 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:35:43.415646 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:35:43.423378 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:35:43.425386 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:35:44.380346 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.954 seconds
[0m02:35:44.388414 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203394C8150>]}
[0m02:35:44.390435 [info ] [Thread-2 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 0.99s]
[0m02:35:44.391948 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:35:44.395980 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:35:44.395980 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:35:44.395980 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:35:44.395980 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:35:44.399779 [info ] [Thread-4 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:35:44.401792 [info ] [Thread-3 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:35:44.403803 [info ] [Thread-5 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:35:44.403803 [info ] [Thread-2 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:35:44.403803 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:35:44.403803 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:35:44.403803 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:35:44.410043 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:35:44.410043 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:35:44.410043 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:35:44.410043 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:35:44.410043 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:35:44.410043 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:35:44.425787 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:35:44.425787 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:35:44.449164 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:35:44.449164 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:35:44.449164 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:35:44.457486 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:35:44.462001 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:35:44.469866 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:35:44.469866 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:35:44.477753 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:35:44.481680 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:35:44.481680 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:35:44.489951 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:35:44.491016 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:35:44.492796 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:35:44.492796 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:35:44.497746 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:35:44.497746 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

with_window_aggregates as (
    select
        trade_id,
        trade_date,
        portfolio_id,
        security_id,
        ticker,
        quantity,
        price,
        price as execution_price,
        trade_value,
        commission,
        round(avg(price) over (partition by trade_date, security_id), 2) as daily_avg_price,
        min(price) over (partition by trade_date, security_id) as daily_min_price,
        max(price) over (partition by trade_date, security_id) as daily_max_price,
        (max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)) as daily_price_range,
        round(stddev_pop(price) over (partition by trade_date, security_id), 4) as daily_volatility,
        round((price - min(price) over (partition by trade_date, security_id)) / nullif((max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)), 0), 8) as execution_percentile
    from trades_detail
)

select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    daily_min_price,
    daily_max_price,
    daily_price_range,
    daily_volatility,
    execution_percentile,
    round(100 * (price - daily_avg_price) / nullif(daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when execution_percentile > 0.75 then 'POOR'
        when execution_percentile > 0.50 then 'FAIR'
        when execution_percentile > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(commission / nullif(trade_value, 0), 8) as commission_ratio,
    round(100 * commission / nullif(trade_value, 0), 6) as commission_ratio_bps
from with_window_aggregates
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:35:44.502798 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:35:45.514309 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.009 seconds
[0m02:35:45.520464 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203394BFD10>]}
[0m02:35:45.523332 [info ] [Thread-5 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.12s]
[0m02:35:45.526268 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:35:45.527944 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:35:45.528904 [info ] [Thread-5 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:35:45.530911 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:35:45.530911 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:35:45.542471 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:35:45.546114 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.040 seconds
[0m02:35:45.552350 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203393A5150>]}
[0m02:35:45.555008 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:35:45.552350 [info ] [Thread-2 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.14s]
[0m02:35:45.563713 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:35:45.565719 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:35:45.568031 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:35:45.569209 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:35:45.571214 [info ] [Thread-2 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:35:45.571214 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:35:45.571214 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:35:45.571214 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:35:45.587031 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:35:45.589083 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:35:45.595796 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:35:45.599488 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:35:45.599488 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:35:45.759770 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.264 seconds
[0m02:35:45.759770 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.263 seconds
[0m02:35:45.759770 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203393C7450>]}
[0m02:35:45.771160 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020338BF1C50>]}
[0m02:35:45.771160 [info ] [Thread-4 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.36s]
[0m02:35:45.771160 [info ] [Thread-3 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.37s]
[0m02:35:45.771160 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:35:45.771160 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:35:46.452606 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.851 seconds
[0m02:35:46.462506 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203396559D0>]}
[0m02:35:46.462506 [info ] [Thread-2 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 0.89s]
[0m02:35:46.462506 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:35:46.804649 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.231 seconds
[0m02:35:46.809518 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25687054-1bf5-4e74-91a8-e18c82ab54b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002033949A290>]}
[0m02:35:46.809518 [info ] [Thread-5 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.28s]
[0m02:35:46.816354 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:35:46.818552 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:35:46.823504 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:35:46.823504 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:35:47.788292 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:35:47.788292 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:35:48.707641 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:35:48.707641 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:35:49.779058 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m02:35:49.779058 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m02:35:50.764825 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_trades' was left open.
[0m02:35:50.764825 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_trades: Close
[0m02:35:51.704573 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:35:51.704573 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:35:52.959480 [info ] [MainThread]: 
[0m02:35:52.963501 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 20.93 seconds (20.93s).
[0m02:35:52.977884 [debug] [MainThread]: Command end result
[0m02:35:53.228575 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:35:53.240699 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:35:53.267388 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:35:53.274018 [info ] [MainThread]: 
[0m02:35:53.276815 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:35:53.276815 [info ] [MainThread]: 
[0m02:35:53.284430 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:35:53.284430 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:35:53.292169 [debug] [MainThread]: Command `dbt build` succeeded at 02:35:53.292169 after 25.53 seconds
[0m02:35:53.294750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203262124D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020325E588D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002031F5D79D0>]}
[0m02:35:53.300190 [debug] [MainThread]: Flushing usage events
[0m02:35:56.292981 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:36:26.044280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001650D04C690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001650D04DF90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001650CDF1E10>]}


============================== 02:36:26.053169 | 907cb3fd-bed0-4fc3-8f33-ef0a14f9254c ==============================
[0m02:36:26.053169 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:36:26.053169 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_b', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m02:36:27.545597 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:36:27.547604 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:36:27.550756 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:36:27.739445 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:36:27.739445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001650D0F49D0>]}
[0m02:36:28.239662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651F35C490>]}
[0m02:36:28.462481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001650C03D110>]}
[0m02:36:28.462481 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:36:30.024290 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:36:30.898511 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:36:30.898511 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:36:30.898511 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:36:30.940371 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:36:31.170462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651F91B110>]}
[0m02:36:31.703862 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:36:31.712158 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:36:31.883489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651FCC1A10>]}
[0m02:36:31.886523 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:36:31.900270 [info ] [MainThread]: 
[0m02:36:31.903962 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:36:31.903962 [info ] [MainThread]: 
[0m02:36:31.910433 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:36:31.938253 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:36:32.297839 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:36:32.301882 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:36:32.305125 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:36:36.996170 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 4.691 seconds
[0m02:36:37.031459 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:36:37.081732 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:36:37.084883 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:36:37.086211 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:36:39.609145 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.522 seconds
[0m02:36:39.685112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001650D05AC90>]}
[0m02:36:39.701727 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:36:39.701727 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:36:39.710195 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:36:39.701727 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:36:39.710195 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:36:39.721024 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:36:39.725056 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:36:39.727515 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:36:39.731950 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:36:39.737091 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:36:39.737091 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:36:39.737091 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:36:39.745015 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:36:39.745618 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:36:39.745618 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:36:39.750152 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:36:39.775738 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:36:39.788184 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:36:39.808142 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:36:39.824729 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:36:39.832879 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:36:39.834814 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:36:39.836925 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:36:39.857649 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:36:40.000329 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:36:40.014239 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:36:40.021616 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:36:40.038228 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:36:40.046748 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:36:40.052190 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:36:40.055048 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:36:40.055048 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:36:40.063837 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:36:40.065852 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:36:40.068891 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:36:40.070764 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:36:40.072006 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:36:40.072006 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:36:40.079252 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:36:40.084704 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:36:42.520088 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.437 seconds
[0m02:36:42.527138 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.445 seconds
[0m02:36:42.858836 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651F5055D0>]}
[0m02:36:42.858836 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651F52FFD0>]}
[0m02:36:42.867687 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 3.11s]
[0m02:36:42.867687 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 3.12s]
[0m02:36:42.875270 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:36:42.878467 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:36:43.142770 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.077 seconds
[0m02:36:43.149999 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.072 seconds
[0m02:36:43.159190 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001652027F6D0>]}
[0m02:36:43.174775 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001652027FA10>]}
[0m02:36:43.174775 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 3.43s]
[0m02:36:43.182344 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 3.44s]
[0m02:36:43.183092 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:36:43.183092 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:36:43.191994 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:36:43.193267 [info ] [Thread-5 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:36:43.198541 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:36:43.198541 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:36:43.214783 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:36:43.224163 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:36:43.240371 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:36:43.248465 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:36:43.248465 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:36:44.056865 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.800 seconds
[0m02:36:44.061661 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651F4C5C10>]}
[0m02:36:44.061661 [info ] [Thread-5 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.86s]
[0m02:36:44.071057 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:36:44.072532 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:36:44.077031 [info ] [Thread-2 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:36:44.078040 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:36:44.080462 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:36:44.094942 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:36:44.097435 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:36:44.111313 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:36:44.120016 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:36:44.127175 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:36:45.706574 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.578 seconds
[0m02:36:45.714252 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016509BA3510>]}
[0m02:36:45.719377 [info ] [Thread-2 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 1.64s]
[0m02:36:45.723074 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:36:45.739096 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:36:45.741107 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:36:45.743445 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:36:45.745455 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:36:45.745455 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:36:45.745455 [info ] [Thread-5 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:36:45.751180 [info ] [Thread-4 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:36:45.755963 [info ] [Thread-2 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:36:45.757976 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:36:45.759484 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:36:45.759484 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:36:45.759484 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:36:45.764052 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:36:45.764052 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:36:45.767613 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:36:45.768217 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:36:45.775806 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:36:45.792219 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:36:45.808296 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:36:45.824322 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:36:45.829841 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:36:45.829841 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:36:45.832648 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:36:45.845186 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:36:45.845186 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:36:45.859215 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:36:45.868991 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:36:45.881541 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:36:45.885546 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:36:45.889557 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:36:45.892581 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:36:45.897824 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:36:45.902687 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:36:45.902687 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:36:45.907634 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

with_window_aggregates as (
    select
        trade_id,
        trade_date,
        portfolio_id,
        security_id,
        ticker,
        quantity,
        price,
        price as execution_price,
        trade_value,
        commission,
        round(avg(price) over (partition by trade_date, security_id), 2) as daily_avg_price,
        min(price) over (partition by trade_date, security_id) as daily_min_price,
        max(price) over (partition by trade_date, security_id) as daily_max_price,
        (max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)) as daily_price_range,
        round(stddev_pop(price) over (partition by trade_date, security_id), 4) as daily_volatility,
        round((price - min(price) over (partition by trade_date, security_id)) / nullif((max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)), 0), 8) as execution_percentile
    from trades_detail
)

select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    daily_min_price,
    daily_max_price,
    daily_price_range,
    daily_volatility,
    execution_percentile,
    round(100 * (price - daily_avg_price) / nullif(daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when execution_percentile > 0.75 then 'POOR'
        when execution_percentile > 0.50 then 'FAIR'
        when execution_percentile > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(commission / nullif(trade_value, 0), 8) as commission_ratio,
    round(100 * commission / nullif(trade_value, 0), 6) as commission_ratio_bps
from with_window_aggregates
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:36:45.911622 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:36:46.853500 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.937 seconds
[0m02:36:46.867251 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651F524C50>]}
[0m02:36:46.870428 [info ] [Thread-4 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.11s]
[0m02:36:46.878407 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:36:46.882895 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:36:46.885191 [info ] [Thread-4 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:36:46.885191 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:36:46.892020 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:36:46.909971 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:36:46.917476 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.004 seconds
[0m02:36:46.922628 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.016 seconds
[0m02:36:46.932171 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651F53E710>]}
[0m02:36:46.940650 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651F474690>]}
[0m02:36:46.940650 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:36:46.940650 [info ] [Thread-5 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.17s]
[0m02:36:46.948658 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.18s]
[0m02:36:46.973905 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:36:46.975777 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:36:46.979810 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:36:46.982550 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:36:46.990343 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:36:47.146495 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.230 seconds
[0m02:36:47.165692 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651FCFB250>]}
[0m02:36:47.171488 [info ] [Thread-2 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.41s]
[0m02:36:47.174029 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:36:47.179544 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:36:47.182377 [info ] [Thread-5 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:36:47.185162 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_security_performance, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:36:47.188921 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:36:47.206323 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:36:47.206323 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:36:47.232833 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:36:47.238752 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:36:47.240760 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:36:48.152726 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.164 seconds
[0m02:36:48.160535 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.916 seconds
[0m02:36:48.168678 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651F4CF610>]}
[0m02:36:48.185310 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '907cb3fd-bed0-4fc3-8f33-ef0a14f9254c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016520445BD0>]}
[0m02:36:48.186311 [info ] [Thread-4 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.28s]
[0m02:36:48.186311 [info ] [Thread-5 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.00s]
[0m02:36:48.193630 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:36:48.193630 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:36:48.201746 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:36:48.201746 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:36:48.201746 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:36:49.338125 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:36:49.341347 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:36:50.372415 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_summary' was left open.
[0m02:36:50.372415 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m02:36:51.893897 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_trades' was left open.
[0m02:36:51.897928 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_trades: Close
[0m02:36:53.125475 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:36:53.127530 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:36:54.666361 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:36:54.666361 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:36:55.775599 [info ] [MainThread]: 
[0m02:36:55.781252 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 23.87 seconds (23.87s).
[0m02:36:55.783665 [debug] [MainThread]: Command end result
[0m02:36:56.006359 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:36:56.014744 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:36:56.038646 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:36:56.038646 [info ] [MainThread]: 
[0m02:36:56.038646 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:36:56.047071 [info ] [MainThread]: 
[0m02:36:56.048849 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:36:56.048849 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:36:56.056291 [debug] [MainThread]: Command `dbt build` succeeded at 02:36:56.056291 after 30.22 seconds
[0m02:36:56.058879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016506467950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000165064679D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651FF105D0>]}
[0m02:36:56.063289 [debug] [MainThread]: Flushing usage events
[0m02:36:59.666394 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:37:31.234157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB945CCC90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB945CFC50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB945CC790>]}


============================== 02:37:31.237434 | 41a423c2-5428-4667-90b1-0f4a6921eebc ==============================
[0m02:37:31.237434 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:37:31.239440 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m02:37:32.284654 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:37:32.284654 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:37:32.284654 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:37:32.460533 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:37:32.460533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '41a423c2-5428-4667-90b1-0f4a6921eebc', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EBA69EFE90>]}
[0m02:37:32.765011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '41a423c2-5428-4667-90b1-0f4a6921eebc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EBA449E750>]}
[0m02:37:32.932175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '41a423c2-5428-4667-90b1-0f4a6921eebc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB935BD1D0>]}
[0m02:37:32.934181 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:37:33.506642 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:37:33.870909 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:37:33.872915 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:37:33.874922 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:37:33.893738 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:37:34.004808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41a423c2-5428-4667-90b1-0f4a6921eebc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EBA6DA3C90>]}
[0m02:37:34.307605 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:37:34.311618 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:37:34.355488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41a423c2-5428-4667-90b1-0f4a6921eebc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EBA7271CD0>]}
[0m02:37:34.355488 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:37:34.365501 [info ] [MainThread]: 
[0m02:37:34.365501 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:37:34.367507 [info ] [MainThread]: 
[0m02:37:34.367507 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:37:34.371524 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:37:34.556575 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:37:34.562851 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:37:34.562851 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:37:38.075395 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.516 seconds
[0m02:37:38.092498 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:37:38.139486 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:37:38.143250 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:37:38.145264 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:37:40.947191 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.802 seconds
[0m02:37:40.982318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41a423c2-5428-4667-90b1-0f4a6921eebc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EBA72A6850>]}
[0m02:37:40.997317 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:37:40.999331 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:37:40.999331 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:37:41.003232 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:37:41.003232 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:37:41.003232 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:37:41.003232 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:37:41.003232 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:37:41.024824 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:37:41.037345 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:37:41.037345 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:37:41.044418 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:37:41.143433 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:37:41.145440 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:37:41.149457 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:37:41.151471 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:37:41.176651 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:37:41.183526 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:37:41.185534 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:37:41.187541 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:37:44.571573 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.386 seconds
[0m02:37:44.627244 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41a423c2-5428-4667-90b1-0f4a6921eebc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EBA78E7910>]}
[0m02:37:44.627244 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.62s]
[0m02:37:44.627244 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:37:44.627244 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:37:44.627244 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:37:44.634471 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m02:37:44.635913 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:37:44.636687 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:37:44.646640 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:37:44.656277 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:37:44.658962 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:37:44.662124 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:37:44.662124 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:37:44.882001 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.734 seconds
[0m02:37:44.893000 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41a423c2-5428-4667-90b1-0f4a6921eebc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EBA77C3D50>]}
[0m02:37:44.893000 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.89s]
[0m02:37:44.893000 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:37:44.904177 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:37:44.906853 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:37:44.906853 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m02:37:44.906853 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:37:44.927967 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:37:44.931044 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:37:45.081482 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:37:45.092571 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:37:45.092571 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:37:47.130505 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.034 seconds
[0m02:37:47.130505 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41a423c2-5428-4667-90b1-0f4a6921eebc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EBA718AC90>]}
[0m02:37:47.130505 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 2.22s]
[0m02:37:47.146479 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:37:47.948337 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.287 seconds
[0m02:37:47.948337 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41a423c2-5428-4667-90b1-0f4a6921eebc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EBA727A750>]}
[0m02:37:47.948337 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.31s]
[0m02:37:47.965905 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:37:47.972283 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:37:47.972283 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:37:47.972283 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:37:49.138865 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:37:49.138865 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:37:50.222951 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m02:37:50.222951 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m02:37:51.215177 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:37:51.215177 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:37:52.139221 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:37:52.139221 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:37:53.469904 [info ] [MainThread]: 
[0m02:37:53.471913 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 19.10 seconds (19.10s).
[0m02:37:53.473920 [debug] [MainThread]: Command end result
[0m02:37:53.549284 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:37:53.549284 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:37:53.566090 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:37:53.566090 [info ] [MainThread]: 
[0m02:37:53.566090 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:37:53.566090 [info ] [MainThread]: 
[0m02:37:53.566090 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:37:53.581177 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:37:53.581177 [debug] [MainThread]: Command `dbt build` succeeded at 02:37:53.581177 after 22.47 seconds
[0m02:37:53.581177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB94632950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB94633150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB9463FF90>]}
[0m02:37:53.581177 [debug] [MainThread]: Flushing usage events
[0m02:37:55.278777 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:38:20.846253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FB4DD31D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FB4D6DA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FB4D6C890>]}


============================== 02:38:20.854147 | 5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef ==============================
[0m02:38:20.854147 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:38:20.857926 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_a', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m02:38:22.455302 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:38:22.459310 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:38:22.461825 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:38:22.706324 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:38:22.706324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FB3B3DA50>]}
[0m02:38:23.070589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FC6255410>]}
[0m02:38:23.212113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FC60D2750>]}
[0m02:38:23.216895 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:38:23.901543 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:38:24.498479 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:38:24.502345 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:38:24.504362 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:38:24.516799 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:38:24.641662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FC669F9D0>]}
[0m02:38:24.926345 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:38:24.930663 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:38:25.007065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FC6A417D0>]}
[0m02:38:25.012929 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:38:25.020799 [info ] [MainThread]: 
[0m02:38:25.026075 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:38:25.026075 [info ] [MainThread]: 
[0m02:38:25.026075 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:38:25.039934 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:38:25.205639 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:38:25.205639 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:38:25.205639 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:38:29.631880 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 4.422 seconds
[0m02:38:29.646035 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:38:29.669878 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:38:29.669878 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:38:29.669878 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:38:31.941587 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.269 seconds
[0m02:38:31.967552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FB4D7B650>]}
[0m02:38:31.976398 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:38:31.978872 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:38:31.980075 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:38:31.980075 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:38:31.980075 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:38:31.980075 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:38:31.980075 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:38:31.980075 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:38:31.999753 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:38:32.007184 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:38:32.011734 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:38:32.013288 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:38:32.066284 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:38:32.075280 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:38:32.075280 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:38:32.079799 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:38:32.079799 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:38:32.079799 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:38:32.079799 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:38:32.079799 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:38:35.580396 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.499 seconds
[0m02:38:35.646419 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FC6D85850>]}
[0m02:38:35.650129 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.67s]
[0m02:38:35.650129 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:38:35.657067 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:38:35.658586 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:38:35.658586 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m02:38:35.658586 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:38:35.668624 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:38:35.668624 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:38:35.683268 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:38:35.683268 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:38:35.683268 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:38:35.683268 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:38:36.703084 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 4.624 seconds
[0m02:38:36.703084 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FC708B310>]}
[0m02:38:36.703084 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 4.72s]
[0m02:38:36.719817 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:38:36.721833 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:38:36.723847 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:38:36.723847 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m02:38:36.723847 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:38:36.734833 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:38:36.734833 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:38:36.858043 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:38:36.863894 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:38:36.868545 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:38:38.303525 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.431 seconds
[0m02:38:38.308740 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FB35FC310>]}
[0m02:38:38.308740 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.58s]
[0m02:38:38.312918 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:38:38.845806 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.156 seconds
[0m02:38:38.847723 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b5e3e0c-0b86-4ad7-a57f-7830f8dd86ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FC6FC6C90>]}
[0m02:38:38.847723 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.19s]
[0m02:38:38.847723 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:38:38.847723 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:38:38.847723 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:38:38.847723 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:38:39.783193 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:38:39.783193 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:38:41.262238 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m02:38:41.263346 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m02:38:42.797273 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:38:42.797273 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:38:43.753511 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:38:43.753511 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:38:44.768139 [info ] [MainThread]: 
[0m02:38:44.768139 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 19.74 seconds (19.74s).
[0m02:38:44.776189 [debug] [MainThread]: Command end result
[0m02:38:44.870304 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:38:44.876080 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:38:44.886548 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:38:44.886548 [info ] [MainThread]: 
[0m02:38:44.888558 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:38:44.891288 [info ] [MainThread]: 
[0m02:38:44.891288 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:38:44.895459 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:38:44.896485 [debug] [MainThread]: Command `dbt build` succeeded at 02:38:44.896485 after 24.22 seconds
[0m02:38:44.896485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FAD1A7950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FAD1A79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023FC344E590>]}
[0m02:38:44.898915 [debug] [MainThread]: Flushing usage events
[0m02:38:48.063245 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:39:59.654802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002170881D110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002170881C8D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002170881C4D0>]}


============================== 02:39:59.665674 | d531867e-d225-4d18-8feb-986625554ae9 ==============================
[0m02:39:59.665674 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:39:59.665674 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_b', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m02:40:00.808729 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:40:00.808729 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:40:00.808729 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:40:01.007165 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:40:01.009170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021719C05E10>]}
[0m02:40:01.288527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171773E790>]}
[0m02:40:01.389316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002170682D190>]}
[0m02:40:01.394696 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:40:02.058236 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:40:02.480504 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:40:02.482326 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:40:02.483779 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:40:02.500745 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:40:02.570549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171A2925D0>]}
[0m02:40:02.810333 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:40:02.814675 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:40:02.863787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171A4C17D0>]}
[0m02:40:02.863787 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:40:02.863787 [info ] [MainThread]: 
[0m02:40:02.863787 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:40:02.863787 [info ] [MainThread]: 
[0m02:40:02.863787 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:40:02.879744 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:40:03.038260 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:40:03.038260 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:40:03.038260 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:40:06.905273 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.864 seconds
[0m02:40:06.920330 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:40:06.951196 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:40:06.953848 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:40:06.955011 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:40:08.975699 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.027 seconds
[0m02:40:09.022453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021708857B10>]}
[0m02:40:09.027522 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:40:09.027522 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:40:09.027522 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:40:09.027522 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:40:09.033175 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:40:09.033175 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:40:09.033175 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:40:09.033175 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:40:09.033175 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:40:09.033175 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:40:09.033175 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:40:09.033175 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:40:09.044305 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:40:09.044305 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:40:09.046821 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:40:09.046821 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:40:09.062493 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:40:09.062493 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:40:09.077503 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:40:09.077503 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:40:09.077503 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:40:09.077503 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:40:09.091370 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:40:09.107223 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:40:09.139617 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:40:09.147903 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:40:09.156828 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:40:09.163998 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:40:09.167578 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:40:09.170458 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:40:09.171075 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:40:09.173588 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:40:09.175493 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:40:09.175493 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:40:09.177507 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:40:09.179458 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:40:09.179458 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:40:09.182369 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:40:09.182369 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:40:09.184902 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:40:11.214445 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.030 seconds
[0m02:40:11.215463 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.035 seconds
[0m02:40:11.271541 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171BC14BD0>]}
[0m02:40:11.272093 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171AA83A90>]}
[0m02:40:11.272093 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 2.23s]
[0m02:40:11.277068 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.24s]
[0m02:40:11.278429 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:40:11.279055 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:40:11.516081 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.333 seconds
[0m02:40:11.516081 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.340 seconds
[0m02:40:11.522642 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171AA83550>]}
[0m02:40:11.524471 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171A504F10>]}
[0m02:40:11.527822 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.49s]
[0m02:40:11.530151 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.49s]
[0m02:40:11.530151 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:40:11.533393 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:40:11.533393 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:40:11.536136 [info ] [Thread-4 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:40:11.538372 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:40:11.538694 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:40:11.544353 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:40:11.544353 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:40:11.555632 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:40:11.561691 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:40:11.561691 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:40:12.419601 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.856 seconds
[0m02:40:12.427104 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171AB6A850>]}
[0m02:40:12.429115 [info ] [Thread-4 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.89s]
[0m02:40:12.431122 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:40:12.433437 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:40:12.434030 [info ] [Thread-5 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:40:12.434030 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:40:12.436958 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:40:12.441178 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:40:12.444534 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:40:12.450606 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:40:12.456313 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:40:12.456313 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:40:13.405389 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.946 seconds
[0m02:40:13.421381 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171A7C9950>]}
[0m02:40:13.424847 [info ] [Thread-5 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 0.99s]
[0m02:40:13.426864 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:40:13.433691 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:40:13.435814 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:40:13.436421 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:40:13.439159 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:40:13.439159 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:40:13.444645 [info ] [Thread-4 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:40:13.449334 [info ] [Thread-2 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:40:13.452674 [info ] [Thread-5 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:40:13.457678 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:40:13.461561 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:40:13.464831 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:40:13.469176 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:40:13.472707 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:40:13.475409 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:40:13.478794 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:40:13.481749 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:40:13.496405 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:40:13.512111 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:40:13.521317 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:40:13.528087 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:40:13.533328 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:40:13.536157 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:40:13.537710 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:40:13.544363 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:40:13.552735 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:40:13.555670 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:40:13.562768 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:40:13.569180 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:40:13.569180 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:40:13.569180 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:40:13.577915 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:40:13.579772 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:40:13.582195 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:40:13.582195 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:40:13.582195 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

with_window_aggregates as (
    select
        trade_id,
        trade_date,
        portfolio_id,
        security_id,
        ticker,
        quantity,
        price,
        price as execution_price,
        trade_value,
        commission,
        round(avg(price) over (partition by trade_date, security_id), 2) as daily_avg_price,
        min(price) over (partition by trade_date, security_id) as daily_min_price,
        max(price) over (partition by trade_date, security_id) as daily_max_price,
        (max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)) as daily_price_range,
        round(stddev_pop(price) over (partition by trade_date, security_id), 4) as daily_volatility,
        round((price - min(price) over (partition by trade_date, security_id)) / nullif((max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)), 0), 8) as execution_percentile
    from trades_detail
)

select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    daily_min_price,
    daily_max_price,
    daily_price_range,
    daily_volatility,
    execution_percentile,
    round(100 * (price - daily_avg_price) / nullif(daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when execution_percentile > 0.75 then 'POOR'
        when execution_percentile > 0.50 then 'FAIR'
        when execution_percentile > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(commission / nullif(trade_value, 0), 8) as commission_ratio,
    round(100 * commission / nullif(trade_value, 0), 6) as commission_ratio_bps
from with_window_aggregates
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:40:13.588850 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:40:14.810979 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.223 seconds
[0m02:40:14.816382 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171AB4C4D0>]}
[0m02:40:14.816382 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.36s]
[0m02:40:14.822119 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:40:14.918977 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.326 seconds
[0m02:40:14.925485 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171AB2E990>]}
[0m02:40:14.929510 [info ] [Thread-4 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.46s]
[0m02:40:14.931524 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:40:15.042123 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.450 seconds
[0m02:40:15.048490 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.451 seconds
[0m02:40:15.048490 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171AB4E490>]}
[0m02:40:15.062265 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171A83FC90>]}
[0m02:40:15.066926 [info ] [Thread-2 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.58s]
[0m02:40:15.069135 [info ] [Thread-5 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.60s]
[0m02:40:15.069135 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:40:15.078267 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:40:15.078267 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:40:15.085240 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:40:15.086339 [info ] [Thread-3 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:40:15.089632 [info ] [Thread-2 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:40:15.089632 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:40:15.094474 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:40:15.097989 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:40:15.100697 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:40:15.108742 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:40:15.116406 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:40:15.116952 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:40:15.128501 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:40:15.130515 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:40:15.138599 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:40:15.140606 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:40:15.140606 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:40:15.142590 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:40:15.145305 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:40:16.079628 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.934 seconds
[0m02:40:16.087691 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002171BC54A50>]}
[0m02:40:16.089850 [info ] [Thread-3 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.00s]
[0m02:40:16.095029 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:40:16.155568 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.006 seconds
[0m02:40:16.162548 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd531867e-d225-4d18-8feb-986625554ae9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021719D01D50>]}
[0m02:40:16.164624 [info ] [Thread-2 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.07s]
[0m02:40:16.166487 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:40:16.166487 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:40:16.166487 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:40:16.171831 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:40:17.313096 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:40:17.315109 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:40:18.235290 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:40:18.237308 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:40:19.200191 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:40:19.200952 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:40:20.284066 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m02:40:20.284066 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m02:40:22.840255 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_summary' was left open.
[0m02:40:22.840255 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m02:40:24.387321 [info ] [MainThread]: 
[0m02:40:24.389444 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 21.52 seconds (21.52s).
[0m02:40:24.397557 [debug] [MainThread]: Command end result
[0m02:40:24.493978 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:40:24.495985 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:40:24.499607 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:40:24.499607 [info ] [MainThread]: 
[0m02:40:24.509263 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:40:24.509263 [info ] [MainThread]: 
[0m02:40:24.510860 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:40:24.512885 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:40:24.514891 [debug] [MainThread]: Command `dbt build` succeeded at 02:40:24.514891 after 25.02 seconds
[0m02:40:24.514891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002170888FB10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021700CE7AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021700CE79D0>]}
[0m02:40:24.514891 [debug] [MainThread]: Flushing usage events
[0m02:40:27.964830 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:41:52.574268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255D812CF50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255D81929D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255D8193990>]}


============================== 02:41:52.579640 | 444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6 ==============================
[0m02:41:52.579640 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:41:52.584373 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m02:41:54.221788 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:41:54.221788 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:41:54.221788 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:41:54.469890 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:41:54.469890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255EA54C910>]}
[0m02:41:54.822534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255EA53FFD0>]}
[0m02:41:55.037045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255EA44EA50>]}
[0m02:41:55.037045 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:41:55.980711 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:41:56.433565 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:41:56.436045 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:41:56.437713 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:41:56.449180 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:41:56.545986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255EAB62050>]}
[0m02:41:56.769545 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:41:56.780832 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:41:56.856548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255EADD1C10>]}
[0m02:41:56.858562 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:41:56.866522 [info ] [MainThread]: 
[0m02:41:56.866522 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:41:56.870283 [info ] [MainThread]: 
[0m02:41:56.870283 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:41:56.880671 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:41:57.077367 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:41:57.077367 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:41:57.077367 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:41:59.971990 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.893 seconds
[0m02:41:59.999719 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:42:00.066059 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:42:00.066059 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:42:00.066059 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:42:02.199847 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.128 seconds
[0m02:42:02.247585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255EB0B0750>]}
[0m02:42:02.257368 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:42:02.257368 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:42:02.257368 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:42:02.265021 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:42:02.267034 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:42:02.269046 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:42:02.271059 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:42:02.272084 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:42:02.292085 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:42:02.306499 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:42:02.311989 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:42:02.329459 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:42:02.390532 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:42:02.402414 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:42:02.412820 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:42:02.416208 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:42:02.416208 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:42:02.420985 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:42:02.422393 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:42:02.422393 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:42:06.010693 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.586 seconds
[0m02:42:06.071494 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255EB0A8A10>]}
[0m02:42:06.071494 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.80s]
[0m02:42:06.071494 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:42:06.076376 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:42:06.076376 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:42:06.076376 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m02:42:06.076376 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:42:06.084473 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:42:06.089195 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:42:06.098348 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:42:06.100992 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:42:06.100992 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:42:06.100992 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:42:06.311054 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.889 seconds
[0m02:42:06.311054 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255EB11E190>]}
[0m02:42:06.311054 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 4.04s]
[0m02:42:06.320782 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:42:06.320782 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:42:06.320782 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:42:06.320782 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m02:42:06.327922 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:42:06.333476 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:42:06.333985 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:42:06.465158 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:42:06.472225 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:42:06.477667 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:42:07.957993 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.479 seconds
[0m02:42:07.972144 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255D799C3D0>]}
[0m02:42:07.977338 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.65s]
[0m02:42:07.979351 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:42:09.591340 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.487 seconds
[0m02:42:09.602417 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '444c5dc1-7d7b-438e-a62d-0bb4abf9b9f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255EB56B3D0>]}
[0m02:42:09.602417 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.53s]
[0m02:42:09.611147 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:42:09.611147 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:42:09.621035 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:42:09.621820 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:42:10.478836 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:42:10.480344 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:42:11.436247 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m02:42:11.439190 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m02:42:12.618118 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:42:12.619146 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:42:14.772404 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:42:14.776441 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:42:15.994144 [info ] [MainThread]: 
[0m02:42:15.996151 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 19.12 seconds (19.12s).
[0m02:42:15.998522 [debug] [MainThread]: Command end result
[0m02:42:16.087023 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:42:16.089002 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:42:16.105097 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:42:16.107107 [info ] [MainThread]: 
[0m02:42:16.110018 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:42:16.111773 [info ] [MainThread]: 
[0m02:42:16.111773 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:42:16.111773 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:42:16.111773 [debug] [MainThread]: Command `dbt build` succeeded at 02:42:16.111773 after 23.70 seconds
[0m02:42:16.119814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255EAAEA5D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255D15179D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255D1517950>]}
[0m02:42:16.120440 [debug] [MainThread]: Flushing usage events
[0m02:42:19.270683 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:43:43.009471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214409AD7D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214409AC8D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214409AE010>]}


============================== 02:43:43.016868 | 8844e577-30ed-4bfa-af2e-5deaff657104 ==============================
[0m02:43:43.016868 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:43:43.019731 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt build --select tag:pipeline_c', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m02:43:44.109028 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:43:44.111043 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:43:44.113050 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:43:44.274647 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:43:44.274647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021452DC7ED0>]}
[0m02:43:44.531010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021452DCEA50>]}
[0m02:43:44.622174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002143F99D010>]}
[0m02:43:44.622174 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:43:45.201571 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:43:45.498318 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:43:45.506739 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:43:45.507839 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:43:45.507839 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:43:45.626699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453188410>]}
[0m02:43:45.837610 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:43:45.853386 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:43:45.916894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453154510>]}
[0m02:43:45.916894 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:43:45.916894 [info ] [MainThread]: 
[0m02:43:45.916894 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:43:45.916894 [info ] [MainThread]: 
[0m02:43:45.916894 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:43:45.937449 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:43:46.060676 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:43:46.060676 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:43:46.060676 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:43:49.742578 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.671 seconds
[0m02:43:49.754126 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:43:49.786931 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:43:49.786931 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:43:49.786931 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:43:51.737122 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 1.946 seconds
[0m02:43:51.793646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021450190110>]}
[0m02:43:51.798675 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:43:51.798675 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:43:51.798675 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:43:51.798675 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:43:51.798675 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m02:43:51.814645 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m02:43:51.816660 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m02:43:51.816660 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m02:43:51.816660 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m02:43:51.816660 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m02:43:51.816660 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m02:43:51.830537 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m02:43:51.831419 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:43:51.831419 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:43:51.831419 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:43:51.831419 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:43:51.865325 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:43:51.874522 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:43:51.874522 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:43:51.881704 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:43:51.886434 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:43:51.887726 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:43:51.889738 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:43:51.929486 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:43:51.929486 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:43:51.937126 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:43:51.940121 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:43:51.940121 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:43:51.940121 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:43:51.940121 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:43:51.940121 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:43:51.953025 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m02:43:51.953025 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:43:51.955766 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m02:43:51.955766 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m02:43:51.955766 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:43:51.955766 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m02:43:51.955766 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:43:51.955766 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:43:51.955766 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:43:54.451968 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.488 seconds
[0m02:43:54.667197 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.709 seconds
[0m02:43:54.680949 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214532BB3D0>]}
[0m02:43:54.680949 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453BCAC90>]}
[0m02:43:54.686068 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 2.85s]
[0m02:43:54.688037 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 2.86s]
[0m02:43:54.690307 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:43:54.693436 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:43:54.693436 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:43:54.696509 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:43:54.698820 [info ] [Thread-5 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m02:43:54.700274 [info ] [Thread-3 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m02:43:54.700274 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m02:43:54.702800 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m02:43:54.703865 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:43:54.703865 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:43:54.712260 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:43:54.720636 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:43:54.724050 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:43:54.732624 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:43:54.733692 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:43:54.742054 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:43:54.743729 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:43:54.745265 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m02:43:54.747501 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:43:54.749507 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m02:43:54.763120 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.804 seconds
[0m02:43:54.764781 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.802 seconds
[0m02:43:54.769074 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002143F490F90>]}
[0m02:43:54.773417 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453D9DC50>]}
[0m02:43:54.775537 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.95s]
[0m02:43:54.777241 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 2.96s]
[0m02:43:54.778345 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:43:54.779987 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:43:55.455646 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.708 seconds
[0m02:43:55.461680 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214533F2F10>]}
[0m02:43:55.464831 [info ] [Thread-5 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.76s]
[0m02:43:55.466840 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:43:55.466840 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:43:55.466840 [info ] [Thread-2 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m02:43:55.469992 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m02:43:55.469992 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:43:55.476002 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:43:55.478019 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:43:55.482044 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:43:55.485815 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:43:55.485815 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

lagged_values as (
    select
        *,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav_usd
    from valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        prev_nav_usd as prev_nav,
        nav_usd - prev_nav_usd as daily_pnl,
        case
            when prev_nav_usd > 0
            then (nav_usd - prev_nav_usd) / prev_nav_usd
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from lagged_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m02:43:55.790789 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.039 seconds
[0m02:43:55.800184 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214536650D0>]}
[0m02:43:55.800184 [info ] [Thread-3 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 1.09s]
[0m02:43:55.804486 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:43:55.804486 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:43:55.804486 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:43:55.804486 [info ] [Thread-5 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m02:43:55.812852 [info ] [Thread-4 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m02:43:55.819580 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m02:43:55.820601 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m02:43:55.820601 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:43:55.825465 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:43:55.836451 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:43:55.849958 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:43:55.851964 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:43:55.858415 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:43:55.860421 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:43:55.860421 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:43:55.868009 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:43:55.868009 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

lagged_position_values as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        prev_value,
        market_value_usd - prev_value as daily_pnl,
        case
            when prev_value > 0
            then (market_value_usd - prev_value) / prev_value
            else 0
        end as daily_return_pct
    from lagged_position_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m02:43:55.868009 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:43:55.868009 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(cast(market_value_usd as numeric(18, 2))) as sector_value,
        sum(cast(quantity as numeric(18, 2))) as total_quantity
    from enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(cast(market_value_usd as numeric(18, 2))) as portfolio_value
    from enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m02:43:56.537510 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.663 seconds
[0m02:43:56.537510 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.056 seconds
[0m02:43:56.544608 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021452EA8090>]}
[0m02:43:56.557570 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002143D3F1150>]}
[0m02:43:56.559587 [info ] [Thread-4 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 0.72s]
[0m02:43:56.564318 [info ] [Thread-2 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 1.09s]
[0m02:43:56.564318 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:43:56.569476 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:43:56.569476 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:43:56.569476 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:43:56.569476 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:43:56.569476 [info ] [Thread-3 (]: 10 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m02:43:56.569476 [info ] [Thread-4 (]: 11 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m02:43:56.569476 [info ] [Thread-2 (]: 12 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m02:43:56.569476 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m02:43:56.585245 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m02:43:56.585245 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m02:43:56.585245 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:43:56.585245 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:43:56.585245 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:43:56.601844 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:43:56.617415 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:43:56.627397 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:43:56.627397 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:43:56.634223 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:43:56.634223 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:43:56.649299 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:43:56.655748 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:43:56.655748 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:43:56.675973 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:43:56.686165 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:43:56.675973 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m02:43:56.686165 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m02:43:56.696917 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:43:56.702172 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m02:43:57.009245 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.133 seconds
[0m02:43:57.013521 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453E455D0>]}
[0m02:43:57.015153 [info ] [Thread-5 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 1.20s]
[0m02:43:57.016723 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:43:57.017812 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:43:57.019416 [info ] [Thread-5 (]: 13 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m02:43:57.020465 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m02:43:57.021519 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:43:57.027769 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:43:57.029484 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:43:57.033245 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:43:57.033245 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:43:57.038423 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m02:43:57.461409 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.759 seconds
[0m02:43:57.473101 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453568890>]}
[0m02:43:57.475115 [info ] [Thread-2 (]: 12 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 0.89s]
[0m02:43:57.477128 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:43:57.480035 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:43:57.482051 [info ] [Thread-2 (]: 14 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m02:43:57.484498 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m02:43:57.486509 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:43:57.492542 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:43:57.494555 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:43:57.504347 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:43:57.508229 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:43:57.508229 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m02:43:57.558618 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.862 seconds
[0m02:43:57.558618 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.863 seconds
[0m02:43:57.558618 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214536234D0>]}
[0m02:43:57.580395 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453BCAD10>]}
[0m02:43:57.582413 [info ] [Thread-3 (]: 10 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 0.99s]
[0m02:43:57.582413 [info ] [Thread-4 (]: 11 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 1.00s]
[0m02:43:57.588421 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:43:57.591549 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:43:57.591549 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:43:57.591549 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:43:57.598122 [info ] [Thread-3 (]: 15 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m02:43:57.598122 [info ] [Thread-4 (]: 16 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m02:43:57.603933 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m02:43:57.603933 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m02:43:57.609118 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:43:57.609118 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:43:57.619687 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:43:57.624225 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:43:57.635691 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:43:57.638319 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:43:57.651396 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:43:57.653405 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:43:57.660774 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:43:57.660774 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m02:43:57.662780 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:43:57.667141 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m02:43:57.797289 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.757 seconds
[0m02:43:57.804340 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021454E755D0>]}
[0m02:43:57.808418 [info ] [Thread-5 (]: 13 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 0.78s]
[0m02:43:57.810461 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:43:57.810461 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:43:57.810461 [info ] [Thread-5 (]: 17 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m02:43:57.810461 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m02:43:57.810461 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:43:57.810461 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:43:57.826101 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:43:57.831439 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:43:57.835450 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:43:57.835450 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m02:43:58.349221 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.837 seconds
[0m02:43:58.352178 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453E70310>]}
[0m02:43:58.352178 [info ] [Thread-2 (]: 14 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 0.87s]
[0m02:43:58.357310 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:43:58.357310 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:43:58.357310 [info ] [Thread-2 (]: 18 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m02:43:58.357310 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m02:43:58.357310 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:43:58.362981 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:43:58.362981 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:43:58.373449 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:43:58.373449 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:43:58.373449 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m02:43:58.590231 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.921 seconds
[0m02:43:58.592818 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.927 seconds
[0m02:43:58.604117 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021454EA55D0>]}
[0m02:43:58.606135 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453BCB990>]}
[0m02:43:58.606135 [info ] [Thread-4 (]: 16 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 0.99s]
[0m02:43:58.617266 [info ] [Thread-3 (]: 15 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 1.00s]
[0m02:43:58.621625 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:43:58.621625 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:43:58.621625 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:43:58.621625 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:43:58.621625 [info ] [Thread-4 (]: 19 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m02:43:58.632432 [info ] [Thread-3 (]: 20 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m02:43:58.635955 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m02:43:58.638186 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m02:43:58.638186 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:43:58.638186 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:43:58.652001 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:43:58.663235 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:43:58.663235 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:43:58.685610 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:43:58.685610 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:43:58.688271 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:43:58.696594 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:43:58.696594 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m02:43:58.701845 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:43:58.704844 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m02:43:58.956501 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.121 seconds
[0m02:43:58.962554 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021454ECB2D0>]}
[0m02:43:58.962554 [info ] [Thread-5 (]: 17 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 1.15s]
[0m02:43:58.970916 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:43:58.970916 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:43:58.970916 [info ] [Thread-5 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m02:43:58.970916 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m02:43:58.970916 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:43:58.986988 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:43:58.986988 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:43:59.004870 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:43:59.006895 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:43:59.006895 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m02:43:59.576839 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.197 seconds
[0m02:43:59.584907 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021452DFA110>]}
[0m02:43:59.584907 [info ] [Thread-2 (]: 18 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 1.23s]
[0m02:43:59.584907 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:43:59.591707 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:43:59.591707 [info ] [Thread-2 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m02:43:59.591707 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m02:43:59.591707 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:43:59.608236 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:43:59.608236 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:43:59.685647 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:43:59.685647 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.988 seconds
[0m02:43:59.702339 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453620110>]}
[0m02:43:59.702339 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:43:59.708665 [info ] [Thread-4 (]: 19 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 1.07s]
[0m02:43:59.710677 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m02:43:59.710677 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:43:59.718342 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:43:59.724348 [info ] [Thread-4 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m02:43:59.725042 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m02:43:59.725042 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:43:59.742735 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:43:59.744751 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:43:59.751987 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:43:59.767011 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:43:59.767011 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m02:43:59.866546 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.159 seconds
[0m02:43:59.866546 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.853 seconds
[0m02:43:59.875812 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021454EFE210>]}
[0m02:43:59.878704 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453164ED0>]}
[0m02:43:59.878704 [info ] [Thread-3 (]: 20 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 1.24s]
[0m02:43:59.878704 [info ] [Thread-5 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 0.91s]
[0m02:43:59.889822 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:43:59.889822 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:43:59.894536 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:43:59.894536 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:43:59.894536 [info ] [Thread-3 (]: 24 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m02:43:59.901821 [info ] [Thread-5 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m02:43:59.901821 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m02:43:59.906296 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m02:43:59.908917 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:43:59.910756 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:43:59.912771 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:43:59.926567 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:43:59.926567 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:43:59.943302 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:43:59.943302 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:43:59.957953 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:43:59.961372 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:43:59.963199 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m02:43:59.965578 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:43:59.965578 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m02:44:00.729975 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.763 seconds
[0m02:44:00.733001 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.960 seconds
[0m02:44:00.741342 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453E54990>]}
[0m02:44:00.743756 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021452DF87D0>]}
[0m02:44:00.749463 [info ] [Thread-3 (]: 24 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 0.84s]
[0m02:44:00.752215 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:44:00.752215 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:44:00.757791 [info ] [Thread-3 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m02:44:00.760444 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_performance_drivers, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m02:44:00.761650 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:44:00.767824 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:44:00.769830 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:44:00.773593 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:44:00.773593 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:44:00.773593 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m02:44:00.920642 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.951 seconds
[0m02:44:00.935118 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021454F50890>]}
[0m02:44:01.554215 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.773 seconds
[0m02:44:01.561979 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021454F31010>]}
[0m02:44:03.256728 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.540 seconds
[0m02:44:03.265184 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8844e577-30ed-4bfa-af2e-5deaff657104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021453D1BB90>]}
[0m02:44:05.556302 [debug] [Thread-4 (]: An error was encountered while trying to send an event
[0m02:44:05.558072 [info ] [Thread-5 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 1.03s]
[0m02:44:05.558072 [info ] [Thread-3 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 0.80s]
[0m02:44:05.558072 [info ] [Thread-2 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 3.67s]
[0m02:44:05.561309 [info ] [Thread-4 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.02s]
[0m02:44:05.561820 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:44:05.565592 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:44:05.567603 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:44:05.570197 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:44:05.573720 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:44:05.575952 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:44:05.575952 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:44:06.533069 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:44:06.535665 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:44:07.842214 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m02:44:07.845677 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m02:44:08.903313 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m02:44:08.903313 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m02:44:10.205362 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_executive_summary' was left open.
[0m02:44:10.209475 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m02:44:11.382759 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_position_attribution' was left open.
[0m02:44:11.385309 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m02:44:12.636810 [info ] [MainThread]: 
[0m02:44:12.636810 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 26.72 seconds (26.72s).
[0m02:44:12.651913 [debug] [MainThread]: Command end result
[0m02:44:12.763120 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:44:12.763120 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:44:12.778923 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:44:12.778923 [info ] [MainThread]: 
[0m02:44:12.778923 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:44:12.778923 [info ] [MainThread]: 
[0m02:44:12.794949 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m02:44:12.794949 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:44:12.794949 [debug] [MainThread]: Command `dbt build` succeeded at 02:44:12.794949 after 30.04 seconds
[0m02:44:12.794949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214409A2550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214409A2910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214531243D0>]}
[0m02:44:12.794949 [debug] [MainThread]: Flushing usage events
[0m02:44:14.792787 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:44:58.946373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002016CB3CC10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002016CB3FA10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002016CB3FF10>]}


============================== 02:44:58.951284 | 7a41f533-22a2-4713-9161-f62d381a36ce ==============================
[0m02:44:58.951284 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:44:58.951284 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_c', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m02:44:59.995275 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:44:59.995275 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:44:59.995275 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:45:00.175810 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:45:00.177856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017C34F850>]}
[0m02:45:00.462141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017F0B45D0>]}
[0m02:45:00.551592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002016BB1D0D0>]}
[0m02:45:00.551592 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:45:01.284280 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:45:01.641260 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:45:01.641260 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:45:01.641260 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:45:01.655726 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:45:01.741011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017F56DD10>]}
[0m02:45:02.005051 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:45:02.010199 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:45:02.082112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017F8719D0>]}
[0m02:45:02.085250 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:45:02.090098 [info ] [MainThread]: 
[0m02:45:02.090098 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:45:02.090098 [info ] [MainThread]: 
[0m02:45:02.090098 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:45:02.105086 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:45:02.295364 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:45:02.295364 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:45:02.295364 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:45:05.412829 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.117 seconds
[0m02:45:05.428442 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:45:05.481654 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:45:05.484561 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:45:05.484920 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:45:08.036484 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.552 seconds
[0m02:45:08.096110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017F51B4D0>]}
[0m02:45:08.108083 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:45:08.108083 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:45:08.110607 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:45:08.111812 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:45:08.111812 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m02:45:08.114906 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m02:45:08.115945 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m02:45:08.117676 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m02:45:08.119192 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m02:45:08.119192 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m02:45:08.121213 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m02:45:08.121213 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m02:45:08.123228 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:45:08.123228 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:45:08.125240 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:45:08.126270 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:45:08.141152 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:45:08.143160 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:45:08.153230 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:45:08.153230 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:45:08.153230 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:45:08.153230 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:45:08.198580 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:45:08.198580 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:45:08.198580 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:45:08.198580 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:45:08.214295 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:45:08.214295 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:45:08.222450 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:45:08.224462 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:45:08.224462 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m02:45:08.226468 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:45:08.228477 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m02:45:08.232122 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:45:08.233891 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:45:08.235911 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m02:45:08.235911 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:45:08.235911 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m02:45:08.240152 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:45:08.240152 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:45:10.834299 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.595 seconds
[0m02:45:10.840855 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.607 seconds
[0m02:45:10.961034 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017F7A9550>]}
[0m02:45:10.961034 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017FEF0AD0>]}
[0m02:45:10.961034 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 2.83s]
[0m02:45:10.961034 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.84s]
[0m02:45:10.961034 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:45:10.961034 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:45:10.961034 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:45:10.961034 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:45:10.961034 [info ] [Thread-5 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m02:45:10.961034 [info ] [Thread-2 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m02:45:10.961034 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m02:45:10.961034 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m02:45:10.961034 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:45:10.961034 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:45:10.977162 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:45:10.983572 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:45:10.983572 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:45:10.992811 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:45:10.992811 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:45:10.992811 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:45:10.992811 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:45:10.992811 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m02:45:10.992811 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:45:10.992811 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m02:45:11.084909 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.842 seconds
[0m02:45:11.088945 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017FF22590>]}
[0m02:45:11.095410 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 2.97s]
[0m02:45:11.095410 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:45:11.381767 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.144 seconds
[0m02:45:11.393441 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017FF29A90>]}
[0m02:45:11.397467 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 3.27s]
[0m02:45:11.403396 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:45:11.673714 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.668 seconds
[0m02:45:11.679089 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017FF2A710>]}
[0m02:45:11.684322 [info ] [Thread-5 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.72s]
[0m02:45:11.688255 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:45:11.690269 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:45:11.692790 [info ] [Thread-4 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m02:45:11.694804 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m02:45:11.694804 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:45:11.694804 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:45:11.711664 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:45:11.711664 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:45:11.726488 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:45:11.726488 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

lagged_values as (
    select
        *,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav_usd
    from valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        prev_nav_usd as prev_nav,
        nav_usd - prev_nav_usd as daily_pnl,
        case
            when prev_nav_usd > 0
            then (nav_usd - prev_nav_usd) / prev_nav_usd
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from lagged_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m02:45:12.094104 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.088 seconds
[0m02:45:12.094104 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017F8B5490>]}
[0m02:45:12.094104 [info ] [Thread-2 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 1.13s]
[0m02:45:12.109411 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:45:12.109411 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:45:12.109411 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:45:12.109411 [info ] [Thread-5 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m02:45:12.119635 [info ] [Thread-3 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m02:45:12.119635 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m02:45:12.125409 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m02:45:12.125409 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:45:12.125409 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:45:12.136561 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:45:12.141278 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:45:12.157264 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:45:12.158437 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:45:12.161861 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:45:12.173316 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:45:12.173316 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:45:12.183505 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:45:12.183505 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

lagged_position_values as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        prev_value,
        market_value_usd - prev_value as daily_pnl,
        case
            when prev_value > 0
            then (market_value_usd - prev_value) / prev_value
            else 0
        end as daily_return_pct
    from lagged_position_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m02:45:12.183505 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(cast(market_value_usd as numeric(18, 2))) as sector_value,
        sum(cast(quantity as numeric(18, 2))) as total_quantity
    from enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(cast(market_value_usd as numeric(18, 2))) as portfolio_value
    from enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m02:45:12.788901 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.062 seconds
[0m02:45:12.788901 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017FDFBF50>]}
[0m02:45:12.788901 [info ] [Thread-4 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 1.09s]
[0m02:45:12.804684 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:45:12.804684 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:45:12.804684 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:45:12.804684 [info ] [Thread-2 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m02:45:12.804684 [info ] [Thread-4 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m02:45:12.804684 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m02:45:12.804684 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m02:45:12.820703 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:45:12.820703 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:45:12.834719 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:45:12.847731 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:45:12.852253 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:45:12.861457 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:45:12.868918 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:45:12.868918 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:45:12.887980 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:45:12.889990 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m02:45:12.893050 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:45:12.900757 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m02:45:13.046096 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.855 seconds
[0m02:45:13.046096 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017F061550>]}
[0m02:45:13.046096 [info ] [Thread-3 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 0.93s]
[0m02:45:13.059035 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:45:13.059035 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:45:13.059035 [info ] [Thread-3 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m02:45:13.059035 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m02:45:13.059035 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:45:13.075207 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:45:13.075207 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:45:13.091044 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:45:13.091044 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:45:13.097653 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m02:45:13.409503 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.220 seconds
[0m02:45:13.420418 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020169731110>]}
[0m02:45:13.423614 [info ] [Thread-5 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 1.30s]
[0m02:45:13.426150 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:45:13.428170 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:45:13.432210 [info ] [Thread-5 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m02:45:13.434229 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m02:45:13.437024 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:45:13.453228 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:45:13.455910 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:45:13.471582 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:45:13.483145 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:45:13.486325 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m02:45:13.706562 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.802 seconds
[0m02:45:13.712451 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017F081ED0>]}
[0m02:45:13.714058 [info ] [Thread-4 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 0.91s]
[0m02:45:13.715656 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:45:13.716183 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:45:13.717284 [info ] [Thread-4 (]: 14 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m02:45:13.719138 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m02:45:13.720222 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:45:13.727591 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:45:13.729599 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:45:13.736806 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:45:13.740794 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:45:13.742802 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m02:45:13.939599 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.043 seconds
[0m02:45:13.939599 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.845 seconds
[0m02:45:13.951676 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010000CA50>]}
[0m02:45:13.953185 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017C6A1B90>]}
[0m02:45:13.953185 [info ] [Thread-2 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 1.14s]
[0m02:45:13.953185 [info ] [Thread-3 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 0.89s]
[0m02:45:13.969151 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:45:13.970395 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:45:13.970395 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:45:13.976052 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:45:13.976560 [info ] [Thread-2 (]: 15 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m02:45:13.976560 [info ] [Thread-3 (]: 16 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m02:45:13.976560 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m02:45:13.976560 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m02:45:13.976560 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:45:13.985190 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:45:13.991075 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:45:13.994562 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:45:14.000882 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:45:14.000882 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:45:14.000882 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:45:14.020694 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:45:14.025370 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:45:14.032800 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m02:45:14.037361 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:45:14.042384 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m02:45:14.519997 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.032 seconds
[0m02:45:14.523584 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201000080D0>]}
[0m02:45:14.527214 [info ] [Thread-5 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 1.09s]
[0m02:45:14.527720 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:45:14.529647 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:45:14.529647 [info ] [Thread-5 (]: 17 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m02:45:14.529647 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m02:45:14.532187 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:45:14.536191 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:45:14.538917 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:45:14.547640 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:45:14.551528 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:45:14.552811 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m02:45:14.573068 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.829 seconds
[0m02:45:14.574003 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020169680B50>]}
[0m02:45:14.578616 [info ] [Thread-4 (]: 14 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 0.86s]
[0m02:45:14.578616 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:45:14.580252 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:45:14.580252 [info ] [Thread-4 (]: 18 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m02:45:14.580252 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m02:45:14.584306 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:45:14.587977 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:45:14.587977 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:45:14.596189 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:45:14.596189 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:45:14.596189 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m02:45:14.851924 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.813 seconds
[0m02:45:14.862966 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010111D450>]}
[0m02:45:14.862966 [info ] [Thread-2 (]: 15 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 0.89s]
[0m02:45:14.867096 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:45:14.867096 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:45:14.867096 [info ] [Thread-2 (]: 19 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m02:45:14.873176 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m02:45:14.873545 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:45:14.875382 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:45:14.884335 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:45:14.895549 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:45:14.901133 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:45:14.901133 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m02:45:15.140082 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.092 seconds
[0m02:45:15.140082 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017FDE2E50>]}
[0m02:45:15.152789 [info ] [Thread-3 (]: 16 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 1.16s]
[0m02:45:15.153804 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:45:15.157252 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:45:15.159267 [info ] [Thread-3 (]: 20 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m02:45:15.161877 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m02:45:15.161877 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:45:15.169541 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:45:15.169541 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:45:15.191345 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:45:15.201428 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:45:15.201428 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m02:45:15.307769 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.756 seconds
[0m02:45:15.317789 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017F8ABCD0>]}
[0m02:45:15.317789 [info ] [Thread-5 (]: 17 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 0.79s]
[0m02:45:15.324129 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:45:15.326673 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:45:15.329513 [info ] [Thread-5 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m02:45:15.332192 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m02:45:15.334860 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:45:15.340078 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:45:15.351875 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:45:15.360911 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:45:15.368017 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:45:15.368017 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m02:45:15.375937 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.774 seconds
[0m02:45:15.384470 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020101129ED0>]}
[0m02:45:15.388606 [info ] [Thread-4 (]: 18 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 0.80s]
[0m02:45:15.390224 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:45:15.392235 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:45:15.392235 [info ] [Thread-4 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m02:45:15.395247 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m02:45:15.395247 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:45:15.395247 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:45:15.406889 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:45:15.452650 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:45:15.452650 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:45:15.461025 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m02:45:16.068456 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.166 seconds
[0m02:45:16.077937 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201000E6890>]}
[0m02:45:16.079951 [info ] [Thread-2 (]: 19 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 1.21s]
[0m02:45:16.081964 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:45:16.081964 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:45:16.081964 [info ] [Thread-2 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m02:45:16.081964 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m02:45:16.081964 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:45:16.098908 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:45:16.101030 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:45:16.106616 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:45:16.117844 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:45:16.117844 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m02:45:16.204171 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.996 seconds
[0m02:45:16.206878 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201011D1710>]}
[0m02:45:16.206878 [info ] [Thread-3 (]: 20 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 1.05s]
[0m02:45:16.206878 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:45:16.206878 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:45:16.206878 [info ] [Thread-3 (]: 24 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m02:45:16.206878 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m02:45:16.206878 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:45:16.218936 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:45:16.218936 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:45:16.218936 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:45:16.218936 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:45:16.218936 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m02:45:16.297548 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.922 seconds
[0m02:45:16.297548 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017FF23210>]}
[0m02:45:16.297548 [info ] [Thread-5 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 0.97s]
[0m02:45:16.297548 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:45:16.297548 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:45:16.313860 [info ] [Thread-5 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m02:45:16.314986 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m02:45:16.315739 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:45:16.321810 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:45:16.323821 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:45:16.330170 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:45:16.332187 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:45:16.332187 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m02:45:17.006784 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.888 seconds
[0m02:45:17.006784 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020101191550>]}
[0m02:45:17.021613 [info ] [Thread-2 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 0.92s]
[0m02:45:17.022551 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:45:17.022551 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:45:17.022551 [info ] [Thread-2 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m02:45:17.030023 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_executive_summary, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m02:45:17.032039 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:45:17.043196 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:45:17.045206 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:45:17.052968 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:45:17.052968 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:45:17.052968 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m02:45:17.117411 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.885 seconds
[0m02:45:17.123445 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002017FDF13D0>]}
[0m02:45:17.212256 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.750 seconds
[0m02:45:17.219594 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010000C690>]}
[0m02:45:17.389121 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.056 seconds
[0m02:45:17.396185 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201011EBA10>]}
[0m02:45:17.953853 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.898 seconds
[0m02:45:17.963713 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a41f533-22a2-4713-9161-f62d381a36ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201011EBC90>]}
[0m02:45:21.058603 [debug] [Thread-3 (]: An error was encountered while trying to send an event
[0m02:45:21.058603 [info ] [Thread-4 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 1.82s]
[0m02:45:21.058603 [info ] [Thread-5 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 1.08s]
[0m02:45:21.062693 [info ] [Thread-2 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 0.93s]
[0m02:45:21.064331 [info ] [Thread-3 (]: 24 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 0.92s]
[0m02:45:21.064331 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:45:21.066372 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:45:21.068377 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:45:21.068377 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:45:21.076804 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:45:21.076804 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:45:21.079785 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:45:21.970029 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:45:21.970029 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:45:24.009964 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m02:45:24.011977 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m02:45:25.442820 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_performance_drivers' was left open.
[0m02:45:25.445821 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m02:45:26.608570 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m02:45:26.608570 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m02:45:27.900055 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_position_attribution' was left open.
[0m02:45:27.902065 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m02:45:29.255157 [info ] [MainThread]: 
[0m02:45:29.257166 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 27.17 seconds (27.17s).
[0m02:45:29.261189 [debug] [MainThread]: Command end result
[0m02:45:29.322705 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:45:29.330960 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:45:29.340227 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:45:29.342348 [info ] [MainThread]: 
[0m02:45:29.344810 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:45:29.344810 [info ] [MainThread]: 
[0m02:45:29.344810 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m02:45:29.344810 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:45:29.350642 [debug] [MainThread]: Command `dbt build` succeeded at 02:45:29.350642 after 30.51 seconds
[0m02:45:29.350642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002016CB32C50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002016CB31990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002016CB32610>]}
[0m02:45:29.350642 [debug] [MainThread]: Flushing usage events
[0m02:45:31.797737 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:46:28.365562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020142D4C890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020142D3F890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020142D4D4D0>]}


============================== 02:46:28.372348 | 494f5be4-0b8c-458e-9224-495502201838 ==============================
[0m02:46:28.372348 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:46:28.375596 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_c', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m02:46:29.734879 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:46:29.734879 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:46:29.734879 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:46:29.933181 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:46:29.933181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002015516C250>]}
[0m02:46:30.205364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020155174E90>]}
[0m02:46:30.322107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020141D3D150>]}
[0m02:46:30.322107 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:46:31.051137 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:46:31.454288 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:46:31.454288 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:46:31.454288 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:46:31.465126 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:46:31.549788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002015523F190>]}
[0m02:46:31.794160 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:46:31.802533 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:46:31.964832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201559F1510>]}
[0m02:46:31.968852 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:46:31.990960 [info ] [MainThread]: 
[0m02:46:31.994235 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:46:31.994235 [info ] [MainThread]: 
[0m02:46:31.997164 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:46:32.018415 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:46:32.177849 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:46:32.181834 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:46:32.183124 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:46:35.524353 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.346 seconds
[0m02:46:35.541247 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:46:35.571411 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:46:35.587995 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:46:35.587995 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:46:37.942200 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.353 seconds
[0m02:46:37.974356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020155F57A10>]}
[0m02:46:37.974356 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:46:37.983116 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:46:37.984268 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:46:37.984268 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:46:37.986372 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m02:46:37.988379 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m02:46:37.988379 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m02:46:37.988379 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m02:46:37.992151 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m02:46:37.993894 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m02:46:37.995418 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m02:46:37.995418 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m02:46:37.995418 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:46:37.995418 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:46:37.995418 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:46:37.995418 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:46:38.021348 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:46:38.028796 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:46:38.037098 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:46:38.045055 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:46:38.045055 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:46:38.049611 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:46:38.051633 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:46:38.094310 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:46:38.113511 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:46:38.125998 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:46:38.136328 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:46:38.150160 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:46:38.155556 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:46:38.157562 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:46:38.161016 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:46:38.164155 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:46:38.164155 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m02:46:38.164155 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m02:46:38.164155 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m02:46:38.164155 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m02:46:38.173190 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:46:38.175328 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:46:38.175328 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:46:38.175328 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:46:40.405731 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.228 seconds
[0m02:46:40.551372 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020155A17110>]}
[0m02:46:40.551372 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 2.55s]
[0m02:46:40.555944 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:46:40.557061 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:46:40.558460 [info ] [Thread-5 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m02:46:40.558460 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m02:46:40.560866 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:46:40.564131 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:46:40.564131 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:46:40.573207 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:46:40.573207 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:46:40.579964 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m02:46:40.640724 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.464 seconds
[0m02:46:40.643940 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020155F44650>]}
[0m02:46:40.645946 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 2.65s]
[0m02:46:40.645946 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:46:40.647951 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:46:40.647951 [info ] [Thread-4 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m02:46:40.649655 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m02:46:40.651077 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:46:40.656279 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:46:40.658287 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:46:40.662742 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:46:40.670404 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:46:40.672106 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m02:46:40.737684 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.566 seconds
[0m02:46:40.737684 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020155CC9F90>]}
[0m02:46:40.737684 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.75s]
[0m02:46:40.737684 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:46:40.960558 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.786 seconds
[0m02:46:40.966580 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020142D4C9D0>]}
[0m02:46:40.966580 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 2.97s]
[0m02:46:40.966580 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:46:41.269829 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.690 seconds
[0m02:46:41.275760 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002015523DF10>]}
[0m02:46:41.277767 [info ] [Thread-5 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.72s]
[0m02:46:41.277767 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:46:41.279774 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:46:41.280768 [info ] [Thread-2 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m02:46:41.280768 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m02:46:41.280768 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:46:41.285901 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:46:41.285901 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:46:41.292408 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:46:41.301739 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:46:41.303744 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

lagged_values as (
    select
        *,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav_usd
    from valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        prev_nav_usd as prev_nav,
        nav_usd - prev_nav_usd as daily_pnl,
        case
            when prev_nav_usd > 0
            then (nav_usd - prev_nav_usd) / prev_nav_usd
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from lagged_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m02:46:41.575860 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.902 seconds
[0m02:46:41.581909 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020156035C90>]}
[0m02:46:41.585189 [info ] [Thread-4 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 0.93s]
[0m02:46:41.586959 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:46:41.588965 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:46:41.588965 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:46:41.590973 [info ] [Thread-5 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m02:46:41.592979 [info ] [Thread-3 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m02:46:41.594030 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m02:46:41.596263 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m02:46:41.598275 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:46:41.600492 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:46:41.610754 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:46:41.624335 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:46:41.628083 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:46:41.630093 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:46:41.638538 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:46:41.685132 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:46:41.688006 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:46:41.688006 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

lagged_position_values as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        prev_value,
        market_value_usd - prev_value as daily_pnl,
        case
            when prev_value > 0
            then (market_value_usd - prev_value) / prev_value
            else 0
        end as daily_return_pct
    from lagged_position_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m02:46:41.694128 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:46:41.695650 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(cast(market_value_usd as numeric(18, 2))) as sector_value,
        sum(cast(quantity as numeric(18, 2))) as total_quantity
    from enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(cast(market_value_usd as numeric(18, 2))) as portfolio_value
    from enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m02:46:42.098448 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.793 seconds
[0m02:46:42.102934 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020142BA3410>]}
[0m02:46:42.103996 [info ] [Thread-2 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 0.82s]
[0m02:46:42.105380 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:46:42.108797 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:46:42.109893 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:46:42.111007 [info ] [Thread-4 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m02:46:42.111007 [info ] [Thread-2 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m02:46:42.111007 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m02:46:42.111007 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m02:46:42.111007 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:46:42.116413 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:46:42.117769 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:46:42.128787 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:46:42.128787 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:46:42.138634 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:46:42.140001 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:46:42.151116 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:46:42.156511 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:46:42.156511 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m02:46:42.160769 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:46:42.162443 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m02:46:42.484851 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.795 seconds
[0m02:46:42.484851 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020155F49490>]}
[0m02:46:42.484851 [info ] [Thread-5 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 0.89s]
[0m02:46:42.484851 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:46:42.499392 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:46:42.499392 [info ] [Thread-5 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m02:46:42.499392 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m02:46:42.506869 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:46:42.525004 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:46:42.527028 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:46:42.537796 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:46:42.546427 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:46:42.546427 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m02:46:42.909589 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.748 seconds
[0m02:46:42.909589 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.213 seconds
[0m02:46:42.918279 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201561E8FD0>]}
[0m02:46:42.921688 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002015524D610>]}
[0m02:46:42.921688 [info ] [Thread-4 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 0.81s]
[0m02:46:42.927292 [info ] [Thread-3 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 1.33s]
[0m02:46:42.927292 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:46:42.931648 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:46:42.931648 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:46:42.934532 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:46:42.936166 [info ] [Thread-4 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m02:46:42.936166 [info ] [Thread-3 (]: 14 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m02:46:42.938681 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m02:46:42.941461 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m02:46:42.941461 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:46:42.941461 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:46:42.953940 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:46:42.955447 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.789 seconds
[0m02:46:42.964421 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:46:42.969556 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020155F7E4D0>]}
[0m02:46:42.969556 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:46:42.974164 [info ] [Thread-2 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 0.86s]
[0m02:46:42.974164 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:46:42.985123 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:46:42.987132 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:46:42.994735 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:46:42.996133 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:46:43.002574 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:46:43.002574 [info ] [Thread-2 (]: 15 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m02:46:43.006458 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:46:43.006458 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m02:46:43.006458 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m02:46:43.006458 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m02:46:43.006458 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:46:43.024561 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:46:43.031368 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:46:43.039356 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:46:43.044040 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:46:43.047746 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m02:46:43.986969 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.973 seconds
[0m02:46:43.989683 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.941 seconds
[0m02:46:43.989683 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.979 seconds
[0m02:46:43.992199 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.440 seconds
[0m02:46:44.000068 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201561728D0>]}
[0m02:46:44.010342 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020157228810>]}
[0m02:46:44.018943 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002015722A910>]}
[0m02:46:44.021662 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020156219F50>]}
[0m02:46:44.025733 [info ] [Thread-3 (]: 14 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 1.06s]
[0m02:46:44.027335 [info ] [Thread-2 (]: 15 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 1.00s]
[0m02:46:44.030293 [info ] [Thread-4 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 1.08s]
[0m02:46:44.031608 [info ] [Thread-5 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 1.52s]
[0m02:46:44.033310 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:46:44.034906 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:46:44.035958 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:46:44.037020 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:46:44.038445 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:46:44.040723 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:46:44.042094 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:46:44.043624 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:46:44.045001 [info ] [Thread-3 (]: 16 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m02:46:44.046061 [info ] [Thread-2 (]: 17 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m02:46:44.047425 [info ] [Thread-4 (]: 18 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m02:46:44.049195 [info ] [Thread-5 (]: 19 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m02:46:44.051361 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m02:46:44.053781 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m02:46:44.055373 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m02:46:44.056975 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m02:46:44.058036 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:46:44.059628 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:46:44.061766 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:46:44.064153 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:46:44.073906 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:46:44.086886 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:46:44.097083 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:46:44.108880 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:46:44.109524 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:46:44.111537 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:46:44.113355 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:46:44.113826 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:46:44.121749 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:46:44.129741 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:46:44.138940 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:46:44.148694 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:46:44.150638 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:46:44.160605 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:46:44.165786 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:46:44.165786 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m02:46:44.169593 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:46:44.171709 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m02:46:44.173643 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m02:46:44.173643 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m02:46:45.032650 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.857 seconds
[0m02:46:45.032650 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.863 seconds
[0m02:46:45.041037 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020157263F50>]}
[0m02:46:45.049425 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201559F9190>]}
[0m02:46:45.049425 [info ] [Thread-2 (]: 17 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 0.99s]
[0m02:46:45.049425 [info ] [Thread-3 (]: 16 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 1.00s]
[0m02:46:45.058463 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:46:45.058463 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:46:45.060821 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:46:45.064737 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:46:45.065061 [info ] [Thread-2 (]: 20 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m02:46:45.067632 [info ] [Thread-3 (]: 21 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m02:46:45.067632 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m02:46:45.071837 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m02:46:45.073555 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:46:45.073555 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:46:45.081728 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:46:45.089758 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:46:45.089758 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:46:45.089758 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:46:45.097885 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:46:45.097885 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.919 seconds
[0m02:46:45.108586 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:46:45.110761 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002015722B990>]}
[0m02:46:45.110761 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:46:45.116204 [info ] [Thread-4 (]: 18 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 1.06s]
[0m02:46:45.117528 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m02:46:45.118342 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:46:45.119428 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:46:45.120239 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m02:46:45.120239 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:46:45.124446 [info ] [Thread-4 (]: 22 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m02:46:45.125050 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m02:46:45.127793 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:46:45.132512 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:46:45.132512 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:46:45.139050 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:46:45.141076 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:46:45.141076 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m02:46:45.318403 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.131 seconds
[0m02:46:45.327557 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002015722B0D0>]}
[0m02:46:45.333364 [info ] [Thread-5 (]: 19 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 1.27s]
[0m02:46:45.336672 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:46:45.339287 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:46:45.339287 [info ] [Thread-5 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m02:46:45.342582 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m02:46:45.343877 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:46:45.350333 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:46:45.350333 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:46:45.367300 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:46:45.376100 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:46:45.380256 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m02:46:45.742185 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.622 seconds
[0m02:46:45.750729 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201572B4510>]}
[0m02:46:45.750729 [info ] [Thread-2 (]: 20 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 0.68s]
[0m02:46:45.754441 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:46:45.754441 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:46:45.760813 [info ] [Thread-2 (]: 24 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m02:46:45.762899 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m02:46:45.762899 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:46:45.779261 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:46:45.785994 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:46:45.861209 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:46:45.861209 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:46:45.869383 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m02:46:46.066293 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.942 seconds
[0m02:46:46.073734 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020156041750>]}
[0m02:46:46.075750 [info ] [Thread-3 (]: 21 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 1.00s]
[0m02:46:46.079478 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:46:46.081150 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:46:46.083375 [info ] [Thread-3 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m02:46:46.087920 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m02:46:46.087920 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:46:46.096377 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:46:46.104781 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:46:46.120248 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:46:46.124271 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:46:46.126280 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m02:46:46.256161 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.115 seconds
[0m02:46:46.261444 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.879 seconds
[0m02:46:46.269960 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201572B7B50>]}
[0m02:46:46.277547 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002015523CF10>]}
[0m02:46:46.279902 [info ] [Thread-4 (]: 22 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 1.14s]
[0m02:46:46.282916 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:46:46.284714 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:46:46.285720 [info ] [Thread-4 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m02:46:46.289752 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_performance_drivers, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m02:46:46.290894 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:46:46.298984 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:46:46.300993 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:46:46.308397 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:46:46.312069 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:46:46.313258 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m02:46:46.951921 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.824 seconds
[0m02:46:46.960640 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020156172150>]}
[0m02:46:47.230118 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.916 seconds
[0m02:46:47.235909 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201561381D0>]}
[0m02:46:47.851330 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.979 seconds
[0m02:46:47.857432 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '494f5be4-0b8c-458e-9224-495502201838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002014250E110>]}
[0m02:46:49.600021 [debug] [Thread-5 (]: An error was encountered while trying to send an event
[0m02:46:49.601159 [info ] [Thread-3 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 0.87s]
[0m02:46:49.601787 [info ] [Thread-4 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 0.95s]
[0m02:46:49.602849 [info ] [Thread-2 (]: 24 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 2.09s]
[0m02:46:49.604029 [info ] [Thread-5 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 0.93s]
[0m02:46:49.605067 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:46:49.605067 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:46:49.605067 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:46:49.608260 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:46:49.608260 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:46:49.608260 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:46:49.612862 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:46:50.783812 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:46:50.785387 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:46:52.280126 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m02:46:52.280126 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m02:46:53.505568 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_position_attribution' was left open.
[0m02:46:53.505568 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m02:46:54.440184 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m02:46:54.443086 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m02:46:55.382823 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_executive_summary' was left open.
[0m02:46:55.382823 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m02:46:56.276191 [info ] [MainThread]: 
[0m02:46:56.277123 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 24.28 seconds (24.28s).
[0m02:46:56.292285 [debug] [MainThread]: Command end result
[0m02:46:56.404778 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:46:56.418458 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:46:56.435751 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:46:56.437571 [info ] [MainThread]: 
[0m02:46:56.439560 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:46:56.439560 [info ] [MainThread]: 
[0m02:46:56.441308 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m02:46:56.441308 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:46:56.444276 [debug] [MainThread]: Command `dbt build` succeeded at 02:46:56.444276 after 28.28 seconds
[0m02:46:56.444276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002013C187950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002013C1879D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002013C187A90>]}
[0m02:46:56.446016 [debug] [MainThread]: Flushing usage events
[0m02:46:58.339885 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:50:27.113859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA2D7EC490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA2D7EE390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA2D7ED750>]}


============================== 02:50:27.117237 | 6bbfeb00-b724-43ed-875f-9320069e8569 ==============================
[0m02:50:27.117237 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:50:27.118246 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_c', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m02:50:27.762299 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:50:27.762299 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:50:27.762299 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:50:27.889337 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:50:27.889337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3EB6A610>]}
[0m02:50:28.040968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3EC9D390>]}
[0m02:50:28.102646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA2B7FD110>]}
[0m02:50:28.103087 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:50:28.467229 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:50:28.749160 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:50:28.749160 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:50:28.749160 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:50:28.761518 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:50:28.820654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3F0EAD90>]}
[0m02:50:28.953897 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:50:28.960024 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:50:29.016897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3EF8FC50>]}
[0m02:50:29.018895 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:50:29.022783 [info ] [MainThread]: 
[0m02:50:29.023783 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:50:29.026030 [info ] [MainThread]: 
[0m02:50:29.027720 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:50:29.034468 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:50:29.133267 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:50:29.134355 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:50:29.136261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:50:32.425318 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.294 seconds
[0m02:50:32.425318 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:50:32.449077 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:50:32.449077 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:50:32.449077 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:50:34.148840 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 1.702 seconds
[0m02:50:34.166962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FA26F10>]}
[0m02:50:34.166962 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:50:34.166962 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:50:34.166962 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:50:34.166962 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m02:50:34.166962 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:50:34.166962 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m02:50:34.166962 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m02:50:34.166962 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m02:50:34.166962 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m02:50:34.166962 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m02:50:34.178177 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m02:50:34.178177 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:50:34.178177 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m02:50:34.178177 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:50:34.178177 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:50:34.178177 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:50:34.178177 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:50:34.178177 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:50:34.194379 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:50:34.194379 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:50:34.194379 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:50:34.194379 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:50:34.202113 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:50:34.224416 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:50:34.224416 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:50:34.228850 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:50:34.230858 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:50:34.232865 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:50:34.232865 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:50:34.232865 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:50:34.232865 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m02:50:34.232865 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:50:34.232865 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m02:50:34.232865 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:50:34.242118 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:50:34.242118 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m02:50:34.242118 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:50:34.242118 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m02:50:34.242118 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:50:34.242118 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:50:36.407693 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.161 seconds
[0m02:50:36.490482 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3ED0D450>]}
[0m02:50:36.490482 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 2.31s]
[0m02:50:36.490482 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:50:36.490482 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:50:36.490482 [info ] [Thread-5 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m02:50:36.490482 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m02:50:36.506071 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:50:36.508077 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:50:36.510083 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:50:36.510083 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:50:36.510083 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:50:36.510083 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m02:50:36.906659 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.666 seconds
[0m02:50:36.906659 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.670 seconds
[0m02:50:36.915505 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.669 seconds
[0m02:50:36.915505 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FA209D0>]}
[0m02:50:36.922864 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3F4F6290>]}
[0m02:50:36.922864 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FA13950>]}
[0m02:50:36.922864 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 2.75s]
[0m02:50:36.922864 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.76s]
[0m02:50:36.922864 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 2.74s]
[0m02:50:36.922864 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:50:36.922864 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:50:36.922864 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:50:36.922864 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:50:36.922864 [info ] [Thread-3 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m02:50:36.922864 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m02:50:36.922864 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:50:36.938768 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:50:36.938768 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:50:36.938768 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:50:36.938768 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:50:36.938768 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m02:50:37.195084 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.682 seconds
[0m02:50:37.195084 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3ED5C090>]}
[0m02:50:37.195084 [info ] [Thread-5 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.70s]
[0m02:50:37.195084 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:50:37.195084 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:50:37.195084 [info ] [Thread-2 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m02:50:37.195084 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m02:50:37.195084 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:50:37.195084 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:50:37.210952 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:50:37.212479 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:50:37.212479 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:50:37.212479 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

lagged_values as (
    select
        *,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav_usd
    from valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        prev_nav_usd as prev_nav,
        nav_usd - prev_nav_usd as daily_pnl,
        case
            when prev_nav_usd > 0
            then (nav_usd - prev_nav_usd) / prev_nav_usd
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from lagged_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m02:50:37.798592 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.853 seconds
[0m02:50:37.804630 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3F804890>]}
[0m02:50:37.804630 [info ] [Thread-3 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 0.88s]
[0m02:50:37.804630 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:50:37.804630 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:50:37.804630 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:50:37.804630 [info ] [Thread-5 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m02:50:37.804630 [info ] [Thread-4 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m02:50:37.809518 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m02:50:37.809518 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m02:50:37.811527 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:50:37.811527 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:50:37.815900 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:50:37.819919 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:50:37.821929 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:50:37.823942 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:50:37.827066 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:50:37.831751 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:50:37.831751 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:50:37.833762 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

lagged_position_values as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        prev_value,
        market_value_usd - prev_value as daily_pnl,
        case
            when prev_value > 0
            then (market_value_usd - prev_value) / prev_value
            else 0
        end as daily_return_pct
    from lagged_position_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m02:50:37.835772 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:50:37.837783 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(cast(market_value_usd as numeric(18, 2))) as sector_value,
        sum(cast(quantity as numeric(18, 2))) as total_quantity
    from enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(cast(market_value_usd as numeric(18, 2))) as portfolio_value
    from enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m02:50:38.084457 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.863 seconds
[0m02:50:38.089004 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA2BF7FE10>]}
[0m02:50:38.089004 [info ] [Thread-2 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 0.89s]
[0m02:50:38.089004 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:50:38.089004 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:50:38.089004 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:50:38.089004 [info ] [Thread-3 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m02:50:38.089004 [info ] [Thread-2 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m02:50:38.089004 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m02:50:38.089004 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m02:50:38.089004 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:50:38.089004 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:50:38.102839 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:50:38.106124 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:50:38.106124 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:50:38.110144 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:50:38.110144 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:50:38.114166 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:50:38.115988 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:50:38.115988 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m02:50:38.115988 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:50:38.115988 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m02:50:38.580029 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.743 seconds
[0m02:50:38.589220 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FA08890>]}
[0m02:50:38.589858 [info ] [Thread-4 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 0.77s]
[0m02:50:38.589858 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:50:38.589858 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:50:38.589858 [info ] [Thread-4 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m02:50:38.589858 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m02:50:38.589858 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:50:38.594876 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:50:38.594876 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:50:38.594876 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:50:38.594876 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:50:38.594876 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m02:50:38.645267 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.808 seconds
[0m02:50:38.647277 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FC2B110>]}
[0m02:50:38.649282 [info ] [Thread-5 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 0.84s]
[0m02:50:38.649282 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:50:38.649282 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:50:38.649282 [info ] [Thread-5 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m02:50:38.649282 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m02:50:38.649282 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:50:38.649282 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:50:38.649282 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:50:38.658945 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:50:38.658945 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:50:38.658945 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m02:50:38.817712 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.698 seconds
[0m02:50:38.817712 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FCA9B50>]}
[0m02:50:38.817712 [info ] [Thread-2 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 0.73s]
[0m02:50:38.817712 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:50:38.817712 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:50:38.817712 [info ] [Thread-2 (]: 14 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m02:50:38.817712 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m02:50:38.817712 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:50:38.833570 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:50:38.833570 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:50:38.833570 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:50:38.833570 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:50:38.833570 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m02:50:38.897715 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.781 seconds
[0m02:50:38.897715 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FB0B390>]}
[0m02:50:38.897715 [info ] [Thread-3 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 0.81s]
[0m02:50:38.897715 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:50:38.897715 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:50:38.897715 [info ] [Thread-3 (]: 15 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m02:50:38.897715 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m02:50:38.897715 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:50:38.913871 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:50:38.913871 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:50:38.913871 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:50:38.913871 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:50:38.913871 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m02:50:39.426540 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.822 seconds
[0m02:50:39.426540 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA40D16AD0>]}
[0m02:50:39.426540 [info ] [Thread-4 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 0.84s]
[0m02:50:39.426540 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:50:39.426540 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:50:39.436833 [info ] [Thread-4 (]: 16 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m02:50:39.436833 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m02:50:39.438839 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:50:39.445637 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:50:39.447423 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:50:39.448527 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:50:39.457750 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:50:39.458964 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m02:50:39.648992 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.985 seconds
[0m02:50:39.648992 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3F492850>]}
[0m02:50:39.648992 [info ] [Thread-5 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 1.00s]
[0m02:50:39.648992 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:50:39.663438 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:50:39.663438 [info ] [Thread-5 (]: 17 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m02:50:39.663438 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m02:50:39.663438 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:50:39.663438 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:50:39.663438 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:50:39.680557 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:50:39.680557 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:50:39.680557 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m02:50:39.695365 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.774 seconds
[0m02:50:39.695365 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3EC9FC10>]}
[0m02:50:39.695365 [info ] [Thread-3 (]: 15 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 0.80s]
[0m02:50:39.695365 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:50:39.695365 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:50:39.695365 [info ] [Thread-3 (]: 18 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m02:50:39.695365 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m02:50:39.695365 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:50:39.695365 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:50:39.711302 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:50:39.711302 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:50:39.711302 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:50:39.711302 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m02:50:39.887152 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.046 seconds
[0m02:50:39.887152 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FCD0D50>]}
[0m02:50:39.887152 [info ] [Thread-2 (]: 14 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 1.07s]
[0m02:50:39.887152 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:50:39.887152 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:50:39.887152 [info ] [Thread-2 (]: 19 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m02:50:39.887152 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m02:50:39.887152 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:50:39.887152 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:50:39.887152 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:50:39.902899 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:50:39.902899 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:50:39.902899 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m02:50:40.443404 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.984 seconds
[0m02:50:40.443404 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA40D5DE90>]}
[0m02:50:40.443404 [info ] [Thread-4 (]: 16 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 1.01s]
[0m02:50:40.443404 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:50:40.443404 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:50:40.443404 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m02:50:40.443404 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m02:50:40.443404 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:50:40.443404 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:50:40.443404 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:50:40.458321 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:50:40.458321 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:50:40.458321 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m02:50:40.602557 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.884 seconds
[0m02:50:40.604562 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3F78D4D0>]}
[0m02:50:40.606567 [info ] [Thread-3 (]: 18 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 0.91s]
[0m02:50:40.606567 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:50:40.606567 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:50:40.608572 [info ] [Thread-3 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m02:50:40.608572 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m02:50:40.608572 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:50:40.612582 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:50:40.612582 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:50:40.616591 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:50:40.618597 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:50:40.618597 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m02:50:40.664577 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.757 seconds
[0m02:50:40.664577 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3F492650>]}
[0m02:50:40.664577 [info ] [Thread-2 (]: 19 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 0.78s]
[0m02:50:40.664577 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:50:40.664577 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:50:40.664577 [info ] [Thread-2 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m02:50:40.664577 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m02:50:40.664577 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:50:40.664577 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:50:40.664577 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:50:40.696295 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:50:40.696295 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:50:40.696295 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m02:50:40.919579 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.237 seconds
[0m02:50:40.919579 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FCCB850>]}
[0m02:50:40.919579 [info ] [Thread-5 (]: 17 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 1.26s]
[0m02:50:40.919579 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:50:40.919579 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:50:40.919579 [info ] [Thread-5 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m02:50:40.919579 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m02:50:40.919579 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:50:40.935460 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:50:40.935460 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:50:40.935460 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:50:40.935460 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:50:40.935460 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m02:50:41.272665 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.811 seconds
[0m02:50:41.276267 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FCD5F50>]}
[0m02:50:41.276267 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 0.83s]
[0m02:50:41.283141 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:50:41.283141 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:50:41.283141 [info ] [Thread-4 (]: 24 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m02:50:41.283141 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m02:50:41.283141 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:50:41.288487 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:50:41.288487 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:50:41.296397 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:50:41.296397 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:50:41.296397 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m02:50:41.518048 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.898 seconds
[0m02:50:41.521914 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA40CF8310>]}
[0m02:50:41.522841 [info ] [Thread-3 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 0.91s]
[0m02:50:41.524516 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:50:41.524997 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:50:41.526250 [info ] [Thread-3 (]: 25 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m02:50:41.526250 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m02:50:41.527284 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:50:41.532003 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:50:41.533074 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:50:41.538016 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:50:41.540058 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:50:41.541009 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m02:50:42.255216 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.311 seconds
[0m02:50:42.255216 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3EC55F90>]}
[0m02:50:42.255216 [info ] [Thread-5 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.34s]
[0m02:50:42.255216 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:50:42.255216 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:50:42.255216 [info ] [Thread-5 (]: 26 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m02:50:42.255216 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_executive_summary, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m02:50:42.255216 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:50:42.255216 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:50:42.255216 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:50:42.272560 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:50:42.275556 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:50:42.275556 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m02:50:42.481699 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.180 seconds
[0m02:50:42.483782 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FCD5050>]}
[0m02:50:42.756099 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.214 seconds
[0m02:50:42.758767 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA40CC24D0>]}
[0m02:50:42.973310 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.269 seconds
[0m02:50:42.973310 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3F3DC8D0>]}
[0m02:50:43.211923 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.936 seconds
[0m02:50:43.211923 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bbfeb00-b724-43ed-875f-9320069e8569', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA3FA29990>]}
[0m02:50:45.711060 [debug] [Thread-4 (]: An error was encountered while trying to send an event
[0m02:50:45.711060 [info ] [Thread-3 (]: 25 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 1.23s]
[0m02:50:45.712593 [info ] [Thread-2 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 2.31s]
[0m02:50:45.712943 [info ] [Thread-5 (]: 26 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 0.96s]
[0m02:50:45.715597 [info ] [Thread-4 (]: 24 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 1.20s]
[0m02:50:45.716653 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:50:45.716653 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:50:45.716653 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:50:45.716653 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:50:45.716653 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:50:45.716653 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:50:45.716653 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:50:46.584194 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:50:46.584194 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:50:47.428359 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m02:50:47.428359 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m02:50:48.372558 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m02:50:48.374301 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m02:50:49.240334 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_performance_drivers' was left open.
[0m02:50:49.240334 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m02:50:50.025160 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_position_attribution' was left open.
[0m02:50:50.025160 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m02:50:51.980472 [info ] [MainThread]: 
[0m02:50:51.980472 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 22.95 seconds (22.95s).
[0m02:50:51.987591 [debug] [MainThread]: Command end result
[0m02:50:52.019783 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:50:52.019783 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:50:52.035670 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:50:52.035670 [info ] [MainThread]: 
[0m02:50:52.035670 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:50:52.035670 [info ] [MainThread]: 
[0m02:50:52.035670 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m02:50:52.035670 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:50:52.035670 [debug] [MainThread]: Command `dbt build` succeeded at 02:50:52.035670 after 25.01 seconds
[0m02:50:52.035670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA25C27AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA25C279D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AA25C2CB90>]}
[0m02:50:52.035670 [debug] [MainThread]: Flushing usage events
[0m02:50:53.852974 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:51:18.916376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022040A4CA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022040A4FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022040A4C8D0>]}


============================== 02:51:18.916376 | 640bf87c-925b-4c5b-8169-83414d893151 ==============================
[0m02:51:18.916376 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:51:18.916376 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --select tag:pipeline_a', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m02:51:19.621221 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:51:19.621221 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:51:19.637049 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:51:19.738760 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:51:19.738760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '640bf87c-925b-4c5b-8169-83414d893151', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022052E04D10>]}
[0m02:51:19.882551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '640bf87c-925b-4c5b-8169-83414d893151', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022050294450>]}
[0m02:51:19.946492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '640bf87c-925b-4c5b-8169-83414d893151', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002203FA3D0D0>]}
[0m02:51:19.946492 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:51:20.280483 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:51:20.457756 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:51:20.457756 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:51:20.457756 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:51:20.475127 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:51:20.521275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '640bf87c-925b-4c5b-8169-83414d893151', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220534081D0>]}
[0m02:51:20.616826 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:51:20.632894 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:51:20.671820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '640bf87c-925b-4c5b-8169-83414d893151', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220536F1990>]}
[0m02:51:20.671820 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:51:20.675360 [info ] [MainThread]: 
[0m02:51:20.675360 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:51:20.677370 [info ] [MainThread]: 
[0m02:51:20.677370 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:51:20.681301 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:51:20.744637 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:51:20.744637 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:51:20.744637 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:51:23.646104 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.897 seconds
[0m02:51:23.653107 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:51:23.676718 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:51:23.677718 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:51:23.678548 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:51:25.901455 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.223 seconds
[0m02:51:25.915498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '640bf87c-925b-4c5b-8169-83414d893151', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220531CC750>]}
[0m02:51:25.915498 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:51:25.915498 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:51:25.915498 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:51:25.923116 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:51:25.923116 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:51:25.923116 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:51:25.923116 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:51:25.923116 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:51:25.933431 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:51:25.933431 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:51:25.938787 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:51:25.970396 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:51:25.970396 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:51:25.970396 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:51:25.970396 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:51:25.970396 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:51:25.970396 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:51:25.970396 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:51:25.970396 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:51:25.970396 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:51:29.126457 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.151 seconds
[0m02:51:29.147335 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '640bf87c-925b-4c5b-8169-83414d893151', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022053D8AE90>]}
[0m02:51:29.149339 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.22s]
[0m02:51:29.149339 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:51:29.149339 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:51:29.151343 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:51:29.151343 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated'
[0m02:51:29.151343 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:51:29.155350 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:51:29.157353 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:51:29.160835 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:51:29.162839 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:51:29.162839 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:51:29.162839 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:51:29.395739 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.418 seconds
[0m02:51:29.395739 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '640bf87c-925b-4c5b-8169-83414d893151', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022053C69ED0>]}
[0m02:51:29.395739 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 3.47s]
[0m02:51:29.395739 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:51:29.395739 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:51:29.395739 [info ] [Thread-2 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:51:29.395739 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m02:51:29.395739 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:51:29.411657 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:51:29.411657 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:51:29.479568 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:51:29.482591 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:51:29.482591 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:51:30.796302 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.313 seconds
[0m02:51:30.796302 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '640bf87c-925b-4c5b-8169-83414d893151', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002203D8AFD10>]}
[0m02:51:30.796302 [info ] [Thread-2 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 1.40s]
[0m02:51:30.796302 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:51:32.411343 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.249 seconds
[0m02:51:32.411343 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '640bf87c-925b-4c5b-8169-83414d893151', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022053E93810>]}
[0m02:51:32.411343 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 3.26s]
[0m02:51:32.411343 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:51:32.411343 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:51:32.411343 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:51:32.411343 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:51:33.452744 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:51:33.454767 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:51:34.417302 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:51:34.417302 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:51:35.466332 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_portfolios' was left open.
[0m02:51:35.466891 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m02:51:36.519620 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:51:36.519620 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:51:37.462260 [info ] [MainThread]: 
[0m02:51:37.462260 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 16.78 seconds (16.78s).
[0m02:51:37.462260 [debug] [MainThread]: Command end result
[0m02:51:37.493116 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:51:37.493116 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:51:37.508496 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:51:37.508496 [info ] [MainThread]: 
[0m02:51:37.508496 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:51:37.508496 [info ] [MainThread]: 
[0m02:51:37.508496 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:51:37.508496 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:51:37.508496 [debug] [MainThread]: Command `dbt build` succeeded at 02:51:37.508496 after 18.67 seconds
[0m02:51:37.508496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022040AB3150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022040ABC590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022040ABFCD0>]}
[0m02:51:37.508496 [debug] [MainThread]: Flushing usage events
[0m02:51:39.215002 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:52:07.173730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A550ED3D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A550EF7D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A550EFCD0>]}


============================== 02:52:07.181643 | 6fdde0c7-fcc6-4493-802c-5fbc7a16c60b ==============================
[0m02:52:07.181643 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:52:07.181643 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_b', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m02:52:08.060543 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:52:08.060543 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:52:08.060543 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:52:08.231342 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:52:08.231342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A637BD850>]}
[0m02:52:08.525097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A54047E10>]}
[0m02:52:08.587198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A530F9150>]}
[0m02:52:08.589176 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:52:08.934004 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:52:09.140232 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:52:09.140826 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:52:09.141350 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:52:09.149366 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:52:09.189145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A66900150>]}
[0m02:52:09.311248 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:52:09.311248 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:52:09.348859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A66DC1CD0>]}
[0m02:52:09.348859 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:52:09.348859 [info ] [MainThread]: 
[0m02:52:09.348859 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:52:09.348859 [info ] [MainThread]: 
[0m02:52:09.348859 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:52:09.364637 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:52:09.413236 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:52:09.413236 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:52:09.428564 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:52:12.512724 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.088 seconds
[0m02:52:12.523644 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:52:12.544899 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:52:12.544899 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:52:12.544899 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:52:14.546207 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 1.999 seconds
[0m02:52:14.562276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A66CE3FD0>]}
[0m02:52:14.562276 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:52:14.562276 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:52:14.562276 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:52:14.562276 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:52:14.562276 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m02:52:14.562276 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m02:52:14.562276 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m02:52:14.562276 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m02:52:14.562276 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m02:52:14.562276 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m02:52:14.578328 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m02:52:14.578328 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m02:52:14.578328 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:52:14.578328 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:52:14.578328 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m02:52:14.578328 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m02:52:14.586849 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:52:14.586849 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:52:14.594426 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:52:14.594426 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:52:14.594426 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:52:14.594426 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:52:14.594426 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m02:52:14.624301 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:52:14.626092 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m02:52:14.626092 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:52:14.626092 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:52:14.626092 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:52:14.626092 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m02:52:14.626092 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m02:52:14.626092 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m02:52:14.626092 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m02:52:14.641776 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m02:52:14.641776 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m02:52:14.641776 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m02:52:14.641776 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:52:14.641776 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m02:52:14.641776 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:52:14.641776 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:52:14.641776 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:52:16.966677 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.322 seconds
[0m02:52:16.966677 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.321 seconds
[0m02:52:17.046564 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A665FF6D0>]}
[0m02:52:17.046564 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A67436C10>]}
[0m02:52:17.046564 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.48s]
[0m02:52:17.046564 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.47s]
[0m02:52:17.046564 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m02:52:17.046564 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m02:52:17.190569 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.546 seconds
[0m02:52:17.194532 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A66B70650>]}
[0m02:52:17.196376 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.63s]
[0m02:52:17.197312 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m02:52:17.705980 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.062 seconds
[0m02:52:17.705980 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A6753B190>]}
[0m02:52:17.705980 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 3.13s]
[0m02:52:17.705980 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m02:52:17.705980 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:52:17.705980 [info ] [Thread-3 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m02:52:17.705980 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m02:52:17.705980 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:52:17.722765 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:52:17.722765 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:52:17.722765 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:52:17.722765 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m02:52:17.722765 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m02:52:18.580648 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.849 seconds
[0m02:52:18.581852 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A63C928D0>]}
[0m02:52:18.581852 [info ] [Thread-3 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.88s]
[0m02:52:18.581852 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m02:52:18.581852 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:52:18.581852 [info ] [Thread-2 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m02:52:18.581852 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m02:52:18.581852 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:52:18.581852 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:52:18.581852 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:52:18.595308 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:52:18.595308 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m02:52:18.595308 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m02:52:19.537081 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.938 seconds
[0m02:52:19.537081 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A64311890>]}
[0m02:52:19.537081 [info ] [Thread-2 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 0.96s]
[0m02:52:19.537081 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m02:52:19.551666 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:52:19.551666 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:52:19.551666 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:52:19.551666 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:52:19.554150 [info ] [Thread-3 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m02:52:19.554150 [info ] [Thread-5 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m02:52:19.556121 [info ] [Thread-4 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m02:52:19.557128 [info ] [Thread-2 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m02:52:19.557992 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m02:52:19.558868 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.fact_trades)
[0m02:52:19.558868 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m02:52:19.560873 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m02:52:19.560873 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:52:19.560873 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m02:52:19.562879 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:52:19.562879 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:52:19.564886 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:52:19.567476 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:52:19.573678 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:52:19.573678 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:52:19.573678 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:52:19.573678 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m02:52:19.583363 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:52:19.583363 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:52:19.583363 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:52:19.583363 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:52:19.583363 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:52:19.583363 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m02:52:19.583363 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:52:19.599306 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m02:52:19.600129 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m02:52:19.600129 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m02:52:19.600129 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m02:52:19.600129 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m02:52:19.606413 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

with_window_aggregates as (
    select
        trade_id,
        trade_date,
        portfolio_id,
        security_id,
        ticker,
        quantity,
        price,
        price as execution_price,
        trade_value,
        commission,
        round(avg(price) over (partition by trade_date, security_id), 2) as daily_avg_price,
        min(price) over (partition by trade_date, security_id) as daily_min_price,
        max(price) over (partition by trade_date, security_id) as daily_max_price,
        (max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)) as daily_price_range,
        round(stddev_pop(price) over (partition by trade_date, security_id), 4) as daily_volatility,
        round((price - min(price) over (partition by trade_date, security_id)) / nullif((max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)), 0), 8) as execution_percentile
    from trades_detail
)

select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    daily_min_price,
    daily_max_price,
    daily_price_range,
    daily_volatility,
    execution_percentile,
    round(100 * (price - daily_avg_price) / nullif(daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when execution_percentile > 0.75 then 'POOR'
        when execution_percentile > 0.50 then 'FAIR'
        when execution_percentile > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(commission / nullif(trade_value, 0), 8) as commission_ratio,
    round(100 * commission / nullif(trade_value, 0), 6) as commission_ratio_bps
from with_window_aggregates
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m02:52:19.610155 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m02:52:20.588596 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.983 seconds
[0m02:52:20.588596 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A66DDBAD0>]}
[0m02:52:20.588596 [info ] [Thread-5 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.03s]
[0m02:52:20.588596 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m02:52:20.604492 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.000 seconds
[0m02:52:20.604492 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.997 seconds
[0m02:52:20.609129 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A675B3450>]}
[0m02:52:20.609129 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A66CC9610>]}
[0m02:52:20.609129 [info ] [Thread-3 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.05s]
[0m02:52:20.609129 [info ] [Thread-4 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.05s]
[0m02:52:20.609129 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m02:52:20.609129 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m02:52:20.620711 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:52:20.620711 [info ] [Thread-5 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m02:52:20.620711 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m02:52:20.620711 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:52:20.620711 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:52:20.620711 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:52:20.620711 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:52:20.620711 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m02:52:20.620711 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m02:52:20.868761 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.258 seconds
[0m02:52:20.871053 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A6740E5D0>]}
[0m02:52:20.871053 [info ] [Thread-2 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.31s]
[0m02:52:20.871053 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m02:52:20.871053 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:52:20.877858 [info ] [Thread-4 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m02:52:20.879297 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m02:52:20.879297 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:52:20.885320 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:52:20.887307 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:52:20.891217 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:52:20.893702 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m02:52:20.895720 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m02:52:21.618101 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.983 seconds
[0m02:52:21.622971 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A675BFC10>]}
[0m02:52:21.626896 [info ] [Thread-5 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.00s]
[0m02:52:21.628908 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m02:52:21.859812 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.963 seconds
[0m02:52:21.863847 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fdde0c7-fcc6-4493-802c-5fbc7a16c60b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A675BFB50>]}
[0m02:52:21.863847 [info ] [Thread-4 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 0.98s]
[0m02:52:21.865852 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m02:52:21.869054 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:52:21.872834 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:52:21.873965 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:52:22.692063 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:52:22.693198 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:52:23.764876 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_summary' was left open.
[0m02:52:23.766798 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m02:52:24.797469 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m02:52:24.800476 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m02:52:25.644403 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m02:52:25.646418 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m02:52:26.500317 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m02:52:26.503340 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m02:52:27.324083 [info ] [MainThread]: 
[0m02:52:27.326127 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 17.98 seconds (17.98s).
[0m02:52:27.335139 [debug] [MainThread]: Command end result
[0m02:52:27.458003 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:52:27.465920 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:52:27.485917 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:52:27.487916 [info ] [MainThread]: 
[0m02:52:27.489916 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:52:27.490920 [info ] [MainThread]: 
[0m02:52:27.492928 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m02:52:27.494950 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:52:27.498039 [debug] [MainThread]: Command `dbt build` succeeded at 02:52:27.498039 after 20.44 seconds
[0m02:52:27.500921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A4D517950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A4D5179D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019A4D517A90>]}
[0m02:52:27.504026 [debug] [MainThread]: Flushing usage events
[0m02:52:30.514852 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:53:51.880510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198A455D290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198A455CB50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198A455D9D0>]}


============================== 02:53:51.880510 | 40da85b8-3cb5-47a6-a25d-682736430408 ==============================
[0m02:53:51.880510 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:53:51.880510 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m02:53:52.529145 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:53:52.529145 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:53:52.529145 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:53:52.639007 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:53:52.639007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '40da85b8-3cb5-47a6-a25d-682736430408', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198B6914A50>]}
[0m02:53:52.804140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '40da85b8-3cb5-47a6-a25d-682736430408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198B3C0DC10>]}
[0m02:53:52.858010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '40da85b8-3cb5-47a6-a25d-682736430408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198B6892710>]}
[0m02:53:52.859006 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:53:53.250394 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:53:53.436737 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:53:53.437727 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:53:53.437727 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:53:53.445731 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:53:53.497223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '40da85b8-3cb5-47a6-a25d-682736430408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198B6ECDE90>]}
[0m02:53:53.616714 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:53:53.618787 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:53:53.657610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '40da85b8-3cb5-47a6-a25d-682736430408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198B7201990>]}
[0m02:53:53.657610 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:53:53.660622 [info ] [MainThread]: 
[0m02:53:53.661612 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:53:53.661612 [info ] [MainThread]: 
[0m02:53:53.662618 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:53:53.667863 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:53:53.736970 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:53:53.736970 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:53:53.737889 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:53:57.347304 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.610 seconds
[0m02:53:57.354423 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:53:57.364013 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:53:57.364013 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:53:57.364013 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:53:59.594643 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.226 seconds
[0m02:53:59.603181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '40da85b8-3cb5-47a6-a25d-682736430408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198A0EA9610>]}
[0m02:53:59.612484 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:53:59.612484 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:53:59.612484 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m02:53:59.612484 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m02:53:59.612484 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m02:53:59.612484 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m02:53:59.619026 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:53:59.619026 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:53:59.619026 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:53:59.619026 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:53:59.619026 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:53:59.619026 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:53:59.679459 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:53:59.686639 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:53:59.688461 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m02:53:59.689727 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m02:53:59.691297 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m02:53:59.692351 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:53:59.693397 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m02:53:59.695127 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:54:02.450939 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.757 seconds
[0m02:54:02.450939 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.762 seconds
[0m02:54:02.476228 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '40da85b8-3cb5-47a6-a25d-682736430408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198B6A68290>]}
[0m02:54:02.476228 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '40da85b8-3cb5-47a6-a25d-682736430408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198B7748CD0>]}
[0m02:54:02.476228 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 2.85s]
[0m02:54:02.476228 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 2.86s]
[0m02:54:02.476228 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m02:54:02.476228 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m02:54:02.483063 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:54:02.483063 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:54:02.483063 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m02:54:02.483063 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m02:54:02.483063 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m02:54:02.483063 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m02:54:02.483063 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:54:02.483063 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:54:02.483063 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:54:02.495981 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:54:02.495981 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:54:02.499175 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:54:02.499175 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:54:02.508831 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:54:02.508831 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m02:54:02.512786 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m02:54:02.512786 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m02:54:02.515059 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m02:54:02.515907 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:54:03.937907 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.422 seconds
[0m02:54:03.937907 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '40da85b8-3cb5-47a6-a25d-682736430408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198B71FCCD0>]}
[0m02:54:03.937907 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.45s]
[0m02:54:03.937907 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m02:54:05.920836 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.406 seconds
[0m02:54:05.920836 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '40da85b8-3cb5-47a6-a25d-682736430408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198B79B0F50>]}
[0m02:54:05.920836 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 3.44s]
[0m02:54:05.920836 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m02:54:05.920836 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:54:05.920836 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:54:05.920836 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:54:07.054596 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:54:07.054596 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:54:08.360658 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m02:54:08.360658 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m02:54:09.357924 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m02:54:09.357924 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m02:54:10.136056 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m02:54:10.136056 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m02:54:10.950520 [info ] [MainThread]: 
[0m02:54:10.952528 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 17.29 seconds (17.29s).
[0m02:54:10.954534 [debug] [MainThread]: Command end result
[0m02:54:10.989343 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:54:10.991089 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:54:10.991089 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:54:11.000337 [info ] [MainThread]: 
[0m02:54:11.000337 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:54:11.000337 [info ] [MainThread]: 
[0m02:54:11.000337 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m02:54:11.000337 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:54:11.000337 [debug] [MainThread]: Command `dbt build` succeeded at 02:54:11.000337 after 19.23 seconds
[0m02:54:11.000337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000198A45CFF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001989D957950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001989D9579D0>]}
[0m02:54:11.000337 [debug] [MainThread]: Flushing usage events
[0m02:54:14.025097 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:54:51.069477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D3CB7C090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D3CB7FD50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D3CB7E0D0>]}


============================== 02:54:51.069477 | cc4c09a6-30c6-432a-a3c8-07abc4425973 ==============================
[0m02:54:51.069477 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:54:51.069477 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_c', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m02:54:51.740952 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:54:51.740952 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:54:51.740952 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:54:51.853934 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:54:51.865006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4EF358D0>]}
[0m02:54:52.022166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4F0204D0>]}
[0m02:54:52.085492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D3BB6D050>]}
[0m02:54:52.085492 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:54:52.420006 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:54:52.665445 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:54:52.665445 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:54:52.665445 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:54:52.677637 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m02:54:52.730271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4F47FCD0>]}
[0m02:54:52.953483 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:54:52.958459 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:54:53.007283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4F2FEFD0>]}
[0m02:54:53.008350 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:54:53.013122 [info ] [MainThread]: 
[0m02:54:53.014079 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:54:53.015158 [info ] [MainThread]: 
[0m02:54:53.017279 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:54:53.026449 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:54:53.137830 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:54:53.137830 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:54:53.141302 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:54:55.774964 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.638 seconds
[0m02:54:55.787636 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:54:55.787636 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:54:55.787636 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:54:55.787636 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:54:57.603545 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 1.803 seconds
[0m02:54:57.613048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4EF18B50>]}
[0m02:54:57.622423 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:54:57.622423 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:54:57.622423 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:54:57.622423 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:54:57.622423 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m02:54:57.622423 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m02:54:57.622423 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m02:54:57.622423 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m02:54:57.622423 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m02:54:57.622423 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m02:54:57.622423 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m02:54:57.622423 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m02:54:57.633626 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:54:57.633626 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:54:57.633626 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:54:57.633626 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:54:57.642695 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:54:57.647067 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:54:57.653797 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:54:57.658683 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:54:57.661105 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:54:57.663495 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:54:57.666095 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:54:57.673510 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:54:57.697539 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:54:57.697539 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:54:57.697539 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:54:57.711096 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:54:57.713405 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:54:57.713405 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:54:57.713405 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:54:57.713405 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m02:54:57.713405 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:54:57.713405 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m02:54:57.713405 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m02:54:57.713405 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:54:57.713405 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m02:54:57.713405 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:54:57.713405 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:54:57.713405 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:54:59.655376 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.936 seconds
[0m02:54:59.834180 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4F48BC50>]}
[0m02:54:59.835696 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 2.21s]
[0m02:54:59.836267 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:54:59.836267 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:54:59.836267 [info ] [Thread-3 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m02:54:59.836267 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m02:54:59.836267 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:54:59.845191 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:54:59.846906 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:54:59.846906 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:54:59.853985 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:54:59.856623 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m02:54:59.895999 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.176 seconds
[0m02:54:59.902913 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4EFE3D10>]}
[0m02:54:59.902913 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.28s]
[0m02:54:59.908435 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:54:59.976349 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.259 seconds
[0m02:54:59.976349 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4FEE0B50>]}
[0m02:54:59.984139 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 2.35s]
[0m02:54:59.984139 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:55:00.120984 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.400 seconds
[0m02:55:00.120984 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4FF7C190>]}
[0m02:55:00.120984 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 2.50s]
[0m02:55:00.120984 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:55:00.120984 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:55:00.120984 [info ] [Thread-2 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m02:55:00.120984 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m02:55:00.120984 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:55:00.132588 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:55:00.132588 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:55:00.143620 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:55:00.143620 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:55:00.149310 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m02:55:00.510590 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.653 seconds
[0m02:55:00.510590 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4EF9DA50>]}
[0m02:55:00.510590 [info ] [Thread-3 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.67s]
[0m02:55:00.510590 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:55:00.510590 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:55:00.510590 [info ] [Thread-5 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m02:55:00.510590 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m02:55:00.510590 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:55:00.523986 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:55:00.524405 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:55:00.531168 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:55:00.532661 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:55:00.532661 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

lagged_values as (
    select
        *,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav_usd
    from valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        prev_nav_usd as prev_nav,
        nav_usd - prev_nav_usd as daily_pnl,
        case
            when prev_nav_usd > 0
            then (nav_usd - prev_nav_usd) / prev_nav_usd
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from lagged_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m02:55:00.754959 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.605 seconds
[0m02:55:00.756954 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4FF7C190>]}
[0m02:55:00.757954 [info ] [Thread-2 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 0.64s]
[0m02:55:00.758954 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:55:00.759954 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:55:00.759954 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:55:00.760952 [info ] [Thread-3 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m02:55:00.761950 [info ] [Thread-4 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m02:55:00.761950 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m02:55:00.762984 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m02:55:00.763987 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:55:00.764327 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:55:00.764327 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:55:00.764327 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:55:00.764327 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:55:00.764327 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:55:00.764327 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:55:00.780773 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:55:00.780773 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:55:00.780773 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

lagged_position_values as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        prev_value,
        market_value_usd - prev_value as daily_pnl,
        case
            when prev_value > 0
            then (market_value_usd - prev_value) / prev_value
            else 0
        end as daily_return_pct
    from lagged_position_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m02:55:00.780773 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:55:00.780773 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(cast(market_value_usd as numeric(18, 2))) as sector_value,
        sum(cast(quantity as numeric(18, 2))) as total_quantity
    from enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(cast(market_value_usd as numeric(18, 2))) as portfolio_value
    from enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m02:55:01.313108 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.776 seconds
[0m02:55:01.318084 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4F857790>]}
[0m02:55:01.320247 [info ] [Thread-5 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 0.81s]
[0m02:55:01.321143 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:55:01.322588 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:55:01.322588 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:55:01.323594 [info ] [Thread-2 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m02:55:01.324637 [info ] [Thread-5 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m02:55:01.325647 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m02:55:01.326642 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m02:55:01.326642 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:55:01.327693 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:55:01.331668 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:55:01.334945 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:55:01.336864 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:55:01.336864 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:55:01.339947 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:55:01.344529 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:55:01.347524 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:55:01.347524 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m02:55:01.349440 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:55:01.349856 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m02:55:01.612921 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.824 seconds
[0m02:55:01.616954 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4FE92E50>]}
[0m02:55:01.617910 [info ] [Thread-4 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 0.85s]
[0m02:55:01.619867 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:55:01.620511 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:55:01.621789 [info ] [Thread-4 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m02:55:01.622779 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m02:55:01.623779 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:55:01.628774 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:55:01.629776 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:55:01.634371 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:55:01.637378 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:55:01.638289 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m02:55:01.851584 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.069 seconds
[0m02:55:01.851584 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D3BBB97D0>]}
[0m02:55:01.851584 [info ] [Thread-3 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 1.09s]
[0m02:55:01.851584 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:55:01.851584 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:55:01.851584 [info ] [Thread-3 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m02:55:01.851584 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m02:55:01.867492 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:55:01.867492 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:55:01.867492 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:55:01.867492 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:55:01.867492 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:55:01.867492 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m02:55:02.130796 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.779 seconds
[0m02:55:02.136209 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4F838190>]}
[0m02:55:02.137214 [info ] [Thread-5 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 0.81s]
[0m02:55:02.138074 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:55:02.138074 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:55:02.138074 [info ] [Thread-5 (]: 14 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m02:55:02.138074 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m02:55:02.138074 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:55:02.147402 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:55:02.149321 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:55:02.156170 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:55:02.159303 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:55:02.160300 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m02:55:02.277825 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.928 seconds
[0m02:55:02.280823 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5103BD10>]}
[0m02:55:02.280823 [info ] [Thread-2 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 0.96s]
[0m02:55:02.281919 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:55:02.282924 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:55:02.282924 [info ] [Thread-2 (]: 15 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m02:55:02.283852 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m02:55:02.284885 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:55:02.287916 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:55:02.288917 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:55:02.292540 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:55:02.296586 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:55:02.297715 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m02:55:02.355761 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.717 seconds
[0m02:55:02.361763 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4EF35910>]}
[0m02:55:02.362681 [info ] [Thread-4 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 0.74s]
[0m02:55:02.363796 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:55:02.364585 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:55:02.364585 [info ] [Thread-4 (]: 16 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m02:55:02.364585 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m02:55:02.364585 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:55:02.364585 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:55:02.364585 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:55:02.364585 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:55:02.379684 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:55:02.379684 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m02:55:02.634067 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.753 seconds
[0m02:55:02.634067 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D51039610>]}
[0m02:55:02.634067 [info ] [Thread-3 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 0.78s]
[0m02:55:02.634067 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:55:02.634067 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:55:02.634067 [info ] [Thread-3 (]: 17 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m02:55:02.634067 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m02:55:02.634067 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:55:02.634067 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:55:02.634067 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:55:02.649799 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:55:02.649799 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:55:02.649799 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m02:55:02.887312 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.727 seconds
[0m02:55:02.887312 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4F73C850>]}
[0m02:55:02.887312 [info ] [Thread-5 (]: 14 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 0.75s]
[0m02:55:02.887312 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:55:02.887312 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:55:02.887312 [info ] [Thread-5 (]: 18 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m02:55:02.887312 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m02:55:02.887312 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:55:02.887312 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:55:02.887312 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:55:02.903139 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:55:02.903139 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:55:02.903139 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m02:55:03.111219 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.816 seconds
[0m02:55:03.119988 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4FFA3350>]}
[0m02:55:03.121997 [info ] [Thread-2 (]: 15 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 0.84s]
[0m02:55:03.121997 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:55:03.121997 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:55:03.124002 [info ] [Thread-2 (]: 19 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m02:55:03.124002 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m02:55:03.124002 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:55:03.129100 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:55:03.129100 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:55:03.133110 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:55:03.135115 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:55:03.135115 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m02:55:03.366848 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.988 seconds
[0m02:55:03.366848 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4EEC2B50>]}
[0m02:55:03.366848 [info ] [Thread-4 (]: 16 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 1.00s]
[0m02:55:03.366848 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:55:03.366848 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:55:03.366848 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m02:55:03.366848 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m02:55:03.366848 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:55:03.366848 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:55:03.366848 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:55:03.382844 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:55:03.382844 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:55:03.382844 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m02:55:03.703681 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.051 seconds
[0m02:55:03.703681 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4FEE2A50>]}
[0m02:55:03.711927 [info ] [Thread-3 (]: 17 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 1.07s]
[0m02:55:03.711927 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:55:03.711927 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:55:03.711927 [info ] [Thread-3 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m02:55:03.711927 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m02:55:03.711927 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:55:03.711927 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:55:03.719421 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:55:03.719421 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:55:03.719421 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:55:03.719421 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m02:55:03.944352 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.810 seconds
[0m02:55:03.944352 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D51091E50>]}
[0m02:55:03.944352 [info ] [Thread-2 (]: 19 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 0.82s]
[0m02:55:03.944352 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:55:03.944352 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:55:03.944352 [info ] [Thread-2 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m02:55:03.944352 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m02:55:03.944352 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:55:03.944352 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:55:03.959350 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:55:03.975005 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:55:03.975005 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:55:03.975005 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m02:55:04.179449 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.270 seconds
[0m02:55:04.182592 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D3CB88F10>]}
[0m02:55:04.183635 [info ] [Thread-5 (]: 18 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 1.30s]
[0m02:55:04.184681 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:55:04.185736 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:55:04.186780 [info ] [Thread-5 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m02:55:04.187314 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m02:55:04.188485 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:55:04.195142 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:55:04.196711 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:55:04.202500 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:55:04.205654 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:55:04.206704 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m02:55:04.451154 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.725 seconds
[0m02:55:04.457193 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D510F7FD0>]}
[0m02:55:04.459213 [info ] [Thread-3 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 0.75s]
[0m02:55:04.459213 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:55:04.459213 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:55:04.465030 [info ] [Thread-3 (]: 24 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m02:55:04.465030 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m02:55:04.465030 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:55:04.465030 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:55:04.465030 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:55:04.465030 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:55:04.465030 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:55:04.480828 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m02:55:04.689087 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.302 seconds
[0m02:55:04.689087 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D510D72D0>]}
[0m02:55:04.689087 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 1.32s]
[0m02:55:04.689087 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:55:04.689087 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:55:04.689087 [info ] [Thread-4 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m02:55:04.689087 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m02:55:04.689087 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:55:04.704876 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:55:04.704876 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:55:04.704876 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:55:04.704876 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:55:04.704876 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m02:55:05.231751 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.026 seconds
[0m02:55:05.237782 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4FEDF410>]}
[0m02:55:05.237782 [info ] [Thread-5 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.05s]
[0m02:55:05.239790 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:55:05.239790 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:55:05.241801 [info ] [Thread-5 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m02:55:05.241801 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_executive_summary, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m02:55:05.241801 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:55:05.246291 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:55:05.247826 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:55:05.247826 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:55:05.247826 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:55:05.247826 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m02:55:05.455578 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.975 seconds
[0m02:55:05.457588 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D51165BD0>]}
[0m02:55:05.743046 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.034 seconds
[0m02:55:05.743046 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D4F572E10>]}
[0m02:55:05.776107 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.791 seconds
[0m02:55:05.778147 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D5106C4D0>]}
[0m02:55:06.064773 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.811 seconds
[0m02:55:06.068796 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4c09a6-30c6-432a-a3c8-07abc4425973', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D510ACD10>]}
[0m02:55:08.207469 [debug] [Thread-3 (]: An error was encountered while trying to send an event
[0m02:55:08.207469 [info ] [Thread-4 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 1.05s]
[0m02:55:08.207469 [info ] [Thread-2 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 1.83s]
[0m02:55:08.214501 [info ] [Thread-5 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 0.83s]
[0m02:55:08.215640 [info ] [Thread-3 (]: 24 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 0.99s]
[0m02:55:08.215640 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:55:08.215640 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:55:08.215640 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:55:08.222410 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:55:08.222410 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:55:08.222410 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:55:08.229361 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:55:09.065486 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:55:09.065486 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:55:09.937585 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_portfolio_performance' was left open.
[0m02:55:09.939597 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m02:55:10.890155 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_performance_drivers' was left open.
[0m02:55:10.891520 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m02:55:11.952981 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_position_attribution' was left open.
[0m02:55:11.952981 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m02:55:12.984915 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m02:55:12.985920 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m02:55:14.033254 [info ] [MainThread]: 
[0m02:55:14.035281 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 21.02 seconds (21.02s).
[0m02:55:14.035281 [debug] [MainThread]: Command end result
[0m02:55:14.066879 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:55:14.066879 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:55:14.082521 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:55:14.082521 [info ] [MainThread]: 
[0m02:55:14.082521 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:55:14.082521 [info ] [MainThread]: 
[0m02:55:14.082521 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m02:55:14.082521 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:55:14.082521 [debug] [MainThread]: Command `dbt build` succeeded at 02:55:14.082521 after 23.10 seconds
[0m02:55:14.082521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D3CB72610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D36007AD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D360079D0>]}
[0m02:55:14.082521 [debug] [MainThread]: Flushing usage events
[0m02:55:15.982656 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:58:54.517758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018188BED9D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018188BEFF50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018188BEE350>]}


============================== 02:58:54.517758 | 732ade60-2623-4d02-91bf-b62190ae4dad ==============================
[0m02:58:54.517758 [info ] [MainThread]: Running with dbt=1.11.2
[0m02:58:54.527987 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_c', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m02:58:55.335012 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m02:58:55.335012 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m02:58:55.335012 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m02:58:55.445182 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m02:58:55.445182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018199FD6610>]}
[0m02:58:55.571593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018199F3CE50>]}
[0m02:58:55.635566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018186C05090>]}
[0m02:58:55.635566 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m02:58:55.973744 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m02:58:56.143402 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:58:56.143402 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m02:58:56.143402 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:58:56.149426 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m02:58:56.189267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A589E90>]}
[0m02:58:56.307363 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:58:56.307363 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:58:56.340364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A891950>]}
[0m02:58:56.340364 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m02:58:56.340364 [info ] [MainThread]: 
[0m02:58:56.340364 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:58:56.340364 [info ] [MainThread]: 
[0m02:58:56.340364 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:58:56.359377 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m02:58:56.419349 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m02:58:56.419349 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m02:58:56.419349 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:59.767124 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.342 seconds
[0m02:58:59.783138 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m02:58:59.799032 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m02:58:59.799032 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m02:58:59.799032 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:59:02.514217 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.714 seconds
[0m02:59:02.523962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819AE26F10>]}
[0m02:59:02.523962 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:59:02.523962 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:59:02.523962 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:59:02.523962 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:59:02.523962 [info ] [Thread-2 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m02:59:02.540045 [info ] [Thread-3 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m02:59:02.540045 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m02:59:02.540045 [info ] [Thread-5 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m02:59:02.540045 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m02:59:02.540045 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmarks'
[0m02:59:02.540045 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks'
[0m02:59:02.540045 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_positions_daily'
[0m02:59:02.540045 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:59:02.540045 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:59:02.540045 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:59:02.540045 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:59:02.556648 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:59:02.560930 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:59:02.564045 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:59:02.567019 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:59:02.568935 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:59:02.568935 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:59:02.569935 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:59:02.602737 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:59:02.605988 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:59:02.605988 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:59:02.612707 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:59:02.618721 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:59:02.618721 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m02:59:02.618721 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m02:59:02.618721 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m02:59:02.618721 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m02:59:02.618721 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m02:59:02.618721 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m02:59:02.618721 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m02:59:02.618721 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m02:59:02.618721 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m02:59:02.618721 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:59:02.618721 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:59:02.618721 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m02:59:04.833841 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.205 seconds
[0m02:59:04.913988 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819AC06B50>]}
[0m02:59:04.913988 [info ] [Thread-5 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 2.37s]
[0m02:59:04.913988 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m02:59:04.913988 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:59:04.913988 [info ] [Thread-5 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m02:59:04.929843 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m02:59:04.929843 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:59:04.933238 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:59:04.933238 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:59:04.933238 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:59:04.933238 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m02:59:04.933238 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m02:59:04.977283 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.350 seconds
[0m02:59:04.977283 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.350 seconds
[0m02:59:04.982031 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A8F4690>]}
[0m02:59:04.984042 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819AF832D0>]}
[0m02:59:04.984553 [info ] [Thread-2 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 2.44s]
[0m02:59:04.984553 [info ] [Thread-3 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 2.44s]
[0m02:59:04.984553 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m02:59:04.984553 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m02:59:04.984553 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:59:04.989046 [info ] [Thread-2 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m02:59:04.989046 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m02:59:04.989046 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:59:04.993066 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:59:04.993066 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:59:04.993066 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:59:04.993066 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m02:59:04.993066 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m02:59:05.150535 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.522 seconds
[0m02:59:05.150535 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819AC0C490>]}
[0m02:59:05.150535 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 2.61s]
[0m02:59:05.150535 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m02:59:05.515346 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.574 seconds
[0m02:59:05.515346 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819B019F90>]}
[0m02:59:05.515346 [info ] [Thread-5 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 0.59s]
[0m02:59:05.515346 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m02:59:05.515346 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:59:05.515346 [info ] [Thread-3 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m02:59:05.515346 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m02:59:05.515346 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:59:05.530673 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:59:05.530673 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:59:05.530673 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:59:05.530673 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m02:59:05.530673 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

lagged_values as (
    select
        *,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav_usd
    from valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        prev_nav_usd as prev_nav,
        nav_usd - prev_nav_usd as daily_pnl,
        case
            when prev_nav_usd > 0
            then (nav_usd - prev_nav_usd) / prev_nav_usd
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from lagged_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m02:59:06.222951 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.687 seconds
[0m02:59:06.222951 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A06BA90>]}
[0m02:59:06.222951 [info ] [Thread-3 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 0.71s]
[0m02:59:06.238848 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m02:59:06.238848 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:59:06.238848 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:59:06.238848 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:59:06.238848 [info ] [Thread-5 (]: 8 of 26 START sql view model DEV.int_portfolio_analysis_advanced ............... [RUN]
[0m02:59:06.238848 [info ] [Thread-4 (]: 9 of 26 START sql view model DEV.int_portfolio_drawdown ........................ [RUN]
[0m02:59:06.247903 [info ] [Thread-3 (]: 10 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m02:59:06.248623 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m02:59:06.248623 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m02:59:06.248623 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m02:59:06.254502 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:59:06.254502 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:59:06.254502 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:59:06.254502 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:59:06.271553 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:59:06.271553 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:59:06.271553 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:59:06.271553 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:59:06.284119 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:59:06.284119 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:59:06.287685 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:59:06.291690 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:59:06.294082 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m02:59:06.294082 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m02:59:06.294082 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m02:59:06.294082 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m02:59:06.294082 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m02:59:06.294082 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m02:59:06.454496 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.455 seconds
[0m02:59:06.454496 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819AE4F750>]}
[0m02:59:06.454496 [info ] [Thread-2 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 1.47s]
[0m02:59:06.454496 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m02:59:06.454496 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:59:06.454496 [info ] [Thread-2 (]: 11 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m02:59:06.454496 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m02:59:06.454496 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:59:06.470208 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:59:06.470208 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:59:06.470208 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:59:06.470208 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m02:59:06.470208 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m02:59:07.003319 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.705 seconds
[0m02:59:07.003319 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819AE0A550>]}
[0m02:59:07.003319 [info ] [Thread-5 (]: 8 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced .......... [[32mSUCCESS 1[0m in 0.75s]
[0m02:59:07.003319 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m02:59:07.003319 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:59:07.003319 [info ] [Thread-5 (]: 12 of 26 START sql view model DEV.int_position_returns ......................... [RUN]
[0m02:59:07.003319 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m02:59:07.003319 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:59:07.022365 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:59:07.024370 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:59:07.028380 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:59:07.030384 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m02:59:07.030384 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

lagged_position_values as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        prev_value,
        market_value_usd - prev_value as daily_pnl,
        case
            when prev_value > 0
            then (market_value_usd - prev_value) / prev_value
            else 0
        end as daily_return_pct
    from lagged_position_values
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m02:59:07.226804 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.749 seconds
[0m02:59:07.226804 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A8DAA10>]}
[0m02:59:07.226804 [info ] [Thread-2 (]: 11 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 0.77s]
[0m02:59:07.226804 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m02:59:07.226804 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:59:07.226804 [info ] [Thread-2 (]: 13 of 26 START sql view model DEV.int_sector_allocation ........................ [RUN]
[0m02:59:07.226804 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m02:59:07.226804 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:59:07.243671 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:59:07.243671 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:59:07.247766 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:59:07.247766 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m02:59:07.247766 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(cast(market_value_usd as numeric(18, 2))) as sector_value,
        sum(cast(quantity as numeric(18, 2))) as total_quantity
    from enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(cast(market_value_usd as numeric(18, 2))) as portfolio_value
    from enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m02:59:07.646711 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.345 seconds
[0m02:59:07.646711 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819B0EA890>]}
[0m02:59:07.646711 [info ] [Thread-3 (]: 10 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 1.40s]
[0m02:59:07.646711 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m02:59:07.646711 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:59:07.646711 [info ] [Thread-3 (]: 14 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m02:59:07.646711 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m02:59:07.646711 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:59:07.646711 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:59:07.646711 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:59:07.662527 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:59:07.662527 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m02:59:07.662527 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m02:59:07.871573 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.840 seconds
[0m02:59:07.874940 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018199F8CB10>]}
[0m02:59:07.875985 [info ] [Thread-5 (]: 12 of 26 OK created sql view model DEV.int_position_returns .................... [[32mSUCCESS 1[0m in 0.87s]
[0m02:59:07.875985 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m02:59:07.877046 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:59:07.877965 [info ] [Thread-5 (]: 15 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m02:59:07.878945 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m02:59:07.878945 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:59:07.882852 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:59:07.882852 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:59:07.897864 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:59:07.897864 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m02:59:07.897864 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m02:59:08.137870 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.889 seconds
[0m02:59:08.137870 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.841 seconds
[0m02:59:08.144517 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A051490>]}
[0m02:59:08.153683 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819AF09B50>]}
[0m02:59:08.153683 [info ] [Thread-2 (]: 13 of 26 OK created sql view model DEV.int_sector_allocation ................... [[32mSUCCESS 1[0m in 0.92s]
[0m02:59:08.153683 [info ] [Thread-4 (]: 9 of 26 OK created sql view model DEV.int_portfolio_drawdown ................... [[32mSUCCESS 1[0m in 1.91s]
[0m02:59:08.153683 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m02:59:08.153683 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m02:59:08.153683 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:59:08.153683 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:59:08.153683 [info ] [Thread-2 (]: 16 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m02:59:08.153683 [info ] [Thread-4 (]: 17 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m02:59:08.153683 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m02:59:08.153683 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m02:59:08.153683 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:59:08.153683 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:59:08.169373 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:59:08.172404 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:59:08.172404 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:59:08.172404 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:59:08.172404 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:59:08.172404 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m02:59:08.172404 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:59:08.172404 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m02:59:08.185028 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m02:59:08.185028 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m02:59:08.412100 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.743 seconds
[0m02:59:08.416881 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819C115890>]}
[0m02:59:08.417896 [info ] [Thread-3 (]: 14 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 0.77s]
[0m02:59:08.417896 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m02:59:08.417896 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:59:08.417896 [info ] [Thread-3 (]: 18 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m02:59:08.420692 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m02:59:08.420692 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:59:08.420692 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:59:08.420692 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:59:08.420692 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:59:08.420692 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m02:59:08.434358 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m02:59:08.954047 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.768 seconds
[0m02:59:08.954047 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.767 seconds
[0m02:59:08.954047 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A8E7850>]}
[0m02:59:08.964116 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A65D790>]}
[0m02:59:08.966124 [info ] [Thread-2 (]: 16 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 0.80s]
[0m02:59:08.966124 [info ] [Thread-4 (]: 17 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 0.81s]
[0m02:59:08.966124 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m02:59:08.969800 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m02:59:08.969800 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:59:08.969800 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:59:08.969800 [info ] [Thread-2 (]: 19 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m02:59:08.969800 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m02:59:08.969800 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m02:59:08.969800 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m02:59:08.969800 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:59:08.969800 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:59:08.969800 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:59:08.969800 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:59:08.985716 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:59:08.985716 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:59:08.985716 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:59:08.992700 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:59:08.992700 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m02:59:08.992700 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m02:59:08.992700 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m02:59:08.992700 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m02:59:09.193158 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.760 seconds
[0m02:59:09.193158 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A046510>]}
[0m02:59:09.193158 [info ] [Thread-3 (]: 18 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 0.77s]
[0m02:59:09.193158 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m02:59:09.193158 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:59:09.193158 [info ] [Thread-3 (]: 21 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m02:59:09.193158 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m02:59:09.193158 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:59:09.209282 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:59:09.209282 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:59:09.209282 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:59:09.209282 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m02:59:09.209282 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m02:59:09.696730 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.699 seconds
[0m02:59:09.696730 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819C0E9290>]}
[0m02:59:09.696730 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 0.73s]
[0m02:59:09.696730 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m02:59:09.696730 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:59:09.696730 [info ] [Thread-4 (]: 22 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m02:59:09.696730 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m02:59:09.696730 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:59:09.712464 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:59:09.712464 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:59:09.712464 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:59:09.712464 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m02:59:09.712464 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m02:59:09.936404 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.940 seconds
[0m02:59:09.936404 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A7DC9D0>]}
[0m02:59:09.936404 [info ] [Thread-2 (]: 19 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 0.97s]
[0m02:59:09.936404 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m02:59:09.936404 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:59:09.936404 [info ] [Thread-2 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m02:59:09.936404 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m02:59:09.936404 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:59:09.952557 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:59:09.952557 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:59:09.952557 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:59:09.952557 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m02:59:09.952557 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m02:59:10.179806 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.963 seconds
[0m02:59:10.179806 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819C197ED0>]}
[0m02:59:10.179806 [info ] [Thread-3 (]: 21 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 0.99s]
[0m02:59:10.179806 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m02:59:10.179806 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:59:10.179806 [info ] [Thread-3 (]: 24 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m02:59:10.179806 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m02:59:10.179806 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:59:10.179806 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:59:10.179806 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:59:10.195145 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:59:10.197152 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m02:59:10.197152 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m02:59:10.448607 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.538 seconds
[0m02:59:10.453896 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819AF09910>]}
[0m02:59:10.453896 [info ] [Thread-5 (]: 15 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 2.57s]
[0m02:59:10.453896 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m02:59:10.457929 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:59:10.457929 [info ] [Thread-5 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m02:59:10.457929 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_portfolio_performance, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m02:59:10.457929 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:59:10.466826 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:59:10.468955 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:59:10.475256 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:59:10.476646 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m02:59:10.478660 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m02:59:10.861571 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.139 seconds
[0m02:59:10.861571 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819A044BD0>]}
[0m02:59:10.861571 [info ] [Thread-4 (]: 22 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 1.16s]
[0m02:59:10.861571 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m02:59:10.861571 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:59:10.861571 [info ] [Thread-4 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m02:59:10.861571 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m02:59:10.861571 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:59:10.861571 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:59:10.861571 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:59:10.861571 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:59:10.877244 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m02:59:10.877244 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m02:59:10.940710 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.978 seconds
[0m02:59:10.940710 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000181838CD3D0>]}
[0m02:59:11.253350 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.057 seconds
[0m02:59:11.253350 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819C11D0D0>]}
[0m02:59:11.316251 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.838 seconds
[0m02:59:11.319002 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819C100910>]}
[0m02:59:11.848379 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.972 seconds
[0m02:59:11.848379 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '732ade60-2623-4d02-91bf-b62190ae4dad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001819B0B0D90>]}
[0m02:59:14.000182 [debug] [Thread-2 (]: An error was encountered while trying to send an event
[0m02:59:14.000911 [info ] [Thread-3 (]: 24 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 1.07s]
[0m02:59:14.000911 [info ] [Thread-5 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 0.86s]
[0m02:59:14.000911 [info ] [Thread-4 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 0.99s]
[0m02:59:14.003071 [info ] [Thread-2 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 1.00s]
[0m02:59:14.004167 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m02:59:14.005172 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m02:59:14.005887 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m02:59:14.005887 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m02:59:14.005887 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:59:14.005887 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m02:59:14.005887 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m02:59:14.994211 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m02:59:14.994211 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m02:59:16.087906 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_executive_summary' was left open.
[0m02:59:16.089918 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m02:59:17.057530 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_performance_drivers' was left open.
[0m02:59:17.058295 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m02:59:17.842352 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was left open.
[0m02:59:17.842352 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m02:59:18.850508 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_position_attribution' was left open.
[0m02:59:18.850508 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m02:59:19.682924 [info ] [MainThread]: 
[0m02:59:19.682924 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 0 minutes and 23.34 seconds (23.34s).
[0m02:59:19.682924 [debug] [MainThread]: Command end result
[0m02:59:19.736222 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m02:59:19.738230 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m02:59:19.745763 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m02:59:19.745763 [info ] [MainThread]: 
[0m02:59:19.745763 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:59:19.745763 [info ] [MainThread]: 
[0m02:59:19.745763 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m02:59:19.745763 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m02:59:19.745763 [debug] [MainThread]: Command `dbt build` succeeded at 02:59:19.745763 after 25.32 seconds
[0m02:59:19.745763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000181878C87D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018188BE2610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000181810B7950>]}
[0m02:59:19.745763 [debug] [MainThread]: Flushing usage events
[0m02:59:21.402699 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:00:18.870079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C8A0EC590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C8A0EE390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C8A0EE250>]}


============================== 03:00:18.878426 | e786b578-e391-4fb4-bf15-c4f3f0b3f764 ==============================
[0m03:00:18.878426 [info ] [MainThread]: Running with dbt=1.11.2
[0m03:00:18.878426 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_b', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m03:00:19.492704 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m03:00:19.492704 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m03:00:19.492704 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m03:00:19.602231 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m03:00:19.602231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9C50FB50>]}
[0m03:00:19.777087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C8A0DF490>]}
[0m03:00:19.840586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C890DD290>]}
[0m03:00:19.840586 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m03:00:20.157121 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m03:00:20.348430 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:00:20.348430 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m03:00:20.348430 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:00:20.364063 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m03:00:20.417176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9CA86A50>]}
[0m03:00:20.534412 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m03:00:20.537309 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m03:00:20.568218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9CD93890>]}
[0m03:00:20.568218 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m03:00:20.568218 [info ] [MainThread]: 
[0m03:00:20.568218 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m03:00:20.568218 [info ] [MainThread]: 
[0m03:00:20.568218 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:00:20.568218 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m03:00:20.631538 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m03:00:20.631538 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m03:00:20.631538 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:00:23.589132 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.948 seconds
[0m03:00:23.589132 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m03:00:23.606996 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m03:00:23.606996 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m03:00:23.606996 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:00:25.459959 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 1.845 seconds
[0m03:00:25.474929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9C432810>]}
[0m03:00:25.474929 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m03:00:25.474929 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m03:00:25.474929 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m03:00:25.474929 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m03:00:25.474929 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m03:00:25.474929 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m03:00:25.474929 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m03:00:25.474929 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m03:00:25.474929 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m03:00:25.474929 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m03:00:25.474929 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m03:00:25.474929 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m03:00:25.474929 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m03:00:25.474929 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m03:00:25.474929 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m03:00:25.490629 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m03:00:25.491275 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m03:00:25.491275 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m03:00:25.491275 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m03:00:25.506568 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m03:00:25.506568 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m03:00:25.509759 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m03:00:25.509759 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m03:00:25.522297 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m03:00:25.522297 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m03:00:25.538435 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m03:00:25.538435 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m03:00:25.538435 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m03:00:25.538435 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m03:00:25.538435 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m03:00:25.538435 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m03:00:25.538435 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m03:00:25.538435 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m03:00:25.538435 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m03:00:25.538435 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m03:00:25.554100 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m03:00:25.554100 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m03:00:25.554100 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m03:00:25.554100 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m03:00:25.554100 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m03:00:27.906912 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.353 seconds
[0m03:00:27.986506 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9D2DBE10>]}
[0m03:00:27.986506 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.51s]
[0m03:00:27.986506 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m03:00:28.161011 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.609 seconds
[0m03:00:28.161011 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9D4FD510>]}
[0m03:00:28.161011 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.69s]
[0m03:00:28.161011 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m03:00:28.192559 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.636 seconds
[0m03:00:28.192559 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9D4FCD50>]}
[0m03:00:28.192559 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.72s]
[0m03:00:28.192559 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m03:00:28.482393 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.927 seconds
[0m03:00:28.482393 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9D31FC50>]}
[0m03:00:28.492688 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 3.01s]
[0m03:00:28.493694 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m03:00:28.494695 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m03:00:28.495695 [info ] [Thread-3 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m03:00:28.496693 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m03:00:28.497695 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m03:00:28.505772 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m03:00:28.507621 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m03:00:28.514048 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m03:00:28.516773 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m03:00:28.517781 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m03:00:29.709556 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.190 seconds
[0m03:00:29.713434 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9D50FC50>]}
[0m03:00:29.719948 [info ] [Thread-3 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 1.22s]
[0m03:00:29.719948 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m03:00:29.722491 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m03:00:29.726071 [info ] [Thread-5 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m03:00:29.726071 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m03:00:29.728085 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m03:00:29.734123 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m03:00:29.734123 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m03:00:29.738878 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m03:00:29.738878 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m03:00:29.738878 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m03:00:30.799447 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.056 seconds
[0m03:00:30.799447 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9D45B710>]}
[0m03:00:30.799447 [info ] [Thread-5 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 1.07s]
[0m03:00:30.799447 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m03:00:30.799447 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m03:00:30.799447 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m03:00:30.799447 [info ] [Thread-2 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m03:00:30.799447 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m03:00:30.799447 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m03:00:30.799447 [info ] [Thread-3 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m03:00:30.799447 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.fact_trades)
[0m03:00:30.799447 [info ] [Thread-4 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m03:00:30.799447 [info ] [Thread-5 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m03:00:30.799447 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m03:00:30.799447 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m03:00:30.815502 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m03:00:30.815502 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m03:00:30.815502 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m03:00:30.822003 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m03:00:30.822003 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m03:00:30.822003 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m03:00:30.822003 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m03:00:30.831813 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m03:00:30.831813 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m03:00:30.831813 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m03:00:30.831813 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m03:00:30.831813 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m03:00:30.831813 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m03:00:30.847690 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m03:00:30.847690 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m03:00:30.847690 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m03:00:30.847690 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m03:00:30.858280 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m03:00:30.858280 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m03:00:30.858280 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m03:00:30.863514 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m03:00:30.863514 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

with_window_aggregates as (
    select
        trade_id,
        trade_date,
        portfolio_id,
        security_id,
        ticker,
        quantity,
        price,
        price as execution_price,
        trade_value,
        commission,
        round(avg(price) over (partition by trade_date, security_id), 2) as daily_avg_price,
        min(price) over (partition by trade_date, security_id) as daily_min_price,
        max(price) over (partition by trade_date, security_id) as daily_max_price,
        (max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)) as daily_price_range,
        round(stddev_pop(price) over (partition by trade_date, security_id), 4) as daily_volatility,
        round((price - min(price) over (partition by trade_date, security_id)) / nullif((max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)), 0), 8) as execution_percentile
    from trades_detail
)

select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    daily_min_price,
    daily_max_price,
    daily_price_range,
    daily_volatility,
    execution_percentile,
    round(100 * (price - daily_avg_price) / nullif(daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when execution_percentile > 0.75 then 'POOR'
        when execution_percentile > 0.50 then 'FAIR'
        when execution_percentile > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(commission / nullif(trade_value, 0), 8) as commission_ratio,
    round(100 * commission / nullif(trade_value, 0), 6) as commission_ratio_bps
from with_window_aggregates
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m03:00:30.866019 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m03:00:30.866777 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m03:00:30.869511 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m03:00:31.733552 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.870 seconds
[0m03:00:31.738539 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9D0D3350>]}
[0m03:00:31.738539 [info ] [Thread-2 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 0.94s]
[0m03:00:31.738539 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m03:00:31.877797 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.012 seconds
[0m03:00:31.877797 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.011 seconds
[0m03:00:31.877797 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C8A110610>]}
[0m03:00:31.889120 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9D50F9D0>]}
[0m03:00:31.889120 [info ] [Thread-4 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.08s]
[0m03:00:31.889120 [info ] [Thread-3 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.09s]
[0m03:00:31.893687 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m03:00:31.893687 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m03:00:31.893687 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m03:00:31.893687 [info ] [Thread-2 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m03:00:31.893687 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m03:00:31.893687 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m03:00:31.893687 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m03:00:31.893687 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m03:00:31.893687 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m03:00:31.893687 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m03:00:31.893687 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m03:00:32.422417 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.553 seconds
[0m03:00:32.426343 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9D4C2C90>]}
[0m03:00:32.426343 [info ] [Thread-5 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.61s]
[0m03:00:32.426343 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m03:00:32.426343 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m03:00:32.426343 [info ] [Thread-4 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m03:00:32.426343 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m03:00:32.426343 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m03:00:32.438594 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m03:00:32.439511 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m03:00:32.440948 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m03:00:32.440948 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m03:00:32.440948 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m03:00:33.241810 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.335 seconds
[0m03:00:33.241810 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9C53A2D0>]}
[0m03:00:33.241810 [info ] [Thread-2 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 1.35s]
[0m03:00:33.241810 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m03:00:33.493528 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.048 seconds
[0m03:00:33.493528 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e786b578-e391-4fb4-bf15-c4f3f0b3f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C9D451090>]}
[0m03:00:33.493528 [info ] [Thread-4 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.07s]
[0m03:00:33.493528 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m03:00:33.493528 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:00:33.493528 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m03:00:33.493528 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m03:00:34.121928 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m03:00:34.121928 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m03:00:34.999856 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m03:00:34.999856 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m03:00:36.018132 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m03:00:36.018734 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m03:00:37.000763 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m03:00:37.000763 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m03:00:38.079267 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_trade_summary' was left open.
[0m03:00:38.079267 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m03:00:39.053289 [info ] [MainThread]: 
[0m03:00:39.053289 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 18.49 seconds (18.49s).
[0m03:00:39.053289 [debug] [MainThread]: Command end result
[0m03:00:39.098178 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m03:00:39.099021 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m03:00:39.107444 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m03:00:39.107444 [info ] [MainThread]: 
[0m03:00:39.107444 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:00:39.107444 [info ] [MainThread]: 
[0m03:00:39.107444 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m03:00:39.107444 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m03:00:39.107444 [debug] [MainThread]: Command `dbt build` succeeded at 03:00:39.107444 after 20.32 seconds
[0m03:00:39.107444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C8A15F090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C834C7950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027C834C79D0>]}
[0m03:00:39.107444 [debug] [MainThread]: Flushing usage events
[0m03:00:41.768929 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:01:08.989759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231DFFDD990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231DFFDFF90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231DFFDE2D0>]}


============================== 03:01:08.989759 | 9d592e16-5c97-467d-95a1-7c7105b768d7 ==============================
[0m03:01:08.989759 [info ] [MainThread]: Running with dbt=1.11.2
[0m03:01:08.989759 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m03:01:09.600071 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m03:01:09.600071 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m03:01:09.600071 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m03:01:09.707419 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m03:01:09.707419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9d592e16-5c97-467d-95a1-7c7105b768d7', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F13BFB50>]}
[0m03:01:09.865452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9d592e16-5c97-467d-95a1-7c7105b768d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F142C250>]}
[0m03:01:09.995033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9d592e16-5c97-467d-95a1-7c7105b768d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F1342750>]}
[0m03:01:09.998695 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m03:01:10.428559 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m03:01:10.593515 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:01:10.593515 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m03:01:10.593515 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:01:10.608888 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m03:01:10.640717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9d592e16-5c97-467d-95a1-7c7105b768d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F1A52A10>]}
[0m03:01:10.798354 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m03:01:10.798354 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m03:01:10.829971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9d592e16-5c97-467d-95a1-7c7105b768d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F1CB0C50>]}
[0m03:01:10.829971 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m03:01:10.840612 [info ] [MainThread]: 
[0m03:01:10.840612 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m03:01:10.846051 [info ] [MainThread]: 
[0m03:01:10.846051 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:01:10.851230 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m03:01:10.925799 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m03:01:10.925799 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m03:01:10.925799 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:01:13.876818 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 2.947 seconds
[0m03:01:13.878825 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m03:01:13.890854 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m03:01:13.890854 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m03:01:13.890854 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:01:15.980744 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.087 seconds
[0m03:01:16.005858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d592e16-5c97-467d-95a1-7c7105b768d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F17864D0>]}
[0m03:01:16.020854 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m03:01:16.023052 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m03:01:16.023052 [info ] [Thread-2 (]: 1 of 4 START sql table model DEV.stg_cashflows ................................. [RUN]
[0m03:01:16.023052 [info ] [Thread-3 (]: 2 of 4 START sql table model DEV.stg_portfolios ................................ [RUN]
[0m03:01:16.026295 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m03:01:16.026295 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_portfolios'
[0m03:01:16.029511 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m03:01:16.029511 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m03:01:16.050818 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m03:01:16.052824 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m03:01:16.052824 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m03:01:16.070957 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m03:01:16.092245 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m03:01:16.096281 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m03:01:16.097264 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m03:01:16.098769 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m03:01:16.099773 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace transient table BAIN_ANALYTICS.DEV.stg_cashflows
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m03:01:16.099773 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace transient table BAIN_ANALYTICS.DEV.stg_portfolios
    
    
    
    as (-- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m03:01:16.099773 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m03:01:16.101070 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m03:01:18.338386 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.238 seconds
[0m03:01:18.353254 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d592e16-5c97-467d-95a1-7c7105b768d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F1FFC1D0>]}
[0m03:01:18.353254 [info ] [Thread-3 (]: 2 of 4 OK created sql table model DEV.stg_portfolios ........................... [[32mSUCCESS 1[0m in 2.33s]
[0m03:01:18.368183 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m03:01:18.368183 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m03:01:18.368183 [info ] [Thread-5 (]: 3 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m03:01:18.368183 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes'
[0m03:01:18.368183 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m03:01:18.368183 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m03:01:18.368183 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m03:01:18.368183 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m03:01:18.368183 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m03:01:18.368183 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m03:01:18.368183 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m03:01:19.299029 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.199 seconds
[0m03:01:19.305253 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d592e16-5c97-467d-95a1-7c7105b768d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F201D150>]}
[0m03:01:19.306259 [info ] [Thread-2 (]: 1 of 4 OK created sql table model DEV.stg_cashflows ............................ [[32mSUCCESS 1[0m in 3.28s]
[0m03:01:19.307164 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m03:01:19.308148 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m03:01:19.308148 [info ] [Thread-3 (]: 4 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m03:01:19.308148 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m03:01:19.308148 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m03:01:19.317370 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m03:01:19.318370 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m03:01:19.413177 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m03:01:19.416342 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m03:01:19.416342 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



-- Pre-aggregate at source to reduce rows before fact table join
with monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from BAIN_ANALYTICS.DEV.stg_cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m03:01:20.915149 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.498 seconds
[0m03:01:20.915149 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d592e16-5c97-467d-95a1-7c7105b768d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231DEF56390>]}
[0m03:01:20.915149 [info ] [Thread-3 (]: 4 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 1.61s]
[0m03:01:20.915149 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m03:01:21.198343 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.817 seconds
[0m03:01:21.198343 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d592e16-5c97-467d-95a1-7c7105b768d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231F246A190>]}
[0m03:01:21.198343 [info ] [Thread-5 (]: 3 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 2.83s]
[0m03:01:21.198343 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m03:01:21.206293 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:01:21.206293 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m03:01:21.206293 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m03:01:21.987250 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m03:01:21.987250 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m03:01:22.939385 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.stg_cashflows' was left open.
[0m03:01:22.939385 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m03:01:23.913266 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_cashflow_aggregated' was left open.
[0m03:01:23.916607 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m03:01:24.758554 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was left open.
[0m03:01:24.759213 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m03:01:25.789918 [info ] [MainThread]: 
[0m03:01:25.789918 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 14.94 seconds (14.94s).
[0m03:01:25.794208 [debug] [MainThread]: Command end result
[0m03:01:25.829800 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m03:01:25.829800 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m03:01:25.845952 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m03:01:25.845952 [info ] [MainThread]: 
[0m03:01:25.851381 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:01:25.851381 [info ] [MainThread]: 
[0m03:01:25.851381 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m03:01:25.851381 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m03:01:25.851381 [debug] [MainThread]: Command `dbt build` succeeded at 03:01:25.851381 after 16.94 seconds
[0m03:01:25.851381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231E0042B10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231E0043150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231E0043250>]}
[0m03:01:25.851381 [debug] [MainThread]: Flushing usage events
[0m03:01:27.306476 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:02:03.375597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD1E2DC050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD1E0821D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD1E2DF890>]}


============================== 03:02:03.375597 | 38b20c36-c049-476b-836b-a95119e84b27 ==============================
[0m03:02:03.375597 [info ] [MainThread]: Running with dbt=1.11.2
[0m03:02:03.375597 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'I:\\dianababaei\\dbt\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'I:\\dianababaei\\dbt\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_b', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m03:02:03.951762 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m03:02:03.967629 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m03:02:03.967629 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m03:02:04.093192 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`I:\dianababaei\dbt\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m03:02:04.093192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD2E3A4AD0>]}
[0m03:02:04.251313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD307977D0>]}
[0m03:02:04.299528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD1D2B9150>]}
[0m03:02:04.299528 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m03:02:04.635158 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m03:02:04.810676 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:02:04.810676 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m03:02:04.810676 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:02:04.829903 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m03:02:04.880219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD30D125D0>]}
[0m03:02:04.991953 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m03:02:04.991953 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m03:02:05.030232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD30F81890>]}
[0m03:02:05.030232 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m03:02:05.030232 [info ] [MainThread]: 
[0m03:02:05.030232 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m03:02:05.030232 [info ] [MainThread]: 
[0m03:02:05.039533 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:02:05.039533 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m03:02:05.112686 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m03:02:05.112686 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m03:02:05.112686 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:02:08.210466 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 3.097 seconds
[0m03:02:08.218353 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m03:02:08.228711 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m03:02:08.228711 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m03:02:08.228711 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:02:10.462688 [debug] [ThreadPool]: SQL status: SUCCESS 88 in 2.234 seconds
[0m03:02:10.478362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD30E8A690>]}
[0m03:02:10.478362 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m03:02:10.478362 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m03:02:10.478362 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m03:02:10.478362 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m03:02:10.478362 [info ] [Thread-2 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m03:02:10.478362 [info ] [Thread-3 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m03:02:10.478362 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m03:02:10.478362 [info ] [Thread-5 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m03:02:10.478362 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m03:02:10.478362 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_market_prices'
[0m03:02:10.478362 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_securities'
[0m03:02:10.478362 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_trades'
[0m03:02:10.478362 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m03:02:10.478362 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m03:02:10.478362 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m03:02:10.478362 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m03:02:10.494312 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m03:02:10.494312 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m03:02:10.494312 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m03:02:10.509984 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m03:02:10.509984 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m03:02:10.509984 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m03:02:10.509984 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m03:02:10.543819 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m03:02:10.543819 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m03:02:10.543819 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m03:02:10.543819 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m03:02:10.543819 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m03:02:10.543819 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m03:02:10.543819 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m03:02:10.558538 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m03:02:10.558538 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m03:02:10.558538 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m03:02:10.558538 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m03:02:10.558538 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m03:02:10.558538 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m03:02:10.558538 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m03:02:10.558538 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m03:02:10.558538 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m03:02:10.558538 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m03:02:12.518245 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.956 seconds
[0m03:02:12.598218 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD316DBCD0>]}
[0m03:02:12.598218 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 2.12s]
[0m03:02:12.598218 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m03:02:12.726152 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.165 seconds
[0m03:02:12.726152 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD316EAA10>]}
[0m03:02:12.726152 [info ] [Thread-3 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 2.25s]
[0m03:02:12.726152 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m03:02:12.742855 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.177 seconds
[0m03:02:12.746868 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD316F7F50>]}
[0m03:02:12.746868 [info ] [Thread-5 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 2.27s]
[0m03:02:12.746868 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m03:02:12.999055 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.437 seconds
[0m03:02:12.999055 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD30F51410>]}
[0m03:02:12.999055 [info ] [Thread-2 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 2.52s]
[0m03:02:12.999055 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m03:02:12.999055 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m03:02:12.999055 [info ] [Thread-4 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m03:02:12.999055 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m03:02:12.999055 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m03:02:12.999055 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m03:02:12.999055 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m03:02:13.015071 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m03:02:13.018377 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m03:02:13.018377 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m03:02:13.766538 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.748 seconds
[0m03:02:13.766538 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD3164D9D0>]}
[0m03:02:13.766538 [info ] [Thread-4 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 0.77s]
[0m03:02:13.766538 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m03:02:13.766538 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m03:02:13.766538 [info ] [Thread-5 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m03:02:13.766538 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m03:02:13.766538 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m03:02:13.766538 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m03:02:13.766538 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m03:02:13.782585 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m03:02:13.782585 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m03:02:13.782585 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m03:02:14.476816 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.692 seconds
[0m03:02:14.476816 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD30778610>]}
[0m03:02:14.476816 [info ] [Thread-5 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 0.71s]
[0m03:02:14.476816 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m03:02:14.476816 [debug] [Thread-3 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m03:02:14.476816 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m03:02:14.476816 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m03:02:14.476816 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m03:02:14.476816 [info ] [Thread-3 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m03:02:14.492507 [info ] [Thread-4 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m03:02:14.492507 [info ] [Thread-2 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m03:02:14.492507 [info ] [Thread-5 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m03:02:14.492507 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.fact_trades)
[0m03:02:14.492507 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m03:02:14.492507 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m03:02:14.492507 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m03:02:14.492507 [debug] [Thread-3 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m03:02:14.492507 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m03:02:14.492507 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m03:02:14.492507 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m03:02:14.492507 [debug] [Thread-3 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m03:02:14.505447 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m03:02:14.508477 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m03:02:14.508477 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m03:02:14.508477 [debug] [Thread-3 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m03:02:14.508477 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m03:02:14.508477 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m03:02:14.508477 [debug] [Thread-3 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m03:02:14.522588 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m03:02:14.522588 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m03:02:14.526618 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m03:02:14.528624 [debug] [Thread-3 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m03:02:14.528624 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m03:02:14.528624 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m03:02:14.528624 [debug] [Thread-3 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m03:02:14.528624 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m03:02:14.528624 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m03:02:14.528624 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m03:02:14.540253 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

with_window_aggregates as (
    select
        trade_id,
        trade_date,
        portfolio_id,
        security_id,
        ticker,
        quantity,
        price,
        price as execution_price,
        trade_value,
        commission,
        round(avg(price) over (partition by trade_date, security_id), 2) as daily_avg_price,
        min(price) over (partition by trade_date, security_id) as daily_min_price,
        max(price) over (partition by trade_date, security_id) as daily_max_price,
        (max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)) as daily_price_range,
        round(stddev_pop(price) over (partition by trade_date, security_id), 4) as daily_volatility,
        round((price - min(price) over (partition by trade_date, security_id)) / nullif((max(price) over (partition by trade_date, security_id) - min(price) over (partition by trade_date, security_id)), 0), 8) as execution_percentile
    from trades_detail
)

select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    daily_min_price,
    daily_max_price,
    daily_price_range,
    daily_volatility,
    execution_percentile,
    round(100 * (price - daily_avg_price) / nullif(daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when execution_percentile > 0.75 then 'POOR'
        when execution_percentile > 0.50 then 'FAIR'
        when execution_percentile > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(commission / nullif(trade_value, 0), 8) as commission_ratio,
    round(100 * commission / nullif(trade_value, 0), 6) as commission_ratio_bps
from with_window_aggregates
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m03:02:14.542673 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m03:02:15.542784 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.999 seconds
[0m03:02:15.542784 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.002 seconds
[0m03:02:15.542784 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD31463C50>]}
[0m03:02:15.542784 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD3067AF90>]}
[0m03:02:15.542784 [info ] [Thread-5 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 1.05s]
[0m03:02:15.542784 [info ] [Thread-2 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 1.05s]
[0m03:02:15.542784 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m03:02:15.542784 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m03:02:15.542784 [debug] [Thread-5 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m03:02:15.557790 [debug] [Thread-2 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m03:02:15.558294 [info ] [Thread-5 (]: 11 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m03:02:15.558294 [info ] [Thread-2 (]: 12 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m03:02:15.558294 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m03:02:15.558294 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m03:02:15.558294 [debug] [Thread-5 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m03:02:15.558294 [debug] [Thread-2 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m03:02:15.558294 [debug] [Thread-5 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m03:02:15.558294 [debug] [Thread-2 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m03:02:15.558294 [debug] [Thread-5 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m03:02:15.571968 [debug] [Thread-5 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m03:02:15.573973 [debug] [Thread-2 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m03:02:15.578843 [debug] [Thread-2 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m03:02:15.578843 [debug] [Thread-5 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m03:02:15.578843 [debug] [Thread-5 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m03:02:15.578843 [debug] [Thread-2 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m03:02:15.578843 [debug] [Thread-2 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m03:02:15.606696 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.065 seconds
[0m03:02:15.608702 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD31778AD0>]}
[0m03:02:15.608702 [info ] [Thread-4 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 1.12s]
[0m03:02:15.610707 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m03:02:15.811946 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.274 seconds
[0m03:02:15.811946 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD315F8190>]}
[0m03:02:15.811946 [info ] [Thread-3 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 1.32s]
[0m03:02:15.811946 [debug] [Thread-3 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m03:02:16.403231 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.820 seconds
[0m03:02:16.403231 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD316FF090>]}
[0m03:02:16.403231 [info ] [Thread-2 (]: 12 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 0.84s]
[0m03:02:16.403231 [debug] [Thread-2 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m03:02:16.642641 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.062 seconds
[0m03:02:16.642641 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38b20c36-c049-476b-836b-a95119e84b27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD31788490>]}
[0m03:02:16.642641 [info ] [Thread-5 (]: 11 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 1.08s]
[0m03:02:16.642641 [debug] [Thread-5 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m03:02:16.642641 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:02:16.642641 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was left open.
[0m03:02:16.642641 [debug] [MainThread]: On list_BAIN_ANALYTICS: Close
[0m03:02:17.256027 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was left open.
[0m03:02:17.256027 [debug] [MainThread]: On list_BAIN_ANALYTICS_DEV: Close
[0m03:02:18.174257 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was left open.
[0m03:02:18.176270 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m03:02:19.163424 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.fact_trades' was left open.
[0m03:02:19.164066 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.fact_trades: Close
[0m03:02:20.390108 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_security_performance' was left open.
[0m03:02:20.392798 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m03:02:21.358552 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was left open.
[0m03:02:21.359552 [debug] [MainThread]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m03:02:22.228883 [info ] [MainThread]: 
[0m03:02:22.230896 [info ] [MainThread]: Finished running 12 view models in 0 hours 0 minutes and 17.19 seconds (17.19s).
[0m03:02:22.238891 [debug] [MainThread]: Command end result
[0m03:02:22.329019 [debug] [MainThread]: Wrote artifact WritableManifest to I:\dianababaei\dbt\sample-dbt-project\target\manifest.json
[0m03:02:22.336956 [debug] [MainThread]: Wrote artifact SemanticManifest to I:\dianababaei\dbt\sample-dbt-project\target\semantic_manifest.json
[0m03:02:22.354293 [debug] [MainThread]: Wrote artifact RunExecutionResult to I:\dianababaei\dbt\sample-dbt-project\target\run_results.json
[0m03:02:22.355303 [info ] [MainThread]: 
[0m03:02:22.357320 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:02:22.358393 [info ] [MainThread]: 
[0m03:02:22.358393 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m03:02:22.360367 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m03:02:22.363843 [debug] [MainThread]: Command `dbt build` succeeded at 03:02:22.363843 after 19.05 seconds
[0m03:02:22.365783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD176B7950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD176B79D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CD1DF98090>]}
[0m03:02:22.367745 [debug] [MainThread]: Flushing usage events
[0m03:02:24.978130 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:33:46.974134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DDF22E4B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DE23806B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DE2B5B260>]}


============================== 13:33:46.977473 | 1d1958cc-bdf6-4677-ac78-4214d96bff03 ==============================
[0m13:33:46.977473 [info ] [MainThread]: Running with dbt=1.11.4
[0m13:33:46.977473 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --select tag:pipeline_b', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m13:33:48.161174 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m13:33:48.163253 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m13:33:48.164323 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m13:33:48.366665 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m13:33:48.366665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DE2332A50>]}
[0m13:33:48.994182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DE41B85C0>]}
[0m13:33:49.214909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DDFCA0890>]}
[0m13:33:49.217328 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m13:33:49.816647 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m13:33:50.097020 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m13:33:50.097020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DE2B5AAE0>]}
[0m13:33:55.157027 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m13:33:55.184504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DFEF88530>]}
[0m13:33:55.408761 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m13:33:55.414535 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m13:33:55.498956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D90D49010>]}
[0m13:33:55.499616 [info ] [MainThread]: Found 40 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m13:33:55.508307 [info ] [MainThread]: 
[0m13:33:55.508307 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:33:55.508307 [info ] [MainThread]: 
[0m13:33:55.508307 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:33:55.525786 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m13:33:55.655452 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m13:33:55.655452 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m13:33:55.655452 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:33:58.657787 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 2.999 seconds
[0m13:33:58.661138 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: Close
[0m13:33:59.594474 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m13:33:59.624618 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m13:33:59.624618 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m13:33:59.624618 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:34:01.889803 [debug] [ThreadPool]: SQL status: SUCCESS 55 in 2.262 seconds
[0m13:34:01.897954 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: Close
[0m13:34:02.584394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D8F7E5FD0>]}
[0m13:34:02.594548 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m13:34:02.596670 [info ] [Thread-4 (]: 1 of 10 START sql view model DEV.stg_brokers ................................... [RUN]
[0m13:34:02.596670 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m13:34:02.599569 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m13:34:02.616340 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m13:34:02.619645 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m13:34:02.683426 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m13:34:02.685986 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m13:34:02.686494 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m13:34:02.686494 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:34:06.610306 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.923 seconds
[0m13:34:06.671567 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_brokers: Close
[0m13:34:07.568433 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DDFEB8DD0>]}
[0m13:34:07.571974 [info ] [Thread-4 (]: 1 of 10 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 4.97s]
[0m13:34:07.573485 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m13:34:07.574527 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m13:34:07.578591 [info ] [Thread-4 (]: 2 of 10 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m13:34:07.578591 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.stg_market_prices)
[0m13:34:07.581621 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m13:34:07.594597 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m13:34:07.597859 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m13:34:07.604240 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m13:34:07.607398 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m13:34:07.607398 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m13:34:07.609419 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:34:10.668932 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.059 seconds
[0m13:34:10.674637 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: Close
[0m13:34:11.613857 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D90CBD3D0>]}
[0m13:34:11.616377 [info ] [Thread-4 (]: 2 of 10 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 4.03s]
[0m13:34:11.619069 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m13:34:11.619579 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m13:34:11.621599 [info ] [Thread-4 (]: 3 of 10 START sql view model DEV.stg_securities ................................ [RUN]
[0m13:34:11.623116 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.stg_securities)
[0m13:34:11.623116 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m13:34:11.631345 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m13:34:11.634605 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m13:34:11.641669 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m13:34:11.646435 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m13:34:11.647950 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m13:34:11.647950 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:34:14.956905 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.308 seconds
[0m13:34:14.964035 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: Close
[0m13:34:15.879907 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D91343AA0>]}
[0m13:34:15.881439 [info ] [Thread-4 (]: 3 of 10 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 4.26s]
[0m13:34:15.881439 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m13:34:15.884712 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m13:34:15.887743 [info ] [Thread-4 (]: 4 of 10 START sql view model DEV.stg_trades .................................... [RUN]
[0m13:34:15.889358 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.stg_trades)
[0m13:34:15.889358 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m13:34:15.899153 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m13:34:15.901747 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m13:34:15.909056 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m13:34:15.909056 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m13:34:15.909056 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m13:34:15.909056 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:34:18.283599 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.369 seconds
[0m13:34:18.287975 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_trades: Close
[0m13:34:19.108601 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D9147B3E0>]}
[0m13:34:19.111042 [info ] [Thread-4 (]: 4 of 10 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 3.22s]
[0m13:34:19.113050 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m13:34:19.114657 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m13:34:19.117741 [info ] [Thread-4 (]: 5 of 10 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m13:34:19.118871 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m13:34:19.118871 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m13:34:19.128614 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m13:34:19.133727 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m13:34:19.138487 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m13:34:19.144630 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m13:34:19.148072 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m13:34:19.148072 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:34:21.589144 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.442 seconds
[0m13:34:21.597767 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: Close
[0m13:34:22.294380 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D914A79E0>]}
[0m13:34:22.294380 [info ] [Thread-4 (]: 5 of 10 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 3.17s]
[0m13:34:22.298538 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m13:34:22.301399 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m13:34:22.302035 [info ] [Thread-4 (]: 6 of 10 START sql table model DEV.int_trade_metrics ............................ [RUN]
[0m13:34:22.303554 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m13:34:22.304700 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m13:34:22.312986 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m13:34:22.314613 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m13:34:22.337724 [debug] [Thread-4 (]:  adapter: Dropping relation "BAIN_ANALYTICS"."DEV"."INT_TRADE_METRICS" because it is a view and target relation BAIN_ANALYTICS.DEV.int_trade_metrics is of type table.
[0m13:34:22.354881 [debug] [Thread-4 (]: Applying DROP to: "BAIN_ANALYTICS"."DEV"."INT_TRADE_METRICS"
[0m13:34:22.378366 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m13:34:22.380042 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: drop view if exists "BAIN_ANALYTICS"."DEV"."INT_TRADE_METRICS" cascade
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */
[0m13:34:22.380042 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:34:24.849783 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.470 seconds
[0m13:34:24.887014 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m13:34:24.896951 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m13:34:24.897504 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace transient table BAIN_ANALYTICS.DEV.int_trade_metrics
    
    
    
    as (-- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
    )

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m13:34:27.561223 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.665 seconds
[0m13:34:27.568153 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: Close
[0m13:34:28.498271 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D9134B980>]}
[0m13:34:28.500883 [info ] [Thread-4 (]: 6 of 10 OK created sql table model DEV.int_trade_metrics ....................... [[32mSUCCESS 1[0m in 6.19s]
[0m13:34:28.504460 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m13:34:28.507004 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m13:34:28.507004 [info ] [Thread-4 (]: 7 of 10 START sql view model DEV.int_security_performance ...................... [RUN]
[0m13:34:28.507004 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m13:34:28.511436 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m13:34:28.520522 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m13:34:28.523223 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m13:34:28.528097 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m13:34:28.528097 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m13:34:28.528097 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m13:34:28.528097 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:34:31.709759 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.173 seconds
[0m13:34:31.714529 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m13:34:32.721664 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D913464B0>]}
[0m13:34:32.721664 [info ] [Thread-4 (]: 7 of 10 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 4.21s]
[0m13:34:32.725896 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m13:34:32.725896 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m13:34:32.729057 [info ] [Thread-4 (]: 8 of 10 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m13:34:32.729057 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_security_performance, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m13:34:32.729057 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m13:34:32.737521 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m13:34:32.739751 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m13:34:32.749802 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m13:34:32.754493 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m13:34:32.756346 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m13:34:32.756346 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:34:35.509031 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.751 seconds
[0m13:34:35.514346 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: Close
[0m13:34:36.404419 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DDFB61940>]}
[0m13:34:36.406386 [info ] [Thread-4 (]: 8 of 10 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 3.68s]
[0m13:34:36.408232 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m13:34:36.409380 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m13:34:36.410793 [info ] [Thread-4 (]: 9 of 10 START sql view model DEV.int_trade_summary ............................. [RUN]
[0m13:34:36.411971 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m13:34:36.412578 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m13:34:36.419472 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m13:34:36.419472 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m13:34:36.429574 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m13:34:36.433425 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m13:34:36.434473 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m13:34:36.436546 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:34:39.021235 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.585 seconds
[0m13:34:39.026235 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m13:34:39.893075 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DDFB61BE0>]}
[0m13:34:39.894181 [info ] [Thread-4 (]: 9 of 10 OK created sql view model DEV.int_trade_summary ........................ [[32mSUCCESS 1[0m in 3.48s]
[0m13:34:39.897372 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m13:34:39.897372 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m13:34:39.903509 [info ] [Thread-4 (]: 10 of 10 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m13:34:39.906540 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m13:34:39.906540 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m13:34:39.918968 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m13:34:39.921480 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m13:34:39.926746 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m13:34:39.933332 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m13:34:39.934468 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m13:34:39.936625 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:34:42.587694 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.651 seconds
[0m13:34:42.591252 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m13:34:43.568735 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d1958cc-bdf6-4677-ac78-4214d96bff03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D914A45F0>]}
[0m13:34:43.571852 [info ] [Thread-4 (]: 10 of 10 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 3.66s]
[0m13:34:43.573598 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m13:34:43.578193 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:34:43.578193 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was properly closed.
[0m13:34:43.578193 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was properly closed.
[0m13:34:43.581726 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was properly closed.
[0m13:34:43.581726 [info ] [MainThread]: 
[0m13:34:43.584446 [info ] [MainThread]: Finished running 1 table model, 9 view models in 0 hours 0 minutes and 48.07 seconds (48.07s).
[0m13:34:43.587669 [debug] [MainThread]: Command end result
[0m13:34:43.676379 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m13:34:43.681718 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m13:34:43.697169 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\BiaDigi\sample-dbt-project\target\run_results.json
[0m13:34:43.697169 [info ] [MainThread]: 
[0m13:34:43.699858 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:34:43.699858 [info ] [MainThread]: 
[0m13:34:43.699858 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=10
[0m13:34:43.699858 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m13:34:43.705339 [debug] [MainThread]: Command `dbt build` succeeded at 13:34:43.705339 after 56.81 seconds
[0m13:34:43.705339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DE3FA7590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DE3FA6D50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DE3FA6750>]}
[0m13:34:43.705339 [debug] [MainThread]: Flushing usage events
[0m13:34:46.649315 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:56:35.198866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C1F0F5970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C1AFEE630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C1F288EC0>]}


============================== 20:56:35.203907 | 8fa4a1a9-c67f-4ead-b026-f392926a2949 ==============================
[0m20:56:35.203907 [info ] [MainThread]: Running with dbt=1.11.4
[0m20:56:35.203907 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_b', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m20:56:42.493652 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m20:56:42.495666 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m20:56:42.495666 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m20:56:42.596554 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m20:56:42.597561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C1F42AB10>]}
[0m20:56:42.775498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4A4C5BE0>]}
[0m20:56:42.834705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C1DDFE420>]}
[0m20:56:42.836022 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m20:56:43.569067 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m20:56:45.278966 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 1 files changed.
[0m20:56:45.278966 [debug] [MainThread]: Partial parsing: added file: bain_capital_portfolio_analytics://models\pipeline_b\marts\report_trading_performance.sql
[0m20:56:45.278966 [debug] [MainThread]: Partial parsing: added file: bain_capital_portfolio_analytics://models\pipeline_b\marts\fact_trades.sql
[0m20:56:45.278966 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://models\pipeline_b\intermediate\int_trade_metrics.sql
[0m20:56:45.524569 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m20:56:45.538092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4A4FD220>]}
[0m20:56:45.607029 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m20:56:45.610039 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m20:56:45.636688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4A92E240>]}
[0m20:56:45.640297 [info ] [MainThread]: Found 42 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m20:56:45.642047 [info ] [MainThread]: 
[0m20:56:45.642047 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:56:45.642047 [info ] [MainThread]: 
[0m20:56:45.642047 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:56:45.644058 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m20:56:48.501316 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m20:56:48.501316 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m20:56:48.501316 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:56:52.600296 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 4.098 seconds
[0m20:56:52.601310 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: Close
[0m20:56:53.519023 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m20:56:53.531044 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m20:56:53.531044 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m20:56:53.531044 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:56:56.993436 [debug] [ThreadPool]: SQL status: SUCCESS 55 in 3.461 seconds
[0m20:56:56.998918 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: Close
[0m20:56:57.982666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4A492420>]}
[0m20:56:57.989714 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m20:56:57.989714 [info ] [Thread-4 (]: 1 of 12 START sql view model DEV.stg_brokers ................................... [RUN]
[0m20:56:57.989714 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m20:56:57.994815 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m20:56:58.005163 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m20:56:58.006309 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m20:56:58.030406 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m20:56:58.035446 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m20:56:58.035446 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m20:56:58.035446 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:57:01.378085 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.342 seconds
[0m20:57:01.411237 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_brokers: Close
[0m20:57:02.250799 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C1F246870>]}
[0m20:57:02.250799 [info ] [Thread-4 (]: 1 of 12 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 4.26s]
[0m20:57:02.254175 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m20:57:02.254175 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m20:57:02.255905 [info ] [Thread-4 (]: 2 of 12 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m20:57:02.256398 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.stg_market_prices)
[0m20:57:02.256398 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m20:57:02.262559 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m20:57:02.264831 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m20:57:02.270225 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m20:57:02.272278 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m20:57:02.273277 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m20:57:02.273277 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:57:05.498014 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.224 seconds
[0m20:57:05.501799 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: Close
[0m20:57:07.202949 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4A8C8470>]}
[0m20:57:07.204268 [info ] [Thread-4 (]: 2 of 12 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 4.95s]
[0m20:57:07.204268 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m20:57:07.206259 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m20:57:07.206259 [info ] [Thread-4 (]: 3 of 12 START sql view model DEV.stg_securities ................................ [RUN]
[0m20:57:07.208271 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.stg_securities)
[0m20:57:07.209285 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m20:57:07.214799 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m20:57:07.214799 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m20:57:07.219917 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m20:57:07.221929 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m20:57:07.223943 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m20:57:07.223943 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:57:13.187187 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 5.962 seconds
[0m20:57:13.192034 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: Close
[0m20:57:14.178417 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4A165310>]}
[0m20:57:14.180241 [info ] [Thread-4 (]: 3 of 12 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 6.97s]
[0m20:57:14.180241 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m20:57:14.180241 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m20:57:14.180241 [info ] [Thread-4 (]: 4 of 12 START sql view model DEV.stg_trades .................................... [RUN]
[0m20:57:14.183509 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.stg_trades)
[0m20:57:14.183509 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m20:57:14.185411 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m20:57:14.190483 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m20:57:14.192490 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m20:57:14.195499 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m20:57:14.195499 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m20:57:14.197505 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:57:18.722515 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.525 seconds
[0m20:57:18.726592 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_trades: Close
[0m20:57:20.053411 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4C03E060>]}
[0m20:57:20.053411 [info ] [Thread-4 (]: 4 of 12 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 5.87s]
[0m20:57:20.055424 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m20:57:20.057436 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m20:57:20.057436 [info ] [Thread-4 (]: 5 of 12 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m20:57:20.057436 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m20:57:20.060764 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m20:57:20.065861 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m20:57:20.071688 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m20:57:20.075810 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m20:57:20.077820 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m20:57:20.077820 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m20:57:20.077820 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:57:24.312534 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.233 seconds
[0m20:57:24.317576 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: Close
[0m20:57:26.443223 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4A491E80>]}
[0m20:57:26.444836 [info ] [Thread-4 (]: 5 of 12 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 6.39s]
[0m20:57:26.445279 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m20:57:26.445602 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m20:57:26.445602 [info ] [Thread-4 (]: 6 of 12 START sql view model DEV.int_trade_metrics ............................. [RUN]
[0m20:57:26.445602 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m20:57:26.445602 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m20:57:26.449529 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m20:57:26.450538 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m20:57:26.456186 [debug] [Thread-4 (]: Dropping relation "BAIN_ANALYTICS"."DEV"."INT_TRADE_METRICS" because it is of type table
[0m20:57:26.460183 [debug] [Thread-4 (]: Applying DROP to: "BAIN_ANALYTICS"."DEV"."INT_TRADE_METRICS"
[0m20:57:26.467686 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m20:57:26.467686 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: drop table if exists "BAIN_ANALYTICS"."DEV"."INT_TRADE_METRICS" cascade
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */
[0m20:57:26.467686 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:57:33.391922 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 6.924 seconds
[0m20:57:33.394947 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m20:57:33.398970 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m20:57:33.399982 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_trade_metrics
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m20:57:34.654311 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.254 seconds
[0m20:57:34.658010 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: Close
[0m20:57:36.581734 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4AC68590>]}
[0m20:57:36.583945 [info ] [Thread-4 (]: 6 of 12 OK created sql view model DEV.int_trade_metrics ........................ [[32mSUCCESS 1[0m in 10.14s]
[0m20:57:36.585026 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m20:57:36.585026 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_trades
[0m20:57:36.588159 [info ] [Thread-4 (]: 7 of 12 START sql view model DEV.fact_trades ................................... [RUN]
[0m20:57:36.589197 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.fact_trades)
[0m20:57:36.590199 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_trades
[0m20:57:36.594661 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m20:57:36.596715 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_trades
[0m20:57:36.601791 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_trades"
[0m20:57:36.603752 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_trades"
[0m20:57:36.603752 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_trades: create or replace   view BAIN_ANALYTICS.DEV.fact_trades
  
  
  
  
  as (
    -- Pipeline B: Fact Layer
-- fact_trades.sql
-- Purpose: Detailed trade fact table with all metrics



select * from BAIN_ANALYTICS.DEV.int_trade_metrics
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_trades"} */;
[0m20:57:36.604752 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:57:40.476329 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.873 seconds
[0m20:57:40.481764 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_trades: Close
[0m20:57:42.450148 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4C03B2C0>]}
[0m20:57:42.450148 [info ] [Thread-4 (]: 7 of 12 OK created sql view model DEV.fact_trades .............................. [[32mSUCCESS 1[0m in 5.86s]
[0m20:57:42.452162 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_trades
[0m20:57:42.452162 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m20:57:42.454175 [info ] [Thread-4 (]: 8 of 12 START sql view model DEV.int_security_performance ...................... [RUN]
[0m20:57:42.455187 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_trades, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m20:57:42.455187 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m20:57:42.460219 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m20:57:42.462234 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m20:57:42.467888 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m20:57:42.469893 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m20:57:42.470899 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m20:57:42.470899 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:57:46.371242 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.900 seconds
[0m20:57:46.375616 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m20:57:48.596006 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C1A87E210>]}
[0m20:57:48.598020 [info ] [Thread-4 (]: 8 of 12 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 6.14s]
[0m20:57:48.598020 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m20:57:48.600031 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m20:57:48.601623 [info ] [Thread-4 (]: 9 of 12 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m20:57:48.601623 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_security_performance, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m20:57:48.601623 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m20:57:48.608891 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m20:57:48.611191 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m20:57:48.615272 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m20:57:48.617792 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m20:57:48.617792 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m20:57:48.617792 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:57:55.531129 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 6.910 seconds
[0m20:57:55.536181 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: Close
[0m20:57:56.738887 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4A6DD760>]}
[0m20:57:56.741034 [info ] [Thread-4 (]: 9 of 12 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 8.14s]
[0m20:57:56.742095 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m20:57:56.743104 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m20:57:56.744561 [info ] [Thread-4 (]: 10 of 12 START sql view model DEV.int_trade_summary ............................ [RUN]
[0m20:57:56.745574 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m20:57:56.746575 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m20:57:56.751572 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m20:57:56.753632 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m20:57:56.758233 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m20:57:56.759690 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m20:57:56.760771 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m20:57:56.761772 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:58:01.081452 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.320 seconds
[0m20:58:01.087520 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m20:58:01.960998 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4A4FE7E0>]}
[0m20:58:01.961997 [info ] [Thread-4 (]: 10 of 12 OK created sql view model DEV.int_trade_summary ....................... [[32mSUCCESS 1[0m in 5.21s]
[0m20:58:01.963648 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m20:58:01.964659 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m20:58:01.965712 [info ] [Thread-4 (]: 11 of 12 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m20:58:01.965712 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m20:58:01.966733 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m20:58:01.971668 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m20:58:01.973590 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m20:58:01.979637 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m20:58:01.981757 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m20:58:01.982890 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m20:58:01.982890 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:58:05.501897 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.519 seconds
[0m20:58:05.504459 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m20:58:06.564896 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4C640290>]}
[0m20:58:06.565981 [info ] [Thread-4 (]: 11 of 12 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 4.60s]
[0m20:58:06.567831 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m20:58:06.568139 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m20:58:06.569204 [info ] [Thread-4 (]: 12 of 12 START sql view model DEV.report_trading_performance ................... [RUN]
[0m20:58:06.570207 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_trade_performance, now model.bain_capital_portfolio_analytics.report_trading_performance)
[0m20:58:06.571207 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trading_performance
[0m20:58:06.576668 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m20:58:06.577071 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trading_performance
[0m20:58:06.582533 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m20:58:06.582533 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trading_performance"
[0m20:58:06.582533 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trading_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trading_performance.sql
-- Purpose: Trading performance summary by portfolio and security



select * from BAIN_ANALYTICS.DEV.int_trade_summary
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trading_performance"} */;
[0m20:58:06.582533 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:58:11.348429 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.763 seconds
[0m20:58:11.352238 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trading_performance: Close
[0m20:58:12.592555 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fa4a1a9-c67f-4ead-b026-f392926a2949', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C4C643A10>]}
[0m20:58:12.592555 [info ] [Thread-4 (]: 12 of 12 OK created sql view model DEV.report_trading_performance .............. [[32mSUCCESS 1[0m in 6.02s]
[0m20:58:12.592555 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trading_performance
[0m20:58:12.594999 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:58:12.594999 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was properly closed.
[0m20:58:12.594999 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was properly closed.
[0m20:58:12.594999 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trading_performance' was properly closed.
[0m20:58:12.594999 [info ] [MainThread]: 
[0m20:58:12.596708 [info ] [MainThread]: Finished running 12 view models in 0 hours 1 minutes and 26.95 seconds (86.95s).
[0m20:58:12.597721 [debug] [MainThread]: Command end result
[0m20:58:12.624413 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m20:58:12.624413 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m20:58:12.629541 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\BiaDigi\sample-dbt-project\target\run_results.json
[0m20:58:12.629541 [info ] [MainThread]: 
[0m20:58:12.629541 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:58:12.629541 [info ] [MainThread]: 
[0m20:58:12.629541 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=12
[0m20:58:12.629541 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m20:58:12.629541 [debug] [MainThread]: Command `dbt build` succeeded at 20:58:12.629541 after 97.50 seconds
[0m20:58:12.629541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C1DD95730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C1DD96660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023C1F05B620>]}
[0m20:58:12.629541 [debug] [MainThread]: Flushing usage events
[0m20:58:16.914878 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:38:22.977058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A41F39FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A4502AFC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A4502B500>]}


============================== 23:38:22.982208 | 758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb ==============================
[0m23:38:22.982208 [info ] [MainThread]: Running with dbt=1.11.4
[0m23:38:22.982208 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_b', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m23:38:29.646461 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:38:29.646461 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:38:29.648475 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:38:29.756721 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m23:38:29.762132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A6F00DDC0>]}
[0m23:38:29.950547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A70884B30>]}
[0m23:38:30.007726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A70886000>]}
[0m23:38:30.009362 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m23:38:30.465530 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m23:38:32.291526 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 0 files added, 1 files changed.
[0m23:38:32.293538 [debug] [MainThread]: Partial parsing: deleted file: bain_capital_portfolio_analytics://models\pipeline_b\marts\report_trading_performance.sql
[0m23:38:32.294259 [debug] [MainThread]: Partial parsing: deleted file: bain_capital_portfolio_analytics://models\pipeline_b\marts\fact_trades.sql
[0m23:38:32.294259 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://models\pipeline_b\intermediate\int_trade_metrics.sql
[0m23:38:32.533488 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m23:38:32.543518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A730DFA40>]}
[0m23:38:32.609014 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m23:38:32.614105 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m23:38:32.639751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A730E16D0>]}
[0m23:38:32.639751 [info ] [MainThread]: Found 40 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m23:38:32.646646 [info ] [MainThread]: 
[0m23:38:32.646646 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:38:32.646646 [info ] [MainThread]: 
[0m23:38:32.646646 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:38:32.650525 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m23:38:34.916910 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m23:38:34.917909 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m23:38:34.917909 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:38:41.329658 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 6.413 seconds
[0m23:38:41.331663 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: Close
[0m23:38:42.036826 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m23:38:42.054359 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m23:38:42.054359 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m23:38:42.056370 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:38:47.974887 [debug] [ThreadPool]: SQL status: SUCCESS 55 in 5.920 seconds
[0m23:38:47.978652 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: Close
[0m23:38:49.433522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A71EE68D0>]}
[0m23:38:49.441363 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m23:38:49.441363 [info ] [Thread-4 (]: 1 of 10 START sql view model DEV.stg_brokers ................................... [RUN]
[0m23:38:49.442551 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m23:38:49.443559 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m23:38:49.453625 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m23:38:49.454822 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m23:38:49.478909 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m23:38:49.479832 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m23:38:49.479832 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m23:38:49.479832 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m23:38:54.114211 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.634 seconds
[0m23:38:54.142728 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_brokers: Close
[0m23:38:54.801518 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A44760AD0>]}
[0m23:38:54.801518 [info ] [Thread-4 (]: 1 of 10 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 5.36s]
[0m23:38:54.801518 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m23:38:54.801518 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m23:38:54.805485 [info ] [Thread-4 (]: 2 of 10 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m23:38:54.806813 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.stg_market_prices)
[0m23:38:54.806813 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m23:38:54.889169 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m23:38:54.889169 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m23:38:54.894180 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m23:38:54.894180 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m23:38:54.894180 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m23:38:54.894180 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:39:00.389793 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 5.493 seconds
[0m23:39:00.395189 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: Close
[0m23:39:00.990098 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A71E8F980>]}
[0m23:39:00.992009 [info ] [Thread-4 (]: 2 of 10 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 6.18s]
[0m23:39:00.993139 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m23:39:00.994150 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m23:39:00.995230 [info ] [Thread-4 (]: 3 of 10 START sql view model DEV.stg_securities ................................ [RUN]
[0m23:39:00.996208 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.stg_securities)
[0m23:39:00.997224 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m23:39:01.002712 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m23:39:01.004638 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m23:39:01.005719 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m23:39:01.010813 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m23:39:01.010813 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m23:39:01.010813 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:39:03.721806 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.709 seconds
[0m23:39:03.726185 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: Close
[0m23:39:04.421513 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A719671A0>]}
[0m23:39:04.423052 [info ] [Thread-4 (]: 3 of 10 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 3.42s]
[0m23:39:04.424048 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m23:39:04.425046 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m23:39:04.425829 [info ] [Thread-4 (]: 4 of 10 START sql view model DEV.stg_trades .................................... [RUN]
[0m23:39:04.426961 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.stg_trades)
[0m23:39:04.426961 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m23:39:04.431940 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m23:39:04.433942 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m23:39:04.437985 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m23:39:04.439985 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m23:39:04.439985 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m23:39:04.440984 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:39:08.729458 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.289 seconds
[0m23:39:08.733926 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_trades: Close
[0m23:39:09.493954 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A736A80E0>]}
[0m23:39:09.494464 [info ] [Thread-4 (]: 4 of 10 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 5.07s]
[0m23:39:09.495480 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m23:39:09.497473 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m23:39:09.498301 [info ] [Thread-4 (]: 5 of 10 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m23:39:09.499395 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m23:39:09.499771 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m23:39:09.506444 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m23:39:09.507444 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m23:39:09.515521 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m23:39:09.517119 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m23:39:09.518220 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m23:39:09.518220 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:39:13.142188 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.624 seconds
[0m23:39:13.146822 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: Close
[0m23:39:13.929675 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A736AA120>]}
[0m23:39:13.930249 [info ] [Thread-4 (]: 5 of 10 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 4.43s]
[0m23:39:13.932173 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m23:39:13.933182 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m23:39:13.934033 [info ] [Thread-4 (]: 6 of 10 START sql table model DEV.int_trade_metrics ............................ [RUN]
[0m23:39:13.935757 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m23:39:13.935757 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m23:39:13.942098 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m23:39:13.944107 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m23:39:13.957003 [debug] [Thread-4 (]:  adapter: Dropping relation "BAIN_ANALYTICS"."DEV"."INT_TRADE_METRICS" because it is a view and target relation BAIN_ANALYTICS.DEV.int_trade_metrics is of type table.
[0m23:39:13.962710 [debug] [Thread-4 (]: Applying DROP to: "BAIN_ANALYTICS"."DEV"."INT_TRADE_METRICS"
[0m23:39:13.966785 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m23:39:13.966785 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: drop view if exists "BAIN_ANALYTICS"."DEV"."INT_TRADE_METRICS" cascade
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */
[0m23:39:13.967777 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:39:18.244734 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.277 seconds
[0m23:39:18.267580 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m23:39:18.270349 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m23:39:18.270349 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace transient table BAIN_ANALYTICS.DEV.int_trade_metrics
    
    
    
    as (-- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
    )

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m23:39:21.608181 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.336 seconds
[0m23:39:21.611205 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: Close
[0m23:39:22.517214 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A7186AAE0>]}
[0m23:39:22.517743 [info ] [Thread-4 (]: 6 of 10 OK created sql table model DEV.int_trade_metrics ....................... [[32mSUCCESS 1[0m in 8.58s]
[0m23:39:22.517743 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m23:39:22.518748 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m23:39:22.518748 [info ] [Thread-4 (]: 7 of 10 START sql view model DEV.int_security_performance ...................... [RUN]
[0m23:39:22.518748 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m23:39:22.518748 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m23:39:22.518748 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m23:39:22.523991 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m23:39:22.523991 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m23:39:22.523991 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m23:39:22.523991 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m23:39:22.523991 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:39:26.424308 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.896 seconds
[0m23:39:26.425895 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m23:39:27.203061 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A7167A480>]}
[0m23:39:27.203061 [info ] [Thread-4 (]: 7 of 10 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 4.68s]
[0m23:39:27.203061 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m23:39:27.208297 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m23:39:27.208297 [info ] [Thread-4 (]: 8 of 10 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m23:39:27.208297 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_security_performance, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m23:39:27.211646 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m23:39:27.218433 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m23:39:27.218433 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m23:39:27.223465 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m23:39:27.225475 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m23:39:27.225475 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m23:39:27.227485 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:39:33.361189 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 6.134 seconds
[0m23:39:33.365224 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: Close
[0m23:39:34.178386 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A715F3500>]}
[0m23:39:34.179114 [info ] [Thread-4 (]: 8 of 10 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 6.97s]
[0m23:39:34.180246 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m23:39:34.181165 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m23:39:34.182163 [info ] [Thread-4 (]: 9 of 10 START sql view model DEV.int_trade_summary ............................. [RUN]
[0m23:39:34.183160 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m23:39:34.184163 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m23:39:34.188668 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m23:39:34.190764 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m23:39:34.194192 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m23:39:34.195126 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m23:39:34.196121 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m23:39:34.196121 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:39:40.702347 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 6.506 seconds
[0m23:39:40.706371 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m23:39:43.271936 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A4204E4E0>]}
[0m23:39:43.272949 [info ] [Thread-4 (]: 9 of 10 OK created sql view model DEV.int_trade_summary ........................ [[32mSUCCESS 1[0m in 9.09s]
[0m23:39:43.273949 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m23:39:43.275366 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m23:39:43.276443 [info ] [Thread-4 (]: 10 of 10 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m23:39:43.277446 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m23:39:43.278444 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m23:39:43.281441 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m23:39:43.281441 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m23:39:43.286617 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m23:39:43.291811 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m23:39:43.291811 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m23:39:43.291811 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m23:39:49.024749 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 5.731 seconds
[0m23:39:49.028749 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m23:39:49.814089 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '758c5f2a-c620-49e0-8dc2-c8cf8ea3a0eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A4204DB80>]}
[0m23:39:49.814089 [info ] [Thread-4 (]: 10 of 10 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 6.54s]
[0m23:39:49.814089 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m23:39:49.817739 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:39:49.817739 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was properly closed.
[0m23:39:49.817739 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was properly closed.
[0m23:39:49.817739 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was properly closed.
[0m23:39:49.817739 [info ] [MainThread]: 
[0m23:39:49.823084 [info ] [MainThread]: Finished running 1 table model, 9 view models in 0 hours 1 minutes and 17.17 seconds (77.17s).
[0m23:39:49.825097 [debug] [MainThread]: Command end result
[0m23:39:49.864432 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m23:39:49.869476 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m23:39:49.876511 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\BiaDigi\sample-dbt-project\target\run_results.json
[0m23:39:49.876511 [info ] [MainThread]: 
[0m23:39:49.876511 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:39:49.876511 [info ] [MainThread]: 
[0m23:39:49.878520 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=10
[0m23:39:49.879528 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m23:39:49.879528 [debug] [MainThread]: Command `dbt build` succeeded at 23:39:49.879528 after 87.01 seconds
[0m23:39:49.879528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A463766C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A46421DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015A44F69F40>]}
[0m23:39:49.879528 [debug] [MainThread]: Flushing usage events
[0m23:39:53.599347 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:38:05.477387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2AB3DF7D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2AA506270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2AB3DCEF0>]}


============================== 13:38:05.483389 | bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7 ==============================
[0m13:38:05.483389 [info ] [MainThread]: Running with dbt=1.11.4
[0m13:38:05.483389 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --select tag:pipeline_c', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m13:38:09.991432 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m13:38:09.992432 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m13:38:09.992432 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m13:38:10.080314 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m13:38:10.081314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D7406E40>]}
[0m13:38:10.585659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D79CAEA0>]}
[0m13:38:10.674011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D6C36000>]}
[0m13:38:10.676010 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m13:38:11.242897 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m13:38:15.303954 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:38:15.304964 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m13:38:15.304964 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:38:15.311959 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m13:38:15.342057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D7CEEA50>]}
[0m13:38:15.411551 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m13:38:15.438041 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m13:38:15.517594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D7ED94C0>]}
[0m13:38:15.518883 [info ] [MainThread]: Found 40 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m13:38:15.521279 [info ] [MainThread]: 
[0m13:38:15.522287 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:38:15.522287 [info ] [MainThread]: 
[0m13:38:15.522287 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:38:15.525817 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m13:38:19.428430 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m13:38:19.428430 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m13:38:19.429433 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:38:33.123269 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 13.694 seconds
[0m13:38:33.126264 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: Close
[0m13:38:37.384136 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m13:38:37.401144 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m13:38:37.402146 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m13:38:37.402146 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:38:52.744399 [debug] [ThreadPool]: SQL status: SUCCESS 55 in 15.342 seconds
[0m13:38:52.750395 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: Close
[0m13:38:57.048727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2A8800FE0>]}
[0m13:38:57.061605 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m13:38:57.062607 [info ] [Thread-4 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m13:38:57.064604 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m13:38:57.065607 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m13:38:57.076601 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m13:38:57.078603 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m13:38:57.114414 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m13:38:57.116410 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m13:38:57.117410 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m13:38:57.117410 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:39:06.526801 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 9.409 seconds
[0m13:39:06.562518 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: Close
[0m13:39:08.406123 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2A8728EC0>]}
[0m13:39:08.407123 [info ] [Thread-4 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 11.34s]
[0m13:39:08.409178 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m13:39:08.409178 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m13:39:08.411124 [info ] [Thread-4 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m13:39:08.412035 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.stg_benchmarks)
[0m13:39:08.413050 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m13:39:08.418314 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m13:39:08.422481 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m13:39:08.427937 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m13:39:08.431545 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m13:39:08.432058 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m13:39:08.432697 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:13.066089 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.633 seconds
[0m13:39:13.070085 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: Close
[0m13:39:15.749871 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D997E810>]}
[0m13:39:15.750887 [info ] [Thread-4 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 7.34s]
[0m13:39:15.752880 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m13:39:15.753832 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m13:39:15.754935 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m13:39:15.754935 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks)
[0m13:39:15.755943 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m13:39:15.759133 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m13:39:15.761422 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m13:39:15.764470 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m13:39:15.765575 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m13:39:15.765575 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m13:39:15.765575 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:18.677131 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.911 seconds
[0m13:39:18.680386 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: Close
[0m13:39:20.060306 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D993CA70>]}
[0m13:39:20.061310 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 4.31s]
[0m13:39:20.061310 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m13:39:20.062309 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m13:39:20.062309 [info ] [Thread-4 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m13:39:20.063312 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.stg_positions_daily)
[0m13:39:20.063312 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m13:39:20.065312 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m13:39:20.066312 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m13:39:20.068311 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m13:39:20.070311 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m13:39:20.070311 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m13:39:20.071385 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:23.894583 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.823 seconds
[0m13:39:23.901583 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: Close
[0m13:39:25.382839 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D9A1D460>]}
[0m13:39:25.384852 [info ] [Thread-4 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 5.32s]
[0m13:39:25.385853 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m13:39:25.386361 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m13:39:25.387371 [info ] [Thread-4 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m13:39:25.388374 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m13:39:25.389373 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m13:39:25.394372 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m13:39:25.396374 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m13:39:25.401371 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m13:39:25.403373 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m13:39:25.404375 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m13:39:25.404375 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:28.900122 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.495 seconds
[0m13:39:28.904636 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_valuations: Close
[0m13:39:29.817784 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D9A410A0>]}
[0m13:39:29.819795 [info ] [Thread-4 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 4.43s]
[0m13:39:29.821793 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m13:39:29.822793 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m13:39:29.822793 [info ] [Thread-4 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m13:39:29.823793 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m13:39:29.823793 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m13:39:29.827792 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m13:39:29.828793 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m13:39:29.831791 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m13:39:29.834790 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m13:39:29.834790 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m13:39:29.834790 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:32.804047 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.968 seconds
[0m13:39:32.807569 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: Close
[0m13:39:33.985092 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D9A58F20>]}
[0m13:39:33.987103 [info ] [Thread-4 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 4.16s]
[0m13:39:33.989101 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m13:39:33.990103 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m13:39:33.991103 [info ] [Thread-4 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m13:39:33.993102 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m13:39:33.993102 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m13:39:33.999103 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m13:39:34.003102 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m13:39:34.008177 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m13:39:34.012100 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m13:39:34.012100 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav,
        nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date) as daily_pnl,
        case
            when lag(nav_usd) over (partition by portfolio_id order by valuation_date) > 0
            then (nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date)) / lag(nav_usd) over (partition by portfolio_id order by valuation_date)
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from valuations
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m13:39:34.013103 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:36.688089 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.675 seconds
[0m13:39:36.693083 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: Close
[0m13:39:37.498883 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2A83BDB20>]}
[0m13:39:37.499884 [info ] [Thread-4 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 3.51s]
[0m13:39:37.501885 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m13:39:37.502394 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m13:39:37.503407 [info ] [Thread-4 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m13:39:37.504407 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m13:39:37.506408 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m13:39:37.511405 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m13:39:37.516408 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m13:39:37.521405 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m13:39:37.524401 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m13:39:37.525406 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value,
        market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date) as daily_pnl,
        case
            when lag(market_value_usd) over (partition by security_id order by position_date) > 0
            then (market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date)) / lag(market_value_usd) over (partition by security_id order by position_date)
            else 0
        end as daily_return_pct
    from cast_enriched
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m13:39:37.525406 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:41.618684 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.093 seconds
[0m13:39:41.623678 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_returns: Close
[0m13:39:42.303783 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2A83BDB20>]}
[0m13:39:42.304786 [info ] [Thread-4 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 4.80s]
[0m13:39:42.305787 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m13:39:42.306786 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m13:39:42.307786 [info ] [Thread-4 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m13:39:42.308786 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m13:39:42.309786 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m13:39:42.314666 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m13:39:42.316678 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m13:39:42.320741 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m13:39:42.325750 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m13:39:42.326750 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        portfolio_id,
        position_date,
        sector,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd
    from enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(market_value_usd) as sector_value,
        sum(quantity) as total_quantity
    from cast_enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as portfolio_value
    from cast_enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m13:39:42.327750 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:45.112093 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.784 seconds
[0m13:39:45.116091 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: Close
[0m13:39:46.444418 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2A83BDFD0>]}
[0m13:39:46.445502 [info ] [Thread-4 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 4.14s]
[0m13:39:46.446507 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m13:39:46.447430 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m13:39:46.448430 [info ] [Thread-4 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m13:39:46.448430 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m13:39:46.449429 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m13:39:46.454501 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m13:39:46.457765 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m13:39:46.460781 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m13:39:46.464775 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m13:39:46.465776 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m13:39:46.466777 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:49.120379 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.654 seconds
[0m13:39:49.124384 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: Close
[0m13:39:50.259549 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D99F5850>]}
[0m13:39:50.261553 [info ] [Thread-4 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 3.81s]
[0m13:39:50.262554 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m13:39:50.263553 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m13:39:50.264554 [info ] [Thread-4 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m13:39:50.265554 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m13:39:50.265554 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m13:39:50.271549 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m13:39:50.274552 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m13:39:50.278427 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m13:39:50.281425 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m13:39:50.282426 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m13:39:50.282426 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:53.131580 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.849 seconds
[0m13:39:53.135590 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: Close
[0m13:39:53.807102 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D99598B0>]}
[0m13:39:53.808186 [info ] [Thread-4 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 3.54s]
[0m13:39:53.810116 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m13:39:53.810116 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m13:39:53.812114 [info ] [Thread-4 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m13:39:53.812114 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m13:39:53.813111 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m13:39:53.819204 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m13:39:53.823335 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m13:39:53.828347 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m13:39:53.831347 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m13:39:53.832859 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m13:39:53.833871 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:58.199486 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.365 seconds
[0m13:39:58.204482 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: Close
[0m13:39:59.427424 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D9936360>]}
[0m13:39:59.429428 [info ] [Thread-4 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 5.62s]
[0m13:39:59.430427 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m13:39:59.431426 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m13:39:59.432426 [info ] [Thread-4 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m13:39:59.433426 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m13:39:59.434428 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m13:39:59.438426 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m13:39:59.440426 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m13:39:59.445423 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m13:39:59.452463 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m13:39:59.452463 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m13:39:59.453468 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:03.255883 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.802 seconds
[0m13:40:03.259882 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: Close
[0m13:40:04.911998 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D9AAB6B0>]}
[0m13:40:04.914010 [info ] [Thread-4 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 5.48s]
[0m13:40:04.915009 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m13:40:04.915009 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m13:40:04.916009 [info ] [Thread-4 (]: 14 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m13:40:04.917009 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m13:40:04.918008 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m13:40:04.998530 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m13:40:05.002599 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m13:40:05.005622 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m13:40:05.006622 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m13:40:05.007619 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m13:40:05.007619 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:08.590947 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.583 seconds
[0m13:40:08.593949 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: Close
[0m13:40:10.221496 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D9A57C80>]}
[0m13:40:10.222498 [info ] [Thread-4 (]: 14 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 5.30s]
[0m13:40:10.223497 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m13:40:10.224497 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m13:40:10.225497 [info ] [Thread-4 (]: 15 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m13:40:10.226005 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m13:40:10.226005 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m13:40:10.231015 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m13:40:10.235043 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m13:40:10.239044 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m13:40:10.242041 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m13:40:10.243044 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m13:40:10.244045 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:14.694536 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.451 seconds
[0m13:40:14.698532 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: Close
[0m13:40:15.388809 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D83B8A10>]}
[0m13:40:15.389820 [info ] [Thread-4 (]: 15 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 5.16s]
[0m13:40:15.390816 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m13:40:15.390816 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m13:40:15.391968 [info ] [Thread-4 (]: 16 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m13:40:15.392976 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m13:40:15.392976 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m13:40:15.396972 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m13:40:15.397972 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m13:40:15.399972 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m13:40:15.400972 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m13:40:15.401972 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m13:40:15.401972 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:18.887654 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.485 seconds
[0m13:40:18.892651 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: Close
[0m13:40:19.705925 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D7698F80>]}
[0m13:40:19.707932 [info ] [Thread-4 (]: 16 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 4.31s]
[0m13:40:19.708932 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m13:40:19.709932 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m13:40:19.709932 [info ] [Thread-4 (]: 17 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m13:40:19.710931 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m13:40:19.711931 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m13:40:19.717436 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m13:40:19.719442 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m13:40:19.726441 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m13:40:19.733121 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m13:40:19.734131 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m13:40:19.734131 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:22.478569 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.743 seconds
[0m13:40:22.481565 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: Close
[0m13:40:23.686369 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D7EC4770>]}
[0m13:40:23.688463 [info ] [Thread-4 (]: 17 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 3.98s]
[0m13:40:23.689389 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m13:40:23.690436 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m13:40:23.691458 [info ] [Thread-4 (]: 18 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m13:40:23.692464 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m13:40:23.693466 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m13:40:23.698389 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m13:40:23.704573 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m13:40:23.711587 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m13:40:23.715109 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m13:40:23.716105 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m13:40:23.717108 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:26.547902 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.831 seconds
[0m13:40:26.551972 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: Close
[0m13:40:28.052931 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D869D010>]}
[0m13:40:28.053930 [info ] [Thread-4 (]: 18 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 4.36s]
[0m13:40:28.055928 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m13:40:28.055928 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m13:40:28.056928 [info ] [Thread-4 (]: 19 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m13:40:28.057928 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m13:40:28.058928 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m13:40:28.064928 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m13:40:28.066928 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m13:40:28.070928 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m13:40:28.078771 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m13:40:28.079784 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m13:40:28.079784 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:31.794157 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.713 seconds
[0m13:40:31.797157 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: Close
[0m13:40:33.070111 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D9A2C260>]}
[0m13:40:33.073248 [info ] [Thread-4 (]: 19 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 5.01s]
[0m13:40:33.074249 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m13:40:33.075248 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m13:40:33.076249 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m13:40:33.076249 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m13:40:33.077759 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m13:40:33.082771 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m13:40:33.087920 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m13:40:33.090914 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m13:40:33.093631 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m13:40:33.094631 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m13:40:33.095631 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:36.312859 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.218 seconds
[0m13:40:36.316856 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: Close
[0m13:40:37.220808 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D99F7CB0>]}
[0m13:40:37.222806 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 4.14s]
[0m13:40:37.223802 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m13:40:37.224805 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m13:40:37.226801 [info ] [Thread-4 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m13:40:37.227799 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m13:40:37.227799 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m13:40:37.235798 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m13:40:37.241077 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m13:40:37.246073 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m13:40:37.248075 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m13:40:37.249079 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m13:40:37.250079 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:39.764847 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.515 seconds
[0m13:40:39.767846 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: Close
[0m13:40:40.475570 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D9A9BFE0>]}
[0m13:40:40.476570 [info ] [Thread-4 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 3.25s]
[0m13:40:40.478572 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m13:40:40.478572 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m13:40:40.479571 [info ] [Thread-4 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m13:40:40.480572 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m13:40:40.481571 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m13:40:40.486574 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m13:40:40.490021 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m13:40:40.521072 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m13:40:40.523073 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m13:40:40.523073 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m13:40:40.524080 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:45.412452 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.889 seconds
[0m13:40:45.414459 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m13:40:46.284487 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D9AAB440>]}
[0m13:40:46.286488 [info ] [Thread-4 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 5.80s]
[0m13:40:46.287488 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m13:40:46.288487 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m13:40:46.288487 [info ] [Thread-4 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m13:40:46.289487 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_portfolio_performance, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m13:40:46.290485 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m13:40:46.295486 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m13:40:46.299565 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m13:40:46.303566 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m13:40:46.306562 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m13:40:46.307566 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m13:40:46.308572 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:50.870642 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.563 seconds
[0m13:40:50.874644 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m13:40:51.643780 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D9A4A690>]}
[0m13:40:56.297176 [debug] [Thread-4 (]: An error was encountered while trying to send an event
[0m13:40:56.304140 [info ] [Thread-4 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 5.35s]
[0m13:40:56.305141 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m13:40:56.306140 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m13:40:56.307139 [info ] [Thread-4 (]: 24 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m13:40:56.308140 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_executive_summary, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m13:40:56.308140 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m13:40:56.313139 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m13:40:56.315320 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m13:40:56.321329 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m13:40:56.323332 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m13:40:56.324332 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m13:40:56.324332 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:40:59.290150 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.966 seconds
[0m13:40:59.295178 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m13:41:01.494848 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D8366A50>]}
[0m13:41:01.496371 [info ] [Thread-4 (]: 24 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 5.19s]
[0m13:41:01.497368 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m13:41:01.497368 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m13:41:01.498377 [info ] [Thread-4 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m13:41:01.499373 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_performance_drivers, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m13:41:01.500374 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m13:41:01.505368 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m13:41:01.507369 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m13:41:01.512371 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m13:41:01.517315 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m13:41:01.518313 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m13:41:01.519313 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:41:05.155912 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.637 seconds
[0m13:41:05.159995 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m13:41:06.494698 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D8366A50>]}
[0m13:41:06.495701 [info ] [Thread-4 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 5.00s]
[0m13:41:06.496702 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m13:41:06.497701 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m13:41:06.497701 [info ] [Thread-4 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m13:41:06.498701 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_position_attribution, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m13:41:06.499702 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m13:41:06.504379 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m13:41:06.508378 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m13:41:06.511378 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m13:41:06.514378 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m13:41:06.515378 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m13:41:06.515378 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:41:12.878370 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 6.363 seconds
[0m13:41:12.882367 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m13:41:14.634406 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb6b5c6e-5deb-46eb-a250-a4973e0dd8c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2D7BA6240>]}
[0m13:41:14.636411 [info ] [Thread-4 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 8.14s]
[0m13:41:14.637410 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m13:41:14.640410 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:41:14.641410 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was properly closed.
[0m13:41:14.642410 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was properly closed.
[0m13:41:14.642410 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was properly closed.
[0m13:41:14.643409 [info ] [MainThread]: 
[0m13:41:14.643409 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 2 minutes and 59.12 seconds (179.12s).
[0m13:41:14.648404 [debug] [MainThread]: Command end result
[0m13:41:14.688402 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m13:41:14.690405 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m13:41:14.697043 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\BiaDigi\sample-dbt-project\target\run_results.json
[0m13:41:14.697043 [info ] [MainThread]: 
[0m13:41:14.698043 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:41:14.698043 [info ] [MainThread]: 
[0m13:41:14.698043 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m13:41:14.699042 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m13:41:14.699042 [debug] [MainThread]: Command `dbt build` succeeded at 13:41:14.699042 after 189.34 seconds
[0m13:41:14.700042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2AB41E330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2AAB00E00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2AAB01820>]}
[0m13:41:14.700042 [debug] [MainThread]: Flushing usage events
[0m13:41:17.001670 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:01:58.928517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002099BF94CE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002099BF946E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002099BF97F20>]}


============================== 15:01:58.933518 | 9f64e087-182d-4d1b-81f4-0ee4f9fe9829 ==============================
[0m15:01:58.933518 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:01:58.933518 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'None', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt run-operation --args {sql: "SELECT column_name, data_type FROM BAIN_ANALYTICS.INFORMATION_SCHEMA.COLUMNS WHERE table_schema = \'DEV\' AND table_name IN (\'SAMPLE_POSITIONS_DAILY\', \'SAMPLE_SECURITIES\') AND column_name = \'SECURITY_ID\' ORDER BY table_name"} print_result', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m15:02:04.547495 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m15:02:04.547495 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m15:02:04.547495 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m15:02:04.651146 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m15:02:04.652147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9f64e087-182d-4d1b-81f4-0ee4f9fe9829', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209C6E88AD0>]}
[0m15:02:04.831484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9f64e087-182d-4d1b-81f4-0ee4f9fe9829', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209C6F2D250>]}
[0m15:02:04.889646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9f64e087-182d-4d1b-81f4-0ee4f9fe9829', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002099BE97FB0>]}
[0m15:02:04.890646 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m15:02:05.383003 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:02:09.150718 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:02:09.151717 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m15:02:09.151717 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:02:09.159721 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m15:02:09.196638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9f64e087-182d-4d1b-81f4-0ee4f9fe9829', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209C72927E0>]}
[0m15:02:09.262062 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m15:02:09.293673 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m15:02:09.314480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9f64e087-182d-4d1b-81f4-0ee4f9fe9829', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209C77BFC50>]}
[0m15:02:09.314480 [info ] [MainThread]: Found 40 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m15:02:09.315477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f64e087-182d-4d1b-81f4-0ee4f9fe9829', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209C78104D0>]}
[0m15:02:09.315477 [debug] [MainThread]: Acquiring new snowflake connection 'macro_print_result'
[0m15:02:09.315477 [error] [MainThread]: Encountered an error while running operation: Runtime Error
  dbt could not find a macro with the name "print_result" in any package
[0m15:02:09.326398 [debug] [MainThread]: Traceback (most recent call last):
  File "C:\Users\BiaDigi\AppData\Local\Programs\Python\Python312\Lib\site-packages\dbt\task\run_operation.py", line 64, in run
    self._run_unsafe(package_name, macro_name)
  File "C:\Users\BiaDigi\AppData\Local\Programs\Python\Python312\Lib\site-packages\dbt\task\run_operation.py", line 45, in _run_unsafe
    res = adapter.execute_macro(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\BiaDigi\AppData\Local\Programs\Python\Python312\Lib\site-packages\dbt\adapters\base\impl.py", line 1304, in execute_macro
    raise DbtRuntimeError(
dbt_common.exceptions.base.DbtRuntimeError: Runtime Error
  dbt could not find a macro with the name "print_result" in any package

[0m15:02:09.327399 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt could not find a macro with the name 'print_result' in any package. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m15:02:09.328398 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:02:09.328398 [debug] [MainThread]: Command `dbt run-operation` failed at 15:02:09.328398 after 10.54 seconds
[0m15:02:09.329475 [debug] [MainThread]: Connection 'macro_print_result' was properly closed.
[0m15:02:09.329475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002099AA00530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209C7813C80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000209C72901D0>]}
[0m15:02:09.329475 [debug] [MainThread]: Flushing usage events
[0m15:02:14.330587 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:08:18.133592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002322F2066C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002322AD50F50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002322D6D58E0>]}


============================== 15:08:18.136600 | dfb722a6-3688-42a1-a61f-b1c907ccf499 ==============================
[0m15:08:18.136600 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:08:18.137598 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'None', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt seed --select sample_positions_daily sample_market_prices', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m15:08:18.796598 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m15:08:18.796598 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m15:08:18.796598 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m15:08:18.850523 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m15:08:18.851525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'dfb722a6-3688-42a1-a61f-b1c907ccf499', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002325A452BD0>]}
[0m15:08:19.030051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dfb722a6-3688-42a1-a61f-b1c907ccf499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002325A595BE0>]}
[0m15:08:19.087796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dfb722a6-3688-42a1-a61f-b1c907ccf499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232581B9820>]}
[0m15:08:19.089794 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m15:08:19.272112 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:08:19.382738 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:08:19.383804 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://seeds\sample_positions_daily.csv
[0m15:08:19.383804 [debug] [MainThread]: Partial parsing: updated file: bain_capital_portfolio_analytics://seeds\sample_market_prices.csv
[0m15:08:19.564527 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m15:08:19.575422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dfb722a6-3688-42a1-a61f-b1c907ccf499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002322D562C00>]}
[0m15:08:19.647543 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m15:08:19.649545 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m15:08:19.682248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dfb722a6-3688-42a1-a61f-b1c907ccf499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002325A8D8EF0>]}
[0m15:08:19.682248 [info ] [MainThread]: Found 40 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m15:08:19.683245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dfb722a6-3688-42a1-a61f-b1c907ccf499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002322F3E93A0>]}
[0m15:08:19.684244 [info ] [MainThread]: 
[0m15:08:19.685245 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:08:19.685245 [info ] [MainThread]: 
[0m15:08:19.685245 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:08:19.688245 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m15:08:19.788851 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m15:08:19.789851 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m15:08:19.789851 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:24.072719 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 4.282 seconds
[0m15:08:24.076802 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: Close
[0m15:08:24.827040 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m15:08:24.844608 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m15:08:24.846068 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m15:08:24.847026 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:27.980942 [debug] [ThreadPool]: SQL status: SUCCESS 55 in 3.134 seconds
[0m15:08:27.986941 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: Close
[0m15:08:29.355702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dfb722a6-3688-42a1-a61f-b1c907ccf499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002325A865A30>]}
[0m15:08:29.360895 [debug] [Thread-4 (]: Began running node seed.bain_capital_portfolio_analytics.sample_market_prices
[0m15:08:29.360895 [info ] [Thread-4 (]: 1 of 2 START seed file DEV.sample_market_prices ................................ [RUN]
[0m15:08:29.362014 [debug] [Thread-4 (]: Acquiring new snowflake connection 'seed.bain_capital_portfolio_analytics.sample_market_prices'
[0m15:08:29.362014 [debug] [Thread-4 (]: Began compiling node seed.bain_capital_portfolio_analytics.sample_market_prices
[0m15:08:29.362947 [debug] [Thread-4 (]: Began executing node seed.bain_capital_portfolio_analytics.sample_market_prices
[0m15:08:29.425626 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:08:29.426626 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: BEGIN
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_market_prices"} */
[0m15:08:29.426626 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:08:31.713755 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.286 seconds
[0m15:08:31.714755 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:08:31.715753 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: truncate table "BAIN_ANALYTICS"."DEV"."SAMPLE_MARKET_PRICES"
  
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_market_prices"} */;
[0m15:08:32.549079 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.832 seconds
[0m15:08:32.550078 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:08:32.551080 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: COMMIT
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_market_prices"} */
[0m15:08:34.179948 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.627 seconds
[0m15:08:34.199203 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:08:34.200204 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: BEGIN
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_market_prices"} */
[0m15:08:35.109007 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.909 seconds
[0m15:08:35.112098 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:08:35.112098 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: insert into BAIN_ANALYTICS.DEV.sample_market_prices (security_id, price_date, close_price, volume, created_at) values
            (%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%...
[0m15:08:36.717198 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01c278da-0107-cf0a-001d-9343000c5042
[0m15:08:36.718198 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 100038 (22018): DML operation to table BAIN_ANALYTICS.DEV.SAMPLE_MARKET_PRICES failed on column SECURITY_ID with error: Numeric value 'SEC001' is not recognized
[0m15:08:36.719196 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: Close
[0m15:08:37.540304 [debug] [Thread-4 (]: Database Error in seed sample_market_prices (seeds\sample_market_prices.csv)
  100038 (22018): DML operation to table BAIN_ANALYTICS.DEV.SAMPLE_MARKET_PRICES failed on column SECURITY_ID with error: Numeric value 'SEC001' is not recognized
[0m15:08:37.543858 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dfb722a6-3688-42a1-a61f-b1c907ccf499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002322D4C0470>]}
[0m15:08:37.545017 [error] [Thread-4 (]: 1 of 2 ERROR loading seed file DEV.sample_market_prices ........................ [[31mERROR[0m in 8.18s]
[0m15:08:37.545946 [debug] [Thread-4 (]: Finished running node seed.bain_capital_portfolio_analytics.sample_market_prices
[0m15:08:37.546942 [debug] [Thread-4 (]: Began running node seed.bain_capital_portfolio_analytics.sample_positions_daily
[0m15:08:37.547947 [debug] [Thread-7 (]: Marking all children of 'seed.bain_capital_portfolio_analytics.sample_market_prices' to be skipped because of status 'error'.  Reason: Database Error in seed sample_market_prices (seeds\sample_market_prices.csv)
  100038 (22018): DML operation to table BAIN_ANALYTICS.DEV.SAMPLE_MARKET_PRICES failed on column SECURITY_ID with error: Numeric value 'SEC001' is not recognized.
[0m15:08:37.547947 [info ] [Thread-4 (]: 2 of 2 START seed file DEV.sample_positions_daily .............................. [RUN]
[0m15:08:37.550696 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly seed.bain_capital_portfolio_analytics.sample_market_prices, now seed.bain_capital_portfolio_analytics.sample_positions_daily)
[0m15:08:37.550696 [debug] [Thread-4 (]: Began compiling node seed.bain_capital_portfolio_analytics.sample_positions_daily
[0m15:08:37.551861 [debug] [Thread-4 (]: Began executing node seed.bain_capital_portfolio_analytics.sample_positions_daily
[0m15:08:37.564784 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:08:37.565784 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: BEGIN
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_positions_daily"} */
[0m15:08:37.565784 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:08:41.440861 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.874 seconds
[0m15:08:41.441857 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:08:41.442855 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: truncate table "BAIN_ANALYTICS"."DEV"."SAMPLE_POSITIONS_DAILY"
  
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_positions_daily"} */;
[0m15:08:42.629274 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.185 seconds
[0m15:08:42.631599 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:08:42.632598 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: COMMIT
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_positions_daily"} */
[0m15:08:43.388179 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.755 seconds
[0m15:08:43.390180 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:08:43.390180 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: BEGIN
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_positions_daily"} */
[0m15:08:44.012715 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.622 seconds
[0m15:08:44.016708 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:08:44.017785 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: insert into BAIN_ANALYTICS.DEV.sample_positions_daily (position_id, portfolio_id, security_id, position_date, quantity, market_value_usd, created_at) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s...
[0m15:08:44.884232 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01c278da-0107-cc66-001d-9343000c403e
[0m15:08:44.885223 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 100038 (22018): DML operation to table BAIN_ANALYTICS.DEV.SAMPLE_POSITIONS_DAILY failed on column SECURITY_ID with error: Numeric value 'SEC001' is not recognized
[0m15:08:44.886228 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: Close
[0m15:08:46.323307 [debug] [Thread-4 (]: Database Error in seed sample_positions_daily (seeds\sample_positions_daily.csv)
  100038 (22018): DML operation to table BAIN_ANALYTICS.DEV.SAMPLE_POSITIONS_DAILY failed on column SECURITY_ID with error: Numeric value 'SEC001' is not recognized
[0m15:08:46.324301 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dfb722a6-3688-42a1-a61f-b1c907ccf499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002325C4918E0>]}
[0m15:08:46.325304 [error] [Thread-4 (]: 2 of 2 ERROR loading seed file DEV.sample_positions_daily ...................... [[31mERROR[0m in 8.77s]
[0m15:08:46.326305 [debug] [Thread-4 (]: Finished running node seed.bain_capital_portfolio_analytics.sample_positions_daily
[0m15:08:46.327305 [debug] [Thread-7 (]: Marking all children of 'seed.bain_capital_portfolio_analytics.sample_positions_daily' to be skipped because of status 'error'.  Reason: Database Error in seed sample_positions_daily (seeds\sample_positions_daily.csv)
  100038 (22018): DML operation to table BAIN_ANALYTICS.DEV.SAMPLE_POSITIONS_DAILY failed on column SECURITY_ID with error: Numeric value 'SEC001' is not recognized.
[0m15:08:46.333012 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:08:46.333012 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was properly closed.
[0m15:08:46.334084 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was properly closed.
[0m15:08:46.334084 [debug] [MainThread]: Connection 'seed.bain_capital_portfolio_analytics.sample_positions_daily' was properly closed.
[0m15:08:46.335086 [info ] [MainThread]: 
[0m15:08:46.336013 [info ] [MainThread]: Finished running 2 seeds in 0 hours 0 minutes and 26.65 seconds (26.65s).
[0m15:08:46.337012 [debug] [MainThread]: Command end result
[0m15:08:46.471608 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m15:08:46.473613 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m15:08:46.478754 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\BiaDigi\sample-dbt-project\target\run_results.json
[0m15:08:46.478754 [info ] [MainThread]: 
[0m15:08:46.478754 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m15:08:46.479707 [info ] [MainThread]: 
[0m15:08:46.479707 [error] [MainThread]: [31mFailure in seed sample_market_prices (seeds\sample_market_prices.csv)[0m
[0m15:08:46.479707 [error] [MainThread]:   Database Error in seed sample_market_prices (seeds\sample_market_prices.csv)
  100038 (22018): DML operation to table BAIN_ANALYTICS.DEV.SAMPLE_MARKET_PRICES failed on column SECURITY_ID with error: Numeric value 'SEC001' is not recognized
[0m15:08:46.479707 [info ] [MainThread]: 
[0m15:08:46.480708 [error] [MainThread]: [31mFailure in seed sample_positions_daily (seeds\sample_positions_daily.csv)[0m
[0m15:08:46.480708 [error] [MainThread]:   Database Error in seed sample_positions_daily (seeds\sample_positions_daily.csv)
  100038 (22018): DML operation to table BAIN_ANALYTICS.DEV.SAMPLE_POSITIONS_DAILY failed on column SECURITY_ID with error: Numeric value 'SEC001' is not recognized
[0m15:08:46.480708 [info ] [MainThread]: 
[0m15:08:46.480708 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=2
[0m15:08:46.481709 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:08:46.481709 [debug] [MainThread]: Command `dbt seed` failed at 15:08:46.481709 after 28.42 seconds
[0m15:08:46.481709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002322EE5EF30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002322D598E30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002325BD6C620>]}
[0m15:08:46.481709 [debug] [MainThread]: Flushing usage events
[0m15:08:49.081623 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:09:03.821509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B5A288830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B589594C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B560168D0>]}


============================== 15:09:03.825514 | cc9f6bea-6b55-4891-aa0c-d46f754bb0a0 ==============================
[0m15:09:03.825514 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:09:03.825514 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'None', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt seed --select sample_positions_daily sample_market_prices --full-refresh', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m15:09:04.485302 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m15:09:04.486393 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m15:09:04.486393 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m15:09:04.542548 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m15:09:04.542548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'cc9f6bea-6b55-4891-aa0c-d46f754bb0a0', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B7F395E80>]}
[0m15:09:04.717850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc9f6bea-6b55-4891-aa0c-d46f754bb0a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B05644CE0>]}
[0m15:09:04.774850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc9f6bea-6b55-4891-aa0c-d46f754bb0a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B57BAC980>]}
[0m15:09:04.776513 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m15:09:04.964904 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:09:05.091733 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:09:05.091733 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m15:09:05.092666 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:09:05.096741 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m15:09:05.127416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc9f6bea-6b55-4891-aa0c-d46f754bb0a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B056EC980>]}
[0m15:09:05.193922 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m15:09:05.195922 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m15:09:05.221093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc9f6bea-6b55-4891-aa0c-d46f754bb0a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B05A3C920>]}
[0m15:09:05.221093 [info ] [MainThread]: Found 40 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m15:09:05.221093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc9f6bea-6b55-4891-aa0c-d46f754bb0a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B05C19760>]}
[0m15:09:05.223174 [info ] [MainThread]: 
[0m15:09:05.223174 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:09:05.224095 [info ] [MainThread]: 
[0m15:09:05.224095 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:09:05.227092 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m15:09:05.262170 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m15:09:05.262170 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m15:09:05.262170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:09.925878 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 4.663 seconds
[0m15:09:09.928876 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: Close
[0m15:09:10.696629 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m15:09:10.716786 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m15:09:10.716786 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m15:09:10.717781 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:13.659880 [debug] [ThreadPool]: SQL status: SUCCESS 55 in 2.942 seconds
[0m15:09:13.665955 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: Close
[0m15:09:14.897703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc9f6bea-6b55-4891-aa0c-d46f754bb0a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B05A3DA30>]}
[0m15:09:14.904072 [debug] [Thread-4 (]: Began running node seed.bain_capital_portfolio_analytics.sample_market_prices
[0m15:09:14.905072 [info ] [Thread-4 (]: 1 of 2 START seed file DEV.sample_market_prices ................................ [RUN]
[0m15:09:14.906079 [debug] [Thread-4 (]: Acquiring new snowflake connection 'seed.bain_capital_portfolio_analytics.sample_market_prices'
[0m15:09:14.907074 [debug] [Thread-4 (]: Began compiling node seed.bain_capital_portfolio_analytics.sample_market_prices
[0m15:09:14.908071 [debug] [Thread-4 (]: Began executing node seed.bain_capital_portfolio_analytics.sample_market_prices
[0m15:09:14.944069 [debug] [Thread-4 (]: Applying DROP to: "BAIN_ANALYTICS"."DEV"."SAMPLE_MARKET_PRICES"
[0m15:09:14.951068 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:09:14.952069 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: drop table if exists "BAIN_ANALYTICS"."DEV"."SAMPLE_MARKET_PRICES" cascade
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_market_prices"} */
[0m15:09:14.952069 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:09:18.216441 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.264 seconds
[0m15:09:18.228435 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:09:18.229436 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: create table BAIN_ANALYTICS.DEV.sample_market_prices (security_id text,price_date date,close_price float8,volume integer,created_at timestamp without time zone)
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_market_prices"} */
[0m15:09:18.924001 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.694 seconds
[0m15:09:18.949075 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:09:18.949075 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: BEGIN
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_market_prices"} */
[0m15:09:19.563010 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.612 seconds
[0m15:09:19.568011 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:09:19.568011 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: insert into BAIN_ANALYTICS.DEV.sample_market_prices (security_id, price_date, close_price, volume, created_at) values
            (%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s),(%s,%s,%...
[0m15:09:21.852510 [debug] [Thread-4 (]: SQL status: SUCCESS 90 in 2.283 seconds
[0m15:09:21.853522 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:09:21.854524 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: COMMIT
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_market_prices"} */
[0m15:09:22.505993 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.651 seconds
[0m15:09:22.511093 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.bain_capital_portfolio_analytics.sample_market_prices"
[0m15:09:22.533616 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_market_prices: Close
[0m15:09:23.214764 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc9f6bea-6b55-4891-aa0c-d46f754bb0a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B58500710>]}
[0m15:09:23.216763 [info ] [Thread-4 (]: 1 of 2 OK loaded seed file DEV.sample_market_prices ............................ [[32mCREATE 90[0m in 8.31s]
[0m15:09:23.218778 [debug] [Thread-4 (]: Finished running node seed.bain_capital_portfolio_analytics.sample_market_prices
[0m15:09:23.219775 [debug] [Thread-4 (]: Began running node seed.bain_capital_portfolio_analytics.sample_positions_daily
[0m15:09:23.220774 [info ] [Thread-4 (]: 2 of 2 START seed file DEV.sample_positions_daily .............................. [RUN]
[0m15:09:23.221846 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly seed.bain_capital_portfolio_analytics.sample_market_prices, now seed.bain_capital_portfolio_analytics.sample_positions_daily)
[0m15:09:23.222853 [debug] [Thread-4 (]: Began compiling node seed.bain_capital_portfolio_analytics.sample_positions_daily
[0m15:09:23.222853 [debug] [Thread-4 (]: Began executing node seed.bain_capital_portfolio_analytics.sample_positions_daily
[0m15:09:23.236984 [debug] [Thread-4 (]: Applying DROP to: "BAIN_ANALYTICS"."DEV"."SAMPLE_POSITIONS_DAILY"
[0m15:09:23.238985 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:09:23.239982 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: drop table if exists "BAIN_ANALYTICS"."DEV"."SAMPLE_POSITIONS_DAILY" cascade
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_positions_daily"} */
[0m15:09:23.239982 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:09:28.538102 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 5.297 seconds
[0m15:09:28.542096 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:09:28.543098 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: create table BAIN_ANALYTICS.DEV.sample_positions_daily (position_id integer,portfolio_id integer,security_id text,position_date date,quantity integer,market_value_usd integer,created_at timestamp without time zone)
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_positions_daily"} */
[0m15:09:29.159853 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.616 seconds
[0m15:09:29.164353 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:09:29.165362 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: BEGIN
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_positions_daily"} */
[0m15:09:30.041294 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.875 seconds
[0m15:09:30.045298 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:09:30.046297 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: insert into BAIN_ANALYTICS.DEV.sample_positions_daily (position_id, portfolio_id, security_id, position_date, quantity, market_value_usd, created_at) values
            (%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s...
[0m15:09:31.223066 [debug] [Thread-4 (]: SQL status: SUCCESS 50 in 1.176 seconds
[0m15:09:31.224988 [debug] [Thread-4 (]: Using snowflake connection "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:09:31.225986 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: COMMIT
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "seed.bain_capital_portfolio_analytics.sample_positions_daily"} */
[0m15:09:32.339956 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.113 seconds
[0m15:09:32.341956 [debug] [Thread-4 (]: Writing runtime SQL for node "seed.bain_capital_portfolio_analytics.sample_positions_daily"
[0m15:09:32.350814 [debug] [Thread-4 (]: On seed.bain_capital_portfolio_analytics.sample_positions_daily: Close
[0m15:09:33.116111 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc9f6bea-6b55-4891-aa0c-d46f754bb0a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B070CC650>]}
[0m15:09:33.118125 [info ] [Thread-4 (]: 2 of 2 OK loaded seed file DEV.sample_positions_daily .......................... [[32mCREATE 50[0m in 9.89s]
[0m15:09:33.119124 [debug] [Thread-4 (]: Finished running node seed.bain_capital_portfolio_analytics.sample_positions_daily
[0m15:09:33.121124 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:09:33.122124 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was properly closed.
[0m15:09:33.123126 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was properly closed.
[0m15:09:33.123126 [debug] [MainThread]: Connection 'seed.bain_capital_portfolio_analytics.sample_positions_daily' was properly closed.
[0m15:09:33.124124 [info ] [MainThread]: 
[0m15:09:33.124124 [info ] [MainThread]: Finished running 2 seeds in 0 hours 0 minutes and 27.90 seconds (27.90s).
[0m15:09:33.126124 [debug] [MainThread]: Command end result
[0m15:09:33.163925 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m15:09:33.164927 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m15:09:33.169926 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\BiaDigi\sample-dbt-project\target\run_results.json
[0m15:09:33.169926 [info ] [MainThread]: 
[0m15:09:33.170928 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:09:33.170928 [info ] [MainThread]: 
[0m15:09:33.170928 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m15:09:33.171927 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:09:33.171927 [debug] [MainThread]: Command `dbt seed` succeeded at 15:09:33.171927 after 29.43 seconds
[0m15:09:33.172927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B05E75A00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B05FBECC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B58E404D0>]}
[0m15:09:33.172927 [debug] [MainThread]: Flushing usage events
[0m15:09:36.184678 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:09:55.721585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FC4BE4B90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FC4BE4290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FC4AE62A0>]}


============================== 15:09:55.724590 | eb290dce-ecf7-4413-a52e-e97587ed13db ==============================
[0m15:09:55.724590 [info ] [MainThread]: Running with dbt=1.11.4
[0m15:09:55.725590 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_c', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m15:09:56.345636 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m15:09:56.346756 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m15:09:56.346756 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m15:09:56.398488 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m15:09:56.399488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FEF7F2B70>]}
[0m15:09:56.578576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FC1BADBE0>]}
[0m15:09:56.638569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FC21533E0>]}
[0m15:09:56.640543 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m15:09:56.850999 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m15:09:56.957702 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:09:56.958801 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m15:09:56.958801 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:09:56.962803 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m15:09:56.993721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF04CFA70>]}
[0m15:09:57.067861 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m15:09:57.068858 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m15:09:57.106899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FEFF615B0>]}
[0m15:09:57.107904 [info ] [MainThread]: Found 40 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m15:09:57.110413 [info ] [MainThread]: 
[0m15:09:57.111502 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:09:57.111502 [info ] [MainThread]: 
[0m15:09:57.111502 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:09:57.117422 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m15:09:57.156118 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m15:09:57.156118 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m15:09:57.157119 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:10:01.228064 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 4.070 seconds
[0m15:10:01.231062 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: Close
[0m15:10:02.152932 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m15:10:02.170801 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m15:10:02.170801 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m15:10:02.171792 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:10:05.780585 [debug] [ThreadPool]: SQL status: SUCCESS 55 in 3.609 seconds
[0m15:10:05.787552 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: Close
[0m15:10:06.739193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FEFEA3770>]}
[0m15:10:06.744395 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m15:10:06.744395 [info ] [Thread-4 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m15:10:06.745450 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m15:10:06.745450 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m15:10:06.755459 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m15:10:06.757383 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m15:10:06.790547 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m15:10:06.792465 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m15:10:06.792465 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m15:10:06.792465 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:10:10.029655 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.237 seconds
[0m15:10:10.058324 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: Close
[0m15:10:10.715137 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FC09E9010>]}
[0m15:10:10.717137 [info ] [Thread-4 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 3.97s]
[0m15:10:10.718136 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m15:10:10.718136 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m15:10:10.719137 [info ] [Thread-4 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m15:10:10.720137 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.stg_benchmarks)
[0m15:10:10.720137 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m15:10:10.725135 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m15:10:10.727144 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m15:10:10.731212 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m15:10:10.733214 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m15:10:10.733214 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m15:10:10.734215 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:10:14.020793 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.287 seconds
[0m15:10:14.026789 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: Close
[0m15:10:15.241549 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1C3FA40>]}
[0m15:10:15.242066 [info ] [Thread-4 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 4.52s]
[0m15:10:15.242579 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m15:10:15.242579 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m15:10:15.243566 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m15:10:15.244070 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks)
[0m15:10:15.244070 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m15:10:15.246076 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m15:10:15.247076 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m15:10:15.249075 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m15:10:15.250080 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m15:10:15.251079 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m15:10:15.251079 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:10:19.295975 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.045 seconds
[0m15:10:19.300056 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: Close
[0m15:10:20.936903 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1CA7F20>]}
[0m15:10:20.937984 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 5.69s]
[0m15:10:20.938985 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m15:10:20.940063 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m15:10:20.941146 [info ] [Thread-4 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m15:10:20.942150 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.stg_positions_daily)
[0m15:10:20.943149 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m15:10:20.949147 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m15:10:20.951076 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m15:10:20.955071 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m15:10:20.957072 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m15:10:20.958072 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m15:10:20.958072 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:10:25.417858 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.460 seconds
[0m15:10:25.420862 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: Close
[0m15:10:27.078302 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1CB3260>]}
[0m15:10:27.079313 [info ] [Thread-4 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 6.14s]
[0m15:10:27.080308 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m15:10:27.080308 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m15:10:27.081309 [info ] [Thread-4 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m15:10:27.081309 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m15:10:27.082313 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m15:10:27.085313 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m15:10:27.087307 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m15:10:27.090324 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m15:10:27.091333 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m15:10:27.092146 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m15:10:27.092146 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:10:31.944530 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.852 seconds
[0m15:10:31.946531 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_valuations: Close
[0m15:10:32.624831 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1C48800>]}
[0m15:10:32.625835 [info ] [Thread-4 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 5.54s]
[0m15:10:32.626835 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m15:10:32.627835 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m15:10:32.628834 [info ] [Thread-4 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m15:10:32.629835 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m15:10:32.630834 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m15:10:32.635835 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m15:10:32.636835 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m15:10:32.640833 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m15:10:32.642835 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m15:10:32.643834 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m15:10:32.643834 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:10:38.263397 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 5.619 seconds
[0m15:10:38.267712 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: Close
[0m15:10:38.957376 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1CB7FE0>]}
[0m15:10:38.958387 [info ] [Thread-4 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 6.33s]
[0m15:10:38.959388 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m15:10:38.960387 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m15:10:38.960387 [info ] [Thread-4 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m15:10:38.961388 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m15:10:38.962387 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m15:10:38.967387 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m15:10:38.968388 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m15:10:38.976386 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m15:10:38.980387 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m15:10:38.981389 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav,
        nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date) as daily_pnl,
        case
            when lag(nav_usd) over (partition by portfolio_id order by valuation_date) > 0
            then (nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date)) / lag(nav_usd) over (partition by portfolio_id order by valuation_date)
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from valuations
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m15:10:38.982412 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:10:42.789042 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.806 seconds
[0m15:10:42.793049 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: Close
[0m15:10:43.492877 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1CE4890>]}
[0m15:10:43.493889 [info ] [Thread-4 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 4.53s]
[0m15:10:43.494885 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m15:10:43.494885 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m15:10:43.495885 [info ] [Thread-4 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m15:10:43.495885 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m15:10:43.496890 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m15:10:43.500884 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m15:10:43.501883 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m15:10:43.504890 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m15:10:43.506883 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m15:10:43.507883 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value,
        market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date) as daily_pnl,
        case
            when lag(market_value_usd) over (partition by security_id order by position_date) > 0
            then (market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date)) / lag(market_value_usd) over (partition by security_id order by position_date)
            else 0
        end as daily_return_pct
    from cast_enriched
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m15:10:43.507883 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:10:47.558322 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.050 seconds
[0m15:10:47.563317 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_returns: Close
[0m15:10:48.610880 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FC068E330>]}
[0m15:10:48.611878 [info ] [Thread-4 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 5.11s]
[0m15:10:48.612879 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m15:10:48.612879 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m15:10:48.613879 [info ] [Thread-4 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m15:10:48.613879 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m15:10:48.614880 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m15:10:48.616880 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m15:10:48.617881 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m15:10:48.620413 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m15:10:48.621413 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m15:10:48.621413 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        portfolio_id,
        position_date,
        sector,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd
    from enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(market_value_usd) as sector_value,
        sum(quantity) as total_quantity
    from cast_enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as portfolio_value
    from cast_enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m15:10:48.622412 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:10:53.702179 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 5.080 seconds
[0m15:10:53.706244 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: Close
[0m15:10:54.419948 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FC068E330>]}
[0m15:10:54.420951 [info ] [Thread-4 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 5.81s]
[0m15:10:54.422462 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m15:10:54.423473 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m15:10:54.424473 [info ] [Thread-4 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m15:10:54.425474 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m15:10:54.426475 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m15:10:54.431475 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m15:10:54.432785 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m15:10:54.436641 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m15:10:54.440642 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m15:10:54.441641 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m15:10:54.442641 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:10:57.854384 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.411 seconds
[0m15:10:57.857382 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: Close
[0m15:10:59.262328 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1CD49B0>]}
[0m15:10:59.265847 [info ] [Thread-4 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 4.84s]
[0m15:10:59.266847 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m15:10:59.267847 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m15:10:59.268846 [info ] [Thread-4 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m15:10:59.268846 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m15:10:59.269846 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m15:10:59.274846 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m15:10:59.276846 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m15:10:59.279846 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m15:10:59.282846 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m15:10:59.282846 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m15:10:59.283846 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:02.356066 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.073 seconds
[0m15:11:02.361060 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: Close
[0m15:11:03.431819 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1B09CA0>]}
[0m15:11:03.433902 [info ] [Thread-4 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 4.16s]
[0m15:11:03.434832 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m15:11:03.435830 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m15:11:03.435830 [info ] [Thread-4 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m15:11:03.436832 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m15:11:03.437831 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m15:11:03.442907 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m15:11:03.444828 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m15:11:03.448826 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m15:11:03.451827 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m15:11:03.452827 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m15:11:03.453832 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:08.453399 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 5.000 seconds
[0m15:11:08.457410 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: Close
[0m15:11:09.986127 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1C4BD70>]}
[0m15:11:09.988140 [info ] [Thread-4 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 6.55s]
[0m15:11:09.989139 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m15:11:09.990140 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m15:11:09.991140 [info ] [Thread-4 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m15:11:09.991140 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m15:11:09.992140 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m15:11:09.997137 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m15:11:09.999137 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m15:11:10.004136 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m15:11:10.008134 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m15:11:10.008134 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m15:11:10.009139 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:14.246245 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.237 seconds
[0m15:11:14.251240 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: Close
[0m15:11:15.310716 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1C7B770>]}
[0m15:11:15.312228 [info ] [Thread-4 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 5.32s]
[0m15:11:15.314398 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m15:11:15.314398 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m15:11:15.315398 [info ] [Thread-4 (]: 14 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m15:11:15.316398 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m15:11:15.317399 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m15:11:15.322394 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m15:11:15.323399 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m15:11:15.331399 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m15:11:15.334394 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m15:11:15.335394 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m15:11:15.336394 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:18.319867 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.984 seconds
[0m15:11:18.323864 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: Close
[0m15:11:18.997524 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1D2FDA0>]}
[0m15:11:18.999538 [info ] [Thread-4 (]: 14 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 3.68s]
[0m15:11:19.000537 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m15:11:19.001540 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m15:11:19.001540 [info ] [Thread-4 (]: 15 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m15:11:19.002536 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m15:11:19.003537 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m15:11:19.081598 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m15:11:19.082600 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m15:11:19.084681 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m15:11:19.086598 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m15:11:19.087598 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m15:11:19.087598 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:22.782794 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.695 seconds
[0m15:11:22.787119 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: Close
[0m15:11:24.117629 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1AAC380>]}
[0m15:11:24.118629 [info ] [Thread-4 (]: 15 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 5.11s]
[0m15:11:24.119629 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m15:11:24.120628 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m15:11:24.121627 [info ] [Thread-4 (]: 16 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m15:11:24.122625 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m15:11:24.123629 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m15:11:24.128638 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m15:11:24.130452 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m15:11:24.135462 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m15:11:24.138460 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m15:11:24.138460 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m15:11:24.139972 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:28.108397 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.968 seconds
[0m15:11:28.113391 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: Close
[0m15:11:29.532067 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FEFE7E7B0>]}
[0m15:11:29.534075 [info ] [Thread-4 (]: 16 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 5.41s]
[0m15:11:29.535074 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m15:11:29.536075 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m15:11:29.536075 [info ] [Thread-4 (]: 17 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m15:11:29.537075 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m15:11:29.537075 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m15:11:29.540074 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m15:11:29.541075 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m15:11:29.544073 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m15:11:29.545073 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m15:11:29.546073 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m15:11:29.546073 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:34.404279 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.858 seconds
[0m15:11:34.407790 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: Close
[0m15:11:35.380995 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1CB55E0>]}
[0m15:11:35.382999 [info ] [Thread-4 (]: 17 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 5.84s]
[0m15:11:35.383998 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m15:11:35.383998 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m15:11:35.384998 [info ] [Thread-4 (]: 18 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m15:11:35.385996 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m15:11:35.386998 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m15:11:35.391997 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m15:11:35.394001 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m15:11:35.401011 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m15:11:35.404009 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m15:11:35.405011 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m15:11:35.406013 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:38.500706 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.094 seconds
[0m15:11:38.504719 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: Close
[0m15:11:39.273149 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1BC7020>]}
[0m15:11:39.274149 [info ] [Thread-4 (]: 18 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 3.89s]
[0m15:11:39.276149 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m15:11:39.277149 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m15:11:39.278148 [info ] [Thread-4 (]: 19 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m15:11:39.278148 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m15:11:39.279148 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m15:11:39.284147 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m15:11:39.286146 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m15:11:39.289145 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m15:11:39.292142 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m15:11:39.293146 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m15:11:39.294145 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:42.649347 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.355 seconds
[0m15:11:42.653338 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: Close
[0m15:11:44.084947 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1B4E300>]}
[0m15:11:44.085950 [info ] [Thread-4 (]: 19 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 4.81s]
[0m15:11:44.086948 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m15:11:44.087950 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m15:11:44.088950 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m15:11:44.089949 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m15:11:44.089949 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m15:11:44.095948 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m15:11:44.096947 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m15:11:44.100945 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m15:11:44.101947 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m15:11:44.102946 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m15:11:44.102946 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:46.950215 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.847 seconds
[0m15:11:46.954201 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: Close
[0m15:11:47.668620 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FEFD2A2D0>]}
[0m15:11:47.670636 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 3.58s]
[0m15:11:47.671636 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m15:11:47.672648 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m15:11:47.673649 [info ] [Thread-4 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m15:11:47.674647 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m15:11:47.674647 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m15:11:47.680649 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m15:11:47.681975 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m15:11:47.685982 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m15:11:47.688493 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m15:11:47.689492 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m15:11:47.689492 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:52.069991 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.380 seconds
[0m15:11:52.074653 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: Close
[0m15:11:52.735887 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FEFFC38F0>]}
[0m15:11:52.736900 [info ] [Thread-4 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 5.06s]
[0m15:11:52.737898 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m15:11:52.738897 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m15:11:52.738897 [info ] [Thread-4 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m15:11:52.739982 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m15:11:52.740901 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m15:11:52.747984 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m15:11:52.749905 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m15:11:52.782117 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m15:11:52.784117 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m15:11:52.784117 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m15:11:52.784117 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:57.032639 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.248 seconds
[0m15:11:57.037638 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m15:11:58.524245 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FEFFC1FA0>]}
[0m15:11:58.525332 [info ] [Thread-4 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 5.78s]
[0m15:11:58.526287 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m15:11:58.527259 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m15:11:58.529254 [info ] [Thread-4 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m15:11:58.530254 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_portfolio_performance, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m15:11:58.531259 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m15:11:58.538587 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m15:11:58.540866 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m15:11:58.546866 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m15:11:58.550860 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m15:11:58.551864 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m15:11:58.552865 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:12:01.337173 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.784 seconds
[0m15:12:01.342167 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m15:12:02.039511 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FEFEA0D40>]}
[0m15:12:06.406006 [debug] [Thread-4 (]: An error was encountered while trying to send an event
[0m15:12:06.409535 [info ] [Thread-4 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 3.51s]
[0m15:12:06.410047 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m15:12:06.411064 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m15:12:06.412899 [info ] [Thread-4 (]: 24 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m15:12:06.412899 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_executive_summary, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m15:12:06.413974 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m15:12:06.419987 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m15:12:06.420988 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m15:12:06.425995 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m15:12:06.427998 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m15:12:06.428999 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m15:12:06.428999 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:12:11.378858 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.949 seconds
[0m15:12:11.383362 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m15:12:13.265636 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1C6BF20>]}
[0m15:12:13.267723 [info ] [Thread-4 (]: 24 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 6.85s]
[0m15:12:13.269650 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m15:12:13.269650 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m15:12:13.270651 [info ] [Thread-4 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m15:12:13.271651 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_performance_drivers, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m15:12:13.272651 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m15:12:13.277647 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m15:12:13.279650 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m15:12:13.285739 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m15:12:13.287659 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m15:12:13.288664 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m15:12:13.289662 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:12:16.954391 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.665 seconds
[0m15:12:16.959388 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m15:12:18.113600 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1BD20F0>]}
[0m15:12:18.114686 [info ] [Thread-4 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 4.84s]
[0m15:12:18.115609 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m15:12:18.116609 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m15:12:18.116609 [info ] [Thread-4 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m15:12:18.117609 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_position_attribution, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m15:12:18.117609 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m15:12:18.121514 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m15:12:18.123511 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m15:12:18.126020 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m15:12:18.127028 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m15:12:18.128025 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m15:12:18.128025 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:12:20.902590 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.774 seconds
[0m15:12:20.905601 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m15:12:21.608700 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb290dce-ecf7-4413-a52e-e97587ed13db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1BD2FF0>]}
[0m15:12:21.609695 [info ] [Thread-4 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 3.49s]
[0m15:12:21.609695 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m15:12:21.610701 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:12:21.611702 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was properly closed.
[0m15:12:21.611702 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was properly closed.
[0m15:12:21.611702 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was properly closed.
[0m15:12:21.612702 [info ] [MainThread]: 
[0m15:12:21.612702 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 2 minutes and 24.50 seconds (144.50s).
[0m15:12:21.614701 [debug] [MainThread]: Command end result
[0m15:12:21.641861 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m15:12:21.643861 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m15:12:21.648718 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\BiaDigi\sample-dbt-project\target\run_results.json
[0m15:12:21.649721 [info ] [MainThread]: 
[0m15:12:21.649721 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:12:21.649721 [info ] [MainThread]: 
[0m15:12:21.650711 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m15:12:21.650711 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m15:12:21.651719 [debug] [MainThread]: Command `dbt build` succeeded at 15:12:21.650711 after 146.00 seconds
[0m15:12:21.651719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FF1C60F20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FC4B81DF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027FC2DC14F0>]}
[0m15:12:21.651719 [debug] [MainThread]: Flushing usage events
[0m15:12:23.359969 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:11:16.868430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8A1AE36E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8A494A210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8A494B1D0>]}


============================== 16:11:16.875432 | 61d4a826-112f-4aa4-9cd5-11f7a27b57bf ==============================
[0m16:11:16.875432 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:11:16.877432 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt build --select tag:pipeline_a', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m16:11:17.441640 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m16:11:17.441640 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m16:11:17.441640 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m16:11:17.495695 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m16:11:17.495695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '61d4a826-112f-4aa4-9cd5-11f7a27b57bf', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8A5F54CE0>]}
[0m16:11:17.668965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '61d4a826-112f-4aa4-9cd5-11f7a27b57bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8A1CA9850>]}
[0m16:11:17.727602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '61d4a826-112f-4aa4-9cd5-11f7a27b57bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8CE887050>]}
[0m16:11:17.729607 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m16:11:17.937301 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:11:18.042555 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:11:18.042555 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m16:11:18.043597 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:11:18.047595 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m16:11:18.078314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '61d4a826-112f-4aa4-9cd5-11f7a27b57bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8D1426900>]}
[0m16:11:18.149159 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m16:11:18.151153 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m16:11:18.181161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '61d4a826-112f-4aa4-9cd5-11f7a27b57bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8D15A48F0>]}
[0m16:11:18.181161 [info ] [MainThread]: Found 40 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m16:11:18.183167 [info ] [MainThread]: 
[0m16:11:18.184159 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:11:18.184159 [info ] [MainThread]: 
[0m16:11:18.184159 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:11:18.187080 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m16:11:18.235462 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m16:11:18.235462 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m16:11:18.235462 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:11:21.105723 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 2.870 seconds
[0m16:11:21.108720 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: Close
[0m16:11:22.078231 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m16:11:22.096228 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m16:11:22.097229 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m16:11:22.097229 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:11:24.261725 [debug] [ThreadPool]: SQL status: SUCCESS 55 in 2.165 seconds
[0m16:11:24.268556 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: Close
[0m16:11:24.892018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '61d4a826-112f-4aa4-9cd5-11f7a27b57bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8D1152780>]}
[0m16:11:24.896019 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m16:11:24.897024 [info ] [Thread-4 (]: 1 of 4 START sql view model DEV.stg_cashflows .................................. [RUN]
[0m16:11:24.898023 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_cashflows'
[0m16:11:24.898023 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_cashflows
[0m16:11:24.905206 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m16:11:24.908957 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_cashflows
[0m16:11:24.929551 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m16:11:24.930550 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_cashflows"
[0m16:11:24.931550 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: create or replace   view BAIN_ANALYTICS.DEV.stg_cashflows
  
  
  
  
  as (
    -- Pipeline A: Staging Layer
-- stg_cashflows.sql
-- Purpose: Clean and standardize cashflow transaction data
-- Models downstream: 1 (int_cashflow_aggregated)



select
    concat(portfolio_id, '-', cashflow_date, '-', row_number() over (partition by portfolio_id, cashflow_date order by cashflow_id)) as cashflow_id,
    portfolio_id,
    cashflow_date,
    cashflow_type,
    amount,
    currency,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_cashflows
where amount <> 0
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_cashflows"} */;
[0m16:11:24.931550 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:11:27.421056 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.489 seconds
[0m16:11:27.448120 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_cashflows: Close
[0m16:11:28.464149 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '61d4a826-112f-4aa4-9cd5-11f7a27b57bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8A1CA8AA0>]}
[0m16:11:28.465148 [info ] [Thread-4 (]: 1 of 4 OK created sql view model DEV.stg_cashflows ............................. [[32mSUCCESS 1[0m in 3.56s]
[0m16:11:28.466146 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_cashflows
[0m16:11:28.467147 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m16:11:28.468145 [info ] [Thread-4 (]: 2 of 4 START sql view model DEV.stg_portfolios ................................. [RUN]
[0m16:11:28.469143 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_cashflows, now model.bain_capital_portfolio_analytics.stg_portfolios)
[0m16:11:28.470146 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolios
[0m16:11:28.475221 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m16:11:28.479234 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolios
[0m16:11:28.485340 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m16:11:28.487354 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolios"
[0m16:11:28.488408 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolios
  
  
  
  
  as (
    -- Pipeline A: Staging Layer
-- stg_portfolios.sql
-- Purpose: Clean and standardize portfolio dimension data
-- Models downstream: 1 (int_portfolio_attributes)



select
    portfolio_id,
    portfolio_name,
    portfolio_type,
    fund_id,
    status,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolios
where status = 'ACTIVE'
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolios"} */;
[0m16:11:28.489426 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:11:30.875188 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.386 seconds
[0m16:11:30.878183 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolios: Close
[0m16:11:31.528618 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '61d4a826-112f-4aa4-9cd5-11f7a27b57bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8D2F03BC0>]}
[0m16:11:31.530136 [info ] [Thread-4 (]: 2 of 4 OK created sql view model DEV.stg_portfolios ............................ [[32mSUCCESS 1[0m in 3.06s]
[0m16:11:31.530644 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolios
[0m16:11:31.531657 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m16:11:31.533329 [info ] [Thread-4 (]: 3 of 4 START sql table model DEV.int_cashflow_aggregated ....................... [RUN]
[0m16:11:31.534343 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolios, now model.bain_capital_portfolio_analytics.int_cashflow_aggregated)
[0m16:11:31.534343 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m16:11:31.540344 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m16:11:31.545630 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m16:11:31.572628 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m16:11:31.574628 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"
[0m16:11:31.574628 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: create or replace transient table BAIN_ANALYTICS.DEV.int_cashflow_aggregated
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_cashflow_aggregated.sql
-- Purpose: Pre-aggregate cashflows by portfolio, month, type (push aggregation upstream)
-- Models downstream: 1 (fact_portfolio_cashflow)



with cashflows as (
    select * from BAIN_ANALYTICS.DEV.stg_cashflows
),

-- Pre-aggregate at source to reduce rows before fact table join
monthly_aggregated as (
    select
        portfolio_id,
        date_trunc('month', cashflow_date) as cashflow_month,
        cashflow_type,
        currency,
        count(*) as transaction_count,
        sum(amount) as total_amount,
        avg(amount) as avg_amount,
        min(amount) as min_amount,
        max(amount) as max_amount
    from cashflows
    group by portfolio_id, date_trunc('month', cashflow_date), cashflow_type, currency
)

select
    portfolio_id,
    cashflow_month,
    extract(year from cashflow_month) as cashflow_year,
    extract(month from cashflow_month) as cashflow_month_num,
    extract(quarter from cashflow_month) as cashflow_quarter,
    cashflow_type,
    currency,
    transaction_count,
    total_amount,
    avg_amount,
    min_amount,
    max_amount
from monthly_aggregated
    )

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_cashflow_aggregated"} */;
[0m16:11:31.574628 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:11:36.546228 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.971 seconds
[0m16:11:36.548236 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_cashflow_aggregated: Close
[0m16:11:37.157484 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '61d4a826-112f-4aa4-9cd5-11f7a27b57bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8D2F57B60>]}
[0m16:11:37.159485 [info ] [Thread-4 (]: 3 of 4 OK created sql table model DEV.int_cashflow_aggregated .................. [[32mSUCCESS 1[0m in 5.62s]
[0m16:11:37.160484 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_cashflow_aggregated
[0m16:11:37.161484 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m16:11:37.162487 [info ] [Thread-4 (]: 4 of 4 START sql table model DEV.int_portfolio_attributes ...................... [RUN]
[0m16:11:37.162487 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_cashflow_aggregated, now model.bain_capital_portfolio_analytics.int_portfolio_attributes)
[0m16:11:37.163482 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m16:11:37.167483 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m16:11:37.168483 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m16:11:37.172443 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m16:11:37.174446 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_attributes"
[0m16:11:37.175439 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: create or replace transient table BAIN_ANALYTICS.DEV.int_portfolio_attributes
    
    
    
    as (-- Pipeline A: Intermediate Layer
-- int_portfolio_attributes.sql
-- Purpose: Enrich portfolios with dimensional attributes
-- Models downstream: 1 (fact_portfolio_cashflow)



with portfolios as (
    select * from BAIN_ANALYTICS.DEV.stg_portfolios
)

select
    p.portfolio_id,
    p.portfolio_name,
    p.portfolio_type,
    p.fund_id,
    case
        when p.portfolio_type = 'EQUITY' then 1
        when p.portfolio_type = 'FIXED_INCOME' then 2
        when p.portfolio_type = 'BALANCED' then 3
        else 4
    end as portfolio_type_priority,
    p.dbt_loaded_at
from portfolios p
    )

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_attributes"} */;
[0m16:11:37.175439 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:11:40.906120 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.730 seconds
[0m16:11:40.910118 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_attributes: Close
[0m16:11:41.860674 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '61d4a826-112f-4aa4-9cd5-11f7a27b57bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8D2F24380>]}
[0m16:11:41.862690 [info ] [Thread-4 (]: 4 of 4 OK created sql table model DEV.int_portfolio_attributes ................. [[32mSUCCESS 1[0m in 4.70s]
[0m16:11:41.863692 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_attributes
[0m16:11:41.865692 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:11:41.866768 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was properly closed.
[0m16:11:41.867692 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was properly closed.
[0m16:11:41.867692 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.int_portfolio_attributes' was properly closed.
[0m16:11:41.868691 [info ] [MainThread]: 
[0m16:11:41.869702 [info ] [MainThread]: Finished running 2 table models, 2 view models in 0 hours 0 minutes and 23.68 seconds (23.68s).
[0m16:11:41.871703 [debug] [MainThread]: Command end result
[0m16:11:41.899462 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m16:11:41.901384 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m16:11:41.905387 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\BiaDigi\sample-dbt-project\target\run_results.json
[0m16:11:41.905387 [info ] [MainThread]: 
[0m16:11:41.905387 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:11:41.906384 [info ] [MainThread]: 
[0m16:11:41.906384 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m16:11:41.906384 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:11:41.907383 [debug] [MainThread]: Command `dbt build` succeeded at 16:11:41.907383 after 25.14 seconds
[0m16:11:41.907383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8A1AE36E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8D1629220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8A5F57FB0>]}
[0m16:11:41.907383 [debug] [MainThread]: Flushing usage events
[0m16:11:44.458184 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:16:55.052758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002120FC5DC70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002120FC5D0D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002120FC5EF60>]}


============================== 16:16:55.055760 | d713c795-62db-42f2-bf4c-1846270fdd68 ==============================
[0m16:16:55.055760 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:16:55.056758 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_b', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m16:16:55.576083 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m16:16:55.577090 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m16:16:55.577090 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m16:16:55.629183 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m16:16:55.630191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123AD1CA70>]}
[0m16:16:55.795743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123A90CEC0>]}
[0m16:16:55.851482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123ACF39E0>]}
[0m16:16:55.853144 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m16:16:56.029509 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:16:56.128060 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:16:56.128060 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m16:16:56.128060 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:16:56.133062 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.utilities
- models.bain_capital_portfolio_analytics.pipeline_a.marts
[0m16:16:56.163859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123AF4FC80>]}
[0m16:16:56.234391 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m16:16:56.236328 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m16:16:56.282827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123B459EB0>]}
[0m16:16:56.283827 [info ] [MainThread]: Found 40 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m16:16:56.285828 [info ] [MainThread]: 
[0m16:16:56.285828 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:16:56.285828 [info ] [MainThread]: 
[0m16:16:56.285828 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:16:56.288828 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m16:16:56.337832 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m16:16:56.337832 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m16:16:56.337832 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:16:59.476322 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 3.138 seconds
[0m16:16:59.479317 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: Close
[0m16:17:00.137183 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m16:17:00.152410 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m16:17:00.153411 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m16:17:00.154412 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:17:02.719259 [debug] [ThreadPool]: SQL status: SUCCESS 55 in 2.566 seconds
[0m16:17:02.725180 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: Close
[0m16:17:03.805771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123B30A300>]}
[0m16:17:03.811973 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_brokers
[0m16:17:03.813059 [info ] [Thread-4 (]: 1 of 10 START sql view model DEV.stg_brokers ................................... [RUN]
[0m16:17:03.814043 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_brokers'
[0m16:17:03.815054 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_brokers
[0m16:17:03.827500 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m16:17:03.829501 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_brokers
[0m16:17:03.852495 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_brokers"
[0m16:17:03.853496 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_brokers"
[0m16:17:03.853496 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_brokers: create or replace   view BAIN_ANALYTICS.DEV.stg_brokers
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_brokers.sql
-- Purpose: Clean broker/counterparty data



select
    broker_id,
    broker_name,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_brokers
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_brokers"} */;
[0m16:17:03.854496 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:17:05.974449 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.120 seconds
[0m16:17:06.003137 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_brokers: Close
[0m16:17:06.863321 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123CAB4650>]}
[0m16:17:06.865402 [info ] [Thread-4 (]: 1 of 10 OK created sql view model DEV.stg_brokers .............................. [[32mSUCCESS 1[0m in 3.05s]
[0m16:17:06.866324 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_brokers
[0m16:17:06.867324 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m16:17:06.867941 [info ] [Thread-4 (]: 2 of 10 START sql view model DEV.stg_market_prices ............................. [RUN]
[0m16:17:06.868955 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_brokers, now model.bain_capital_portfolio_analytics.stg_market_prices)
[0m16:17:06.868955 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_market_prices
[0m16:17:06.873954 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m16:17:06.874955 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_market_prices
[0m16:17:06.878952 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m16:17:06.880953 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_market_prices"
[0m16:17:06.880953 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: create or replace   view BAIN_ANALYTICS.DEV.stg_market_prices
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_market_prices.sql
-- Purpose: Clean market price data



select
    security_id,
    price_date,
    close_price,
    volume,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_market_prices
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_market_prices"} */;
[0m16:17:06.881953 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:17:09.793210 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.911 seconds
[0m16:17:09.798210 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_market_prices: Close
[0m16:17:10.415525 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123CB75F10>]}
[0m16:17:10.417537 [info ] [Thread-4 (]: 2 of 10 OK created sql view model DEV.stg_market_prices ........................ [[32mSUCCESS 1[0m in 3.55s]
[0m16:17:10.419536 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_market_prices
[0m16:17:10.420535 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_securities
[0m16:17:10.421578 [info ] [Thread-4 (]: 3 of 10 START sql view model DEV.stg_securities ................................ [RUN]
[0m16:17:10.422556 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_market_prices, now model.bain_capital_portfolio_analytics.stg_securities)
[0m16:17:10.423539 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_securities
[0m16:17:10.429546 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m16:17:10.431549 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_securities
[0m16:17:10.435543 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_securities"
[0m16:17:10.437546 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_securities"
[0m16:17:10.437546 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: create or replace   view BAIN_ANALYTICS.DEV.stg_securities
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_securities.sql
-- Purpose: Clean security master data



select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_securities
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_securities"} */;
[0m16:17:10.438547 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:17:13.928472 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.490 seconds
[0m16:17:13.934469 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_securities: Close
[0m16:17:15.581081 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123CC3BEC0>]}
[0m16:17:15.584172 [info ] [Thread-4 (]: 3 of 10 OK created sql view model DEV.stg_securities ........................... [[32mSUCCESS 1[0m in 5.16s]
[0m16:17:15.587179 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_securities
[0m16:17:15.591173 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_trades
[0m16:17:15.594176 [info ] [Thread-4 (]: 4 of 10 START sql view model DEV.stg_trades .................................... [RUN]
[0m16:17:15.597173 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_securities, now model.bain_capital_portfolio_analytics.stg_trades)
[0m16:17:15.599869 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_trades
[0m16:17:15.614796 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m16:17:15.619793 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_trades
[0m16:17:15.630794 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_trades"
[0m16:17:15.636788 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_trades"
[0m16:17:15.638793 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_trades: create or replace   view BAIN_ANALYTICS.DEV.stg_trades
  
  
  
  
  as (
    -- Pipeline B: Staging Layer
-- stg_trades.sql
-- Purpose: Clean and standardize trade transaction data



select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(price as numeric(18, 2)) as price,
    cast(net_amount as numeric(18, 2)) as commission,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_trades
where quantity > 0
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_trades"} */;
[0m16:17:15.640788 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:17:18.924364 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.284 seconds
[0m16:17:18.931974 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_trades: Close
[0m16:17:19.625128 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123CC430B0>]}
[0m16:17:19.628127 [info ] [Thread-4 (]: 4 of 10 OK created sql view model DEV.stg_trades ............................... [[32mSUCCESS 1[0m in 4.03s]
[0m16:17:19.632130 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_trades
[0m16:17:19.636132 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m16:17:19.638131 [info ] [Thread-4 (]: 5 of 10 START sql view model DEV.int_trades_enriched ........................... [RUN]
[0m16:17:19.640130 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_trades, now model.bain_capital_portfolio_analytics.int_trades_enriched)
[0m16:17:19.642131 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m16:17:19.655133 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m16:17:19.661133 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m16:17:19.675216 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m16:17:19.682216 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trades_enriched"
[0m16:17:19.684130 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_trades_enriched
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trades_enriched.sql
-- Purpose: Enrich trades with security and broker details



with trades as (
    select * from BAIN_ANALYTICS.DEV.stg_trades
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
),
brokers as (
    select * from BAIN_ANALYTICS.DEV.stg_brokers
)

select
    t.trade_id,
    t.portfolio_id,
    t.security_id,
    t.broker_id,
    t.trade_date,
    t.trade_type,
    t.quantity,
    t.price,
    t.commission,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector,
    b.broker_name
from trades t
inner join securities s on t.security_id = s.security_id
inner join brokers b on t.broker_id = b.broker_id
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trades_enriched"} */;
[0m16:17:19.686219 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:17:21.943202 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.256 seconds
[0m16:17:21.954213 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trades_enriched: Close
[0m16:17:22.712105 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123CBD0140>]}
[0m16:17:22.715107 [info ] [Thread-4 (]: 5 of 10 OK created sql view model DEV.int_trades_enriched ...................... [[32mSUCCESS 1[0m in 3.07s]
[0m16:17:22.720099 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trades_enriched
[0m16:17:22.723100 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m16:17:22.725100 [info ] [Thread-4 (]: 6 of 10 START sql table model DEV.int_trade_metrics ............................ [RUN]
[0m16:17:22.728620 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trades_enriched, now model.bain_capital_portfolio_analytics.int_trade_metrics)
[0m16:17:22.732616 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m16:17:22.749360 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m16:17:22.758362 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m16:17:22.885669 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m16:17:22.894777 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_metrics"
[0m16:17:22.895767 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: create or replace transient table BAIN_ANALYTICS.DEV.int_trade_metrics
    
    
    
    as (-- Pipeline B: Intermediate Layer
-- int_trade_metrics.sql
-- Purpose: Calculate trade-level metrics and PnL



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_trades_enriched
),

cast_enriched as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(price as numeric(18, 2)) as price,
        cast(commission as numeric(18, 2)) as commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name
    from enriched
),

trade_values as (
    select
        trade_id,
        portfolio_id,
        security_id,
        broker_id,
        trade_date,
        trade_type,
        quantity,
        price,
        commission,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        round(quantity * price, 2) as trade_value,
        round(quantity * price - commission, 2) as net_trade_value,
        round(case
            when trade_type = 'BUY' then -1 * (quantity * price)
            when trade_type = 'SELL' then quantity * price
            else 0
        end, 2) as position_impact
    from cast_enriched
)

select
    trade_id,
    portfolio_id,
    security_id,
    broker_id,
    trade_date,
    trade_type,
    quantity,
    price,
    commission,
    ticker,
    security_name,
    asset_class,
    sector,
    broker_name,
    trade_value,
    net_trade_value,
    position_impact
from trade_values
    )

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_metrics"} */;
[0m16:17:22.896855 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:17:26.845083 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.948 seconds
[0m16:17:26.851026 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_metrics: Close
[0m16:17:27.811981 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123CBF9010>]}
[0m16:17:27.816435 [info ] [Thread-4 (]: 6 of 10 OK created sql table model DEV.int_trade_metrics ....................... [[32mSUCCESS 1[0m in 5.08s]
[0m16:17:27.821435 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_metrics
[0m16:17:27.826436 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_security_performance
[0m16:17:27.829436 [info ] [Thread-4 (]: 7 of 10 START sql view model DEV.int_security_performance ...................... [RUN]
[0m16:17:27.832433 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_metrics, now model.bain_capital_portfolio_analytics.int_security_performance)
[0m16:17:27.833436 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_security_performance
[0m16:17:27.851437 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m16:17:27.856432 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_security_performance
[0m16:17:27.870603 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_security_performance"
[0m16:17:27.877190 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_security_performance"
[0m16:17:27.879294 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: create or replace   view BAIN_ANALYTICS.DEV.int_security_performance
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_security_performance.sql
-- Purpose: Per-security trading performance metrics



with trades as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
)

select
    security_id,
    ticker,
    security_name,
    asset_class,
    sector,
    count(*) as security_trade_count,
    count(distinct portfolio_id) as portfolios_traded,
    count(distinct broker_id) as brokers_used,
    sum(quantity) as total_quantity_traded,
    sum(trade_value) as total_trade_value,
    avg(price) as avg_trading_price,
    min(price) as min_trading_price,
    max(price) as max_trading_price,
    round(stddev_pop(price), 4) as price_volatility,
    sum(commission) as total_commissions
from trades
group by security_id, ticker, security_name, asset_class, sector
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_security_performance"} */;
[0m16:17:27.882293 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:17:30.173489 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.292 seconds
[0m16:17:30.179569 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_security_performance: Close
[0m16:17:31.339007 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123CAB4950>]}
[0m16:17:31.342987 [info ] [Thread-4 (]: 7 of 10 OK created sql view model DEV.int_security_performance ................. [[32mSUCCESS 1[0m in 3.51s]
[0m16:17:31.346987 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_security_performance
[0m16:17:31.348984 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m16:17:31.351002 [info ] [Thread-4 (]: 8 of 10 START sql view model DEV.int_trade_execution_analysis .................. [RUN]
[0m16:17:31.353005 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_security_performance, now model.bain_capital_portfolio_analytics.int_trade_execution_analysis)
[0m16:17:31.354988 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m16:17:31.366997 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m16:17:31.373233 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m16:17:31.379317 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m16:17:31.385246 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"
[0m16:17:31.386248 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_execution_analysis.sql
-- Purpose: Advanced trade execution analysis with market impact and execution costs



with trades_detail as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

market_context as (
    select
        trade_date,
        security_id,
        avg(price) as daily_avg_price,
        min(price) as daily_min_price,
        max(price) as daily_max_price,
        max(price) - min(price) as daily_price_range,
        stddev_pop(price) as daily_volatility
    from trades_detail
    group by 1, 2
)

select
    td.trade_id,
    td.trade_date,
    td.portfolio_id,
    td.security_id,
    td.ticker,
    td.quantity,
    td.price as execution_price,
    td.trade_value,
    td.commission,
    mc.daily_avg_price,
    mc.daily_min_price,
    mc.daily_max_price,
    mc.daily_price_range,
    mc.daily_volatility,
    round((td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0), 8) as execution_percentile,
    round(100 * (td.price - mc.daily_avg_price) / nullif(mc.daily_avg_price, 0), 4) as price_vs_avg_pct,
    case
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.75 then 'POOR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.50 then 'FAIR'
        when (td.price - mc.daily_min_price) / nullif(mc.daily_price_range, 0) > 0.25 then 'GOOD'
        else 'EXCELLENT'
    end as execution_quality,
    round(td.commission / nullif(td.trade_value, 0), 8) as commission_ratio,
    round(100 * td.commission / nullif(td.trade_value, 0), 6) as commission_ratio_bps
from trades_detail td
join market_context mc
    on td.security_id = mc.security_id
    and td.trade_date = mc.trade_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_execution_analysis"} */;
[0m16:17:31.387245 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:17:34.952491 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.565 seconds
[0m16:17:34.958278 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_execution_analysis: Close
[0m16:17:35.817257 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002120B62DBE0>]}
[0m16:17:35.820260 [info ] [Thread-4 (]: 8 of 10 OK created sql view model DEV.int_trade_execution_analysis ............. [[32mSUCCESS 1[0m in 4.46s]
[0m16:17:35.823257 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_execution_analysis
[0m16:17:35.824256 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m16:17:35.826268 [info ] [Thread-4 (]: 9 of 10 START sql view model DEV.int_trade_summary ............................. [RUN]
[0m16:17:35.828259 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_execution_analysis, now model.bain_capital_portfolio_analytics.int_trade_summary)
[0m16:17:35.830257 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_trade_summary
[0m16:17:35.843255 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m16:17:35.851259 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_trade_summary
[0m16:17:35.878320 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m16:17:35.889446 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_trade_summary"
[0m16:17:35.892439 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: create or replace   view BAIN_ANALYTICS.DEV.int_trade_summary
  
  
  
  
  as (
    -- Pipeline B: Intermediate Layer
-- int_trade_summary.sql
-- Purpose: Summarize trades by security and date (for aggregation upstream)



with metrics as (
    select * from BAIN_ANALYTICS.DEV.int_trade_metrics
),

summary as (
    select
        portfolio_id,
        security_id,
        trade_date,
        ticker,
        security_name,
        asset_class,
        sector,
        broker_name,
        count(*) as trade_count,
        sum(quantity) as total_quantity,
        sum(trade_value) as total_trade_value,
        sum(commission) as total_commission,
        avg(price) as avg_price
    from metrics
    group by portfolio_id, security_id, trade_date, ticker, security_name, asset_class, sector, broker_name
)

select * from summary
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_trade_summary"} */;
[0m16:17:35.894370 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:17:38.020900 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.127 seconds
[0m16:17:38.028888 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_trade_summary: Close
[0m16:17:39.025933 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002120B62DE20>]}
[0m16:17:39.027937 [info ] [Thread-4 (]: 9 of 10 OK created sql view model DEV.int_trade_summary ........................ [[32mSUCCESS 1[0m in 3.20s]
[0m16:17:39.029930 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_trade_summary
[0m16:17:39.032016 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m16:17:39.035028 [info ] [Thread-4 (]: 10 of 10 START sql view model DEV.report_trade_performance ..................... [RUN]
[0m16:17:39.036943 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_trade_summary, now model.bain_capital_portfolio_analytics.report_trade_performance)
[0m16:17:39.039016 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_trade_performance
[0m16:17:39.050024 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m16:17:39.057023 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_trade_performance
[0m16:17:39.067967 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m16:17:39.074968 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_trade_performance"
[0m16:17:39.076967 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: create or replace   view BAIN_ANALYTICS.DEV.report_trade_performance
  
  
  
  
  as (
    -- Pipeline B: Report Layer
-- report_trade_performance.sql
-- Purpose: Comprehensive trade execution and performance analysis



select
    trade_id,
    trade_date,
    portfolio_id,
    security_id,
    ticker,
    quantity,
    execution_price,
    trade_value,
    commission,
    daily_avg_price,
    execution_percentile,
    price_vs_avg_pct,
    execution_quality,
    commission_ratio_bps
from BAIN_ANALYTICS.DEV.int_trade_execution_analysis
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_trade_performance"} */;
[0m16:17:39.078961 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:17:42.051169 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.973 seconds
[0m16:17:42.057184 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_trade_performance: Close
[0m16:17:42.720108 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd713c795-62db-42f2-bf4c-1846270fdd68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123CCCB800>]}
[0m16:17:42.722106 [info ] [Thread-4 (]: 10 of 10 OK created sql view model DEV.report_trade_performance ................ [[32mSUCCESS 1[0m in 3.68s]
[0m16:17:42.725104 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_trade_performance
[0m16:17:42.730109 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:17:42.731107 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was properly closed.
[0m16:17:42.733623 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was properly closed.
[0m16:17:42.734662 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_trade_performance' was properly closed.
[0m16:17:42.736693 [info ] [MainThread]: 
[0m16:17:42.738692 [info ] [MainThread]: Finished running 1 table model, 9 view models in 0 hours 0 minutes and 46.45 seconds (46.45s).
[0m16:17:42.746691 [debug] [MainThread]: Command end result
[0m16:17:43.198558 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m16:17:43.208639 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m16:17:43.235402 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\BiaDigi\sample-dbt-project\target\run_results.json
[0m16:17:43.237484 [info ] [MainThread]: 
[0m16:17:43.240479 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:17:43.243441 [info ] [MainThread]: 
[0m16:17:43.244499 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=10
[0m16:17:43.247483 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:17:43.251412 [debug] [MainThread]: Command `dbt build` succeeded at 16:17:43.250492 after 48.27 seconds
[0m16:17:43.253488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002120E5923F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123AE84FB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002123AE840B0>]}
[0m16:17:43.255493 [debug] [MainThread]: Flushing usage events
[0m16:17:46.217873 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:30:43.961535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212D0C4E2D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212D3141010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212D3143E30>]}


============================== 16:30:43.964989 | 7436eb68-5f80-427c-9549-927940ba1cdf ==============================
[0m16:30:43.964989 [info ] [MainThread]: Running with dbt=1.11.4
[0m16:30:43.964989 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\BiaDigi\\sample-dbt-project', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\Users\\BiaDigi\\sample-dbt-project\\logs', 'introspect': 'True', 'invocation_command': 'dbt build --select tag:pipeline_c', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m16:30:44.520792 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m16:30:44.520792 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m16:30:44.521793 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m16:30:44.574631 [warn ] [MainThread]: [[33mWARNING[0m][MissingPlusPrefixDeprecation]: Deprecated functionality
Missing '+' prefix on `bain_capital_portfolio_analytics` found at
`bain_capital_portfolio_analytics` in file
`C:\Users\BiaDigi\sample-dbt-project\dbt_project.yml`. Hierarchical config
values without a '+' prefix are deprecated in dbt_project.yml.
[0m16:30:44.575636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212800E2A80>]}
[0m16:30:44.753915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212D31CCFE0>]}
[0m16:30:45.012844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212803489E0>]}
[0m16:30:45.017847 [info ] [MainThread]: Registered adapter: snowflake=1.11.1
[0m16:30:47.141450 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m16:30:47.817756 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:30:47.818772 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m16:30:47.820754 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:30:47.844285 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.bain_capital_portfolio_analytics.pipeline_a.marts
- models.bain_capital_portfolio_analytics.utilities
[0m16:30:48.025315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212805F2870>]}
[0m16:30:48.453397 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m16:30:48.464401 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m16:30:48.820248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021280609340>]}
[0m16:30:48.822246 [info ] [MainThread]: Found 40 models, 13 seeds, 19 data tests, 12 sources, 638 macros
[0m16:30:48.835251 [info ] [MainThread]: 
[0m16:30:48.836261 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:30:48.837774 [info ] [MainThread]: 
[0m16:30:48.840790 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:30:48.860807 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS'
[0m16:30:49.238837 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS"
[0m16:30:49.240571 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: show terse schemas in database BAIN_ANALYTICS
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS"} */
[0m16:30:49.242135 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:30:53.327952 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 4.086 seconds
[0m16:30:53.332947 [debug] [ThreadPool]: On list_BAIN_ANALYTICS: Close
[0m16:30:54.144780 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BAIN_ANALYTICS_DEV'
[0m16:30:54.188390 [debug] [ThreadPool]: Using snowflake connection "list_BAIN_ANALYTICS_DEV"
[0m16:30:54.190482 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: show objects in BAIN_ANALYTICS.DEV
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "connection_name": "list_BAIN_ANALYTICS_DEV"} */;
[0m16:30:54.193399 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:30:56.549663 [debug] [ThreadPool]: SQL status: SUCCESS 55 in 2.357 seconds
[0m16:30:56.557262 [debug] [ThreadPool]: On list_BAIN_ANALYTICS_DEV: Close
[0m16:30:58.705322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212801E2030>]}
[0m16:30:58.725319 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m16:30:58.733318 [info ] [Thread-4 (]: 1 of 26 START sql view model DEV.stg_benchmark_returns ......................... [RUN]
[0m16:30:58.735316 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.bain_capital_portfolio_analytics.stg_benchmark_returns'
[0m16:30:58.738322 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m16:30:58.775969 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m16:30:58.779894 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m16:30:58.898272 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m16:30:58.906195 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmark_returns"
[0m16:30:58.908199 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmark_returns
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmark_returns.sql



select
    benchmark_id,
    return_date,
    daily_return,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmark_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns"} */;
[0m16:30:58.910277 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:31:01.543181 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.633 seconds
[0m16:31:01.632950 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmark_returns: Close
[0m16:31:02.618291 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021281F5F770>]}
[0m16:31:02.620440 [info ] [Thread-4 (]: 1 of 26 OK created sql view model DEV.stg_benchmark_returns .................... [[32mSUCCESS 1[0m in 3.88s]
[0m16:31:02.623438 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmark_returns
[0m16:31:02.625438 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m16:31:02.627438 [info ] [Thread-4 (]: 2 of 26 START sql view model DEV.stg_benchmarks ................................ [RUN]
[0m16:31:02.629446 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmark_returns, now model.bain_capital_portfolio_analytics.stg_benchmarks)
[0m16:31:02.630430 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m16:31:02.641438 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m16:31:02.644430 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m16:31:02.654439 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m16:31:02.658439 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_benchmarks"
[0m16:31:02.660436 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_benchmarks.sql



select
    benchmark_id,
    benchmark_name,
    benchmark_ticker,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_benchmarks"} */;
[0m16:31:02.662524 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:05.640722 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.979 seconds
[0m16:31:05.646672 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_benchmarks: Close
[0m16:31:06.564956 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021282035D90>]}
[0m16:31:06.566173 [info ] [Thread-4 (]: 2 of 26 OK created sql view model DEV.stg_benchmarks ........................... [[32mSUCCESS 1[0m in 3.94s]
[0m16:31:06.568515 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_benchmarks
[0m16:31:06.571207 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m16:31:06.573119 [info ] [Thread-4 (]: 3 of 26 START sql view model DEV.stg_portfolio_benchmarks ...................... [RUN]
[0m16:31:06.576120 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_benchmarks, now model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks)
[0m16:31:06.577200 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m16:31:06.592122 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m16:31:06.598122 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m16:31:06.611210 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m16:31:06.616823 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"
[0m16:31:06.618901 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: create or replace   view BAIN_ANALYTICS.DEV.stg_portfolio_benchmarks
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_portfolio_benchmarks.sql



select
    portfolio_id,
    benchmark_id,
    is_primary,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_portfolio_benchmarks
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks"} */;
[0m16:31:06.620908 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:10.179928 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.559 seconds
[0m16:31:10.188020 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks: Close
[0m16:31:11.173329 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212820B73B0>]}
[0m16:31:11.181955 [info ] [Thread-4 (]: 3 of 26 OK created sql view model DEV.stg_portfolio_benchmarks ................. [[32mSUCCESS 1[0m in 4.60s]
[0m16:31:11.185872 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks
[0m16:31:11.188003 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m16:31:11.189962 [info ] [Thread-4 (]: 4 of 26 START sql view model DEV.stg_positions_daily ........................... [RUN]
[0m16:31:11.191872 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks, now model.bain_capital_portfolio_analytics.stg_positions_daily)
[0m16:31:11.201957 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m16:31:11.234959 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m16:31:11.240980 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m16:31:11.255964 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m16:31:11.265977 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_positions_daily"
[0m16:31:11.267967 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: create or replace   view BAIN_ANALYTICS.DEV.stg_positions_daily
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_positions_daily.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    cast(quantity as numeric(18, 2)) as quantity,
    cast(market_value_usd as numeric(18, 2)) as market_value_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_positions_daily
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_positions_daily"} */;
[0m16:31:11.272963 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:13.709987 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.439 seconds
[0m16:31:13.738907 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_positions_daily: Close
[0m16:31:15.034955 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212820E36B0>]}
[0m16:31:15.037882 [info ] [Thread-4 (]: 4 of 26 OK created sql view model DEV.stg_positions_daily ...................... [[32mSUCCESS 1[0m in 3.84s]
[0m16:31:15.039945 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_positions_daily
[0m16:31:15.041953 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.stg_valuations
[0m16:31:15.044965 [info ] [Thread-4 (]: 5 of 26 START sql view model DEV.stg_valuations ................................ [RUN]
[0m16:31:15.046954 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_positions_daily, now model.bain_capital_portfolio_analytics.stg_valuations)
[0m16:31:15.048960 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.stg_valuations
[0m16:31:15.059965 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m16:31:15.067395 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.stg_valuations
[0m16:31:15.081417 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.stg_valuations"
[0m16:31:15.086054 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.stg_valuations"
[0m16:31:15.089073 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_valuations: create or replace   view BAIN_ANALYTICS.DEV.stg_valuations
  
  
  
  
  as (
    -- Pipeline C: Staging Layer
-- stg_valuations.sql



select
    valuation_id,
    portfolio_id,
    valuation_date,
    nav,
    nav_usd,
    current_timestamp() as dbt_loaded_at
from BAIN_ANALYTICS.DEV.sample_valuations
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.stg_valuations"} */;
[0m16:31:15.090153 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:17.416858 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.326 seconds
[0m16:31:17.422069 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.stg_valuations: Close
[0m16:31:18.295003 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212820CBEF0>]}
[0m16:31:18.299342 [info ] [Thread-4 (]: 5 of 26 OK created sql view model DEV.stg_valuations ........................... [[32mSUCCESS 1[0m in 3.25s]
[0m16:31:18.302656 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.stg_valuations
[0m16:31:18.304756 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m16:31:18.306954 [info ] [Thread-4 (]: 6 of 26 START sql view model DEV.int_position_enriched ......................... [RUN]
[0m16:31:18.309637 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.stg_valuations, now model.bain_capital_portfolio_analytics.int_position_enriched)
[0m16:31:18.312393 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_enriched
[0m16:31:18.325027 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m16:31:18.329024 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_enriched
[0m16:31:18.339023 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m16:31:18.345024 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_enriched"
[0m16:31:18.347024 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: create or replace   view BAIN_ANALYTICS.DEV.int_position_enriched
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_enriched.sql



with positions as (
    select * from BAIN_ANALYTICS.DEV.stg_positions_daily
),
securities as (
    select * from BAIN_ANALYTICS.DEV.stg_securities
)

select
    p.position_id,
    p.portfolio_id,
    p.security_id,
    p.position_date,
    p.quantity,
    p.market_value_usd,
    s.ticker,
    s.security_name,
    s.asset_class,
    s.sector
from positions p
left join securities s on p.security_id = s.security_id
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_enriched"} */;
[0m16:31:18.348021 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:21.453715 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.105 seconds
[0m16:31:21.462641 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_enriched: Close
[0m16:31:22.342592 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212820D46E0>]}
[0m16:31:22.344677 [info ] [Thread-4 (]: 6 of 26 OK created sql view model DEV.int_position_enriched .................... [[32mSUCCESS 1[0m in 4.03s]
[0m16:31:22.345610 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_enriched
[0m16:31:22.346676 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m16:31:22.348629 [info ] [Thread-4 (]: 7 of 26 START sql view model DEV.int_portfolio_returns ......................... [RUN]
[0m16:31:22.351682 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_enriched, now model.bain_capital_portfolio_analytics.int_portfolio_returns)
[0m16:31:22.353601 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m16:31:22.366681 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m16:31:22.372728 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m16:31:22.388762 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m16:31:22.396691 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_returns"
[0m16:31:22.398366 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_returns.sql



with valuations as (
    select * from BAIN_ANALYTICS.DEV.stg_valuations
),

returns as (
    select
        portfolio_id,
        valuation_date,
        nav,
        nav_usd,
        lag(nav_usd) over (partition by portfolio_id order by valuation_date) as prev_nav,
        nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date) as daily_pnl,
        case
            when lag(nav_usd) over (partition by portfolio_id order by valuation_date) > 0
            then (nav_usd - lag(nav_usd) over (partition by portfolio_id order by valuation_date)) / lag(nav_usd) over (partition by portfolio_id order by valuation_date)
            else 0
        end as daily_return_pct,
        extract(year from valuation_date) as valuation_year,
        extract(month from valuation_date) as valuation_month,
        extract(quarter from valuation_date) as valuation_quarter
    from valuations
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns"} */;
[0m16:31:22.400457 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:26.114405 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.714 seconds
[0m16:31:26.130817 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_returns: Close
[0m16:31:27.312056 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212820D35F0>]}
[0m16:31:27.326790 [info ] [Thread-4 (]: 7 of 26 OK created sql view model DEV.int_portfolio_returns .................... [[32mSUCCESS 1[0m in 4.96s]
[0m16:31:27.329211 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_returns
[0m16:31:27.333217 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_returns
[0m16:31:27.336222 [info ] [Thread-4 (]: 8 of 26 START sql view model DEV.int_position_returns .......................... [RUN]
[0m16:31:27.339231 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_returns, now model.bain_capital_portfolio_analytics.int_position_returns)
[0m16:31:27.341218 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_returns
[0m16:31:27.354218 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m16:31:27.358226 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_returns
[0m16:31:27.368242 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_returns"
[0m16:31:27.373236 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_returns"
[0m16:31:27.375244 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_returns: create or replace   view BAIN_ANALYTICS.DEV.int_position_returns
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_returns.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector
    from enriched
),

returns as (
    select
        position_id,
        portfolio_id,
        security_id,
        position_date,
        quantity,
        market_value_usd,
        ticker,
        security_name,
        asset_class,
        sector,
        lag(market_value_usd) over (partition by security_id order by position_date) as prev_value,
        market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date) as daily_pnl,
        case
            when lag(market_value_usd) over (partition by security_id order by position_date) > 0
            then (market_value_usd - lag(market_value_usd) over (partition by security_id order by position_date)) / lag(market_value_usd) over (partition by security_id order by position_date)
            else 0
        end as daily_return_pct
    from cast_enriched
)

select * from returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_returns"} */;
[0m16:31:27.376244 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:30.199044 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.822 seconds
[0m16:31:30.204041 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_returns: Close
[0m16:31:30.890579 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212D0E80B30>]}
[0m16:31:30.891592 [info ] [Thread-4 (]: 8 of 26 OK created sql view model DEV.int_position_returns ..................... [[32mSUCCESS 1[0m in 3.55s]
[0m16:31:30.892587 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_returns
[0m16:31:30.893589 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m16:31:30.893589 [info ] [Thread-4 (]: 9 of 26 START sql view model DEV.int_sector_allocation ......................... [RUN]
[0m16:31:30.894589 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_returns, now model.bain_capital_portfolio_analytics.int_sector_allocation)
[0m16:31:30.894589 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m16:31:30.898088 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m16:31:30.899091 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m16:31:30.901534 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m16:31:30.903538 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_allocation"
[0m16:31:30.903538 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: create or replace   view BAIN_ANALYTICS.DEV.int_sector_allocation
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_allocation.sql



with enriched as (
    select * from BAIN_ANALYTICS.DEV.int_position_enriched
),

cast_enriched as (
    select
        portfolio_id,
        position_date,
        sector,
        cast(quantity as numeric(18, 2)) as quantity,
        cast(market_value_usd as numeric(18, 2)) as market_value_usd
    from enriched
),

sector_totals as (
    select
        portfolio_id,
        position_date,
        sector,
        count(*) as position_count,
        sum(market_value_usd) as sector_value,
        sum(quantity) as total_quantity
    from cast_enriched
    group by portfolio_id, position_date, sector
),

portfolio_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as portfolio_value
    from cast_enriched
    group by portfolio_id, position_date
)

select
    st.portfolio_id,
    st.position_date,
    st.sector,
    st.position_count,
    st.sector_value,
    st.total_quantity,
    st.sector_value / nullif(pt.portfolio_value, 0) as sector_weight
from sector_totals st
join portfolio_totals pt on st.portfolio_id = pt.portfolio_id and st.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_allocation"} */;
[0m16:31:30.904538 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:33.520800 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.616 seconds
[0m16:31:33.524811 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_allocation: Close
[0m16:31:34.188309 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212820A2900>]}
[0m16:31:34.190400 [info ] [Thread-4 (]: 9 of 26 OK created sql view model DEV.int_sector_allocation .................... [[32mSUCCESS 1[0m in 3.29s]
[0m16:31:34.191395 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_allocation
[0m16:31:34.192395 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m16:31:34.192395 [info ] [Thread-4 (]: 10 of 26 START sql view model DEV.int_portfolio_analysis_advanced .............. [RUN]
[0m16:31:34.194391 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_allocation, now model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced)
[0m16:31:34.194391 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m16:31:34.199411 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m16:31:34.201408 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m16:31:34.204407 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m16:31:34.208404 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"
[0m16:31:34.209407 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_analysis_advanced.sql
-- Purpose: Advanced portfolio analysis with risk decomposition and performance attribution



with daily_metrics as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_calcs as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d,
        max(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as max_return_90d,
        min(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as min_return_90d,
        sum(case when daily_return_pct > 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as positive_days_90d,
        sum(case when daily_return_pct < 0 then 1 else 0 end) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as negative_days_90d
    from daily_metrics
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(100 * daily_return_pct, 4) as daily_return_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * avg_return_90d, 4) as avg_daily_return_90d_pct,
    round(100 * max_return_90d, 4) as max_daily_return_90d_pct,
    round(100 * min_return_90d, 4) as min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    round(100 * positive_days_90d / nullif(positive_days_90d + negative_days_90d, 0), 4) as win_rate_pct,
    case
        when volatility_90d > 0 then round(avg_return_90d / nullif(volatility_90d, 0), 8)
        else 0
    end as sharpe_ratio_simple,
    round(max_return_90d - min_return_90d, 8) as return_range_90d,
    case
        when volatility_90d < 0.005 then 'ULTRA_LOW_RISK'
        when volatility_90d < 0.010 then 'LOW_RISK'
        when volatility_90d < 0.020 then 'MODERATE_RISK'
        when volatility_90d < 0.030 then 'HIGH_RISK'
        else 'VERY_HIGH_RISK'
    end as risk_classification
from rolling_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced"} */;
[0m16:31:34.209407 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:37.100054 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.890 seconds
[0m16:31:37.104053 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced: Close
[0m16:31:38.578667 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002128210CB60>]}
[0m16:31:38.580681 [info ] [Thread-4 (]: 10 of 26 OK created sql view model DEV.int_portfolio_analysis_advanced ......... [[32mSUCCESS 1[0m in 4.39s]
[0m16:31:38.581676 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced
[0m16:31:38.582680 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m16:31:38.583681 [info ] [Thread-4 (]: 11 of 26 START sql view model DEV.int_portfolio_drawdown ....................... [RUN]
[0m16:31:38.584679 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_analysis_advanced, now model.bain_capital_portfolio_analytics.int_portfolio_drawdown)
[0m16:31:38.584679 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m16:31:38.590678 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m16:31:38.592679 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m16:31:38.597677 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m16:31:38.599677 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"
[0m16:31:38.600677 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: create or replace   view BAIN_ANALYTICS.DEV.int_portfolio_drawdown
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_portfolio_drawdown.sql
-- Purpose: Calculate maximum drawdown and recovery metrics



with pr as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

running_max as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        max(nav_usd) over (partition by portfolio_id order by valuation_date) as running_max_nav
    from pr
)

select
    portfolio_id,
    valuation_date,
    round(nav_usd, 2) as nav_usd,
    round(running_max_nav, 2) as running_max_nav,
    round((nav_usd - running_max_nav) / nullif(running_max_nav, 0), 8) as drawdown_pct,
    round(100 * (nav_usd - running_max_nav) / nullif(running_max_nav, 0), 4) as drawdown_pct_display,
    case
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.10 then 'SEVERE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < -0.05 then 'MODERATE'
        when (nav_usd - running_max_nav) / nullif(running_max_nav, 0) < 0 then 'MILD'
        else 'NO_DRAWDOWN'
    end as drawdown_severity
from running_max
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_portfolio_drawdown"} */;
[0m16:31:38.601727 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:43.415058 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.814 seconds
[0m16:31:43.420045 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_portfolio_drawdown: Close
[0m16:31:44.170200 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002128210CAD0>]}
[0m16:31:44.172200 [info ] [Thread-4 (]: 11 of 26 OK created sql view model DEV.int_portfolio_drawdown .................. [[32mSUCCESS 1[0m in 5.59s]
[0m16:31:44.173198 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_portfolio_drawdown
[0m16:31:44.173708 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m16:31:44.174721 [info ] [Thread-4 (]: 12 of 26 START sql view model DEV.int_risk_metrics ............................. [RUN]
[0m16:31:44.175722 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_portfolio_drawdown, now model.bain_capital_portfolio_analytics.int_risk_metrics)
[0m16:31:44.176721 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m16:31:44.181720 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m16:31:44.182720 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m16:31:44.186718 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m16:31:44.188716 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_risk_metrics"
[0m16:31:44.189222 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: create or replace   view BAIN_ANALYTICS.DEV.int_risk_metrics
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_risk_metrics.sql



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

risk_calcs as (
    select
        portfolio_id,
        valuation_date,
        daily_return_pct,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as volatility_90d,
        stddev(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as volatility_1y,
        avg(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 89 preceding and current row) as avg_return_90d,
        min(daily_return_pct) over (partition by portfolio_id order by valuation_date rows between 364 preceding and current row) as max_drawdown
    from returns
)

select
    portfolio_id,
    valuation_date,
    daily_return_pct,
    volatility_90d,
    volatility_1y,
    avg_return_90d,
    max_drawdown,
    case when volatility_90d > 0 then avg_return_90d / volatility_90d else 0 end as sharpe_ratio
from risk_calcs
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_risk_metrics"} */;
[0m16:31:44.189222 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:46.619857 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.430 seconds
[0m16:31:46.622933 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_risk_metrics: Close
[0m16:31:47.418126 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021281F7E990>]}
[0m16:31:47.419138 [info ] [Thread-4 (]: 12 of 26 OK created sql view model DEV.int_risk_metrics ........................ [[32mSUCCESS 1[0m in 3.24s]
[0m16:31:47.419138 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_risk_metrics
[0m16:31:47.420131 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m16:31:47.420131 [info ] [Thread-4 (]: 13 of 26 START sql view model DEV.int_rolling_volatility ....................... [RUN]
[0m16:31:47.421130 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_risk_metrics, now model.bain_capital_portfolio_analytics.int_rolling_volatility)
[0m16:31:47.421130 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m16:31:47.424129 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m16:31:47.425133 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m16:31:47.427137 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m16:31:47.428135 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_rolling_volatility"
[0m16:31:47.429133 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: create or replace   view BAIN_ANALYTICS.DEV.int_rolling_volatility
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_rolling_volatility.sql
-- Purpose: Calculate rolling volatility over different time windows



with daily_returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_stats as (
    select
        portfolio_id,
        valuation_date,
        nav_usd,
        daily_return_pct,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as volatility_30d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as volatility_90d,
        stddev_pop(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 199 preceding and current row
        ) as volatility_200d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 29 preceding and current row
        ) as avg_return_30d,
        avg(daily_return_pct) over (
            partition by portfolio_id
            order by valuation_date
            rows between 89 preceding and current row
        ) as avg_return_90d
    from daily_returns
)

select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    round(volatility_30d, 8) as volatility_30d,
    round(volatility_90d, 8) as volatility_90d,
    round(volatility_200d, 8) as volatility_200d,
    round(avg_return_30d, 8) as avg_return_30d,
    round(avg_return_90d, 8) as avg_return_90d,
    round(100 * volatility_30d, 4) as volatility_30d_pct,
    round(100 * volatility_90d, 4) as volatility_90d_pct,
    round(100 * volatility_200d, 4) as volatility_200d_pct,
    round(100 * avg_return_30d, 4) as avg_return_30d_pct,
    round(100 * avg_return_90d, 4) as avg_return_90d_pct
from rolling_stats
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_rolling_volatility"} */;
[0m16:31:47.429133 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:50.088830 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.660 seconds
[0m16:31:50.094335 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_rolling_volatility: Close
[0m16:31:51.091101 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002128208ECF0>]}
[0m16:31:51.092168 [info ] [Thread-4 (]: 13 of 26 OK created sql view model DEV.int_rolling_volatility .................. [[32mSUCCESS 1[0m in 3.67s]
[0m16:31:51.093141 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_rolling_volatility
[0m16:31:51.094171 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m16:31:51.095164 [info ] [Thread-4 (]: 14 of 26 START sql view model DEV.fact_position_snapshot ....................... [RUN]
[0m16:31:51.096555 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_rolling_volatility, now model.bain_capital_portfolio_analytics.fact_position_snapshot)
[0m16:31:51.097477 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m16:31:51.102477 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m16:31:51.103552 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m16:31:51.109849 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m16:31:51.110851 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_position_snapshot"
[0m16:31:51.111775 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: create or replace   view BAIN_ANALYTICS.DEV.fact_position_snapshot
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_position_snapshot.sql



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    quantity,
    market_value_usd,
    ticker,
    security_name,
    asset_class,
    sector,
    daily_pnl,
    daily_return_pct
from BAIN_ANALYTICS.DEV.int_position_returns
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot"} */;
[0m16:31:51.111775 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:53.483422 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.371 seconds
[0m16:31:53.488490 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_position_snapshot: Close
[0m16:31:54.377357 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021282159010>]}
[0m16:31:54.378440 [info ] [Thread-4 (]: 14 of 26 OK created sql view model DEV.fact_position_snapshot .................. [[32mSUCCESS 1[0m in 3.28s]
[0m16:31:54.380371 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_position_snapshot
[0m16:31:54.380371 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m16:31:54.381371 [info ] [Thread-4 (]: 15 of 26 START sql view model DEV.int_performance_attribution_detailed ......... [RUN]
[0m16:31:54.382372 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_position_snapshot, now model.bain_capital_portfolio_analytics.int_performance_attribution_detailed)
[0m16:31:54.383367 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m16:31:54.454957 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m16:31:54.455960 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m16:31:54.458401 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m16:31:54.460388 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"
[0m16:31:54.461421 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: create or replace   view BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_performance_attribution_detailed.sql
-- Purpose: Detailed performance attribution across multiple dimensions



with pos_data as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

portfolio_metrics as (
    select
        portfolio_id,
        position_date,
        sum(daily_pnl) as total_portfolio_pnl,
        sum(market_value_usd * daily_return_pct) as weighted_pnl,
        sum(market_value_usd) as total_nav
    from pos_data
    group by 1, 2
)

select
    pd.position_id,
    pd.portfolio_id,
    pd.ticker,
    pd.security_name,
    pd.sector,
    pd.asset_class,
    pd.position_date,
    pd.quantity,
    pd.market_value_usd,
    pd.daily_pnl,
    pd.daily_return_pct,
    pm.total_portfolio_pnl,
    pm.total_nav,
    round(pd.market_value_usd / nullif(pm.total_nav, 0), 8) as position_weight,
    round(pd.daily_pnl / nullif(pm.total_portfolio_pnl, 0), 8) as pnl_contribution_pct,
    round(100 * pd.daily_pnl / nullif(pm.total_nav, 0), 4) as pnl_contribution_bps,
    round((pd.market_value_usd / nullif(pm.total_nav, 0)) * pd.daily_return_pct, 8) as weighted_return_contribution,
    case
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0.005 then 'STRONG_GAIN'
        when pd.daily_pnl > 0 and pd.daily_return_pct > 0 then 'POSITIVE'
        when pd.daily_pnl > 0 then 'GAIN_LOW_RETURN'
        when pd.daily_pnl < 0 and pd.daily_return_pct < -0.005 then 'STRONG_LOSS'
        when pd.daily_pnl < 0 then 'LOSS'
        else 'NEUTRAL'
    end as performance_category,
    rank() over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
    ) as pnl_impact_rank,
    round(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
        order by abs(pd.daily_pnl) desc
        rows between unbounded preceding and current row
    ) / nullif(sum(abs(pd.daily_pnl)) over (
        partition by pd.portfolio_id, pd.position_date
    ), 0), 8) as cumulative_pnl_contribution
from pos_data pd
join portfolio_metrics pm
    on pd.portfolio_id = pm.portfolio_id
    and pd.position_date = pm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_performance_attribution_detailed"} */;
[0m16:31:54.461421 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:31:57.039625 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.578 seconds
[0m16:31:57.043625 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_performance_attribution_detailed: Close
[0m16:31:57.802308 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021280142FF0>]}
[0m16:31:57.803327 [info ] [Thread-4 (]: 15 of 26 OK created sql view model DEV.int_performance_attribution_detailed .... [[32mSUCCESS 1[0m in 3.42s]
[0m16:31:57.804318 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_performance_attribution_detailed
[0m16:31:57.805318 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m16:31:57.806320 [info ] [Thread-4 (]: 16 of 26 START sql view model DEV.int_position_attribution ..................... [RUN]
[0m16:31:57.807396 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_performance_attribution_detailed, now model.bain_capital_portfolio_analytics.int_position_attribution)
[0m16:31:57.807396 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_attribution
[0m16:31:57.812397 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m16:31:57.814320 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_attribution
[0m16:31:57.818320 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m16:31:57.819317 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_attribution"
[0m16:31:57.820530 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_attribution.sql
-- Purpose: Analyze position-level contribution to portfolio performance



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_nav as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value
    from pos_perf
    group by 1, 2
)

select
    pp.position_id,
    pp.portfolio_id,
    pp.security_id,
    pp.position_date,
    pp.ticker,
    pp.security_name,
    pp.asset_class,
    pp.sector,
    pp.market_value_usd,
    pn.total_portfolio_value,
    round(pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pp.market_value_usd / nullif(pn.total_portfolio_value, 0), 4) as position_weight_pct,
    pp.daily_pnl,
    pp.daily_return_pct,
    round(pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 8) as position_contribution_to_portfolio_pnl,
    round(100 * pp.daily_pnl / nullif(pn.total_portfolio_value, 0), 4) as position_contribution_bps
from pos_perf pp
join port_nav pn
    on pp.portfolio_id = pn.portfolio_id
    and pp.position_date = pn.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_attribution"} */;
[0m16:31:57.820530 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:01.069771 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.248 seconds
[0m16:32:01.073767 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_attribution: Close
[0m16:32:01.772771 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212802FB710>]}
[0m16:32:01.774863 [info ] [Thread-4 (]: 16 of 26 OK created sql view model DEV.int_position_attribution ................ [[32mSUCCESS 1[0m in 3.97s]
[0m16:32:01.775784 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_attribution
[0m16:32:01.776785 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m16:32:01.778228 [info ] [Thread-4 (]: 17 of 26 START sql view model DEV.int_position_risk_decomposition .............. [RUN]
[0m16:32:01.779318 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_attribution, now model.bain_capital_portfolio_analytics.int_position_risk_decomposition)
[0m16:32:01.780243 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m16:32:01.786247 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m16:32:01.788244 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m16:32:01.793750 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m16:32:01.796833 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"
[0m16:32:01.797750 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: create or replace   view BAIN_ANALYTICS.DEV.int_position_risk_decomposition
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_position_risk_decomposition.sql
-- Purpose: Break down portfolio risk by position, sector, and asset class with contribution analysis



with pos_returns as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

port_risk_metrics as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        count(distinct position_id) as total_positions,
        count(distinct sector) as sector_count,
        count(distinct asset_class) as asset_class_count
    from pos_returns
    group by 1, 2
)

select
    pr.position_id,
    pr.portfolio_id,
    pr.security_id,
    pr.ticker,
    pr.position_date,
    pr.sector,
    pr.asset_class,
    pr.market_value_usd,
    prm.total_portfolio_value,
    round(pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as position_weight,
    round(100 * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 4) as position_weight_pct,
    pr.daily_pnl,
    pr.daily_return_pct,
    round(pr.daily_return_pct * pr.market_value_usd / nullif(prm.total_portfolio_value, 0), 8) as marginal_contribution_to_return,
    prm.total_positions,
    round(1.0 / nullif(prm.total_positions, 0), 8) as equal_weight_benchmark,
    round((pr.market_value_usd / nullif(prm.total_portfolio_value, 0)) - (1.0 / nullif(prm.total_positions, 0)), 8) as weight_vs_equal_weight,
    case
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.10 then 'CONCENTRATED'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.05 then 'SIGNIFICANT'
        when pr.market_value_usd / nullif(prm.total_portfolio_value, 0) > 0.02 then 'MODERATE'
        else 'SMALL'
    end as position_size_category
from pos_returns pr
join port_risk_metrics prm
    on pr.portfolio_id = prm.portfolio_id
    and pr.position_date = prm.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_position_risk_decomposition"} */;
[0m16:32:01.798750 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:04.243462 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.445 seconds
[0m16:32:04.247645 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_position_risk_decomposition: Close
[0m16:32:05.071121 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212820BF800>]}
[0m16:32:05.073129 [info ] [Thread-4 (]: 17 of 26 OK created sql view model DEV.int_position_risk_decomposition ......... [[32mSUCCESS 1[0m in 3.29s]
[0m16:32:05.074128 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_position_risk_decomposition
[0m16:32:05.074128 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m16:32:05.075134 [info ] [Thread-4 (]: 18 of 26 START sql view model DEV.int_sector_performance_attribution ........... [RUN]
[0m16:32:05.076134 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_position_risk_decomposition, now model.bain_capital_portfolio_analytics.int_sector_performance_attribution)
[0m16:32:05.076134 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m16:32:05.081662 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m16:32:05.083657 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m16:32:05.089669 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m16:32:05.091667 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"
[0m16:32:05.092663 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: create or replace   view BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_performance_attribution.sql
-- Purpose: Analyze sector-level contribution to portfolio returns



with pos_perf as (
    select * from BAIN_ANALYTICS.DEV.int_position_returns
),

sector_metrics as (
    select
        portfolio_id,
        position_date,
        sector,
        count(distinct position_id) as position_count,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        round(sum(market_value_usd * daily_return_pct) / nullif(sum(market_value_usd), 0), 8) as weighted_return_pct
    from pos_perf
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_portfolio_value,
        sum(daily_pnl) as total_portfolio_pnl
    from pos_perf
    group by 1, 2
)

select
    sm.portfolio_id,
    sm.position_date,
    sm.sector,
    sm.position_count,
    sm.sector_value,
    pt.total_portfolio_value,
    round(sm.sector_value / nullif(pt.total_portfolio_value, 0), 8) as sector_weight,
    round(100 * sm.sector_value / nullif(pt.total_portfolio_value, 0), 4) as sector_weight_pct,
    sm.sector_pnl,
    pt.total_portfolio_pnl,
    sm.weighted_return_pct as sector_return_pct,
    round(sm.sector_pnl / nullif(pt.total_portfolio_value, 0), 8) as sector_contribution_to_portfolio,
    round(100 * sm.sector_pnl / nullif(pt.total_portfolio_pnl, 0), 4) as sector_pnl_contribution_pct
from sector_metrics sm
join port_totals pt
    on sm.portfolio_id = pt.portfolio_id
    and sm.position_date = pt.position_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_performance_attribution"} */;
[0m16:32:05.092663 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:08.209947 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.117 seconds
[0m16:32:08.213945 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_performance_attribution: Close
[0m16:32:08.989765 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021281F5FBF0>]}
[0m16:32:08.990780 [info ] [Thread-4 (]: 18 of 26 OK created sql view model DEV.int_sector_performance_attribution ...... [[32mSUCCESS 1[0m in 3.91s]
[0m16:32:08.990780 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_performance_attribution
[0m16:32:08.991774 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m16:32:08.991774 [info ] [Thread-4 (]: 19 of 26 START sql view model DEV.int_sector_rotation_analysis ................. [RUN]
[0m16:32:08.992774 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_performance_attribution, now model.bain_capital_portfolio_analytics.int_sector_rotation_analysis)
[0m16:32:08.992774 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m16:32:08.995783 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m16:32:08.995783 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m16:32:08.998781 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m16:32:09.000778 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"
[0m16:32:09.000778 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: create or replace   view BAIN_ANALYTICS.DEV.int_sector_rotation_analysis
  
  
  
  
  as (
    -- Pipeline C: Intermediate Layer
-- int_sector_rotation_analysis.sql
-- Purpose: Analyze sector allocation changes and rotation patterns



with sector_daily as (
    select
        portfolio_id,
        position_date,
        sector,
        sum(market_value_usd) as sector_value,
        sum(daily_pnl) as sector_pnl,
        count(distinct position_id) as position_count
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2, 3
),

port_totals as (
    select
        portfolio_id,
        position_date,
        sum(market_value_usd) as total_value
    from BAIN_ANALYTICS.DEV.int_position_returns
    group by 1, 2
),

with_weights as (
    select
        sd.portfolio_id,
        sd.position_date,
        sd.sector,
        sd.sector_value,
        sd.position_count,
        round(sd.sector_value / nullif(pt.total_value, 0), 8) as current_weight,
        lag(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as prior_weight,
        lead(sd.sector_value / nullif(pt.total_value, 0)) over (
            partition by sd.portfolio_id, sd.sector
            order by sd.position_date
        ) as next_weight,
        sd.sector_pnl,
        pt.total_value
    from sector_daily sd
    join port_totals pt
        on sd.portfolio_id = pt.portfolio_id
        and sd.position_date = pt.position_date
)

select
    portfolio_id,
    position_date,
    sector,
    sector_value,
    position_count,
    round(100 * current_weight, 4) as current_weight_pct,
    round(100 * prior_weight, 4) as prior_weight_pct,
    round(100 * (current_weight - nullif(prior_weight, 0)), 4) as weight_change_pct,
    sector_pnl,
    round(sector_pnl / nullif(total_value, 0), 8) as sector_contribution,
    case
        when current_weight > nullif(prior_weight, current_weight) then 'INCREASED'
        when current_weight < nullif(prior_weight, current_weight) then 'DECREASED'
        else 'STABLE'
    end as allocation_change,
    case
        when current_weight > 0.25 then 'OVERWEIGHT'
        when current_weight > 0.15 then 'NEUTRAL_HIGH'
        when current_weight > 0.08 then 'NEUTRAL'
        when current_weight > 0.03 then 'NEUTRAL_LOW'
        else 'UNDERWEIGHT'
    end as allocation_stance,
    round(100 * sector_pnl / nullif(sector_value, 0), 4) as sector_return_pct
from with_weights
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.int_sector_rotation_analysis"} */;
[0m16:32:09.001782 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:12.222851 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.221 seconds
[0m16:32:12.226856 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.int_sector_rotation_analysis: Close
[0m16:32:12.972132 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212820D1B20>]}
[0m16:32:12.974130 [info ] [Thread-4 (]: 19 of 26 OK created sql view model DEV.int_sector_rotation_analysis ............ [[32mSUCCESS 1[0m in 3.98s]
[0m16:32:12.975206 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.int_sector_rotation_analysis
[0m16:32:12.976130 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m16:32:12.977130 [info ] [Thread-4 (]: 20 of 26 START sql view model DEV.fact_sector_performance ...................... [RUN]
[0m16:32:12.978127 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.int_sector_rotation_analysis, now model.bain_capital_portfolio_analytics.fact_sector_performance)
[0m16:32:12.979135 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m16:32:12.984129 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m16:32:12.986152 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m16:32:12.990243 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m16:32:12.992164 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_sector_performance"
[0m16:32:12.993167 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: create or replace   view BAIN_ANALYTICS.DEV.fact_sector_performance
  
  
  
  
  as (
    -- Pipeline C: Fact Layer
-- fact_sector_performance.sql



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_quantity,
    sector_weight
from BAIN_ANALYTICS.DEV.int_sector_allocation
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_sector_performance"} */;
[0m16:32:12.993167 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:15.874922 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.881 seconds
[0m16:32:15.878916 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_sector_performance: Close
[0m16:32:16.531845 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002128211AB10>]}
[0m16:32:16.532848 [info ] [Thread-4 (]: 20 of 26 OK created sql view model DEV.fact_sector_performance ................. [[32mSUCCESS 1[0m in 3.55s]
[0m16:32:16.533859 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_sector_performance
[0m16:32:16.534859 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m16:32:16.536862 [info ] [Thread-4 (]: 21 of 26 START sql view model DEV.report_portfolio_risk_analysis ............... [RUN]
[0m16:32:16.537861 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_sector_performance, now model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis)
[0m16:32:16.538931 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m16:32:16.543933 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m16:32:16.545866 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m16:32:16.549518 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m16:32:16.550526 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"
[0m16:32:16.551447 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_portfolio_risk_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_portfolio_risk_analysis.sql
-- Purpose: Comprehensive risk analysis and decomposition



select
    portfolio_id,
    valuation_date,
    nav_usd,
    daily_return_pct,
    volatility_90d_pct,
    avg_daily_return_90d_pct,
    max_daily_return_90d_pct,
    min_daily_return_90d_pct,
    positive_days_90d,
    negative_days_90d,
    win_rate_pct,
    sharpe_ratio_simple,
    return_range_90d,
    risk_classification
from BAIN_ANALYTICS.DEV.int_portfolio_analysis_advanced
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis"} */;
[0m16:32:16.551447 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:20.659983 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.107 seconds
[0m16:32:20.663973 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis: Close
[0m16:32:21.313242 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021282036A50>]}
[0m16:32:21.315256 [info ] [Thread-4 (]: 21 of 26 OK created sql view model DEV.report_portfolio_risk_analysis .......... [[32mSUCCESS 1[0m in 4.78s]
[0m16:32:21.316254 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis
[0m16:32:21.316254 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m16:32:21.317254 [info ] [Thread-4 (]: 22 of 26 START sql table model DEV.fact_portfolio_performance .................. [RUN]
[0m16:32:21.318252 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_portfolio_risk_analysis, now model.bain_capital_portfolio_analytics.fact_portfolio_performance)
[0m16:32:21.319252 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m16:32:21.325327 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m16:32:21.327253 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m16:32:21.349249 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m16:32:21.350250 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.fact_portfolio_performance"
[0m16:32:21.351250 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: create or replace transient table BAIN_ANALYTICS.DEV.fact_portfolio_performance
    
    
    
    as (-- Pipeline C: Fact Layer
-- fact_portfolio_performance.sql
-- Purpose: Portfolio performance fact table - joins multiple intermediates



with returns as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),
risk as (
    select * from BAIN_ANALYTICS.DEV.int_risk_metrics
)

select
    pr.portfolio_id,
    pr.valuation_date,
    pr.nav_usd,
    pr.daily_return_pct,
    pr.valuation_year,
    pr.valuation_month,
    pr.valuation_quarter,
    rm.volatility_90d,
    rm.volatility_1y,
    rm.sharpe_ratio,
    rm.max_drawdown
from returns pr
left join risk rm on pr.portfolio_id = rm.portfolio_id and pr.valuation_date = rm.valuation_date
    )

/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance"} */;
[0m16:32:21.351250 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:25.827101 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.475 seconds
[0m16:32:25.830097 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.fact_portfolio_performance: Close
[0m16:32:26.687345 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002128034B8C0>]}
[0m16:32:26.688353 [info ] [Thread-4 (]: 22 of 26 OK created sql table model DEV.fact_portfolio_performance ............. [[32mSUCCESS 1[0m in 5.37s]
[0m16:32:26.688353 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.fact_portfolio_performance
[0m16:32:26.689359 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m16:32:26.689359 [info ] [Thread-4 (]: 23 of 26 START sql view model DEV.report_executive_summary ..................... [RUN]
[0m16:32:26.690359 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.fact_portfolio_performance, now model.bain_capital_portfolio_analytics.report_executive_summary)
[0m16:32:26.690359 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_executive_summary
[0m16:32:26.693359 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m16:32:26.694358 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_executive_summary
[0m16:32:26.695359 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m16:32:26.697358 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_executive_summary"
[0m16:32:26.697358 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: create or replace   view BAIN_ANALYTICS.DEV.report_executive_summary
  
  
  
  
  as (
    -- Pipeline C: Executive Report
-- report_executive_summary.sql
-- Purpose: High-level portfolio performance and risk metrics for executive review



with port_perf as (
    select * from BAIN_ANALYTICS.DEV.int_portfolio_returns
),

rolling_vol as (
    select * from BAIN_ANALYTICS.DEV.int_rolling_volatility
),

max_drawdown as (
    select
        portfolio_id,
        valuation_date,
        min(drawdown_pct_display) as max_drawdown_pct
    from BAIN_ANALYTICS.DEV.int_portfolio_drawdown
    group by 1, 2
)

select
    pp.portfolio_id,
    pp.valuation_date,
    round(pp.nav_usd, 2) as portfolio_nav_usd,
    round(100 * pp.daily_return_pct, 4) as daily_return_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 29 preceding and current row
    ), 4) as return_30d_pct,
    round(100 * sum(pp.daily_return_pct) over (
        partition by pp.portfolio_id
        order by pp.valuation_date
        rows between 89 preceding and current row
    ), 4) as return_90d_pct,
    round(rv.volatility_30d_pct, 4) as volatility_30d_pct,
    round(rv.volatility_90d_pct, 4) as volatility_90d_pct,
    md.max_drawdown_pct,
    case
        when rv.volatility_90d < 0.01 then 'VERY_LOW'
        when rv.volatility_90d < 0.02 then 'LOW'
        when rv.volatility_90d < 0.03 then 'MODERATE'
        else 'HIGH'
    end as risk_level,
    case
        when pp.daily_return_pct > 0.01 then 'STRONG'
        when pp.daily_return_pct > 0 then 'POSITIVE'
        when pp.daily_return_pct < -0.01 then 'WEAK'
        else 'NEUTRAL'
    end as daily_performance_trend
from port_perf pp
join rolling_vol rv
    on pp.portfolio_id = rv.portfolio_id
    and pp.valuation_date = rv.valuation_date
join max_drawdown md
    on pp.portfolio_id = md.portfolio_id
    and pp.valuation_date = md.valuation_date
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_executive_summary"} */;
[0m16:32:26.698358 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:30.078721 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.380 seconds
[0m16:32:30.082740 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_executive_summary: Close
[0m16:32:30.918901 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212D50C81D0>]}
[0m16:32:33.832501 [debug] [Thread-4 (]: An error was encountered while trying to send an event
[0m16:32:33.833811 [info ] [Thread-4 (]: 23 of 26 OK created sql view model DEV.report_executive_summary ................ [[32mSUCCESS 1[0m in 4.23s]
[0m16:32:33.833811 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_executive_summary
[0m16:32:33.834816 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m16:32:33.834816 [info ] [Thread-4 (]: 24 of 26 START sql view model DEV.report_performance_drivers ................... [RUN]
[0m16:32:33.834816 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_executive_summary, now model.bain_capital_portfolio_analytics.report_performance_drivers)
[0m16:32:33.835816 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m16:32:33.837816 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m16:32:33.838815 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m16:32:33.840817 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m16:32:33.841816 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_performance_drivers"
[0m16:32:33.841816 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: create or replace   view BAIN_ANALYTICS.DEV.report_performance_drivers
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_performance_drivers.sql
-- Purpose: Performance driver analysis and attribution by position and sector



select
    position_id,
    portfolio_id,
    ticker,
    security_name,
    sector,
    asset_class,
    position_date,
    market_value_usd,
    daily_pnl,
    daily_return_pct,
    position_weight,
    pnl_contribution_bps,
    weighted_return_contribution,
    performance_category,
    pnl_impact_rank,
    cumulative_pnl_contribution
from BAIN_ANALYTICS.DEV.int_performance_attribution_detailed
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_performance_drivers"} */;
[0m16:32:33.841816 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:37.501511 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 3.660 seconds
[0m16:32:37.506526 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_performance_drivers: Close
[0m16:32:38.635826 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021281FA1730>]}
[0m16:32:38.636826 [info ] [Thread-4 (]: 24 of 26 OK created sql view model DEV.report_performance_drivers .............. [[32mSUCCESS 1[0m in 4.80s]
[0m16:32:38.638825 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_performance_drivers
[0m16:32:38.639826 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m16:32:38.639826 [info ] [Thread-4 (]: 25 of 26 START sql view model DEV.report_position_attribution .................. [RUN]
[0m16:32:38.640826 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_performance_drivers, now model.bain_capital_portfolio_analytics.report_position_attribution)
[0m16:32:38.641826 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_position_attribution
[0m16:32:38.646896 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m16:32:38.648504 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_position_attribution
[0m16:32:38.655629 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m16:32:38.657628 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_position_attribution"
[0m16:32:38.657628 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: create or replace   view BAIN_ANALYTICS.DEV.report_position_attribution
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_position_attribution.sql
-- Purpose: Position-level contribution analysis report



select
    position_id,
    portfolio_id,
    security_id,
    position_date,
    ticker,
    security_name,
    asset_class,
    sector,
    market_value_usd,
    total_portfolio_value,
    position_weight_pct,
    daily_pnl,
    daily_return_pct,
    position_contribution_bps
from BAIN_ANALYTICS.DEV.int_position_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_position_attribution"} */;
[0m16:32:38.658633 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:41.625172 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.966 seconds
[0m16:32:41.627176 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_position_attribution: Close
[0m16:32:42.610197 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021281F9DAF0>]}
[0m16:32:42.612338 [info ] [Thread-4 (]: 25 of 26 OK created sql view model DEV.report_position_attribution ............. [[32mSUCCESS 1[0m in 3.97s]
[0m16:32:42.613212 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_position_attribution
[0m16:32:42.614213 [debug] [Thread-4 (]: Began running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m16:32:42.615220 [info ] [Thread-4 (]: 26 of 26 START sql view model DEV.report_sector_analysis ....................... [RUN]
[0m16:32:42.616225 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.bain_capital_portfolio_analytics.report_position_attribution, now model.bain_capital_portfolio_analytics.report_sector_analysis)
[0m16:32:42.617215 [debug] [Thread-4 (]: Began compiling node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m16:32:42.622290 [debug] [Thread-4 (]: Writing injected SQL for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m16:32:42.624627 [debug] [Thread-4 (]: Began executing node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m16:32:42.629625 [debug] [Thread-4 (]: Writing runtime sql for node "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m16:32:42.632683 [debug] [Thread-4 (]: Using snowflake connection "model.bain_capital_portfolio_analytics.report_sector_analysis"
[0m16:32:42.632683 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: create or replace   view BAIN_ANALYTICS.DEV.report_sector_analysis
  
  
  
  
  as (
    -- Pipeline C: Report Layer
-- report_sector_analysis.sql
-- Purpose: Sector-level performance and contribution analysis



select
    portfolio_id,
    position_date,
    sector,
    position_count,
    sector_value,
    total_portfolio_value,
    sector_weight_pct,
    sector_pnl,
    sector_return_pct,
    sector_contribution_to_portfolio,
    sector_pnl_contribution_pct
from BAIN_ANALYTICS.DEV.int_sector_performance_attribution
  )
/* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bain_capital", "target_name": "dev", "node_id": "model.bain_capital_portfolio_analytics.report_sector_analysis"} */;
[0m16:32:42.633725 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:32:45.119078 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.485 seconds
[0m16:32:45.124075 [debug] [Thread-4 (]: On model.bain_capital_portfolio_analytics.report_sector_analysis: Close
[0m16:32:45.887586 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7436eb68-5f80-427c-9549-927940ba1cdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021281F9C050>]}
[0m16:32:45.887586 [info ] [Thread-4 (]: 26 of 26 OK created sql view model DEV.report_sector_analysis .................. [[32mSUCCESS 1[0m in 3.27s]
[0m16:32:45.888685 [debug] [Thread-4 (]: Finished running node model.bain_capital_portfolio_analytics.report_sector_analysis
[0m16:32:45.889690 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:32:45.889690 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS' was properly closed.
[0m16:32:45.889690 [debug] [MainThread]: Connection 'list_BAIN_ANALYTICS_DEV' was properly closed.
[0m16:32:45.889690 [debug] [MainThread]: Connection 'model.bain_capital_portfolio_analytics.report_sector_analysis' was properly closed.
[0m16:32:45.891059 [info ] [MainThread]: 
[0m16:32:45.891059 [info ] [MainThread]: Finished running 1 table model, 25 view models in 0 hours 1 minutes and 57.05 seconds (117.05s).
[0m16:32:45.893481 [debug] [MainThread]: Command end result
[0m16:32:45.920488 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\BiaDigi\sample-dbt-project\target\manifest.json
[0m16:32:45.923488 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\BiaDigi\sample-dbt-project\target\semantic_manifest.json
[0m16:32:45.927487 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\BiaDigi\sample-dbt-project\target\run_results.json
[0m16:32:45.927487 [info ] [MainThread]: 
[0m16:32:45.928487 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:32:45.928487 [info ] [MainThread]: 
[0m16:32:45.928487 [info ] [MainThread]: Done. PASS=26 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=26
[0m16:32:45.928487 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingPlusPrefixDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m16:32:45.929632 [debug] [MainThread]: Command `dbt build` succeeded at 16:32:45.929632 after 122.04 seconds
[0m16:32:45.929632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212D3BC6030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212D3810DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212D3810EF0>]}
[0m16:32:45.929632 [debug] [MainThread]: Flushing usage events
[0m16:32:47.423565 [debug] [MainThread]: An error was encountered while trying to flush usage events
